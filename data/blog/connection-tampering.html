<div class="mb2 gray5">19 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/25gh0YtlMKeoZPrXPocdbF/a037644634dd8509c8e7d36522b6689c/2544-1-Hero.png" alt="">
<div class="post-content lh-copy gray1">
	<p>Have you ever made a phone call, only to have the call cut as soon as it is answered, with no obvious reason or explanation? This analogy is the starting point for understanding connection tampering on the Internet and its impact.&nbsp;</p>
	<p>We have <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>found</u></a> that 20 percent of all Internet connections are abruptly closed before any useful data can be exchanged. Essentially, every fifth call is cut before being used. As with a phone call, it can be challenging for one or both parties to know what happened. Was it a faulty connection? Did the person on the other end of the line hang up? Did a third party intervene to stop the call?&nbsp;&nbsp;</p>
	<p>On the Internet, Cloudflare is in a unique position to help figure out when a third party may have played a role. Our global network allows us to identify patterns that suggest that an external party may have intentionally tampered with a connection to prevent content from being accessed. Although they are often hard to decipher, the ways connections are abruptly closed give clues to what might have happened. Sources of tampering generally do not try to hide their actions, which leaves hints of their existence that we can use to identify detectable ‚Äòsignatures‚Äô in the connection protocol. As we explain below, there are other protocol features that are less likely to be spoofed and that point to third party actions. We can use these hints to build signature patterns of connection tampering that can be recognized.</p>
	<p>To be clear, there are many reasons a third party might tamper with a connection. Enterprises may tamper with outbound connections from their networks to prevent users from interacting with spam or phishing sites. ISPs may use connection tampering to enforce court or regulatory orders that demand website blocking to address copyright infringement or for other legal purposes. Governments may mandate large-scale censorship and information control.&nbsp;</p>
	<p>Despite the fact that everyone knows it happens, no other large operation has previously looked at the use of connection tampering at scale and across jurisdictions. We think that creates a notable gap in understanding what is happening in the Internet ecosystem, and that shedding light on these practices is important for transparency and the long-term health of the Internet. So today, we‚Äôre proud to share a view of global connection tampering practices.</p>
	<p>The full technical details were recently peer-reviewed and published in ‚Äú<a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>Global, Passive Detection of Connection Tampering</u></a>‚Äù at ACM SIGCOMM, with its <a href="https://youtu.be/RD73IgzQMFo?si=OWvNnlNNLalbhygV&amp;t=2984"><u>public presentation</u></a>. We‚Äôre also announcing a new <a href="https://radar.cloudflare.com/security-and-attacks#tcp-resets-and-timeouts"><u>dashboard</u></a> and <a href="https://developers.cloudflare.com/api/operations/radar-get-connection-tampering-summary"><u>API</u></a> on Cloudflare Radar that shows a near real-time view of specific connection timeout and reset events ‚Äì the two mechanisms dominant in tampering experienced by users<b> </b>connecting to Cloudflare‚Äôs network globally.</p>
	<p>To better understand our perspective, it helps to understand the nature of connection tampering and reasons we‚Äôre talking about it.</p>
	<h2>Global insights for a global audience</h2>
	<p>Evidence of connection tampering is visible in networks all around the world. We were initially shocked that, globally, about 20% of all connections to Cloudflare close unexpectedly before any useful data exchange occurs ‚Äî consistent with connection tampering. Here is a snapshot of these anomalous connections seen by Cloudflare that, as of today, <a href="https://blog.cloudflare.com/tcp-resets-timeouts"><u>we‚Äôre sharing on Radar</u></a>.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1nPz5Ulu2YS7eV6Hpmniwg/ddc879a6068d720576f5431dc9455606/2544-2.png" alt="2544-2" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><i><sub>via </sub></i><a href="https://radar.cloudflare.com/security-and-attacks?dateStart=2024-07-28&amp;dateEnd=2024-08-26#tcp-resets-and-timeouts"><i><sub>Cloudflare Radar</sub></i></a></p>
	<p>It‚Äôs not all tampering, but some of it clearly is, as we describe in more detail below. The challenge is filtering through the noise to determine which anomalous connections can confidently be attributed to tampering.</p>
	<h2>Macro-level analysis and validation</h2>
	<p>In <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>our work</u></a> we identified 19 patterns of anomalous connections as being candidate signatures for connection tampering. From those, we found that 14 had been previously reported by active ‚Äúon the ground‚Äù measurement efforts, which presented an opportunity for validation at macro-level: If we observe our tampering signatures from Cloudflare‚Äôs network in the same places others observe them from the ground, we could have greater confidence that the signatures capture true cases of connection tampering when observed elsewhere, where there has been no prior reporting. To mitigate the risk of confirmation bias from looking where tampering is known to exist, we decided to look everywhere at the same time.</p>
	<p>Taking that approach, the figure below, taken from our peer-review <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>study</u></a>, is a visual side-by-side comparison of each of the 19 signatures. The data is taken from a two-week interval starting January 26, 2023. Within each signature column is the proportion of matching connections broken down by the country where the connection originated. For example, the column third from the right labeled with ‚ü®PSH ‚Üí RST;RST<sub>0</sub>‚ü© indicates that we almost exclusively observed that signature on connections from China. Overall, what we find is a mirror of known cases from public and prior reports, which is an indication that our methodology works.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/4w1iJCVyRwZdgblT7uk2tZ/5fe4d154b6268b17af840b7952b51143/2544-3.png" alt="2544-3" class="kg-image" width="1999" height="1028" loading="lazy">

	</figure>
	<p><i><sub></sub></i><a href="https://research.cloudflare.com/publications/SundaraRaman2023"><i><sub><u>Figure 1</u></sub></i></a><i><sub>: Signature matching across countries: Each column is the total global number of connections matching a specific signature. Within each column is the proportion of connections initiations from individual countries matching that signature.</sub></i></p>
	<p>Interestingly, by honing in on prevalence, and setting aside the raw number of signature matches, interesting patterns emerge. As a result of this data-driven perspective, unexpected macro-insights also emerge. If we focus on the three most populous countries in the world ranked by <a href="https://worldpopulationreview.com/country-rankings/internet-users-by-country"><u>number of Internet users</u></a>, connections from China contribute a substantial portion of matches across no fewer than 9 of the signatures. This is perhaps unsurprising, but reinforces prior studies that find evidence of the Great Firewall (GFW) being made of many <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>different deployments and implementations</u></a> of blocking mandates. Next, matches on connections from India also contribute substantially to nine 9 different signatures, five of which are in common with signatures where China matches feature highly. Looking at the third most populous, the United States, a visible if not substantial proportion of matches appear on all but two of the signatures.</p>
	<p>A snapshot of signature distributions per-country, also taken from the peer-review <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>study</u></a>, appears below for a select set of countries. The global distribution is included for comparison. The dark gray portions marked ‚ü®SYN ‚Üí ‚àÖ‚ü© are included for completeness, but have more non-tampering alternative explanations than the others (for example, as result of a low-rate <a href="https://blog.cloudflare.com/the-rise-of-multivector-amplifications"><u>SYN flood</u></a>).</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/57Dip4I995kVVjXAhQxMrH/1a43c41084b8cb7d517d12ae995cbe8c/2544-4.png" alt="2544-4" class="kg-image" width="1999" height="690" loading="lazy">

	</figure>
	<p><a href="https://research.cloudflare.com/publications/SundaraRaman2023"><sub><i><u>Figure 4</u></i></sub></a><sub><i>: Signature distribution per country: The percentage of connections originating from select countries (and globally) that match a particular signature, or are not tampered with.</i></sub></p>
	<p>From this perspective we again observe patterns that match prior studies. We focus first on rates above the global average, and ignore the noisiest signature ‚ü®SYN ‚Üí ‚àÖ‚ü© in medium-gray; there are simply too many other explanations for a signature match at this earliest possible stage. Among all connections from Turkmenistan (TM), Russia (RU), Iran (IR), and China (CN), roughly 80%, 30%, 40%, and 30%, respectively, of those connections match a tampering signature. The data also reveals high signature match rates where no prior reports exist. For example, connections from Peru (PE) and Mexico (MX), match roughly 50% and 25%, respectively; <a href="https://blog.cloudflare.com/tcp-resets-timeouts"><u>analysis of individual networks</u></a> in these countries suggests a likely explanation is zero-rating in mobile and cellular networks, where an ISP allows access to certain resources (but not others) at no cost. If we look below the global average, Great Britain (GB), the United States (US), and Germany (DE), each match a signature on about 10% of connections.</p>
	<p>The data makes clear that connection tampering is widespread, and close to many users, if not most. In many ways, it‚Äôs closer than most know. To explain why, we explain connection tampering with a very familiar communication tool, the telephone.</p>
	<h2>Explaining tampering with telephone calls</h2>
	<p>Connection tampering is a way for a third party to block access to particular content. However, it‚Äôs not enough for the third party to know the <i>type</i> of content it wants to block. The third party can only block an identity by name.&nbsp;</p>
	<p>Ultimately, connection tampering is possible only by accident ‚Äì an unintended side effect of protocol design. On the Internet, the most common identity is the domain name. In a communication on the Internet, the domain name is most often transmitted in the ‚Äú<a href="https://www.cloudflare.com/en-gb/learning/ssl/what-is-sni"><u>server name indication (SNI)</u></a>‚Äù field in TLS ‚Äì exposed in cleartext for all to see.</p>
	<p>To understand why this matters, it helps to understand what connection tampering looks like in human-to-human communications without the Internet. The Internet itself looks and operates much like the postal system, which relies only on addresses and never on names. However, the way most people use the Internet is much more like the ‚Äú<a href="https://en.wikipedia.org/wiki/Plain_old_telephone_service"><u>plain old telephone system</u></a>,‚Äù which <i>requires</i> names to succeed.</p>
	<p>In the telephone system, a person first dials a phone number, <i>not</i> a name. The call is <code>connected</code> and usable only after the other side answers, and the caller hears a voice.&nbsp; The caller asks for a name only <i>after</i> the call is connected. The call manifests in the system as energy signals that do not identify the communicating parties. Finally, after the call ends, a new call is required to communicate again.</p>
	<p>On the Internet, a client such as a browser ‚Äúestablishes a connection.‚Äù Much like a telephone caller, it initiates a connection request to a server‚Äôs <code>number</code>, which is an IP address. The longest-standing ‚Äúconnection-oriented‚Äù protocol to connect two devices is called the <a href="https://cloudflare.tv/shows/this-week-in-net/this-week-in-net-50th-anniversary-of-the-tcp-paper/oZKEA4v4"><u>Transmission Control Protocol</u></a>, or TCP. The domain name is transmitted in isolation from the connection establishment, much like asking for a name once the phone is answered. The connections are ‚Äúlogical‚Äù identified by metadata that does not identify communicating parties. Finally, a new connection is established with each new visit to a website.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1BzA3XvqopuaP1WSg0rK6X/ea247bded376cf834656c56933c35cff/2544-5.png" alt="2544-5" class="kg-image" width="1746" height="794" loading="lazy">
	</figure>
	<p><sub><i>Comparison between a TCP connection and a telephone call</i></sub></p>
	<p>What happens if a telephone company is required to prevent a call to some party? One option is to modify or manipulate phone directories so a caller can‚Äôt get the phone number they need to dial the phone that makes the call; this is the essence of <a href="https://www.cloudflare.com/en-gb/learning/access-management/what-is-dns-filtering"><u>DNS filtering</u></a>. A second option is to block all calls to the phone number, but this inadvertently affects others, just like <a href="https://blog.cloudflare.com/consequences-of-ip-blocking"><u>IP blocking</u></a> does.</p>
	<p>Once a phone call is initiated, the only way for the telephone company to know <i>who</i> is being called is to listen in on the call and wait for the caller to say, ‚Äúis so-and-so there?‚Äù or ‚Äúcan I speak with so-and-so?‚Äù Mobile and cellular calls are no exception. The idea that the number we call <i>is</i> the person who will answer is just an expectation ‚Äì it has never been the reality. For example, a parent could get a number to give to their child, or a taxi company could leave the mobile phone with whomever is on-shift at the time. As a result, the telephone company <i>must listen in</i>. Once it hears a certain name it can cut the call; neither side would have any idea what has happened ‚Äì this is the very definition of connection tampering on the Internet.&nbsp;</p>
	<p>For the purpose of establishing a communication channel, phone calls and TCP connections are at least comparable, and arguably exactly the same ‚Äì not least because the domain name is transmitted separately from establishing a connection.</p>
	<p>Similarly, on the Internet, the only way for a third party to know the intended recipient of a connection is to ‚Äúlook inside‚Äù of packets as they are transmitted. Where a telephone company would have to listen for a name, a third party on the Internet waits to see something it does not like, most often a forbidden name. Recall from above the unintended side-effect of the protocol: the name is visible in the SNI, which is required to help encrypt the data communication. When that happens, the third party causes one or both devices to close the connection by either dropping messages or injecting specially-crafted messages that cause the communicating parties to abort the connection.</p>
	<p>The mechanisms to trigger tampering begin with <a href="https://www.cloudflare.com/learning/security/what-is-next-generation-firewall-ngfw"><u>deep packet inspection (DPI)</u></a>, which means looking into the data portions that lie beyond the address and other metadata belonging to the connection. It‚Äôs safe to say that this functionality does not come for free; whether it‚Äôs an ISP‚Äôs router or a parental proxy, DPI is an expensive operation that gets more expensive at large scale or high speed.&nbsp;</p>
	<p>One last point worth mentioning is that weaknesses in telephone tampering similarly appear in connection tampering. For example, the sound of Jean and Gene are indistinguishable to any ear, despite being different names. Similarly, tampering with connections to Twitter‚Äôs short-form name ‚Äút.co‚Äù would also affect ‚Äúmicrosoft.com‚Äù ‚Äì and <a href="https://en.wikipedia.org/wiki/Internet_censorship_in_Russia#Deep_packet_inspection"><u>has</u></a>.</p>
	<h2>A live view of tampering during Mahsa Amini protests</h2>
	<p>Before we delve deeply into the technical, there is one more motivation that is personal to many at Cloudflare. Transparency is important and the reason we started this work, but it was after seeing the data <i>during</i> the Mahsa Amini protests in Iran in 2022 that we committed internally to share the data on Radar.&nbsp;</p>
	<p>The figure below is for connections from Iran during 17 days overlapping the protests. The plot-lines track individual signals of anomalous connections, including signatures of <a href="https://blog.cloudflare.com/passive-detection-of-connection-tampering"><u>different types</u></a> of connection tampering. This data pre-dates the Radar service, so we have elected to share this representation from the <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>peer-reviewed paper</u></a>. It was also the first visual example of the value of the data if it could be shared via Radar.&nbsp;
	</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/3IKNhC2gLo7CeUQclssiuM/0cf30c0b2eef1fd7008276fcb4be9fd2/2544-6.png" alt="2544-6" class="kg-image" width="726" height="620" loading="lazy">
	</figure>
	<p><sub><i></i></sub><a href="https://research.cloudflare.com/publications/SundaraRaman2023"><sub><i><u>Figure 8</u></i></sub></a><sub><i>: Signature match rates longitudinally in Iran during a period of nation-wide protests. (ùë•-axis is local time.)</i></sub></p>
	<p></p>
	<p>From the data there are two observations that stick out. First is the way that the lines appear stable before the protests, then increase after the protests began. Second is the variation between the lines over time, in particular the lines in light gray, dark purple, and dark green. Recall that each line is a different tampering signature, so the variation between lines suggests changes in the underlying causes ‚Äì either the mechanisms at work, or the traffic that invokes them.</p>
	<p>We emphasize that a signature match, alone, does not in itself mean there is tampering. However, in the case of Iran in 2022 there were public reports of blocking of various forms. The methods in use at the time, specifically <a href="https://www.cloudflare.com/en-gb/learning/ssl/what-is-sni"><u>Server Name Indication (SNI)</u></a>-based blocking of access to content, had also previously been <a href="https://ooni.org/post/2020-iran-sni-blocking"><u>well-documented</u></a>, and matched with our observations represented by the figure above.</p>
	<p>What about today? Below we see the Radar view of the twelve months from August 2023 to August 2024. Each color represents a different stage of the connection where tampering might happen. In the previous 12 months, TCP connection anomalies in Iran are lower than the <a href="https://radar.cloudflare.com/security-and-attacks?dateStart=2024-08-01&amp;dateEnd=2024-08-08"><u>worldwide averages</u></a>, overall, but appear significantly higher in the portion of anomalies represented by the light-blue region. This ‚ÄúPost ACK‚Äù phase of communication is often associated with SNI-based blocking. (In the graph above, the relevant signatures are represented by the dark purple and dark green lines.) Alongside, the changing proportions of the different plot-lines since mid-December 2023 suggest that techniques have been changing over time.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/3qhesraWkFdNPbWgx2x0xX/e980324e5edd412d44e1bd83afae943b/2544-7.png" alt="2544-7" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><i><sub>via </sub></i><a href="https://radar.cloudflare.com/security-and-attacks/ir?dateStart=2023-08-26&amp;dateEnd=2024-08-26#tcp-resets-and-timeouts"><i><sub>Cloudflare Radar</sub></i></a></p>
	<h2>The importance of an open network measurement community</h2>
	<p>As a testament to the importance of open measurement and research communities, this work very literally ‚Äú<a href="https://en.wikipedia.org/wiki/Standing_on_the_shoulders_of_giants">builds on the shoulders of giants</a>.‚Äù It was produced in collaboration with researchers at the <a href="https://www.cs.umd.edu">University of Maryland</a>, <a href="https://www.epfl.ch">√âcole Polytechnique F√©d√©rale de Lausanne</a>, and the <a href="https://cse.engin.umich.edu">University of Michigan</a>, but does not exist in isolation. There have been extensive efforts to measure connection tampering, most of which comes from the censorship measurement community. The bulk of that work consists of <i>active</i> measurements, in which researchers craft and transmit probes in or along networks and regions to identify blocking behavior. Unsurprisingly, active measurement has both strengths and weaknesses, as described in <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>Section 2</u></a> in the paper).&nbsp;</p>
	<p>The counterpart to active measurement, and the focus of our project, is <i>passive</i> measurement, which takes an ‚Äúobserve and do nothing‚Äù approach. Passive measurement comes with its own strengths and weaknesses but, crucially, it relies on having a good vantage point such as a large network operator. Each of active and passive measurements are most effective when working in conjunction, in this case helping to paint a more complete picture of the impact of connection tampering on users.</p>
	<p>Most importantly, when embarking upon any type of measurement, great care must be taken to understand and <a href="https://cacm.acm.org/magazines/2016/10/207765-ethical-considerations-in-network-measurement-papers/fulltext"><u>evaluate the safety of the measurement</u></a> since the risk imposed on people and networks are often indirect, or hidden from view.</p>
	<h2>Limitations of our data</h2>
	<p>We have no doubt about the importance of being transparent with connection tampering, but we also need to be explicit about the limits on the insights that can be gleaned from the data. As passive observers of connections to the Cloudflare network ‚Äì and only the Cloudflare network ‚Äì we are only able to see or infer the following:</p>
	<ol>
		<li>
			<p><b>Signs of connection tampering, but not where it happened.</b> Any software or device between the client‚Äôs application and the server systems can tamper with a connection. The list ranges from purpose-built systems, to firewalls in the enterprise or home broadband router, and protection software installed on home or school computers. <i>All we can infer is where the connection started</i> (albeit at the limits of geolocation inaccuracies inherent in the Internet‚Äôs design)<i>.</i></p>
		</li>
		<li>
			<p><b>(Often, but not always) What triggered the tampering, but not why.</b> Typically, tampering systems are triggered by domain names, keywords, or regular expressions. With enough repetition, and manual inspection, it may be possible to identify the <i>likely</i> cause of tampering, but not the reasons. Many tampering system designs are prone to unintended consequences, among them the <a href="https://en.wikipedia.org/wiki/Internet_censorship_in_Russia#Deep_packet_inspection"><u>t.co</u></a> example mentioned above.</p>
		</li>
		<li>
			<p><b>Who and what </b><b><i>is</i></b><b> affected, but not who or what </b><b><i>could</i></b><b> be affected.</b> As passive observers, there are limits on the kinds of inferences we can make. For example, observable tampering on 1000 out of 1001 connections to <code>example.com</code> suggests that tampering is likely on the next connection attempt. However, that says nothing about connections to <code>another-example.com</code>.&nbsp;</p>
		</li>
	</ol>
	<h2>Data, data, data: Extracting signals from the noise</h2>
	<p>If you just want to get and use the data on Radar, see our ‚Äú<a href="https://blog.cloudflare.com/tcp-resets-timeouts"><u>how to</u></a>‚Äù guide. Otherwise, let‚Äôs understand the data itself.</p>
	<p>The focus of this work is <a href="https://www.cloudflare.com/learning/ddos/glossary/tcp-ip"><u>TCP</u></a>. In our data there are two mechanisms available to a third-party to force a connection to close: <a href="https://en.wikipedia.org/wiki/Packet_drop_attack"><u>dropping packets</u></a> to induce timeouts or <a href="https://en.wikipedia.org/wiki/TCP_reset_attack#TCP_resets"><u>injecting forged TCP RST packets</u></a>, each with various deployment choices. Individual tampering signatures may be reflections of those choices. For comparison, a graceful TCP close is initiated with a FIN packet.&nbsp;</p>
	<h3>Connection tampering signatures</h3>
	<p>Our detection mechanism evaluates sets of packets in a connection against a set of <i>signatures</i> for connection tampering. The signatures are hand-crafted from signatures identified in prior work, and by analyzing samples of connections to Cloudflare‚Äôs network that we classify as <i>anomalous </i>‚Äì connections that close early, and ungracefully by way of a RST packet or timeout within the first 10 packets from the client. We analyzed the samples and found that 19 patterns accounted for 86.9% of all possibly tampered connections in the samples, shown in the table below.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/5LssSxT9SkDpXzMXtPmtZ1/d84fc29e5e5972d5837b8affeb72a03a/2544-8.png" alt="2544-8" class="kg-image" width="1888" height="844" loading="lazy">
	</figure>
	<p><sub></sub><a href="https://research.cloudflare.com/publications/SundaraRaman2023"><sub><u>Table 1</u></sub></a><sub>: The comprehensive set of tampering signatures we identify through global passive measurements.</sub></p>
	<p></p>
	<p>To help reason about tampering, we also classed the 19 signatures above according to the stage of the connection lifetime in which they appear. Each stage implies something about the middlebox, as described below alongside corresponding sequence diagrams:</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/49GKWrmtfdg9Xpk0K2RiGJ/0e4e87314e21392ef31c00968013b666/Screenshot_2024-09-04_at_2.57.52_PM.png" alt="2544-9" class="kg-image" width="1071" height="482" loading="lazy">
	</figure>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6xZbuENcYfkucNmVUJmwQv/d20ec4202b8b1365bb394f9a9a56805a/Screenshot_2024-09-04_at_2.58.00_PM.png" alt="2544-10" class="kg-image" width="1057" height="621" loading="lazy">
	</figure>
	<p></p>
	<ul>
		<li>
			<p><b>(a) Post-SYN (mid-handshake)</b>: Tampering is likely triggered by the destination IP address because the middlebox has likely not seen application data, which is typically transmitted after the handshake completes.</p>
		</li>
		<li>
			<p><b>(b) Post-ACK (immediately after handshake)</b>: The connection is established and immediately forced to close before seeing any data. It is possible, even likely, that the middlebox has likely seen a data packet; for example, the host header in HTTP or SNI field in TLS.&nbsp;</p>
		</li>
		<li>
			<p><b>(c) Post-PSH (after first data packet)</b>: The middlebox has definitely seen the first data packet because the server has received it. The middlebox may have been waiting for a packet with a PSH flag, typically set to indicate data in the packet should be delivered to the application on receipt, without delay. The likely middlebox is likely a <a href="https://en.wikipedia.org/wiki/Man-on-the-side_attack"><u>monster-on-the-side</u></a> because it permits the offending packet to reach the destination.</p>
		</li>
		<li>
			<p><b>(d) Later-in-flow (after multiple data packets)</b>: Tampering at later stages in the connection (not immediately after the first data packet, but still within the first 10 packets). The prevalence of encrypted data in TLS makes this the least likely stage for tampering to occur. The likely triggers are keywords appearing in cleartext later in (HTTP) connections, or by the likes of enterprise proxies and parental protection software that has visibility into encrypted traffic and can reset connections when certain keywords are encountered.&nbsp;</p>
		</li>
	</ul>
	<h3>Accounting for alternative explanations</h3>
	<p>How can we be confident that the signatures above detect middlebox tampering, and not just atypical client behavior? One of the challenges of passive measurement is that we do not have full visibility into the clients connecting to our network, so absolute positives are hard if not impossible. Instead, we look for strong positive evidence of tampering, that must first begin by identifying <b>false positives</b>.&nbsp;</p>
	<p>We are aware of the following sources of false positives that can be hard to disambiguate from true sources of tampering. <i>All but the last occur in the first two stages</i> of the connection, before data packets are received.&nbsp;</p>
	<ul>
		<li>
			<p><b>Scanners</b> are client-side applications that probe servers to elicit responses. Some scanner software uses fixed bits in the header to self-identify, which helps us filter. For example, we found that <a href="https://zmap.io"><u>Zmap</u></a> accounts for approximately 1% of all <code>‚ü®SYN ‚Üí RST‚ü©</code> signature matches.</p>
		</li>
		<li>
			<p><b>SYN flood attacks</b> are another likely source of false positives, especially for signatures in the Post-SYN connection stage like the <code>‚ü®SYN ‚Üí ‚àÖ‚ü©</code> and <code>‚ü®SYN ‚Üí RST‚ü©</code> signatures. These are less likely to appear in our dataset collection, which happens <a href="https://www.cloudflare.com/learning/ddos/syn-flood-ddos-attack/https://www.cloudflare.com/learning/ddos/syn-flood-ddos-attack"><u>after the DDoS protection</u></a> systems.</p>
		</li>
		<li>
			<p><b>Happy Eyeballs</b> is a <a href="https://datatracker.ietf.org/doc/html/rfc8305"><u>common technique</u></a> used by dual-stack clients in which the client initiates an IPv6 connection to the server and, with some delay to favor IPv6, also makes an IPv4 connection. The client keeps the connection that succeeds first and drops the other. Clients that cease transmission or close the connection with a RST instead of a FIN would show up in the data, matching the <code>‚ü®SYN ‚Üí RST‚ü©</code> signature.&nbsp;</p>
		</li>
		<li>
			<p><b>Browser-triggered RSTs</b> may appear at any stage of the connection, but especially for signatures that match later in a connection (after multiple data packets). It might be triggered, for example, by a user closing a browser tab. Unlike targeted tampering, however, RSTs originating from browsers are unlikely to be biased towards specific services or websites.&nbsp;</p>
		</li>
	</ul>
	<p>How can we separate legitimate client-initiated false positives from third-party tampering? We seek an evidence-based approach to distinguish tampering signatures from other signals within the dataset. For this we turn to individual bits in the packet headers.</p>
	<h3>Signature validation ‚Äì letting the data speak</h3>
	<p>Signature matches in isolation are insufficient to make good determinations. Alongside, we can find further supporting evidence of their accuracy by examining connections in aggregate ‚Äì if the cause is tampering, and tampering is targeted, then there must be other patterns or markers in common. For example, we expect browser behavior to appear worldwide; however, as we showed above, signatures that match on connections in only some places or some time intervals stick out.&nbsp;</p>
	<p>Similarly, we expect certain characteristics in contiguous packets within a connection to also stick out, and indeed they do, namely in the <a href="https://datatracker.ietf.org/doc/html/rfc6864"><u>IP-ID</u></a> and <a href="https://www.cloudflare.com/learning/cdn/glossary/time-to-live-ttl"><u>TTL</u></a> fields in the IP header.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/7CVNobND5JzSYY4rszgem9/36d5500f0ff8c41c56c1def969f7d571/Screenshot_2024-09-04_at_2.57.36_PM.png" alt="2544-11" class="kg-image" width="1191" height="571" loading="lazy">
	</figure>
	<p><b>The IP-ID (IP identification) field</b> in the IPv4 packet header is usually a fixed per-connection value, often incremented by the client for each subsequent packet it sends. In other words, we expect the change in IP-ID value in subsequent packets sent from the same client to be small. Thus, large changes in IP-ID value between subsequent packets are unexpected in normal connections, and could be used as an indicator of packet injection. This is exactly what we see in the figure above, marked (a), for a select set of signatures.</p>
	<p><b>The Time-to-Live (TTL) field </b>offers another clue for detecting injected packets. Here, too, most client implementations use the same <a href="https://www.cloudflare.com/learning/cdn/glossary/time-to-live-ttl"><u>TTL</u></a> for each packet sent on a connection, usually set initially to either 64 or 128 and decremented by every router along the packet‚Äôs route. If a RST packet does not have the same TTL as other packets in a connection, it‚Äôs a strong signal that it was injected. Looking at the figure above, marked (b), we can see marked differences in TTLs, indicating the presence of a third party.&nbsp;</p>
	<p>We strongly encourage readers to read the <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>underlying details</u></a> of how and why these make sense.&nbsp; Connections with high maximum IP-ID and TTL differences give positive evidence for traffic tampering, but the <i>absence</i> of these signals does not necessarily mean that tampering did not occur, as some middleboxes are known to <a href="https://censoredplanet.org/assets/censorship-devices.pdf"><u>copy IP header values</u></a> including the IP-ID and TTL from the original packets in the connection. Our interest is in responsibly ensuring our dataset has indicative value.</p>
	<p><b>There is one last caveat: </b>While our tampering signatures capture many forms of tampering, there is still potential for<b> false negatives</b> for connections that <i>were</i> tampered with but escaped our detection. Some examples are connections terminated after the first 10 packets (since we don‚Äôt sample that far), FIN injection (a less common alternative to RST injection), or connections where all packets are dropped before reaching Cloudflare‚Äôs servers. Our signatures also do not apply to <a href="https://www.cloudflare.com/learning/ddos/glossary/user-datagram-protocol-udp"><u>UDP-based protocols</u></a> such as QUIC. We hope to expand the scope of our connection tampering signatures in the future.</p>
	<h2>Case studies</h2>
	<p>To get a sense of how this looks on the Cloudflare network, below we provide further examples of TCP connection anomalies that are consistent with <a href="https://ooni.org/reports"><u>OONI reports</u></a> of connection tampering.</p>
	<p>For additional insights from this specific study, see the full technical <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>paper</u></a> and <a href="https://www.youtube.com/watch?v=DyDv3MHICto&amp;list=PLU4C2_kotFP2JAkoL6pcgbb52f6GIJJd7&amp;ab_channel=ACMSIGCOMM"><u>presentation</u></a>. For other regions and networks not listed below, please see the <a href="https://blog.cloudflare.com/tcp-resets-timeouts"><u>new data on Radar</u></a>.</p>
	<h3>Pakistan</h3>
	<p>Reporting from <a href="https://tribune.com.pk/story/2491142/pakistan-should-be-transparent-about-internet-disruptions-surveillance-amnesty-international"><u>inside</u></a> Pakistan suggests changes in users‚Äô Internet experience throughout August 2024. Taking a look at a two-week interval in early August, there is a significant shift in Post-ACK connection anomalies starting on August 9, 2024.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/38SPF52mjzVCDvEnO63hhu/40013024b9d46b083147911cebe04017/2544-12.png" alt="2544-12" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub><i>via </i></sub><a href="https://radar.cloudflare.com/security-and-attacks/pk?dateStart=2024-08-03&amp;dateEnd=2024-08-17#tcp-resets-and-timeouts"><sub><i>Cloudflare Radar</i></sub></a></p>
	<p>The August 9 Post-ACK spike can be almost entirely attributed to <a href="https://radar.cloudflare.com/as56167"><u>AS56167 (Pak Telecom Mobile Limited)</u></a>, shown below in the first image, where Post-ACK anomalies jumped from under 5% to upwards of 70% of all connections, and has remained high since. Correspondingly, we see a significant reduction in the number of successful HTTP requests reaching Cloudflare‚Äôs network from clients in AS56167, below in the second image, which provides evidence that connections are being disrupted. This Pakistan example reinforces the importance of corroborating reports and observations, discussed in more detail in the <a href="https://blog.cloudflare.com/tcp-resets-timeouts"><u>Radar dataset release</u></a>.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6y0WGCYjlvOhOurny2rN7p/11e01392c341f3a5f083d0f064b2507e/2544-13.png" alt="2544-13" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub><i>via </i></sub><a href="https://radar.cloudflare.com/security-and-attacks/AS56167?dateStart=2024-08-03&amp;dateEnd=2024-08-17#tcp-resets-and-timeouts"><sub><i>Cloudflare Radar</i></sub></a></p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/2aFE80hJQ5f6uJprUYFmEt/7cbef59280afe60dff88209e82aaab82/2544-14.png" alt="2544-14" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub><i>via </i></sub><a href="https://radar.cloudflare.com/traffic/AS56167?dateStart=2024-08-03&amp;dateEnd=2024-08-17#http-traffic"><sub><i>Cloudflare Radar</i></sub></a></p>
	<h3>Tanzania</h3>
	<p>A <a href="https://ooni.org/post/2024-tanzania-lgbtiq-censorship-and-other-targeted-blocks"><u>OONI report</u></a> from April 2024 discusses targeted connection tampering in <a href="https://radar.cloudflare.com/tz"><u>Tanzania</u></a>. The report states that this blocking is observed on the client side as connection timeouts after the <a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake"><u>Client Hello</u></a> message during the <a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake"><u>TLS handshake</u></a>, indicating that a middlebox is dropping the packet containing the Client Hello message. On the server side, connections tampered with in this way would appear as Post-ACK timeouts as the PSH packet containing the Client Hello message never reaches the server.</p>
	<p>Looking at the Post-ACK data represented in the light-blue portion, below, we find matching evidence: close to 30% of all new TCP connections from Tanzania appear as Post-ACK anomalies. Breaking this down further (not shown in the plots below), approximately one third is due to timeouts, consistent with the OONI report above. The remainder is due to RSTs.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/2IVvmuECBkPhL8xS7fdOcV/38759c2445b7408bb00772e9fba67acd/2544-15.png" alt="2544-15" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub><i>via </i></sub><a href="https://radar.cloudflare.com/security-and-attacks/tz?dateStart=2024-07-24&amp;dateEnd=2024-08-20#tcp-resets-and-timeouts"><sub><i>Cloudflare Radar</i></sub></a></p>
	<p></p>
	<h3>Ethiopia</h3>
	<p><a href="https://radar.cloudflare.com/et"><u>Ethiopia</u></a> is another location with <a href="https://ooni.org/post/2023-ethiopia-blocks-social-media"><u>previously-reported</u></a> connection tampering. Consistent with this, we see elevated rates of Post-PSH TCP anomalies across networks in Ethiopia. Our internal data shows that the majority of Post-PSH anomalies in this case are due to RSTs, although timeouts are also prevalent.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/YTj7Kypiu0nSjmvZ00Jjo/0ee5074f71c27c6d117c28dc082e5de5/2544-16.png" alt="2544-16" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub><i>via </i></sub><a href="https://radar.cloudflare.com/security-and-attacks/et?dateStart=2024-07-24&amp;dateEnd=2024-08-20#tcp-resets-and-timeouts"><sub><i>Cloudflare Radar</i></sub></a></p>
	<p>The majority of traffic arriving to Cloudflare‚Äôs servers from IP addresses geolocated in Ethiopia is from <a href="https://radar.cloudflare.com/as24757"><u>AS24757 (Ethio Telecom)</u></a>, shown below in the first image, so it is perhaps unsurprising that its data closely matches the country-wide distribution of connection anomalies. The number of Post-PSH connections originating from <a href="https://radar.cloudflare.com/as328988"><u>AS328988 (SAFARICOM TELECOMMUNICATIONS ETHIOPIA PLC)</u></a>, shown below in the second image, are higher in proportion and account for over 33% of all connections from that network.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/43sDPBfmz2u2JIRIPN0htd/82d3a202f2910d23efd65ebdce35dfe9/2544-17.png" alt="2544-17" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub>via </sub><a href="https://radar.cloudflare.com/security-and-attacks/AS24757?dateStart=2024-07-24&amp;dateEnd=2024-08-20#tcp-resets-and-timeouts"><sub>Cloudflare Radar</sub></a></p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/5fyguCauAPqdXYXkCvhjAl/34ed3b562667051b5ec74df9076c7b58/2544-18.png" alt="" class="kg-image" width="1999" height="1125" loading="lazy">
	</figure>
	<p><sub>via </sub><a href="https://radar.cloudflare.com/security-and-attacks/AS328988?dateStart=2024-07-24&amp;dateEnd=2024-08-20#tcp-resets-and-timeouts"><sub><i>Cloudflare Radar</i></sub></a></p>
	<h2>Reflecting on the present to promote a resilient future</h2>
	<p>Connection tampering is a blocking mechanism that is deployed in various forms throughout the Internet. Although we have developed ways to help detect and understand it globally, the experience is just as individual as an interrupted phone call.</p>
	<p>Connection tampering is also made possible <i>by accident</i>. It works because domain names are visible in cleartext. But it may not always be this way. For example, <a href="https://datatracker.ietf.org/doc/draft-ietf-tls-esni"><u>Encrypted Client Hello (ECH)</u></a> is an emerging building block that encrypts the SNI field.&nbsp;</p>
	<p>We‚Äôll continue to look for ways to talk about network activity and disruption, all to foster wider conversations. Check out the newest additions about connection anomalies on <a href="https://radar.cloudflare.com/security-and-attacks#tcp-resets-and-timeouts"><u>Cloudflare Radar</u></a> and the <a href="https://blog.cloudflare.com/tcp-resets-timeouts"><u>corresponding blog post</u></a>, as well as the <a href="https://research.cloudflare.com/publications/SundaraRaman2023"><u>peer-reviewed technical paper</u></a> and its <a href="https://youtu.be/RD73IgzQMFo?si=OWvNnlNNLalbhygV&amp;t=2984"><u>15-minute summary talk</u></a>.</p>
</div>