{
	"initialReadingTime": "2",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Matt Boyle",
				"slug": "matt",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/1XsQ97lUyeF4YqBuUlp9qp/e082efd936c9c4dd4063ebb1e89f6aa3/matt.png",
				"location": "London",
				"website": null,
				"twitter": "@mattjamesboyle",
				"facebook": null
			},
			{
				"name": "Priyadharshini Subramanian",
				"slug": "priyadharshini",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/2lnmJarhqWNmYgr4gNeHCF/32bd5daefabe50c86bbd2874501beb2b/priyadharshini.jpg",
				"location": "California, USA",
				"website": "https://github.com/priyakvs",
				"twitter": "@Priya39788707",
				"facebook": "priyadharshini.subramanian.12"
			}
		],
		"excerpt": "We are excited to open source a Cloudflare Worker that will make notifications available to any communication service that has webhook integration by transforming a generic webhook response to any required format",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/4qRNZdMMFcmDWu5lILHhhn/b8611dbb2a166dcbd3d9c1dd43b3f7dc/cloudflare-relay-worker.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/6VJzT6fPBtK9XhRPREMdbp/47c87776c8ee85ed2b253d4076df9d1d/image5-13.png\" alt=\"\" class=\"kg-image\" width=\"1800\" height=\"1013\" loading=\"lazy\"/>\n            \n            </figure><p>Our <a href=\"/new-tools-to-monitor-your-server-and-avoid-downtime/\">Notification Center</a> offers first class support for a variety of popular services (a list of which are available <a href=\"https://developers.cloudflare.com/fundamentals/notifications/create-notifications/configure-webhooks\">here</a>). However, even with such extensive support, you may use a tool that isn’t on that list. In that case, it is possible to leverage <a href=\"https://workers.cloudflare.com\">Cloudflare Workers</a> in combination with a generic webhook to deliver notifications to <i>any</i> service that accepts webhooks.</p><p>Today, we are excited to announce that we are open sourcing a Cloudflare Worker that will make it as easy as possible for you to transform our generic webhook response into any format you require. Here’s how to do it.</p><p>For this example, we are going to write a Cloudflare Worker that takes a generic webhook response, transforms it into the correct format and delivers it to Rocket Chat, a popular customer service messaging platform.  When Cloudflare sends you a generic webhook, it will have the following schema, where “text” and “data” will vary depending on the alert that has fired:</p>\n            <pre class=\"language-json\"><code class=\"language-json\">{\n   &quot;name&quot;: &quot;Your custom webhook&quot;,\n   &quot;text&quot;: &quot;The alert text&quot;,\n   &quot;data&quot;: {\n       &quot;some&quot;: &quot;further&quot;,\n       &quot;info&quot;: [\n           &quot;about&quot;,\n           &quot;your&quot;,\n           &quot;alert&quot;,\n           &quot;in&quot;\n       ],\n       &quot;json&quot;: &quot;format&quot;\n   },\n   &quot;ts&quot;: 123456789\n}</pre></code>\n            <p>Whereas Rocket Chat is looking for this format:</p>\n            <pre class=\"language-json\"><code class=\"language-json\">{\n   &quot;text&quot;: &quot;Example message&quot;,\n   &quot;attachments&quot;: [\n       {\n           &quot;title&quot;: &quot;Rocket Chat&quot;,\n           &quot;title_link&quot;: &quot;https://rocket.chat&quot;,\n           &quot;text&quot;: &quot;Rocket.Chat, the best open source chat&quot;,\n           &quot;image_url&quot;: &quot;/images/integration-attachment-example.png&quot;,\n           &quot;color&quot;: &quot;#764FA5&quot;\n       }\n   ]\n}</pre></code>\n            <h2>Getting Started</h2><p>Firstly, you’ll need to ensure you are ready to develop on the Cloudflare Workers platform. You can find more information on how to do that <a href=\"https://developers.cloudflare.com/workers/\">here</a>. For the purpose of this example, we will assume you have a Cloudflare account and Wrangler, the Workers CLI, setup.</p><p>Next, let us see the steps to extend the notifications system in detail.</p><p><b>Step 1</b>Clone the webhook relay worker GitHub repository: <code>git clone https://github.com/cloudflare/cf-webhook-relay.git</code></p><p><b>Step 2</b>Check the webhook payload format required by your communication tool. In this specific case, it would look like the Rocket Chat example payload shared above.</p><p><b>Step 3</b>Sign up for Rocket Chat and add a webhook integration to accept incoming webhook notifications.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/1LYgyVgd1cLkVVTBLKqaog/7338f0dcf40b7d5c67f706d6e7a8378c/image2-15.png\" alt=\"Example configuration of incoming webhook integration in Rocket Chat\" class=\"kg-image\" width=\"1999\" height=\"1261\" loading=\"lazy\"/>\n            \n            </figure><p>**Step 4**Configure an encrypted wrangler secret for request authentication and the Rocket Chat URL for sending requests in your Worker: <a href=\"https://developers.cloudflare.com/workers/platform/environment-variables/#adding-secrets-via-wrangler\">Environment variables · Cloudflare Workers docs</a> (for this example, the secret is not encrypted.)</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/6SRZ9WJYEbf0IfKEv568b/c2f89b6af6b7cda4da387d30097f2507/image3-15.png\" alt=\"Workers environment variables configuration in Cloudflare dashboard\" class=\"kg-image\" width=\"1999\" height=\"693\" loading=\"lazy\"/>\n            \n            </figure><p><b>Step 5</b>Modify your worker to accept POST webhook requests with the secret configured as a query param for authentication.</p>\n            <pre class=\"language-json\"><code class=\"language-json\">if (headers.get(&quot;cf-webhook-auth&quot;) !== WEBHOOK_SECRET) {\n    return new Response(&quot;:(&quot;, {\n        headers: {&#039;content-type&#039;: &#039;text/plain&#039;},\n            status: 401\n    })\n}</pre></code>\n            <p><b>Step 6</b>Convert the incoming request payload from the notification system (like in the example shared above) to the Rocket Chat format in the worker.</p>\n            <pre class=\"language-json\"><code class=\"language-json\">let incReq = await request.json()\nlet msg = incReq.text\nlet webhookName = incReq.name\nlet rocketBody = {\n    &quot;text&quot;: webhookName,\n    &quot;attachments&quot;: [\n        {\n            &quot;title&quot;: &quot;Cloudflare Webhook&quot;,\n            &quot;text&quot;: msg,\n            &quot;title_link&quot;: &quot;https://cloudflare.com&quot;,\n            &quot;color&quot;: &quot;#764FA5&quot;\n        }\n    ]\n}</pre></code>\n            <p><b>Step 7</b>Configure the Worker to send POST requests to the Rocket Chat webhook with the converted payload.</p>\n            <pre class=\"language-json\"><code class=\"language-json\">const rocketReq = {\n    headers: {\n        &#039;content-type&#039;: &#039;application/json&#039;,\n    },\n    method: &#039;POST&#039;,\n    body: JSON.stringify(rocketBody),\n}\nconst response = await fetch(\n    ROCKET_CHAT_URL,\n    rocketReq,\n)\nconst res = await response.json()\nconsole.log(res)\nreturn new Response(&quot;:)&quot;, {\n    headers: {&#039;content-type&#039;: &#039;text/plain&#039;},\n})</pre></code>\n            <p><b>Step 8</b>Set up deployment configuration in your wrangler.toml file and publish your Worker. You can now see the Worker in the Cloudflare dashboard.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/4v3krfdWPyWlb5XxsErwsk/2bc2a5f3093125b15df4f84eb32687eb/image1-20.png\" alt=\"View and Manage workers in Cloudflare dashboard\" class=\"kg-image\" width=\"1928\" height=\"862\" loading=\"lazy\"/>\n            \n            </figure><p><b>Step 9</b>You can manage and monitor the Worker with a variety of available tools.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/5kFBdyg5YEaadtiQwyVqYB/ee7407b849af3fb7d0d6d158040a32fa/image9-8.png\" alt=\"Monitoring workers in Cloudflare dashboard\" class=\"kg-image\" width=\"1999\" height=\"1337\" loading=\"lazy\"/>\n            \n            </figure><p><b>Step 10</b>Add the Worker URL as a generic webhook to the notification destinations in the Cloudflare dashboard: <a href=\"https://developers.cloudflare.com/fundamentals/notifications/create-notifications/configure-webhooks/#generic-webhooks\">Configure webhooks · Cloudflare Fundamentals docs</a>.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2p1qMaGDkEM6H3C5hHVst1/7a438f38f9af84390c6bcff63fc17115/image6-7.png\" alt=\"Webhooks destination under Destinations in Notifications tab\" class=\"kg-image\" width=\"1999\" height=\"872\" loading=\"lazy\"/>\n            \n            </figure>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/6PNvwMldKKmfZa8UlLvbHA/ac4fe6cedc4688767fe46561c315cde5/image7-6.png\" alt=\"Workers URL as a generic webhook in Cloudflare dashboard example\" class=\"kg-image\" width=\"1999\" height=\"875\" loading=\"lazy\"/>\n            \n            </figure><p><b>Step 11</b>Create a notification with the destination as the configured generic webhook: <a href=\"https://developers.cloudflare.com/fundamentals/notifications/create-notifications/\">Create a Notification · Cloudflare Fundamentals docs</a>.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/216pxD7Q6yTqyPuMbYuTgk/fe2aa412e4f8f762e546050a5f22421f/image8-6.png\" alt=\"Example of notification creation\" class=\"kg-image\" width=\"1999\" height=\"1208\" loading=\"lazy\"/>\n            \n            </figure><p><b>Step 12</b>Tada! With your Cloudflare Worker running, you can now receive all notifications to Rocket Chat. We can configure in the same way for any communication tool.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/7nnSDSJrXuT0QlVXoGLVDY/46813c4d571b45e050872fdcd82d99ad/image4-9.png\" alt=\"Sample webhook notification in Rocket Chat\" class=\"kg-image\" width=\"1999\" height=\"223\" loading=\"lazy\"/>\n            \n            </figure><p>We know that a notification system is essential to proactively monitor any issues that may arise within a project. We are excited with this announcement to make notifications available to any communication service without having to worry too much about the system&#39;s compatibility to them. We have lots of updates planned, like adding more alertable events to choose from and extending our support to a wide range of webhook services to receive them.</p><p><i>If you&#39;re interested in building scalable services and solving interesting technical problems, we are hiring engineers on our team in</i> <a href=\"https://boards.greenhouse.io/cloudflare/jobs/3252504?gh_jid=3252504\"><i>Austin</i></a> <i>&amp;</i> <a href=\"https://boards.greenhouse.io/cloudflare/jobs/3231716?gh_jid=3231716\"><i>Lisbon</i></a>.</p>",
		"id": "2kJG94dvikz1gzbXcQeTzF",
		"localeList": {
			"name": "Cloudflare Relay Worker Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "We are excited to open source a Cloudflare Worker that will make notifications available to any communication service that has webhook integration by transforming a generic webhook response to any required format.",
		"metadata": {
			"title": "Cloudflare Relay Worker",
			"description": "We are excited to open source a Cloudflare Worker that will make notifications available to any communication service that has webhook integration by transforming a generic webhook response to any required format.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/1YmkAU8zmZJH9178YPHQTA/b23d77a6cc039ac5a253769f2dfbb980/cloudflare-relay-worker-9WL9FK.png"
		},
		"primary_author": {},
		"published_at": "2022-05-02T13:58:22.000+01:00",
		"slug": "cloudflare-relay-worker",
		"tags": [
			{
				"id": "6QktrXeEFcl4e2dZUTZVGl",
				"name": "Product News",
				"slug": "product-news"
			},
			{
				"id": "6hbkItfupogJP3aRDAq6v8",
				"name": "Cloudflare Workers",
				"slug": "workers"
			},
			{
				"id": "4HIPcb68qM0e26fIxyfzwQ",
				"name": "Developers",
				"slug": "developers"
			},
			{
				"id": "5cye1Bh5KxFh3pKSnX8Dsy",
				"name": "Serverless",
				"slug": "serverless"
			},
			{
				"id": "3JAY3z7p7An94s6ScuSQPf",
				"name": "Developer Platform",
				"slug": "developer-platform"
			}
		],
		"title": "Cloudflare Relay Worker",
		"updated_at": "2024-08-27T01:32:29.817Z",
		"url": "https://blog.cloudflare.com/cloudflare-relay-worker"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}