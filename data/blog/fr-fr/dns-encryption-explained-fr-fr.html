<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2019/10/DoT-DoH@2x.png" class="kg-image"></figure>
	<p>Le Domain Name System (DNS) est le carnet d'adresses d'Internet. Lorsque vous consultez cloudflare.com ou tout autre site, votre navigateur demandera à un résolveur DNS l'adresse IP où se trouve le site. Malheureusement, ces requêtes et réponses DNS ne sont généralement pas protégées. Le chiffrement des DNS renforcerait la confidentialité et la sécurité des utilisateurs. Dans cet article, nous examinerons deux mécanismes de chiffrement de DNS, appelés DNS over TLS (DoT) et DNS over HTTPS (DoH), et expliquerons leur fonctionnement.</p>
	<p>Les applications qui veulent résoudre un nom de domaine vers une adresse IP utilisent généralement des DNS. En général, ce n'est pas le programmeur qui a écrit l'application qui le fait de manière explicite. Au lieu de cela, il écrit quelque chose qui ressemble à fetch("https://example.com/news") et demande à une bibliothèque logicielle de gérer la traduction de "example.com" en une adresse IP.</p>
	<p>En arrière-plan, la librairie logicielle se charge de découvrir le <a href="https://www.cloudflare.com/learning/dns/what-is-dns/" target="_blank">résolveur DNS récursif</a> externe, de s'y connecter et de lui communiquer le protocole DNS (voir la figure ci-dessous) afin de résoudre le nom demandé par l'application. Le choix du résolveur DNS externe et la question de savoir si la confidentialité et la sécurité sont assurées ne dépendent pas de l'application. Cela dépend de la bibliothèque logicielle utilisée et des politiques définies par le système d'exploitation de l'appareil qui exécute le logiciel.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2019/10/DNS-flow-diagram.png" class="kg-image">
		<figcaption>Généralités sur les requêtes et réponses DNS</figcaption>
	</figure>
	<h2 id="le-r-solveur-dns-externe"><strong>Le résolveur DNS externe</strong></h2>
	<p>Le système d'exploitation apprend généralement l'adresse du résolveur par le réseau local en utilisant le protocole DHCP (Dynamic Host Configuration Protocol). Dans les réseaux domestiques et mobiles, il finit généralement par utiliser le résolveur du fournisseur d'accès à Internet (FAI). Dans les réseaux d'entreprise, le résolveur sélectionné est généralement contrôlé par l'administrateur réseau. S'ils le souhaitent, les utilisateurs qui contrôlent leurs appareils peuvent remplacer le résolveur par une adresse spécifique, comme par exemple l'adresse d'un résolveur public comme 8.8.8.8 de Google ou <a href="https://blog.cloudflare.com/dns-resolver-1-1-1-1/">1.1.1.1 de Cloudflare</a>, mais la plupart des utilisateurs ne s’ennuient pas à le faire lorsqu'ils se connectent à un point d’accès Wi-Fi public dans un café ou un aéroport.</p>
	<p>Le choix d'un résolveur externe a un impact direct sur la qualité de l’expérience de l’utilisateur. La plupart des utilisateurs ne modifient pas leurs paramètres de résolveur et finiront probablement par utiliser le résolveur DNS de leur FAI. L'amélioration la plus visible est la rapidité et l'exactitude de la résolution des noms. Les améliorations en matière de confidentialité ou de sécurité ne seront peut-être pas immédiatement perceptibles, mais elles permettront d'empêcher d'autres personnes de faire du profilage ou d'interférer avec votre navigation. Ceci est particulièrement important dans le cas des réseaux Wi-Fi publics où quiconque se trouvant physiquement à proximité peut capturer et déchiffrer le trafic du réseau sans fil.</p>
	<h2 id="dns-non-chiffr-"><strong>DNS non chiffré</strong></h2>
	<p>Depuis leur création en 1987, les DNS ont été la plupart du temps non chiffrés. Quiconque se trouvant entre votre appareil et le résolveur est capable d'espionner ou même de modifier vos requêtes et réponses DNS. Il peut s'agir de toute personne sur votre réseau Wi-Fi local, de votre fournisseur d'accès Internet (FAI) et des fournisseurs de transit. Cela peut avoir une incidence sur votre confidentialité en révélant les noms des domaines que vous visitez.</p>
	<p>Que peuvent-ils voir ? Prenons l'exemple de cette capture de paquets réseau sur un ordinateur portable connecté à un réseau domestique :</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2019/10/dns-at-home-marked.png" class="kg-image"></figure>
	<p>On peut faire les observations suivantes :</p>
	<ul>
		<li>Le port source UDP est le 53, qui est le numéro de port standard pour les DNS non chiffrés. Le payload UDP peut donc être une réponse DNS.</li>
		<li>Cela laisse supposer que l'adresse IP source 192.168.2.254 est un résolveur DNS alors que l'adresse IP de destination 192.168.2.14 est le client DNS.</li>
		<li>La payload UDP pourrait en effet être analysée comme une réponse DNS, et révèle que l'utilisateur essayait de se connecter à twitter.com.</li>
		<li>S'il y a des connexions futures vers 104.244.42.129 ou 104.244.42.42.1, alors c'est très probablement le trafic qui est dirigé vers "twitter.com".</li>
		<li>Si un trafic HTTPS chiffré supplémentaire est acheminé vers cette adresse IP, suivi d'autres requêtes DNS, cela pourrait indiquer qu'un navigateur Web a chargé des ressources supplémentaires à partir de cette page. Cela pourrait potentiellement révéler les pages qu'un utilisateur a consultées sur twitter.com.</li>
	</ul>
	<p>Étant donné que les messages DNS ne sont pas protégés, d'autres attaques sont possibles :</p>
	<ul>
		<li>Les requêtes pourraient être dirigées vers un résolveur qui effectue un <a href="https://en.wikipedia.org/wiki/DNS_hijacking" target="_blank">détournement du DNS</a>. Par exemple, au Royaume-Uni, Virgin Media et <a href="https://bt.custhelp.com/app/answers/detail/a_id/14244/c/402" target="_blank">BT</a> renvoient une réponse fausse pour des domaines qui n'existent pas, et redirigent les utilisateurs vers une page de recherche. Cette redirection est possible parce que l'ordinateur ou le téléphone font aveuglément confiance au résolveur DNS qui a été annoncé en utilisant DHCP par le routeur de passerelle fourni par le FAI.</li>
		<li>Les pare-feu peuvent facilement intercepter, bloquer ou modifier n'importe quel trafic DNS non chiffré en fonction du seul numéro du port. Il est à noter que l'inspection textuelle n'est pas une solution miracle pour atteindre les objectifs de visibilité, car il est possible de contourner le résolveur DNS.</li>
	</ul>
	<h2 id="chiffrement-des-dns"><strong>Chiffrement des DNS</strong></h2>
	<p>Le chiffrement des DNS rend beaucoup plus difficile aux pirates informatiques qui surveillent vos messages DNS ou qui les corrompent pendant le transit. Tout comme le Web est passé du HTTP non chiffré au HTTPS chiffré, il existe désormais des mise à niveau du protocole DNS qui chiffre le protocole DNS. Le chiffrement du Web a permis de sécuriser et privatiser les communications et de développer le commerce. Le chiffrement des DNS améliorera encore davantage la confidentialité des utilisateurs.</p>
	<p>Il existe deux mécanismes normalisés permettant de sécuriser le transport DNS entre vous et le résolveur : <a href="https://tools.ietf.org/html/rfc7858" target="_blank">DNS over TLS (2016)</a> et <a href="https://tools.ietf.org/html/rfc8484" target="_blank">DNS Queries over HTTPS (2018)</a>. Les deux sont basés sur le protocole Transport Layer Security (TLS) qui est également utilisé pour sécuriser la communication entre vous et un site Web en utilisant HTTPS. Dans TLS, le serveur (qu'il s'agisse d'un serveur Web ou d'un résolveur DNS) s'authentifie auprès du client (votre périphérique) à l'aide d'un certificat. Ceci garantit que personne d'autre ne puisse se faire passer pour le serveur (le résolveur).</p>
	<p>Avec DNS over TLS (DoT), le message DNS original est directement intégré dans le canal TLS sécurisé. De l'extérieur, on ne peut ni savoir quel nom a été demandé, ni le modifier. L'application client prévue sera capable de déchiffrer TLS de la manière suivante :</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2019/10/dns-over-tls13-marked.png" class="kg-image"></figure>
	<p>Dans le suivi des paquets pour les DNS non chiffrés, il était évident qu'une requête DNS pouvait être envoyée directement par le client, suivie d'une réponse DNS du résolveur. Dans le cas du DoT chiffré, cependant, certains messages de handshake TLS sont échangés avant l'envoi de messages DNS chiffrés :</p>
	<ul>
		<li>Le client envoie un Client Hello, annonçant les capacités TLS prises en charge.</li>
		<li>Le serveur répond par un Server Hello, acceptant les paramètres TLS qui seront utilisés pour sécuriser la connexion. Le message Certificate contient l'identité du serveur tandis que le message Certificate Verify contiendra une signature numérique qui peut être vérifiée par le client en utilisant le certificat du serveur. Le client vérifie généralement ce certificat par rapport à sa liste locale d'autorités de certification de confiance, mais la spécification DoT mentionne d'autres <a href="https://tools.ietf.org/html/rfc7858#section-3.2" target="_blank">mécanismes de confiance alternatifs</a> comme l’épinglage de clé publique.</li>
		<li>Une fois le handshake TLS achevé par le client et le serveur, ces derniers peuvent enfin commencer à échanger des messages chiffrés.</li>
		<li>Bien que l'image ci-dessus contienne une requête et une réponse DNS, dans la pratique, la connexion TLS sécurisée restera ouverte et sera réutilisée pour de futures requêtes DNS.</li>
	</ul>
	<p>La sécurisation des protocoles non chiffrés en plaçant TLS sur un nouveau port a déjà été effectuée auparavant :</p>
	<ul>
		<li>Web traffic: HTTP (tcp/80) -&gt; HTTPS (tcp/443)</li>
		<li>Sending email: SMTP (tcp/25) -&gt; SMTPS (tcp/465)</li>
		<li>Receiving email: IMAP (tcp/143) -&gt; IMAPS (tcp/993)</li>
		<li>Now: DNS (tcp/53 or udp/53) -&gt; DoT (tcp/853)</li>
	</ul>
	<p>Le problème de l'introduction d'un nouveau port est qu'il peut être bloqué par les pare-feu existants. Soit parce qu'ils ont recours à des listes blanches où les nouveaux services doivent être activés explicitement, soit parce qu'un administrateur réseau bloque explicitement un service. Si la solution sécurisée (DoT) est moins facilement disponible que la solution non sécurisée, les utilisateurs et les applications pourraient être tentés de se rabattre sur les DNS non chiffrés. Cela pourrait par la suite permettre aux attaquants de forcer les utilisateurs à utiliser une version non sécurisée.</p>
	<p>Ces attaques de repli ne relèvent pas de la théorie. Le <a href="https://blog.cloudflare.com/performing-preventing-ssl-stripping-a-plain-english-primer/">SSL Stripping</a> a déjà été utilisée pour faire passer les sites Web HTTPS en HTTP, en permettant ainsi aux attaquants de voler des mots de passe ou de pirater des comptes.</p>
	<p>Une autre solution, DNS Queries over HTTPS (DoH), a été <a href="https://tools.ietf.org/html/rfc8484#section-1" target="_blank">conçue</a> pour répondre à deux cas d'utilisation fréquents :</p>
	<ul>
		<li>Éviter le problème ci-dessus où les dispositifs sur le trajet interfèrent avec les DNS. Cela comprend le problème de blocage des ports décrit ci-dessus.</li>
		<li>Activer les applications Web pour accéder aux DNS via les API de navigateur existantes.<br>DoH est essentiellement HTTPS, le standard chiffré utilisé par le Web, et réutilise le même numéro de port (tcp/443). Les navigateurs Web ont déjà <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" target="_blank">désapprouvé le HTTP</a> non sécurisé en faveur du HTTPS. Cela fait de HTTPS un excellent choix pour transporter les messages DNS en toute sécurité. Vous trouverez un exemple de ce type de requête DoH <a href="https://tools.ietf.org/html/rfc8484#section-4.1.1" target="_blank">ici</a>.</li>
	</ul>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2019/10/DoH-flow-diagram.png" class="kg-image">
		<figcaption>DoH : Requête et réponse DNS transportées via un flux HTTPS sécurisé</figcaption>
	</figure>
	<p>Certains utilisateurs craignent que l'utilisation de HTTPS ne porte atteinte à leur vie privée en raison de l'utilisation potentielle de cookies de suivi. Les concepteurs du protocole DoH ont <a href="https://tools.ietf.org/html/rfc8484#section-8" target="_blank">tenu compte</a> de divers aspects de la protection de la vie privée et ont explicitement déconseillé l'utilisation de cookies HTTP pour empêcher le suivi, et cette recommandation est largement respectée. La reprise de la session TLS améliore les performances du handshake TLS 1.2, mais peut potentiellement être utilisée pour corréler les connexions TLS. Heureusement, l'utilisation de TLS 1.3 permet d'éviter la reprise d'une session TLS en réduisant le nombre d'allers-retours par défaut, ce qui répond efficacement aux préoccupations en matière de confidentialité.</p>
	<p>L'utilisation de HTTPS signifie que les améliorations du protocole HTTP peuvent également bénéficier à DoH. Par exemple, le <a href="https://blog.cloudflare.com/http3-the-past-present-and-future/">protocole HTTP/3</a> en cours de développement, basé sur <a href="https://blog.cloudflare.com/the-road-to-quic/">QUIC</a>, pourrait apporter des améliorations supplémentaires en cas de perte de paquets due à l'absence de blocage en tête de file. Cela signifie que plusieurs requêtes DNS peuvent être envoyées simultanément sur le canal sécurisé sans se bloquer les unes les autres lorsqu'un paquet est perdu.</p>
	<p>Un <a href="https://tools.ietf.org/html/draft-huitema-quic-dnsoquic" target="_blank">projet</a> de DNS over QUIC (DNS/QUIC) existe également et est semblable à DoT, mais sans le problème de blocage en tête de file dû à l'utilisation de QUIC. Cependant, HTTP/3 et DNS/QUIC exigent tous deux qu'un port UDP soit accessible. En théorie, les deux pourraient basculer vers DoH over HTTP/2 et DoT, respectivement.</p>
	<h2 id="d-ploiement-de-dot-et-de-doh"><strong>Déploiement de DoT et de DoH</strong></h2>
	<p>Étant donné que DoT et DoH sont relativement nouveaux, ils ne sont pas encore déployés partout. Côté serveur, les principaux résolveurs publics, comme 1.1.1.1 de Cloudflare et Google DNS le prennent en charge. Cependant, de nombreux résolveurs de FAI ne le prennent toujours pas en charge. Une petite liste des résolveurs publics prenant en charge DoH est disponible sur la page <a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/DNS-server-sources" target="_blank">DNS server sources</a> et une autre liste des résolveurs publics prenant en charge DoT et DoH est disponible sur <a href="https://dnsprivacy.org/wiki/display/DP/DNS+Privacy+Public+Resolvers" target="_blank">DNS Privacy Public Resolvers</a>.</p>
	<p>Il existe deux méthodes pour activer DoT ou DoH sur les appareils des utilisateurs finaux :</p>
	<ul>
		<li>Ajouter la prise en charge aux applications, en contournant le service de résolveur du système d'exploitation.</li>
		<li>Ajouter la prise en charge au système d'exploitation, en assurant de manière transparente la prise en charge des applications.</li>
	</ul>
	<p>Il existe généralement trois types de configuration pour DoT ou DoH côté client :</p>
	<ul>
		<li>Désactivé : Les DNS ne seront pas chiffrés.</li>
		<li>Mode opportuniste : essayer d'utiliser un transport sécurisé pour les DNS, mais revenir aux DNS non chiffrés si ce dernier n'est pas disponible. Ce mode est vulnérable aux attaques par déclassement qui permettent à un attaquant de forcer un périphérique à utiliser des DNS non chiffrés. Il permet de protéger la confidentialité lorsqu'il n'y a pas d'attaquants actifs sur le chemin.</li>
		<li>Mode strict : essayer d'utiliser les DNS sur un protocole de transport sécurisé. S'il n'est pas disponible, tout est interrompu et l'utilisateur voit une erreur s'afficher.</li>
	</ul>
	<p>État actuel de la configuration DNS à l'échelle du système sur un protocole de transport sécurisé :</p>
	<ul>
		<li>Android 9 : <a href="https://android-developers.googleblog.com/2018/04/dns-over-tls-support-in-android-p.html" target="_blank">prend en charge</a> DoT grâce à sa fonction « Private DNS ». Modes :</li>
		<li>Le mode opportuniste (« automatique ») est utilisé par défaut. Le résolveur des paramètres réseau (généralement DHCP) sera utilisé.</li>
		<li>Le mode strict peut être <a href="https://blog.cloudflare.com/enable-private-dns-with-1-1-1-1-on-android-9-pie/">configuré</a> en définissant un nom d'hôte explicite. Aucune adresse IP n'est autorisée, le nom d'hôte est résolu à l'aide du résolveur par défaut et est également utilisé pour valider le certificat. (<a href="https://github.com/aosp-mirror/platform_frameworks_base/commit/a24d459a5d60c706472f9b620d079cd0a40a7279" target="_blank">code source pertinent</a>)</li>
		<li>Les utilisateurs d'iOS et d'Android peuvent également installer <a href="https://1.1.1.1/" target="_blank">l'application 1.1.1.1</a> pour activer la prise en charge DoH ou DoT en mode strict. Elle utilise en interne les interfaces de programmation VPN pour permettre l'interception du trafic DNS non chiffré avant sa transmission sur un canal sécurisé.</li>
		<li>Linux avec systemd-resolved de systemd 239 &nbsp;DoT par l'option <a href="https://www.freedesktop.org/software/systemd/man/resolved.conf.html#DNSOverTLS=" target="_blank">DNSOverTLS</a>.</li>
		<li>Désactivé est la valeur par défaut.</li>
		<li>Le mode opportuniste peut être configuré, mais aucune validation de certificat n'est effectuée.</li>
		<li>Le mode strict est disponible depuis systemd 243. Tout certificat signé par une autorité de certification de confiance est accepté. Cependant, <a href="https://github.com/systemd/systemd/blob/v243/src/resolve/resolved-dnstls-gnutls.c#L62-L63" target="_blank">il n'y a pas de validation du nom d'hôte</a> avec le backend GnuTLS alors que le backend OpenSSL <a href="https://github.com/systemd/systemd/blob/v243/src/resolve/resolved-dnstls-openssl.c#L86-L87" target="_blank">attend</a> une adresse IP.</li>
		<li>Dans tous les cas, aucune indication de nom de serveur (SNI) n'est envoyée. Le nom du certificat n'est <a href="https://github.com/systemd/systemd/issues/9397" target="_blank">pas validé</a>, ce qui rend une attaque de l'homme du milieu (HDM) plutôt insignifiante.</li>
		<li>Linux, macOS et Windows peuvent <a href="https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy/" target="_blank">utiliser</a> un client DoH en mode strict. La commande proxy-dns de Cloudflare utilise le résolveur DNS de Cloudflare par défaut, mais les utilisateurs peuvent le remplacer par l’option proxy-dns-upstream.</li>
	</ul>
	<p>Les navigateurs Web prennent en charge DoH au lieu de DoT :</p>
	<ul>
		<li>Firefox 62 <a href="https://support.mozilla.org/en-US/kb/firefox-dns-over-https" target="_blank">prend en charge</a> DoH et propose plusieurs paramètres <a href="https://wiki.mozilla.org/Trusted_Recursive_Resolver" target="_blank">trusted Recursive Resolver (TRR)</a>. DoH est désactivé par défaut, mais Mozilla procède actuellement à une <a href="https://blog.mozilla.org/futurereleases/2019/09/06/whats-next-in-making-dns-over-https-the-default/" target="_blank">expérience</a> visant à activer DoH pour certains utilisateurs aux États-Unis. Cette expérience utilise actuellement le résolveur 1.1.1.1 de Cloudflare, car nous sommes le seul fournisseur qui satisfait actuellement à la <a href="https://wiki.mozilla.org/Security/DOH-resolver-policy" target="_blank">politique en matière de résolveurs stricte</a> exigée par Mozilla. Étant donné que de nombreux résolveurs DNS ne prennent toujours pas en charge le transport DNS chiffré, la démarche de Mozilla garantira que davantage d'utilisateurs seront protégés par DoH.</li>
		<li>Lorsqu'il sera activé au cours de l'expérience, ou via l'option « Activer DNS over HTTPS » dans les paramètres réseau, Firefox utilisera le mode opportuniste (network.trr.mode=2 at about:config).</li>
		<li>Il est possible d'activer le mode strict avec network.trr.mode=3, mais nécessite la spécification d’une adresse IP de résolveur explicite (par exemple, network.trr.bootstrapAddress=1.1.1.1).</li>
		<li>Bien que Firefox ignore le résolveur par défaut du système, il peut être configuré avec d'autres résolveurs. En outre, les versions professionnelles qui utilisent un résolveur qui ne prend pas en charge DoH ont la <a href="https://support.mozilla.org/en-US/kb/configuring-networks-disable-dns-over-https" target="_blank">possibilité</a> de désactiver DoH.</li>
		<li>Chrome 78 <a href="https://blog.chromium.org/2019/09/experimenting-with-same-provider-dns.html" target="_blank">accepte</a> le DoH opportuniste si l'adresse du résolveur du système correspond à celle de l'un des <a href="https://www.chromium.org/developers/dns-over-https" target="_blank">fournisseurs DoH programmée en dur</a> (<a href="https://chromium.googlesource.com/chromium/src.git/+/f93a48e3720931c25a3abc7848b08afed43e3be2%5E%21/" target="_blank">changement de code source</a>). Cette expérience est activée sur toutes les plates-formes sauf Linux et iOS, et exclut les versions professionnelles par défaut.</li>
		<li>Opera 65 <a href="https://blogs.opera.com/desktop/2019/09/opera-65-0-3430-0-developer-update/" target="_blank">ajoute</a> une option pour activer DoH via le résolveur 1.1.1.1 de Cloudflare. Cette fonctionnalité est désactivée par défaut. Une fois activée, elle semble utiliser le mode opportuniste : si 1.1.1.1:443 (sans SNI) est accessible, il sera utilisé. Sinon, il revient au résolveur non chiffré par défaut.</li>
	</ul>
	<p>La page <a href="https://github.com/curl/curl/wiki/DNS-over-HTTPS" target="_blank">DNS over HTTPS</a> du projet Curl contient une liste complète des fournisseurs du DoH et des applications supplémentaires.</p>
	<p>Comme alternative au chiffrement du chemin réseau complet entre l'appareil et le résolveur DNS externe, il est possible d'opter pour une solution intermédiaire : utiliser un DNS non chiffré entre les appareils et la passerelle du réseau local, mais <a href="https://blog.cloudflare.com/dns-over-tls-built-in/">chiffrer tout le trafic DNS</a> entre le routeur passerelle et le résolveur DNS externe. En se basant sur un réseau filaire ou sans fil sécurisé, cela protégerait tous les appareils du réseau local contre un FAI indiscret, ou d'autres prédateurs sur internet. Dans la mesure où les points d’accès Wi-Fi publics ne sont pas considérés comme sûrs, cette solution ne le serait pas sur les réseaux Wi-Fi publics. Même s'il est protégé par mot de passe avec une clé WPA2-PSK, des intrus pourront toujours s'infiltrer pour modifier les DNS non chiffrés.</p>
	<h2 id="autres-questions-de-s-curit-"><strong>Autres questions de sécurité</strong></h2>
	<p>Les sections précédentes décrivaient les modes de transport DNS sécurisés DoH et DoT. Ils ne feront que garantir que votre client recevra la réponse non altérée de la part du résolveur DNS. Il ne protège cependant pas le client contre un résolveur qui renvoie la mauvaise réponse (par des attaques par détournement de DNS ou par empoisonnement du cache des DNS). La « vraie » réponse est déterminée par le propriétaire d'un domaine ou d'une zone tel que rapporté par le serveur de nom faisant autorité. <a href="https://www.cloudflare.com/learning/dns/dns-security/" target="_blank">DNSSEC</a> permet aux clients de vérifier l'intégrité de la réponse DNS renvoyée et de détecter toute modification non autorisée sur le chemin entre le client et le serveur de noms officiel.</p>
	<p>Cependant, le déploiement de DNSSEC est entravé par des dispositifs intermédiaires qui transfèrent <a href="https://labs.ripe.net/Members/willem_toorop/sunrise-dns-over-tls-sunset-dnssec" target="_blank">incorrectement</a> les messages DNS, et même si les informations sont disponibles, les résolveurs stub utilisés par les applications pourraient même ne pas valider les résultats. Un rapport publié en 2016 <a href="https://www.internetsociety.org/resources/doc/2016/state-of-dnssec-deployment-2016/" target="_blank">a révélé</a> que seuls 26 % des utilisateurs utilisent des résolveurs validant DNSSEC.</p>
	<p>DoH et DoT protègent le transport entre le client et le résolveur public. Il se peut que le résolveur public doive faire appel à d'autres serveurs de noms reconnus pour résoudre un nom. Traditionnellement, le chemin d'accès entre tout résolveur et le serveur de noms officiel utilise des DNS non chiffrés. Pour protéger également ces messages DNS, nous avons fait une expérience avec Facebook, en utilisant DoT entre 1.1.1.1 et les serveurs de noms faisant autorité de Facebook. Bien que la mise en place d'un canal sécurisé à l'aide de TLS augmente la latence, elle peut être amortie sur de nombreuses requêtes.</p>
	<p>Le chiffrement du transport permet de protéger les résultats du résolveur et les métadonnées. Par exemple, les informations <a href="https://tools.ietf.org/html/rfc7871" target="_blank">EDNS Client Subnet (ECS)</a> comprises dans les requêtes DNS pourraient révéler l'adresse originale du client qui a lancé la requête DNS. Le fait de cacher ces renseignements tout au long du chemin améliore la confidentialité. Cela permet également <a href="https://labs.ripe.net/Members/willem_toorop/sunrise-dns-over-tls-sunset-dnssec" target="_blank">d'éviter</a> que des dispositifs intermédiaires défaillants ne perturbent le DNSSEC en raison de problèmes de transfert DNS.</p>
	<h2 id="probl-mes-op-rationnels-avec-le-chiffrement-des-dns"><strong>Problèmes opérationnels avec le chiffrement des DNS</strong></h2>
	<p>Le chiffrement des DNS peut représenter un problème pour les personnes ou les entreprises qui sont tributaires de la surveillance ou de la modification du trafic DNS. Les dispositifs de sécurité utilisant la surveillance passive surveillent tout le trafic réseau entrant et sortant sur une machine ou sur la périphérie d'un réseau. À partir de requêtes DNS non chiffrées, ils peuvent par exemple identifier des machines infectées par des logiciels malveillants. Si la requête DNS est chiffrée, les solutions de surveillance passive ne pourront pas surveiller les noms de domaine.</p>
	<p>Certains s'attendent à ce que les résolveurs DNS appliquent le filtrage de contenu dans les buts suivants :</p>
	<ul>
		<li>Bloquer les domaines utilisés pour diffuser des logiciels malveillants.</li>
		<li>Bloquer les publicités.</li>
		<li>Effectuer un filtrage pour le contrôle parental, en bloquant les domaines proposant du contenu pour adultes.</li>
		<li>Bloquer l'accès aux domaines diffusant des contenus illégaux selon la réglementation locale.</li>
		<li>Proposer un service <a href="https://en.wikipedia.org/wiki/Split-horizon_DNS" target="_blank">DNS avec découpage d’horizon</a> pour donner des réponses différentes selon le réseau source.</li>
	</ul>
	<p>L'avantage de bloquer l'accès aux domaines via le résolveur DNS est que cela peut être fait de manière centralisée, sans avoir à le refaire dans chaque application. Malheureusement, ce stratagème est également assez approximatif. Imaginons qu'un site Web héberge du contenu destiné à plusieurs utilisateurs sur exemple.com/videos/pour-enfants/ et exemple.com/videos/pour-adultes/. Le résolveur DNS ne pourra voir qu’« exemple.com » et pourra choisir de le bloquer ou non. Dans ce cas, les commandes spécifiques à l'application, telles que les extensions de navigateur, seraient plus efficaces puisqu'elles peuvent en fait examiner les URL et opérer une sélection parmi les contenus pour empêcher ou non l'accès à ces derniers.</p>
	<p>La surveillance DNS n'est pas exhaustive. Les logiciels malveillants peuvent ignorer les DNS et coder en dur les adresses IP, ou utiliser <a href="https://blog.netlab.360.com/an-analysis-of-godlua-backdoor-en/" target="_blank">d'autres méthodes</a> pour interroger une adresse IP. Cependant, tous les logiciels malveillants ne sont pas nécessairement complexes, de sorte que la surveillance DNS peut toujours servir d'outil de <a href="https://en.wikipedia.org/wiki/Defense_in_depth_%28computing%29" target="_blank">défense en profondeur</a>.</p>
	<p>Tous ces cas d'utilisation de surveillance non passive ou de blocage DNS nécessitent l'aide du résolveur DNS. Les configurations qui se basent sur des mises à jour DoH/DoT opportunistes du résolveur actuel conserveront les mêmes fonctionnalités que celles habituellement assurées par les DNS non chiffrés. Malheureusement, cette approche est vulnérable aux attaques par déclassement, comme nous l'avons déjà indiqué. Pour résoudre ce problème, les administrateurs système peuvent diriger les points de terminaison vers un résolveur DoH/DoT en mode strict. Idéalement, cela se fait par le biais de solutions de gestion des périphériques sécurisés (<a href="https://en.wikipedia.org/wiki/Mobile_device_management" target="_blank">MDM</a>, <a href="https://en.wikipedia.org/wiki/Group_Policy" target="_blank">stratégie de groupe</a> sur Windows, etc.).</p>
	<h2 id="conclusion"><strong>Conclusion</strong></h2>
	<p>L'une des pierres angulaires d'Internet est le mappage des noms vers une adresse en utilisant les DNS. Les DNS utilisent depuis toujours des modes de transport non chiffrés et non sécurisés. Des FAI s'en sont déjà servis à mauvais escient dans le passé pour diffuser de la <a href="https://www.icsi.berkeley.edu/pubs/networking/redirectingdnsforads11.pdf" target="_blank">publicité</a>, mais cela a aussi entraîné des fuites de données personnelles. Les clients d'un cybercafé indiscrets peuvent utiliser des DNS non chiffrés pour surveiller vos activités. Il est possible de résoudre tous ces problèmes en utilisant DNS over TLS (DoT) ou DNS over HTTPS (DoH). Ces techniques de protection de l'utilisateur sont relativement nouvelles et sont de plus en plus répandues.</p>
	<p>D'un point de vue technique, DoH est très similaire à HTTPS et suit la tendance générale du secteur qui est de <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" target="_blank">désavouer les solutions non sécurisées</a>. DoT est un mode de transport plus simple que DoH dans la mesure où la couche HTTP est supprimée, mais cela facilite également le blocage, volontaire ou accidentel.</p>
	<p>Le choix d'un résolveur DNS vient en complément de l'activation d'un mode de transport sécurisé. Certains prestataires utilisent un résolveur DNS configuré localement, mais tentent de remplacer de manière opportuniste le protocole de transport non chiffré par un protocole plus sécurisé (DoT ou DoH). Malheureusement, le résolveur DNS est généralement par défaut celui fourni par le FAI, qui ne prend pas nécessairement en charge les modes de transport sécurisés.</p>
	<p>Mozilla a adopté une approche différente. Plutôt que de compter sur des résolveurs locaux qui ne prennent même pas en charge DoH, ils permettent à l'utilisateur de sélectionner explicitement un résolveur. Les résolveurs recommandés par Mozilla doivent satisfaire à des <a href="https://wiki.mozilla.org/Security/DOH-resolver-policy" target="_blank">normes élevées</a> de protection de la vie privée des utilisateurs. Afin de garantir que les fonctions de contrôle parental basées sur les DNS restent fonctionnelles et de prendre en charge le cas d’utilisation du découpage d’horizon, Mozilla a <a href="https://support.mozilla.org/en-US/kb/configuring-networks-disable-dns-over-https" target="_blank">ajouté</a> un mécanisme permettant aux résolveurs privés de désactiver DoH.</p>
	<p>Les protocoles de transport DoT et DoH vont pouvoir nous permettre de passer à un Internet plus sûr. Comme on peut le voir dans les suivis de paquets précédents, ces protocoles sont similaires aux mécanismes existants pour sécuriser le trafic des applications. Une fois cette faille de sécurité et de protection de la vie privée colmatée, il en restera encore <a href="https://arxiv.org/pdf/1906.09682.pdf" target="_blank">beaucoup</a> <a href="https://blog.cloudflare.com/esni/">d'autres</a>.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/10/tales-from-the-crypto-team@2x-5.png" class="kg-image"></figure>
</div>