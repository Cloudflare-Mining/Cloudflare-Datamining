<div class="mb2 gray5">8 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/09/image7-11.png" class="kg-image" alt="Amazon’s $2bn IPv4 tax — and how you can avoid paying it" loading="lazy" width="1801" height="1013"></figure>
	<p>Ce qu'il y a de merveilleux avec Internet c'est que, tant pour le consommateur que pour le producteur, les coûts n'ont jamais cessé de diminuer. Fut un temps où il vous fallait une salle de serveurs, toute une série de matériel et une armée de techniciens pour que tout fonctionne. Le cloud a certes profondément transformé cela mais cela n'empêchait pas de nombreux services tels que SSL ou la protection illimitée contre les attaques DDoS de rester hors de portée pour beaucoup. Nous pensons que l'évolution vers un Internet plus accessible, tant en ce qui concerne la facilité d'utilisation que la réduction des coûts, est un progrès formidable et nous sommes fiers d'y avoir contribué.</p>
	<p>Il arrive toutefois que la marche du progrès soit interrompue.</p>
	<p>Le 28 juillet 2023, <a href="https://aws.amazon.com/blogs/aws/new-aws-public-ipv4-address-charge-public-ip-insights" target="_blank">Amazon Web Services (AWS) annonçait</a> qu'à compter du 1er février 2024, toutes les adresses IPv4 publiques, qu'elles soient rattachées à un service ou non, allaient être facturées par IP et par heure. Ce changement de paradigme ajoutera au moins 43 dollars par an de frais pour chaque adresse IPv4 ; cela peut ne pas sembler énorme, mais des analyses rapides <a href="https://www.linkedin.com/posts/atoonk_new-aws-public-ipv4-address-charge-public-activity-7091779585368862720-x0zw" target="_blank">laissent à penser</a> que cela devrait engendrer environ deux milliards de dollars de taxe sur Internet.</p>
	<p>Dans cet article de blog, nous vous proposerons une explication un peu plus détaillée de la technologie impliquée, mais surtout, nous vous indiquerons, étape par étape, comment Cloudflare peut vous aider à vous affranchir de la nécessité de payer Amazon pour un service qu'ils ne devraient tout simplement pas vous facturer et si vous êtes un client de l'offre Pro ou Business, au lieu de vous voir débourser 43 dollars, nous souhaitons que vous les empochiez. Ne donnez pas 43 dollars à Amazon pour IPv4, laissez-nous vous donner 43 dollars en plus d'IPv4.</p>
	<h3 id="ce-que-cloudflare-peut-vous-apporter">Ce que Cloudflare peut vous apporter</h3>
	<p>Le seul moyen d'éviter d'avoir à payer la taxe d'Amazon pour IPv4 est de passer à IPv6 avec AWS. Nous sommes cependant conscients de ce que tout le monde n'est pas prêt à franchir le cap ; le processus peut être coûteux et difficile, ou encore provoquer des problèmes de compatibilité matérielle ou de performances réseau. Nous passons en revue les détails de ces difficultés ci-après, poursuivez donc la lecture ! Cloudflare peut faciliter la transition : alors, laissez-nous le soin de communiquer avec AWS avec d'IPv6. Par ailleurs, vous bénéficierez de tous les autres avantages liés à l'utilisation de Cloudflare et de notre réseau mondial (notamment les performances et la sécurité qui ont fait la réputation de Cloudflare), ainsi que d'un crédit de 43 dollars sur l'utilisation de nos services !</p>
	<p>De tels services IPv6, Cloudflare en propose depuis des années ; en réalité nous les avons annoncés lors de la première semaine anniversaire de Cloudflare en 2011 ! Nous avons également fait en sorte que le processus soit simple, vous pouvez donc le configurer dès aujourd'hui.</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/image6-2.png" class="kg-image" alt="" loading="lazy" width="1999" height="628"></figure>
	<p>Pour configurer cette fonctionnalité, vous devrez activer la compatibilité IPv6 et configurer votre serveur d' origine <a href="https://docs.aws.amazon.com/vpc/latest/userguide/aws-ipv6-support.html" target="_blank">AWS sur IPv6</a>.</p>
	<p>Pour ce faire, procédez selon les étapes suivantes :</p>
	<ol>
		<li>Connectez-vous à votre compte Cloudflare.</li>
		<li>Sélectionnez le domaine concerné.</li>
		<li>Cliquez sur Network (Réseau).</li>
	</ol>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/Screenshot-2023-09-25-at-17.01.11.png" class="kg-image" alt="" loading="lazy" width="1580" height="332"></figure>
	<p>4. &nbsp; Vérifiez que la compatibilité IPv6 est bien activée.</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/Screenshot-2023-09-25-at-17.01.24.png" class="kg-image" alt="" loading="lazy" width="1590" height="222"></figure>
	<p>Pour obtenir un serveur d'origine IPv6 auprès d'Amazon, vous devrez probablement suivre ces étapes :</p>
	<ol>
		<li>Associez un bloc CIDR IPv6 à votre VPC et vos sous-réseaux</li>
		<li>Mettez à jour vos tables de routage</li>
		<li>Mettez à jour vos règles de groupe de sécurité</li>
		<li>Changez votre type d'instance</li>
		<li>Attribuez des adresses IPv6 à vos instances</li>
		<li>(Option) Configurez IPv6 sur vos instances</li>
	</ol>
	<p>(Pour plus d'informations concernant cette migration, consultez <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-migrate-ipv6.html#vpc-migrate-ipv6-example" target="_blank">ce lien</a>.)</p>
	<p>Une fois les origines IPv6 définies, il vous faudra mettre à jour vos origines sur Cloudflare, afin que des adresses IPv6 soient utilisées. Dans l'exemple simple d'une origine unique à la racine, cela se fait par la création d' un enregistrement AAAA placé en proxy (orange-cloud) dans votre éditeur DNS Cloudflare :</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/image2-8.png" class="kg-image" alt="" loading="lazy" width="1999" height="532"></figure>
	<p>Si vous utilisez des équilibreurs de charge, vous devrez <a href="https://developers.cloudflare.com/load-balancing/how-to/create-pool/#edit-a-pool" target="_blank">mettre à jour les origines</a> ici.</p>
	<p>Une fois que c'est fait, vous pouvez supprimer le ou les enregistrements A/IPv4 et le trafic se déplacera vers l'adresse V6. Si ce processus est aujourd'hui simple, nous travaillons à simplifier plus encore la migration vers IPv6 sur Cloudflare.</p>
	<p>Une fois que vous avez configuré ces fonctionnalités et que le trafic circule dans Cloudflare vers votre serveur d'origine depuis au moins 6 mois, vous êtes éligible à un crédit de 43 dollars transféré directement dans votre compte Cloudflare ! Vous pouvez utiliser ce crédit dans le cadre de votre abonnement Pro ou Business ou encore pour votre utilisation de Workers et R2. Consultez <a href="https://www.cloudflare.com/lp/avoid-amazon-ipv4-tax" target="_blank">cet article</a> pour plus d'informations concernant l'inscription à cette offre.</p>
	<p>Avec cette fonctionnalité, Cloudflare vous accorde la souplesse nécessaire pour gérer vos paramètres IPv6 selon vos besoins. En profitant de la prise en charge adaptable d'IPv6 par Cloudflare, vous garantissez une connectivité sans interruption à vos utilisateurs, sans qu'ils aient à payer de coûts supplémentaires pour les adresses IPv4 publiques.</p>
	<h3 id="quest-ce-qui-cloche-avec-ipv4">Qu'est-ce qui cloche avec IPv4 ?</h3>
	<p>Donc, si Cloudflare propose cette solution, quel est l'intérêt de passer à IPv6 ? Et bien, pour que l'explication soit limpide, commençons par évoquer le problème d'IPv4.</p>
	<p><a href="https://www.cloudflare.com/learning/network-layer/internet-protocol/#:~:text=The%2520Internet%2520Protocol%2520(IP)%2520is,Network%2520layer" target="_blank">Les adresses IP</a> servent à identifier et atteindre des ressources sur un réseau. Il peut s'agir d'un réseau privé, tel que celui que vous utilisez au bureau, ou d'un réseau public complexe, comme c'est le cas d'Internet. Voici un exemple d'adresse IPv4 198.51.100.1 ou 198.51.100.50. Il existe environ 4,3 milliards d'adresses IPv4 de ce type associées à des sites web, serveurs et autres destinations sur l'Internet et qui peuvent être utilisées pour le routage.</p>
	<p>Le chiffre de 4,3 milliards d'adresses IPv4 peut paraître énorme, mais il ne l'est pas tant que ça puisque l'espace IPv4 est en train de s'épuiser. En septembre 2015, ARIN, un des registres Internet régionaux qui permettent aux personnes d'acquérir des adresses IP, <a href="https://www.arin.net/resources/guide/ipv4" target="_blank">a annoncé</a> qu'il était à court d'espace disponible : si vous souhaitez acheter une adresse IPv4, vous devez vous adresser aux entreprises privées qui les vendent. Ces entreprises facturent une coquette somme pour leurs adresses IPv4. Le tarif aujourd'hui se situe autour de <a href="https://auctions.ipv4.global" target="_blank">40 USD par adresse IPv4</a>. Pour acheter un regroupement d'adresses IPv4, ce que l'on appelle également un préfixe et qui comporte au minimum 256 adresses IP, il faut débourser environ 10 000 USD.</p>
	<p>Les adresses IP sont nécessaires pour disposer d'un domaine ou d'un appareil sur Internet, mais de nos jours les adresses IPv4 sont une ressource de plus en plus complexe à acquérir. Par conséquent, pour favoriser la croissance de l'internet, il fallait mettre à disposition un plus grand nombre d'adresses uniques sans ruiner les clients. C'est là que l'IPv6 entre en jeu.</p>
	<h3 id="ipv4-vs-ipv6">IPv4 vs IPv6</h3>
	<p>En 1995 l'IETF (Internet Engineering Task Force) publiait la <a href="https://datatracker.ietf.org/doc/html/rfc1883" target="_blank">RFC</a> pour IPv6 qui proposait de résoudre le problème de l'espace limité de l'IPv4. Au lieu de 32 bits d'espace adressable, l'IPv6 élargissait à 128 bits d'espace adressable. <strong>Cela signifie qu'au lieu de 4,3 milliards d'adresses disponibles, il en existe environ 340 millions de décillions</strong>. Cela correspond plus ou moins au nombre de grains de sable présents sur terre.</p>
	<p>S'il y une solution à ce problème, pourquoi s'inquiéter ? &nbsp;La réponse tient au fait que de nombreux réseaux sur Internet continuent de préférer IPv4 et que des entreprises telles que AWS commencent à facturer l'utilisation d'IPv4.</p>
	<p>Commençons par évoquer le cas d'AWS : aujourd'hui AWS possède les plus grandes parts de l'espace IPv4. Durant une certaine période, lorsque les adresses IPv4 étaient vendues pour quelques dollars par adresse IP sur le marché privé, AWS a fait le choix de mettre à profit de son énorme capital en achetant une grande quantité de l'espace. Aujourd'hui, AWS possède 1,7 % de l'espace d'adressage IPv4, ce qui correspond à<a href="https://toonk.io/aws-and-their-billions-in-ipv4-addresses/index.html" target="_blank"> environ 100 millions d'adresses IPv4</a>.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/09/image1-11.png" class="kg-image" alt="" loading="lazy" title="Chart" width="1934" height="1190"></figure>
	<p>D'aucuns penseraient que la meilleure chose à faire est de passer à IPv6, toutefois, pour la communauté d'Internet, l'opération s'avère pour le moins compliquée.</p>
	<p>Lorsqu'IPv6 a été publiée dans les années 1990, très peu de réseaux étaient équipés pour la prise en charge d'IPv6. Cependant, en 2023 la situation est différente : les réseaux mondiaux qui prennent en charge IPv6 ont <a href="https://pulse.internetsociety.org/technologies" target="_blank">augmenté de 46 pour cent</a>, il existe donc de moins en moins de contraintes matérielles empêchant la prise en charge de cette version. Par ailleurs, les outils de sécurité et de lutte contre les abus n'avaient initialement aucune idée de la manière de traiter les attaques ou le trafic utilisant l'espace d'adressage IPv6, et cela reste un problème pour certains de ces outils. En 2014, pour faciliter la tâche de conversion pour les outils d'origine, nous avons créé un <a href="https://blog.cloudflare.com/eliminating-the-last-reasons-to-not-enable-ipv6">pseudo IPv4</a> qui permet de rapprocher ces outils.</p>
	<p>Malgré ces efforts, de nombreux réseaux ne disposent toujours pas de l'infrastructure suffisante pour prendre en charge la mise en réseau selon IPv6 dans la mesure où la plupart des réseaux ont été conçus sur IPv4. Chez Cloudflare, nous avons développé notre réseau de telle sorte que les deux protocoles puissent être acceptés, ce système est connu sous le nom de « dual-stack ».</p>
	<p>Pendant une certaine période, de nombreux réseaux faisaient également état de performances sérieusement dégradées avec IPv6 par rapport à IPv4. Ce n'est plus le cas. En effet, la dégradation des performances observée avec IPv6 dans tout l'internet est minime par rapport à IPv4. Elle s'explique notamment par l'ancienneté du matériel, la connectivité IPv6 non optimale en dehors de notre réseau et le coût élevé du déploiement d'IPv6. Vous pouvez constater dans le tableau ci-dessous la latence supplémentaire sur le trafic IPv6 sur le réseau de Cloudflare par rapport au trafic IPv4 :</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/09/image5-5.png" class="kg-image" alt="" loading="lazy" title="Chart" width="1200" height="742"></figure>
	<p><br>De nombreux obstacles sont venus entraver l'adoption d'IPv6. Pour certains, il subsiste des problèmes de compatibilité matérielle et de performances. C'est pourquoi il peut être judicieux de continuer à utiliser IPv4 pendant la transition vers IPv6 et la décision d'AWS de facturer IPv4 pèse donc sur de nombreux sites web.</p>
	<h3 id="%C3%A9vitez-donc-de-payer-la-taxe-daws">Évitez donc de payer la taxe d'AWS</h3>
	<p>En fin de compte, le choix est évident : vous pouvez payer Amazon plus cher pour louer ses adresses IP que pour les acheter, ou passer à Cloudflare et utiliser notre service gratuit pour faciliter la transition vers l'IPv6 à moindres frais.</p>
</div>