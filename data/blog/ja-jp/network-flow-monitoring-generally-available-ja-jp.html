<div class="mb2 gray5">7 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/10/image4-4.png" class="kg-image" alt="Network flow monitoring is GA, providing end-to-end traffic visibility" loading="lazy" width="1999" height="1125"></figure>
	<p>ネットワークエンジニアは、DDoS攻撃の分析やその他のトラフィックの異常をトラブルシューティングする際に、ネットワークのトラフィックや運用をより適切に可視化する必要性に気づくことがよくあります。このようなエンジニアは通常、ネットワークトラフィックに関する高度なメトリックを持っていますが、問題を明確にする特定のトラフィックフローに関する重要な情報を収集するのに苦労しています。この問題を解決するために、Cloudflareは、<a href="https://www.cloudflare.com/network-services/products/magic-network-monitoring" target="_blank">Magic Network Monitoring</a>と呼ばれるクラウドネットワークフロー監視製品を試験的に実施しており、お客様はネットワーク全体のすべてのトラフィックをエンドツーエンドで可視化できます。</p>
	<p>本日、CloudflareはMagic Network Monitoring（旧<a href="https://blog.cloudflare.com/flow-based-monitoring-for-magic-transit">Flow Based Monitoring</a>）をすべての企業のお客様に一般提供することを発表でき、嬉しく思います。過去1年間にわたって、CloudflareのエンジニアリングチームはMagic Network Monitoringを大幅に改善しました。当社は、お客様が脅威をより迅速に特定し、脆弱性を軽減し、ネットワークをより安全にするのに役立つネットワークサービス製品を提供できることを嬉しく思っています。<br><br>Magic Network Monitoringは、Magic TransitおよびMagic WANの企業のお客様に対し、自動的に有効になります。この製品はCloudflareダッシュボードのアカウントレベルにあり、「分析とログ&gt; Magic Monitoring」に移動して開くことができます。Magic Network Monitoringのオンボーディングプロセスはセルフサービスで、アクセス権を持つすべての企業のお客様は本日より、製品の設定を開始できます。</p>
	<p>Magic TransitまたはMagic WANをお持ちでない企業のお客様で、Magic Network Monitoringの試用に関心をお持ちのお客様は、Cloudflareのアカウントチームにリクエストを送信するか、こちらのフォームに記入して<a href="http://network-services/products/magic-network-monitoring" target="_blank">専門家に相談する</a>ことで、無料版（トラフィック量に多少の<a href="https://developers.cloudflare.com/magic-network-monitoring/magic-network-monitoring-free" target="_blank">制限</a>があります）にアクセスできます。</p>
	<h3 id="magic-network-monitoring%E3%81%A8%E3%81%AF%EF%BC%9F">Magic Network Monitoringとは？</h3>
	<p>Magic Network Monitoringはクラウドネットワークフロー監視です。<a href="https://en.wikipedia.org/wiki/Traffic_flow_(computer_networking)" target="_blank">ネットワークトラフィックフロー</a>とは、同じインターネットプロトコルとポートのセットを持つ、1つのソースと1つの宛先間のパケットストリームを指します。お客様は、トラフィックがもともとCloudflareのネットワークを通過していなくても、ルーター（またはその他のネットワークフロージェネレーター）から<a href="https://www.cloudflare.com/learning/cdn/glossary/anycast-network" target="_blank">Cloudflareのエニーキャストネットワーク</a>上の一般に利用可能なエンドポイントにネットワークフローレポートを送信できます。Cloudflareはネットワークフローデータを分析し、分析ダッシュボードを介して主要なネットワークトラフィックメトリックをお客様に可視化します。これらのメトリクスには、経時的なトラフィック量（ビットまたはパケット単位）、送信元IP、宛先IP、ポート、トラフィックプロトコルおよびルーターIPが含まれます。また、お客様は<a href="https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack" target="_blank">DDoS攻撃</a>やその他の異常なトラフィック量のアクティビティを識別するようにアラートを設定できます。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2023/10/1-1.png" class="kg-image" alt="" loading="lazy" width="1435" height="802">
		<figcaption>お客様のネットワークからCloudflareにフローデータを送信し、分析を行います</figcaption>
	</figure>
	<h3 id="%E4%BC%81%E6%A5%AD%E3%81%AEddos%E6%94%BB%E6%92%83%E3%82%BF%E3%82%A4%E3%83%97%E3%81%AE%E6%A4%9C%E5%87%BA">企業のDDoS攻撃タイプの検出</h3>
	<p><a href="https://developers.cloudflare.com/magic-transit/on-demand" target="_blank">Magic Transit On Demand</a>（MTOD）のお客様は、Magic Network Monitoringを使用することで、トラフィックの可視性が大幅に向上します。<a href="https://www.cloudflare.com/network-services/products/magic-transit" target="_blank">Magic Transit</a>は、オンプレミス、クラウドホスト、ハイブリッドネットワーク向けに、すべてのCloudflareデータセンターからDDoS攻撃対策およびトラフィックの高速化を提供するネットワークセキュリティソリューションです。Magic Transit On Demandのお客様は、DDoS攻撃が検出されたときにMagic Transitを有効にして保護できます。</p>
	<p>一般的に、一部のMTODのお客様は、DDoS攻撃を迅速に識別し、適切な軽減措置を講じるためのネットワーク可視化ツールが不足していることがわかりました。現在、MTODのお客様はMagic Network Monitoringを使用してネットワークデータを分析し、DDoS攻撃が検出された場合にアラートを受信できます。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2023/10/2-1.png" class="kg-image" alt="" loading="lazy" width="1436" height="761">
		<figcaption>Cloudflareはお客様のネットワークフローデータからDDoS攻撃を検出します</figcaption>
	</figure>
	<p>一度DDoS攻撃が検出されると、Magic Network Monitoringのお客様は、DDoS攻撃を軽減するために手動または自動のいずれかを選択し、Magic Transitを有効にすることができます。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2023/10/3-1.png" class="kg-image" alt="" loading="lazy" width="1436" height="761">
		<figcaption>DDoS攻撃対策のためにMagic Transitを有効にする</figcaption>
	</figure>
	<h3 id="%E4%BC%81%E6%A5%AD%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E7%9B%A3%E8%A6%96">企業のネットワーク監視</h3>
	<p>CloudflareのMagic WANおよびCloudflare Oneのお客様もMagic Network Monitoringを使用することで利益が得られます。今日、これらのお客様はCloudflareのネットワークを介して送信されるトラフィックに対し、優れた可視性を有していますが、時には、Cloudflareを介して送信されないトラフィックは、可視性に欠けている場合があります。これにはローカルネットワーク上に残るトラフィックや、クラウド環境間で送信されるネットワークトラフィックが含まれます。Magic WANとCloudflare Oneのお客様は、Magic Network Monitoringを自社の一連の製品ソリューションに追加することで、ネットワーク上のすべてのトラフィックにわたり、エンドツーエンドのネットワークの可視性を確立できます。</p>
	<h3 id="%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%81%8A%E3%82%88%E3%81%B3%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%88%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E6%B7%B1%E6%8E%98%E3%82%8A%E3%81%97%E3%81%BE%E3%81%99">ネットワークフローおよびネットワークトラフィックのサンプリングを深掘りします</h3>
	<p>Magic Network Monitoringは、ネットワークフローデータを取り込み分析することで、ネットワークトラフィックの可視性がより向上します。<br><br>このプロセスは、ルーター（またはその他のネットワークフロー生成デバイス）がインバウンドおよび/またはアウトバウンドのパケットデータの<a href="https://en.wikipedia.org/wiki/Sampling_(statistics)" target="_blank">統計サンプルを</a>収集するときに開始されます。これらのサンプルは、X個のパケットごとに1個を検査して収集され、Xはルーターで設定されたサンプリングレートです。一般的なサンプリングレートは、1,000パケットごとに1から4,000パケットごとに1の範囲です。理想的なサンプリングレートは、トラフィック量、トラフィックの多様性、ルーターのハードウェアの計算能力/メモリ能力よって異なります。<a href="https://developers.cloudflare.com/magic-network-monitoring/routers/recommended-sampling-rate" target="_blank">推奨されるネットワークフローサンプリングレート</a>の詳細については、CloudflareのMNM開発者ドキュメントを参照してください。<br><br>サンプリングされたデータは、ネットワークフローデータの2つの業界標準形式（NetFlowまたはsFlow）のいずれかにパッケージ化されます。NetFlowでは、サンプリングされたパケットデータは、送信元IPまたは宛先IP、ポート、プロトコルなどのさまざまなパケットの特性によってグループ化されます。サンプリングされたパケットデータの各グループには、トラフィック量の推定値も含まれます。sFlowでは、パケットヘッダ全体が代表サンプルとして選択され、データの要約は行われません。その結果、sFlowは、より豊富なデータ形式であり、NetFlowデータよりもネットワークトラフィックに関する詳細が含まれています。NetFlowまたはsFlowデータサンプルのいずれかが収集されると、分析とアラートのためにMagic Network Monitoringに送信されます。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/10/4-1.png" class="kg-image" alt="" loading="lazy" width="1600" height="400"></figure>
	<h3 id="%E5%8D%98%E7%B4%94%E3%81%AA%E7%84%A1%E4%BD%9C%E7%82%BA%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%8Cmagic-network-monitoring%E3%81%A7%E6%A9%9F%E8%83%BD%E3%81%97%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E7%90%86%E7%94%B1">単純な無作為サンプリングがMagic Network Monitoringで機能しなかった理由</h3>
	<p>Magic Network Monitoringは1年前の早期アクセスリリースから大きな進歩を遂げてきました。特に、Cloudflareのエンジニアリングチームは、MNMのトラフィック量の推定精度向上に多大な時間を投資しました。Magic Network Monitoringの早期アクセス版では、ネットワークトラフィック量の推定値が高すぎて、期待値と一致していないとお客様から予期していなかった報告がありました。<br><br>Magic Network Monitoringは、受信したNetFlowまたはsFlowデータを独自にサンプリングするため、Cloudflare のグローバルネットワーク全体で取り込まれたデータを効果的に拡張および管理できます。MNMによって解析されたNetFlowまたはsFlowデータはすでにサンプリングされたパケットデータに基づいて構築されているため、トラフィック量の推定精度を高めることは予想以上にはるかに困難でした。これにより、製品の分析では、データサンプリングに複数の異なるレイヤーが導入されます。</p>
	<p>Magic Network Monitoringの最初のバージョンでは、同じタイムスタンプを持つネットワークフローデータのランダムなサブセットを選択して、その時点のトラフィック量を表す<a href="https://en.wikipedia.org/wiki/Simple_random_sample" target="_blank">ランダムサンプリング</a>を使用していました。ネットワークフローデータの特徴として、いくつかのサンプルはその他のサンプルよりも重要であり、ネットワークトラフィックが大量であることです。この重要性を説明するために、<a href="https://en.wikipedia.org/wiki/Weighting" target="_blank">重み付け</a>を各サンプルに関連付けることができます。これは、サンプルが表すトラフィック量に基づいています。ネットワークフローデータの重み付けは常に正の数であり、<a href="https://en.wikipedia.org/wiki/Long_tail" target="_blank">ロングテール分布</a>に従います。このようなデータ特性により、MNMのランダムサンプリングが顧客のネットワークのトラフィック量を誤って推定してしまいました。ロングテールからの外れたデータサンプルがその時点ですべてのトラフィックの代表としてランダムに選択された場合、お客様は、トラフィック量の分析で誤ったスパイクが表示されることがあります。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/10/5-1.png" class="kg-image" alt="" loading="lazy" width="1600" height="400"></figure>
	<h3 id="varopt%E3%83%AA%E3%82%B6%E3%83%BC%E3%83%90%E3%83%BC%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%A7%E7%B2%BE%E5%BA%A6%E3%82%92%E5%90%91%E4%B8%8A">VarOptリザーバーサンプリングで精度を向上</h3>
	<p>この問題を解決するために、Cloudflareエンジニアリングチームは、<a href="https://arxiv.org/pdf/0803.0473.pdf" target="_blank">VarOp</a>と呼ばれる代替の<a href="https://en.wikipedia.org/wiki/Reservoir_sampling" target="_blank">貯留層サンプリング</a>技術を実装しました。VarOptは、データストリームの長さが不明な場合にデータストリームからサンプルを収集するように設計されています（受信ネットワークフローデータを分析するのに最適なアプリケーション）。MNMのVarOptの実装では、ネットワークフローデータのサンプルで満たされた固定サイズの空のリザーバーから開始します。リザーバーがいっぱいで、新しい受信ネットワークフローデータがまだある場合、古いサンプルがリザーバーからランダムに破棄され、新しいサンプルと置き換えられます。一定数のサンプルが観察された後、リザーバー内のすべての加重サンプルにわたるトラフィック量を計算します。これが、その時点での顧客のネットワークフローの推定トラフィック量となります。最後に、リザーバーが空になり、最新のネットワークフローサンプルの次のセットでリザーバーを満たすことによって、VarOptループが再開されます。</p>
	<p>新しいVarOptサンプリング手法により、Magic Network Monitoringのトラフィック量の推定精度が大幅に向上し、お客様の問題が解決されました。これらのサンプリングの改善により、一般提供への道が開かれ、正確なネットワークフロー分析を誰でも利用できるようになることを嬉しく思います。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/10/6-1.png" class="kg-image" alt="" loading="lazy" width="1600" height="320"></figure>
	<h3 id="%E9%96%8B%E7%99%BA%E8%80%85%E5%90%91%E3%81%91%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8A%E3%82%88%E3%81%B3discord%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3">開発者向けドキュメントおよびDiscordコミュニティ</h3>
	<p>Magic Network Monitoringの詳細な<a href="https://developers.cloudflare.com/magic-network-monitoring" target="_blank">開発者ドキュメント</a>では、製品の機能を説明し、新規のお客様向けのステップバイステップの設定ガイドの概要を説明しています。Magic Network Monitoringドキュメントにお取り組みの上、開発者ドキュメントの右上隅にある[フィードバックする]ボタンをクリックして、お気軽にフィードバックをお寄せください。</p>
	<p>また、CloudflareのDiscordコミュニティに、設定問題のデバッグ、新機能のテスト、製品フィードバックの提供を中心に構築されたチャネルを作成しました。このリンクから<a href="https://discord.gg/cloudflaredev" target="_blank">Cloudflare Discordサーバー</a>に参加できます。</p>
	<h3 id="%E7%84%A1%E6%96%99%E7%89%88">無料版</h3>
	<p><a href="https://developers.cloudflare.com/magic-network-monitoring/magic-network-monitoring-free" target="_blank">Magic Network Monitoringの無料版</a>は、Cloudflareアカウントチームへのリクエストに応じて、すべてのEnterpriseのお客様にご利用いただけます。無料版は、Enterpriseのお客様が、Magic Transit、Magic WAN、または Cloudflare Oneを購入する前に、Magic Network Monitoringを迅速にテストおよび評価できるように設計されています。Enterpriseのお客様は、製品ドキュメントの<a href="https://developers.cloudflare.com/magic-network-monitoring/get-started" target="_blank">ステップバイステップのオンボーディングガイド</a>に従って、Magic Network Monitoringを自分ですべて設定できます。無料版には、処理できるトラフィック量に多少、<a href="https://developers.cloudflare.com/magic-network-monitoring/magic-network-monitoring-free" target="_blank">制限</a>があり、製品のドキュメントでさらに概説されています。</p>
	<p>Magic Network Monitoringの無料版は、クローズドベータを介して、Free、Pro、およびBusinessプランのCloudflareのすべてのお客様にもご利用いただけます。<a href="https://developers.cloudflare.com/magic-network-monitoring/magic-network-monitoring-free" target="_blank">無料版のドキュメントを読み</a>、<a href="https://forms.gle/z93ghpydpKdAFZ7P9" target="_blank">このフォームに記入</a>することで、誰でも無料版へのアクセスをリクエストできます。<a href="https://discord.com/invite/cloudflaredev" target="_blank">CloudflareのDiscordサーバー</a>に参加し、Magic Network Monitoring Discordチャネルでメッセージを送信する人はすべて、優先アクセスが許可されます。</p>
	<h3 id="%E4%BB%8A%E6%97%A5%E3%81%8B%E3%82%89%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B%E6%AC%A1%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97">今日から実行できる次のステップ</h3>
	<p>Magic Network Monitoringは一般提供されており、Magic Transitおよび Magic WANのすべてのお客様は、現在、自動的に製品へのアクセスが許可されています。Cloudflareダッシュボードのアカウントレベルに移動し、「分析とログ &gt; Magic Monitoring」を選択すると、製品に移動できます。<br><br>Magic TransitやMagic WANをお持ちでない企業のお客様で、Magic Network Monitoringを使用してトラフィックの可視性を向上させたい場合は、今すぐ<a href="http://network-services/products/magic-network-monitoring" target="_blank">MNMの専門家にご相談ください</a>。<br><br>DDoS攻撃対策にMagic TransitおよびMagic Network Monitoringを使用することに関心がある場合は、<a href="https://www.cloudflare.com/network-services/products/magic-transit" target="_blank">Magic Transitのデモをリクエストできます</a>。Magic WANおよびMagic Network Monitoringを併用して、エンドツーエンドのネットワークトラフィックの可視性を確立したい場合は、<a href="https://www.cloudflare.com/network-services/products/magic-wan" target="_blank">Magic WANの専門家に相談してください</a>。</p>
</div>