{
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Filippo Valsorda",
				"slug": "filippo",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/46wTy3eKIkbnXRmuf2gsIt/ef5fc878a27d020b33532be5e44d9e1f/filippo.jpg",
				"location": null,
				"website": null,
				"twitter": "@filosottile",
				"facebook": null
			}
		],
		"excerpt": "CloudFlare's DNS server, RRDNS, is written in Go and the DNS team used to generate a file called version.go in our Makefile. version.go looked something like this.",
		"feature_image": "https:undefined",
		"featured": false,
		"html": "<p>CloudFlare&#39;s DNS server, <a href=\"/tag/rrdns/\">RRDNS</a>, is written in Go and the DNS team used to generate a file called <code>version.go</code> in our Makefile. <code>version.go</code> looked something like this:</p>\n            <pre class=\"language-go\"><code class=\"language-go\">// THIS FILE IS AUTOGENERATED BY THE MAKEFILE. DO NOT EDIT.\n\n// +build\tmake\n\npackage version\n\nvar (\n\tVersion   = &quot;2015.6.2-6-gfd7e2d1-dev&quot;\n\tBuildTime = &quot;2015-06-16-0431 UTC&quot;\n)</pre></code>\n            <p>and was used to embed version information in RRDNS. It was built inside the Makefile using <code>sed</code> and <code>git describe</code> from a template file. It worked, but was pretty ugly.</p><p>Today we noticed that another Go team at CloudFlare, the <a href=\"/tag/data/\">Data</a> team, had <b>a much smarter way to bake version numbers into binaries using the </b><code><b>-X</b></code><b> linker option</b>.</p><p>The <code>-X</code> <a href=\"https://golang.org/cmd/ld/\">Go linker option</a>, which you can set with <code>-ldflags</code>, sets the value of a string variable in the Go program being linked. You use it like this: <code>-X main.version 1.0.0</code>.</p><p>A simple example: let&#39;s say you have this source file saved as <code>hello.go</code>.</p>\n            <pre class=\"language-go\"><code class=\"language-go\">package main\n\nimport &quot;fmt&quot;\n\nvar who = &quot;World&quot;\n\nfunc main() {\n    fmt.Printf(&quot;Hello, %s.\\n&quot;, who)\n}</pre></code>\n            <p>Then you can use <code>go run</code> (or other build commands like <code>go build</code> or <code>go install</code>) with the <code>-ldflags</code> option to modify the value of the <code>who</code> variable:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ go run hello.go\nHello, World.\n$ go run -ldflags=&quot;-X main.who CloudFlare&quot; hello.go\nHello, CloudFlare.</pre></code>\n            <p>The format is <code>importpath.name string</code>, so it&#39;s possible to set the value of any string anywhere in the Go program, not just in main. Note that from Go 1.5 the syntax has <a href=\"https://tip.golang.org/cmd/link/\">changed</a> to <code>importpath.name=string</code>. The old style is still supported but the linker will complain.</p><p>I was worried this would not work with external linking (<a href=\"https://docs.google.com/document/d/1nr-TQHw_er6GOQRsF6T43GGhFDelrAP0NqSS_00RgZQ/view\">for example when using cgo</a>) but as we can see with <code>-ldflags=&quot;-linkmode=external -v&quot;</code> the Go linker runs first anyway and takes care of our <code>-X</code>.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ go build -x -ldflags=&quot;-X main.who CloudFlare -linkmode=external -v&quot; hello.go\nWORK=/var/folders/v8/xdj2snz51sg2m2bnpmwl_91c0000gn/T/go-build149644699\nmkdir -p $WORK/command-line-arguments/_obj/\ncd /Users/filippo/tmp/X\n/usr/local/Cellar/go/1.4.2/libexec/pkg/tool/darwin_amd64/6g -o $WORK/command-line-arguments.a -trimpath $WORK -p command-line-arguments -complete -D _/Users/filippo/tmp/X -I $WORK -pack ./hello.go\ncd .\n/usr/local/Cellar/go/1.4.2/libexec/pkg/tool/darwin_amd64/6l -o hello -L $WORK -X main.hi hi -linkmode=external -v -extld=clang $WORK/command-line-arguments.a\n# command-line-arguments\nHEADER = -H1 -T0x2000 -D0x0 -R0x1000\nsearching for runtime.a in $WORK/runtime.a\nsearching for runtime.a in /usr/local/Cellar/go/1.4.2/libexec/pkg/darwin_amd64/runtime.a\n 0.06 deadcode\n 0.07 pclntab=284969 bytes, funcdata total 49800 bytes\n 0.07 dodata\n 0.08 symsize = 0\n 0.08 symsize = 0\n 0.08 reloc\n 0.09 reloc\n 0.09 asmb\n 0.09 codeblk\n 0.09 datblk\n 0.09 dwarf\n 0.09 sym\n 0.09 headr\nhost link: clang -m64 -gdwarf-2 -Wl,-no_pie,-pagezero_size,4000000 -o hello -Qunused-arguments /var/folders/v8/xdj2snz51sg2m2bnpmwl_91c0000gn/T//go-link-mFNNCD/000000.o /var/folders/v8/xdj2snz51sg2m2bnpmwl_91c0000gn/T//go-link-mFNNCD/000001.o /var/folders/v8/xdj2snz51sg2m2bnpmwl_91c0000gn/T//go-link-mFNNCD/go.o -g -O2 -g -O2 -lpthread\n 0.17 cpu time\n33619 symbols\n64 sizeof adr\n216 sizeof prog\n23412 liveness data</pre></code>\n            <p><i>Do you want to work next to Go developers that can always make you learn a new trick? </i><a href=\"https://www.cloudflare.com/join-our-team\"><i>We are hiring in London, San Francisco and Singapore</i></a><i>.</i></p>",
		"id": "7JoU9nV9zNjoGpJYgiusvV",
		"localeList": {
			"name": "Setting Go variables from the outside Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2015-07-01T14:26:37.000+01:00",
		"reading_time": 2,
		"slug": "setting-go-variables-at-compile-time",
		"tags": [
			{
				"id": "5X8LHhjKihRu7muwB9u5a1",
				"name": "RRDNS",
				"slug": "rrdns"
			},
			{
				"id": "6lhzEBz2B56RKa4nUEAGYJ",
				"name": "Programming",
				"slug": "programming"
			},
			{
				"id": "KDI5hQcs301H8vxpGKXO0",
				"name": "Go",
				"slug": "go"
			},
			{
				"id": "6QVJOBzgKXUO9xAPEpqxvK",
				"name": "Reliability",
				"slug": "reliability"
			}
		],
		"title": "Setting Go variables from the outside",
		"updated_at": "2024-08-27T02:38:52.643Z",
		"url": "https://blog.cloudflare.com/setting-go-variables-at-compile-time"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}