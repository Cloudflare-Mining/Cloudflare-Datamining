<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image1-80.png" class="kg-image" alt="Protection against CVE-2021-45046, the additional Log4J RCE vulnerability"></figure>
	<p>继 CVE-2021-44228 之后，已提交了第二个 Log4J CVE：<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046" target="_blank">CVE-2021-45046</a>。我们<a href="https://blog.cloudflare.com/zh-cn/cve-2021-44228-log4j-rce-0-day-mitigation-zh-cn/">之前针对 CVE-2021-44228 发布</a>的规则针对这个新的 CVE 提供相同级别的保护。</p>
	<p>鉴于此漏洞被广泛地利用，使用 Log4J 的任何人士都应该尽快更新到版本 <strong>2.16.0</strong>，即使您之前已更新到 2.15.0。最新版本可在 <a href="https://logging.apache.org/log4j/2.x/download.html" target="_blank">Log4J 下载页面</a>上找到。</p>
	<p>使用 Cloudflare WAF 的客户可遵循三条规则来帮助缓解任何漏洞利用企图：</p>
	<!--kg-card-begin: markdown-->
	<table>
		<thead>
			<tr>
				<th>规则 ID</th>
				<th>描述</th>
				<th>默认操作</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><code>100514</code> (旧版 WAF)<br><code>6b1cc72dff9746469d4695a474430f12</code> (新版 WAF)</td>
				<td>Log4J 标头</td>
				<td><code>阻止</code></td>
			</tr>
			<tr>
				<td><code>100515</code> (旧版 WAF)<br><code>0c054d4e4dd5455c9ff8f01efe5abb10</code> (新版 WAF)</td>
				<td>Log4J 主体</td>
				<td><code>阻止</code></td>
			</tr>
			<tr>
				<td><code>100516</code> (旧版 WAF)<br><code>5f6744fa026a4638bda5b3d7d5e015dd</code> (新版 WAF)</td>
				<td>Log4J URL</td>
				<td><code>阻止</code></td>
			</tr>
		</tbody>
	</table>
	<!--kg-card-end: markdown-->
	<p>漏洞风险通过三条规则缓解，分别检查 HTTP 标头、主体和 URL。</p>
	<p>除了上述规则之外，我们还发布了第四条规则，用于防御广泛得多的一系列攻击，其代价是更高的误报率。为此，我们提供了该规则，但未将其默认设置为 BLOCK：</p>
	<!--kg-card-begin: markdown-->
	<table>
		<thead>
			<tr>
				<th>规则 ID</th>
				<th>描述</th>
				<th>默认操作</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><code>100517</code> (旧版 WAF)<br><code>2c5413e155db4365befe0df160ba67d7</code> (新版 WAF)</td>
				<td>Log4J 高级 URI，标头</td>
				<td><code>禁用</code></td>
			</tr>
		</tbody>
	</table>
	<!--kg-card-end: markdown-->
	<h3 id="-"><strong>受影响的对象</strong></h3>
	<p>Log4J 是基于 Java 的功能强大的组件，提供日志记录库，由 Apache Software Foundation 维护。</p>
	<p>在不低于 2.0-beta9 且不高于 2.14.1 的所有 Log4J 版本中，攻击者可以利用配置、日志消息和参数中的 JNDI 功能进行远程代码执行。具体来说，攻击者只要能控制日志消息或日志消息参数，就可以在启用消息查找替换的情况下，执行从 LDAP 服务器加载的任意代码。</p>
	<p>此外，之前针对 CVE-2021-22448 的缓解措施（如 2.15.0 中所看到的那样）不足以防御 CVE-2021-45046。</p>
</div>