<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/12/image-57.png" class="kg-image"></figure>
	<p>今天，我们发布了一项新的服务，自动平台优化（APO），它所能做到的远不止是服务于您网站上的静态内容。在这次发布中我们对WordPress提供了支持，这是最受欢迎的网站托管解决方案，为38％的网站提供了服务。我们的测试显示，通过Cloudflare网络为您的网站提供几乎所有内容，可以使90%的桌面用户的首字节时间（TTFB）减少72%，<a href="https://web.dev/fcp/" target="_blank">首次内容绘制</a>缩短23%，<a href="https://web.dev/speed-index/" target="_blank">速度指数</a>（Speed Index）减少13%。这意味着您网站的访问者不仅可以更快地看到首先绘制的内容，而且可以更快地看到所有内容。</p>
	<p>借助适用于WordPress的自动平台优化，诸如共享主机拥塞，数据库查找速度缓慢或插件行为不当等常见问题不会再为您的客户带来运行缓慢的问题。现在，任意WordPress用户都可以使用这项服务。</p>
	<h3 id="-">自动平台优化的定价</h3>
	<p>在我们的Free计划中，适用于WordPress的APO每月需收取5$的费用，在我们的Professional， Business和Enterprise计划中，该服务不收取额外费用。无需使用费，没有“意外”账单，<em>只有提速</em>。</p>
	<h3 id="--1">如何开始</h3>
	<p>开始使用APO的最简单方法是先进入WordPress管理控制台。</p>
	<ol>
		<li>首先，在WordPress网站上安装<a href="https://wordpress.org/plugins/cloudflare/" target="_blank">Cloudflare WordPress插件</a>或更新到最新版本（3.8.2或更高版本）。</li>
		<li>验证插件（<a href="https://wordpress.org/plugins/cloudflare/#installation" target="_blank">此处的步骤</a>）从而与Cloudflare进行对话（如果您尚未这样做的话）。</li>
		<li>在Cloudflare主页上打开自动平台优化。</li>
	</ol>
	<p>免费用户首先会被引导到Cloudflare的控制面板上以购买此服务。</p>
	<h3 id="--2">我们为什么构建此服务</h3>
	<p>在Cloudflare，客户只需点击一个按钮，我们就会欣然接受为其解决难题的机会。运行一个持续快速的网站是一个挑战。许多企业没有时间和金钱来为他们的站点提供复杂而昂贵的性能解决方案。即使他们这样做了，为了确保获得可能的最佳性能而特别地关注，也可能付出极其昂贵的代价。不过，拥有一个快速的网站并不一定很复杂。<strong>您的内容与您的客户越近，您的网站的效果就越好。</strong>静态内容缓存可以为图像、CSS和JavaScript等文件实现这一点，但这还不够。动态内容仍然是从源服务器获取的，这需要大量的往返和处理时间。有关动态和静态内容的更多信息，请参阅我们的<a href="https://www.cloudflare.com/learning/cdn/caching-static-and-dynamic-content/" target="_blank">学习中心</a>。</p>
	<p>WordPress是世界上最开放的平台之一，但是这意味着您总是会因插件或其他来源而有可能受到性能损失的风险，而在必要时，它们可能很难查明和解决。借助自动平台优化服务，我们将您的网站放入我们的网络中，无需更改您现有的主机提供商，您的网站就可以在10毫秒内连接到发达世界99%的互联网用户。这意味着对于大多数请求，您的客户甚至无需到访您的源服务器，这减少了大量的往返行程和服务器处理时间。这些优化运行在我们的边缘网络上，因此，由于没有在客户端上运行其他JavaScript，它们也不会影响渲染或交互性。</p>
	<h3 id="--3">我们如何衡量网络性能</h3>
	<p>评估网站的性能很困难。您可以跟踪许多不同的指标，而哪个度量标准最能有效地代表用户体验并不总是显而易见的。正如我们在<a href="https://blog.cloudflare.com/new-speed-page/">博客</a>中发布的新的<a href="https://dash.cloudflare.com/?to=/:account/:zone/speed" target="_blank">Speed页面</a>时所讨论的那样，我们旨在通过使用webpagetest.org的基础架构自动执行测试，并在一处可视化和数字化地汇总结果，从而为客户简化此操作。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/12/image-58.png" class="kg-image"></figure>
	<p>可视化可以让您清楚地知道客户访问您的站点时会看到什么，而<em>关键加载时间</em>是判断您网站性能的最重要指标。在查看您的网站性能的基础上，我们提供了一个建议列表来进一步提高其性能。如果您使用的是WordPress，那么我们会用自动平台优化来测试您的站点，以估计您将从这项服务中得到的好处。</p>
	<h3 id="--4">自动平台优化的好处</h3>
	<p>我们在超过500个基于WordPress的Cloudflare客户网站上测试了APO，以了解APO的性能会有哪些改进。结果不言自明：</p>
	<p><strong>测试结果</strong></p>
	<!--kg-card-begin: markdown-->
	<style type="text/css">
		.tg {
			border-collapse: collapse;
			border-spacing: 0;
		}

		.tg td {
			border-color: black;
			border-style: solid;
			border-width: 1px;
			font-family: Arial, sans-serif;
			font-size: 14px;
			overflow: hidden;
			padding: 10px 5px;
			word-break: normal;
		}

		.tg th {
			border-color: black;
			border-style: solid;
			border-width: 1px;
			font-family: Arial, sans-serif;
			font-size: 14px;
			font-weight: normal;
			overflow: hidden;
			padding: 10px 5px;
			word-break: normal;
		}

		.tg .tg-aa1j {
			background-color: #c0c0c0;
			border-color: inherit;
			font-size: 18px;
			font-weight: bold;
			text-align: center;
			vertical-align: middle
		}

		.tg .tg-r5qm {
			border-color: inherit;
			font-size: 18px;
			text-align: left;
			vertical-align: middle
		}
	</style>
	<table class="tg">
		<thead>
			<tr>
				<th class="tg-aa1j">指标</th>
				<th class="tg-aa1j">百分位</th>
				<th class="tg-aa1j">Cloudflare基线</th>
				<th class="tg-aa1j">启用APO</th>
				<th class="tg-aa1j">改善 (%)</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td class="tg-r5qm" rowspan="2"><span style="font-weight:400;font-style:normal;text-decoration:none">首字节时间 (TTFB)</span></td>
				<td class="tg-r5qm">90th</td>
				<td class="tg-r5qm">1252 ms</td>
				<td class="tg-r5qm">351 ms</td>
				<td class="tg-r5qm">71.96%</td>
			</tr>
			<tr>
				<td class="tg-r5qm">10th</td>
				<td class="tg-r5qm">254 ms</td>
				<td class="tg-r5qm">261 ms</td>
				<td class="tg-r5qm">-2.76%</td>
			</tr>
			<tr>
				<td class="tg-r5qm" rowspan="2"><a href="https://web.dev/fcp/" target="_blank" rel="noopener noreferrer"><span style="font-weight:400;font-style:normal;text-decoration:underline">首次内容绘制</span></a><br><a href="https://web.dev/fcp/" target="_blank" rel="noopener noreferrer"><span style="font-weight:400;font-style:normal;text-decoration:underline"> </span></a><span style="font-weight:400;font-style:normal;text-decoration:none">(FCP)</span></td>
				<td class="tg-r5qm"><span style="font-weight:400;font-style:normal">90th</span></td>
				<td class="tg-r5qm">2655 ms</td>
				<td class="tg-r5qm">2056 ms</td>
				<td class="tg-r5qm">22.55%</td>
			</tr>
			<tr>
				<td class="tg-r5qm"><span style="font-weight:400;font-style:normal">10th</span></td>
				<td class="tg-r5qm">894 ms</td>
				<td class="tg-r5qm">783 ms</td>
				<td class="tg-r5qm">12.46%</td>
			</tr>
			<tr>
				<td class="tg-r5qm" rowspan="2"><a href="https://web.dev/speed-index/" target="_blank" rel="noopener noreferrer"><span style="font-weight:400;font-style:normal;text-decoration:underline">速度指数</span></a><br><a href="https://web.dev/speed-index/" target="_blank" rel="noopener noreferrer"><span style="font-weight:400;font-style:normal;text-decoration:underline"> </span></a><span style="font-weight:400;font-style:normal;text-decoration:none">(SI)</span></td>
				<td class="tg-r5qm"><span style="font-weight:400;font-style:normal">90th</span></td>
				<td class="tg-r5qm">6428</td>
				<td class="tg-r5qm">5586</td>
				<td class="tg-r5qm">13.11%</td>
			</tr>
			<tr>
				<td class="tg-r5qm"><span style="font-weight:400;font-style:normal">10th</span></td>
				<td class="tg-r5qm">1301</td>
				<td class="tg-r5qm">1242</td>
				<td class="tg-r5qm">4.52%</td>
			</tr>
		</tbody>
	</table>
	<!--kg-card-end: markdown-->
	<p>注意：以上数据基于Cloudflare缓存的505个随机选择的网站的测试结果。使用来自美国南卡罗来纳州的WebPageTest在以下环境中运行测试：Chrome，电缆连接速度。</p>
	<p>最重要的是，使用APO，站点的TTFB既快速又一致。因为我们现在从Cloudflare的边缘提供html的初始处理时间为0，所以第一个字节到达眼球的速度一直都很快。在高负载下，WordPress源在构建html并返回给访问者时可能会出现延迟。APO消除了由于负载引起的变化，从而使TTFB始终小于400 ms。</p>
	<p>此外，在更快的TTFB和额外的第三方字体缓存之间，我们看到在我们测试的最快和最慢的站点中，FCP和SI的性能都有所改善。TTFB的降低自然是其中的一部分原因，因为对于其他指标而言，从TTFB中减少的每一毫秒都是潜在的增益。缓存其他第三方字体可以使我们减少获取该内容所需的时间。由于文本呈现的原因，给定的字体通常会阻塞绘制，因此缓存其他第三方字体可以提高页面绘制的速度，并提高速度指数。</p>
	<p>鉴于<a href="https://kinsta.com/" target="_blank">Kinsta</a>在WordPress方面的专业性，我们请Kinsta的员工试用了APO，并告诉我们他们的想法。Kinsta网站内容经理<a href="https://brianli.com/" target="_blank">Brian Li</a>在位于东京的网站上运行了来自世界各地的一系列测试。接下来他将会为大家解释一下他们做了什么以及结果如何：</p>
	<blockquote>在Kinsta，<a href="https://kinsta.com/blog/fastest-wordpress-hosting/" target="_blank">WordPress的性能</a>是我们心中不可或缺的东西。因此，当Cloudflare着手测试他们针对WordPress的新自动平台优化（APO）服务时，我们都全神贯注。</blockquote>
	<blockquote>这是我们为测试新服务所做的：</blockquote>
	<blockquote>我们在日本东京建立了一个测试站点——这是Kinsta客户可以使用的24个高性能<a href="https://kinsta.com/knowledgebase/google-cloud-data-center-locations/" target="_blank">数据中心位置</a>之一。</blockquote>
	<blockquote>我们在世界各地的六个不同地点进行了几次速度测试，测试包含了使用或不使用Cloudflare的APO的情况。</blockquote>
	<blockquote>结果令人难以置信！</blockquote>
	<blockquote>通过在Cloudflare的边缘网络上缓存<a href="https://kinsta.com/blog/wordpress-vs-static-html/" target="_blank">静态HTML</a>，我们看到了70-300％的性能提升。不出所料，离东京最远的测试地点减少的<a href="https://kinsta.com/blog/ttfb/" target="_blank">加载时间</a>最为显著。</blockquote>
	<blockquote>如果你的WordPress网站使用的是仅缓存CSS、JS和图片的传统<a href="https://kinsta.com/blog/wordpress-cdn/#how-cdn-works" target="_blank">CDN</a>，那么无需犹豫，即刻升级到Cloudflare的WordPress APO吧，它将帮助你在与现代Jamstack和默认处于边缘的静态网站的竞争中保持竞争力。</blockquote>
	<p>下图总结了Brian的测试结果：</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2020/12/image-59.png" class="kg-image">
		<figcaption>从全球6个位置加载位于东京的托管网站的页面加载速度 - 比较Kinsta，使用KeyCDN的Kinsta和使用Cloudflare APO的Kinsta。</figcaption>
	</figure>
	<p>从Kinsta对APO的测试中可以看到的一个明显的好处是，不管你的访问者在世界的哪个地方，你的站点都能保持性能的一致性。与其他设置中两到三秒的加载时间相比，APO始终如一的亚秒级性能表明，如果您有一个全球客户群，APO将为所有访问者提供更好的体验。</p>
	<h3 id="--5">自动平台优化如何工作</h3>
	<p>自动平台优化是能够使用Cloudflare Workers的功能智能缓存动态内容的结果。通过缓存动态内容，我们可以从边缘网络为整个网站提供服务。试想一个“静态站点”，一个无需考虑进行任何构建或维护工作的静态站点。客户可以继续以同样的方式管理和更新他们网站上的内容，并把辛劳的工作留给我们。通过我们的网络同时服务静态和动态内容，通常没有源请求或源处理时间。这意味着所有通信都发生在用户设备与我们的边缘之间。APO服务如此有效的原因是其减少了动态内容从边缘到源通常所需的往返次数。首先让我们看看为访问者加载一个WordPress站点的过程通常是什么样的。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2020/12/image-60.png" class="kg-image">
		<figcaption>典型的用户访问站点的序列图</figcaption>
	</figure>
	<p>在一个常规的请求流中，Cloudflare能够缓存一些内容，如图像、CSS或JS，而其他的请求则转向源服务器或第三方服务以获取内容。最重要的是，获取站点的HTML的第一个请求需要返回到源，这是TTFB较长的典型原因，因为在客户端可以接收HTML并对其进行解析以进行后续请求之前，其他的请求都不会发出。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2020/12/image-61.png" class="kg-image">
		<figcaption>访问同一站点，但启用了APO。</figcaption>
	</figure>
	<p>一旦启用APO，所有这些到源的传输都会被移除。TTFB改善良多，因为第一跳都开始并结束于Cloudflare网络。这也意味着浏览器会更早地开始抓取和绘制网页，每个绘制事件都会更早地发生。最后，通过缓存第三方字体，我们删除了需要离开Cloudflare网络的其他请求，并延长了向用户显示文本的时间。网站通常使用第三方域名托管的字体。虽然这节省了在源上托管它所产生的带宽成本（取决于托管字体的位置），但获取它们仍然是一个昂贵的操作。通过重新托管字体并从缓存中提供它们，我们可以减少其余昂贵的往返行程。</p>
	<p>使用适用于WordPress的APO，您可以告别会拖累客户体验的数据库拥塞或笨拙的插件。这些优势是在我们本已非常快的TLS连接和HTTP / 2等行业领先的协议支持的基础上获得的，可确保我们使用最高效，最快的方式来连接网站并将其交付给客户。</p>
	<p>对于拥有支持身份验证会话的WordPress网站的客户，您不必担心我们将身份验证用户的内容缓存并提供给其他人。我们绕过了为认证用户提供的标准WordPress和WooCommerce cookies的缓存。这确保了针对特定用户的定制内容只对该用户可见。虽然我们的Business级服务已经为客户提供了这项功能，但现在任何启用APO的WordPress客户都可以使用它。</p>
	<p>你可能会想：“这些听起来都很棒，但是当我在我的网站上改变内容的时候呢？” 由于此服务与我们的<a href="https://www.cloudflare.com/integrations/wordpress/" target="_blank">WordPress插件</a>协同工作，因此我们能够了解您何时进行更改，确保我们能快速清除Cloudflare边缘中的内容并使用新内容对其进行刷新。安装该插件后，我们将检测内容更改并通过自动缓存清除功能在全球范围内更新我们的边缘网络。作为此版本的一部分，我们更新了WordPress插件，因此无论您是否使用APO，都应立即升级到最新版本。如果您不使用或无法使用我们的WordPress插件，那么APO仍将提供相同的性能优势，但是当内容被再次请求时，APO可能会在长达30分钟的时间内提供旧的内容。</p>
	<p>这个服务是建立在最初发布于<a href="https://blog.cloudflare.com/improving-html-time-to-first-byte/">此处</a>和<a href="https://blog.cloudflare.com/fast-google-fonts-with-cloudflare-workers/">此处</a>的博客所描述的原型工作的基础上的。要更深入地了解服务的技术方面以及Cloudflare Workers如何让我们得以构建自动平台优化服务，请参阅<a href="https://blog.cloudflare.com/building-automatic-platform-optimization-for-wordpress-using-cloudflare-workers/">相关博客文章</a>。</p>
	<h3 id="-wordpress-">从今天起支持WordPress，其他平台的支持将在短期内推出</h3>
	<p>尽管今天的公告重点是支持WordPress，但这仅仅是个开始。我们计划将这些功能引入用于Web托管的其他流行平台。如果您经营一个平台，并对我们如何能够一起为您的所有客户改进产品感兴趣，<a href="https://www.cloudflare.com/partners/" target="_blank">请联系我们</a>。如果您正在运行一个网站，请让我们知道您希望看到APO下一步新增支持的平台</p>
</div>