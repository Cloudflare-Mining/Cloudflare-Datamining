<div class="mb2 gray5">21 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image12-1.png" class="kg-image" alt="How Cloudflare helps next-generation markets" loading="lazy"></figure>
	<p>互联网的一个神奇之处在于它没有国籍。互联网不需要通过海关，不需要签证，也不说任何一种语言。任何用户，无论身处哪个国家，只需要一个联网设备，就能访问这个世界最伟大的信息创新。互联网将完成余下的所有工作。Cloudflare 的部分职责是确保地球上连接到互联网的人都获得良好的体验，无论他们是在下一代市场还是当前的市场。本文中，我们将讨论如何定义下一代市场，如何帮助这些市场中的人们更快地访问他们日常使用的网站和应用程序，以及如何让开发者更容易地在下一代市场的用户附近部署服务。</p>
	<h2 id="-">什么是下一代市场？</h2>
	<p>下一代市场是互联网的未来。随着可负担的接入增加，不仅数十亿人将更多地使用互联网，而且应用程序开发的趋势已经指向移动优先、有时仅移动的方式提供内容和服务。在所谓的“全球北部”，即<a href="https://www.imf.org/external/datamapper/FMEconGroup.xlsx" target="_blank">国际货币基金组织（IMF）定义为先进经济体</a>的国家，互联网看起来可能有所不同（更多以桌面为中心），但随着应用程序开发人员为所有市场(而不仅仅是当代市场)构建产品，这些差异将会缩小。我们称这些市场为下一代市场，而不是使用国际货币基金组织或世界银行的定义，因为我们希望通过用户如何与互联网互动而不是他们的政府如何与全球经济互动来对市场进行分类。与北美和欧洲的用户结合使用台式电脑和移动设备连接互联网相比，下一代市场的用户通过<a href="https://blog.cloudflare.com/where-mobile-traffic-more-and-less-popular">移动设备</a>连接互联网的比例达到 50% 或更多，有时甚至高达80%。这些市场的一些例子是中国、印度、印度尼西亚、泰国，以及非洲和中东的国家。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image4.jpg" class="kg-image" alt="" loading="lazy"></figure>
	<p>这些流量的大部分还使用了 HTTP/S，这是互联网通信安全、高性能和可靠的行业标准。大约 88% 的时间内，HTTP/S 在互联网上广泛使用。在移动用户比例较高的国家和地区，通过 HTTP/S 的流量比例也较高，如下表所示。例如，非洲和 APJC（亚太、日本和中国）国家使用 HTTP/S 的比例高于任何其他协议，超过了所有其他地区。相比之下，在北美，更多流量使用较旧的协议，例如 SMTP、FTP或 RTMP。</p><!--kg-card-begin: html-->
	<table width="100%">
		<thead>
			<tr>
				<th>地区</th>
				<th>使用 HTTP/S 的流量百分比</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>非洲（AFR）</td>
				<td>92%</td>
			</tr>
			<tr>
				<td>亚太、日本和中国（APJC）</td>
				<td>92%</td>
			</tr>
			<tr>
				<td>北美西部（WNAM）</td>
				<td>90%</td>
			</tr>
			<tr>
				<td>北美东部（ENAM）</td>
				<td>89%</td>
			</tr>
			<tr>
				<td>大洋洲（OC）</td>
				<td>89%</td>
			</tr>
			<tr>
				<td>东欧（EEUR）</td>
				<td>88%</td>
			</tr>
			<tr>
				<td>中东（ME）</td>
				<td>85%</td>
			</tr>
			<tr>
				<td>西欧（WEUR）</td>
				<td>83%</td>
			</tr>
			<tr>
				<td>南美（SAM）</td>
				<td>64%</td>
			</tr>
		</tbody>
	</table><!--kg-card-end: html-->
	<p>移动互联网连接的普及也体现在开发人员正在这些地区构建的应用程序类型上：专门为本地用户设计的流行应用程序的本地模型。例如，<a href="https://www.cloudflare.com/case-studies/carousell" target="_blank">像 Carousell 这样的电子商务公司</a>和<a href="https://www.cloudflare.com/case-studies/how-bookmyshow-uses-cloudflare-to-mitigate-massive-ddos-attacks" target="_blank">像 BookMyShow 这样的票务公司</a>，大部分业务都依赖于移动和应用程序用户，这是他们所在地区独有的。更广泛来说，Instagram 和 TikTok 等著名的应用程序没有基于 Web 或桌面的应用程序，它们鼓励用户只使用移动设备。这些市场属于下一代，因为它们的大多数用户都在使用像 Carousell 那样为移动、高性能互联网设计的移动设备和应用程序。</p>
	<p>这些市场中的两个群体有着相似的担忧，但两者的不同之处足以让我们需要分别解决：用户和为用户开发应用程序的开发者。他们都有一个要求：快。但是，对用户和应用程序开发人员来说，快的表现方式略有不同。让我们来谈谈每个群体以及 Cloudflare 如何帮助解决他们的问题。</p>
	<h2 id="--1">下一代用户</h2>
	<p>这些市场的用户关心的是观察到的体验：他们希望与应用程序进行实时交互。这与其他市场的用户对互联网的期望没有什么不同，但在移动网络上实现这一点要困难得多，因为移动网络往往具有更高的延迟、损失和更低的带宽。</p>
	<p>下一代市场的另一个挑战是，一般而言，互联网连接在地理上非常分散。想象一下，您正在“打电话”游戏，向公园另一边的人发送信息：您发送信息的唯一方式是告诉在您旁边的人，他告诉在他旁边的人，以此类推，直到信息到达公园的另一边。类似这样：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image10.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>如果您玩过“打电话”游戏，您就知道这是乐观的情况：即使某人就在您的身旁，他也不一定能收到您试图发送的所有信息。但是，让我们假设以上乐观的情况是真的：那么，在上述情景中，您将能够通过人们端到端地把消息传递到公园的另一边。现在，让我们将人们的数量减少一般，意味着每个发送消息的人都需要喊两倍远的距离。这个时候情况就会开始变得更加混乱了：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image1-38.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>在这种情况下，消息的接收者第一次没有正确地听到消息，并要求发送者再次发出消息。这个被称为“重传”的过程减少了可以在互联网上一次发送的数据量。重传率取决于无线网络的蜂窝密度、光纤电缆的光信号，以及在更广泛的互联网上，最终用户和网站或接收端之间的跳数。</p>
	<p>重传率会受到丢包的影响，即一些包由于信号传输不良或发送端和接收端之间的路径上的设备错误而无法到达接收端。发生丢包时，互联网上的协议，例如<a href="https://www.cloudflare.com/learning/ddos/glossary/tcp-ip" target="_blank">传输控制协议（TCP） </a>将减少可以在连接上传输的数据量。一次可以发送的数据量被称为拥塞窗口，协议将缩小拥塞窗口，以帮助保持连接，直到 TCP 确定连接不会再次丢包。这种缩小拥塞窗口的过程称为 backoff，当第一次检测到丢包时，拥塞窗口将呈指数缩小，然后随时间线性扩大。这意味着具有高重传率的连接和网络会严重影响用户在互联网上与网站和应用程序的交互方式。</p>
	<h2 id="--2">“边缘合作伙伴计划”让我们更接近用户</h2>
	<p>由于下一代市场的大多数用户是移动用户，为了获得快速的体验，更加接近用户是至关重要的。移动设备的速度往往较慢，因为对无线电波的干扰往往会给互联网连接增加额外的不稳定性，从而导致性能欠佳。在下一代市场中，可能还会面临电力消耗等问题带来的挑战：如果电网不能支持大型移动通信基站，就需要较小范围的小型基站，这可能会进一步增加不稳定性，增加重传和延迟。</p>
	<p>然而，除了本地网络的挑战之外，还有一个挑战是将这些网络与互联网其他部分进行互连。下一代市场的网络能够到达的对等互连点可能不及大型网络那样多，可能需要通过进入与更多网络具有更密集连接的互联网交换中心来优化其对等互连，即使这些交换中心可能距离更远。例如，像法兰克福、伦敦和新加坡这样的地方，对于分别在中东、非洲和亚洲等地区的少数几个互联网交换中心的大量网络的互通特别有用。</p>
	<p>对终端用户而言的不利之处是，为了连接到互联网和他们关注的网站，这些市场的网络必须走很长的路才能到达互联网的其他部分。对于可缓存的内容，也就是不经常更改的内容，跨洋过海地发送数据请求(和响应)并非对互联网容量的正确利用方式。更糟糕的是，这样做会导致拥塞、重传和丢包等问题，这反过来又会导致性能下降。</p>
	<p>我们看到延迟会直接影响互联网性能的一个领域是 TLS，即传输层安全。TLS 确保终端用户与应用程序的交互是私密的。建立 TLS 时需要执行三次握手，要求最终用户发起连接，服务器响应，最终用户确认响应，然后才开始发送数据。终端用户距离执行握手的网站或 CDN 越远，握手时间就越长，性能就会越差：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image11.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>接近用户通常不仅提高了最终用户的性能，还提高了网络上互联网体验的基本稳定性。Cloudflare 通过我们的“边缘合作伙伴计划”(Edge Partner Program，EPP)帮助解决这个问题，该计划允许 ISP 将他们的网络与 Cloudflare 进行在本地进行物理集成，使我们尽可能地接近他们的用户。当我们在 ISP 中嵌入 Cloudflare 节点时，我们缩短了最终用户和 Cloudflare 之间的物理距离，进而缩短了最终用户的数据请求在互联网骨干网中传输所需的时间。在过去的四年里，我们的 107 个新城市中有 80% 已经进入了下一代市场，以帮助我们提高缓存和动态性能。</p>
	<p>让内容和服务更接近最终用户的另一个好处是：我们可以使用我们的网络智能将流量从您的“最后一英里网络”路由到其目的地，帮助改善用户访问互联网其他部分的体验。平均而言, <a href="https://www.cloudflare.com/products/argo-smart-routing" target="_blank">Argo Smart Routing</a> 帮助将动态和非缓存内容的性能提高 30% 以上。如果用户需要获取的内容远离他们的设备，这一点尤其有价值。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image13-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>现在我们已经讨论了“边缘合作伙伴计划”的重要性，及其它如何理论上如何帮助用户，让我们谈谈在沙特阿拉伯的一组部署，向您展示它是如何实际上帮助用户的。</p>
	<h3 id="--3">边缘合作伙伴计划在沙特阿拉伯</h3>
	<p>沙特阿拉伯是一个可以从边缘合作伙伴计划中获益的优秀例子，这个国家过去与 Cloudflare 进行对等互连的最近地点是法兰克福。正如我们上面提到的，对于中东的许多国家来说，法兰克福是这些网络选择与其他网络进行对等的地方，尽管法兰克福距离利雅得超过 5300 公里。</p>
	<p>但是，通过将 Cloudflare 网络硬件部署到移动网络 Mobily，我们能够能其用户的 RTT 中位数改善 50% 以上。在我们部署之前，Mobily 上的最终用户通过法兰克福的 RTT 中位数为 131 ms。一旦我们在这个网络上增加了达曼、利雅得和吉达三个站点，Mobily 用户看到延迟大幅减少，部署前的 RTT <em>中位数</em>（131 ms）现在变成了大约第 85 个百分位。在此之前，每两个请求中有一个花费的时间超过 131 ms，而之后几乎每个请求(其中 85%)花费的时间少于 131 ms。因此，沙特阿拉伯的用户可以通过他们的 ISP 和 Cloudflare 更快地访问他们关心的网站和服务。皆大欢喜。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image9-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>本地化也有助于减少重传和必须通过这些网络发送的数据量。以两个数据中心为例：我们最大的数据中心之一 —— 位于加州洛杉矶，另一个新数据中心 —— 位于沙特阿拉伯的吉达。洛杉矶接收来自世界各地的流量：来自中国、印度尼西亚、澳大利亚，以及洛杉矶本地。看看从世界各地进入洛杉矶的连接的平均重传率：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image6-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>洛杉矶的平均重传率相当高，主要是因为来自中国、印度尼西亚、台湾、韩国和日本的用户为浏览其网站而来到洛杉矶。但吉达的情况就有所不同了：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image5-5.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>吉达用户的重传率低得多，也更加稳定，这是因为 Mobily 的用户在距离设备更近的地方终止连接。通过嵌入 Mobily 的网络，我们减少了所需的跳数，也缩短了在不太可靠的路径上传输的跳数。最初请求第一次成功的机会更大，不需要多次重试。</p>
	<h2 id="-warp">下一代市场中的 WARP</h2>
	<p>对任何市场的用户而言，Cloudflare WARP 都是一个保护隐私的优秀工具，可帮助确保通过隐私优先、高性能的路径访问互联网。虽然世界各地的用户都可以使用 WARP，但下一代市场的用户在采用 WARP 方面快人一步。以下是到目前为止，WARP 在苹果应用商店中的总下载量：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image7-5.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>我们最近做了一些更改，在更多“边缘合作伙伴”地点增加了<a href="https://blog.cloudflare.com/geoexit-improving-warp-user-experience-larger-network"> WARP 支持</a>，它为这些地点提供了更快、更私密的体验。现在更多的 WARP 用户可以在更多的地方获得更佳的性能。</p>
	<p>WARP 与 Cloudflare 网络很好地协同工作，以确保快速、私密的互联网体验。在越来越多的下一代市场网络中，WARP 用户将能在与其 ISP 相同的地点连接到 Cloudflare，然后进入互联网的其他部分。如果他们试图连接的网站受到 Cloudflare 的保护，那么他们就可以通过 Cloudflare 快速访问他们关心的网站。否则，用户仍然可以通过 Cloudflare 连接到他们需要的网站，并在整个连接过程中保护他们的隐私。</p>
	<h2 id="--4">下一代开发者</h2>
	<p>假设您是阿曼马斯喀特的一名应用开发者，正试图制作一款针对自己市场的新购物应用。为了与其他现有应用竞争，您不仅需要具备与众不同之处，还需要与竞争对手不相上下的应用内性能体验，同时还需要能够提供服务并赚钱。全球购物应用程序提供实时浏览体验，您的区域应用程序也需要满足或超越这一要求。如果外部竞争对手拥有比您更快的购物应用，例如，真正的亚马逊在这个国家更快，那么您的应用是否是“阿曼的亚马逊”完全不重要。</p>
	<p>但在下一代市场中，性能往往是他们的应用程序和现有应用程序之间的差异化因素——通常是因为现有应用程序往往在这些市场中表现欠佳。这通常是因为现有应用程序将使用可能不提供本地服务的云提供商。例如，APJC 地区的用户可能经常看到他们的流量被发送到香港、新加坡，甚至洛杉矶，因为那里是离他们最近的云数据中心。所以当您在开发“印度尼西亚的亚马逊”时，您需要让自己的应用比亚马逊在印度尼西亚的应用速度更快，让您的应用对用户来说尽可能本土化将有助于实现应用的吸引力：为印尼用户提供专门的高性能体验。</p>
	<p>值得注意的是，许多云服务确实为开发人员提供了本地选择：如果您在阿曼，那里就有一个本地云数据中心供您托管服务。但大多数在新一代市场上建立的初创公司和小型企业会选择在更大、更远的地方托管他们的应用程序，以优化成本。</p>
	<p>例如，与遥远地区的选择相比，在中东地区本地化的成本非常高。中东的开发人员只要转移到法兰克福，每月的数据传输费用就可以节省 30% 甚至更多；法兰克福距离用户较远，但服务成本较低。应用程序开发人员一直在尝试平衡成本和用户体验，可能会在用户体验方面做出一些折衷，使他们能够在短期内优化成本。因此，即使受 Cloudflare 保护的开发者正在利用边缘合作伙伴计划的本地对等互连，但阿曼的开发者最终可能还是会把他们的用户送到法兰克福，因为他们选择在那里托管服务以节省成本。在许多情况下，那是这些市场的开发人员必须做出的权衡：略微降低服务的性能，以便更便宜地运行。</p>
	<h2 id="cloudflare-workers-">Cloudflare Workers 部署到本地</h2>
	<p>对这些开发者来说幸运的是，Cloudflare 的开发人员平台允许应用开发者构建一个分布式应用程序，可在用户所在的位置运行，以便他们不必在性能和成本节约之间进行选择。以沙特阿拉伯为例，Mobily 用户的流量现在终止于吉达本地。从端到端角度来看，这是可以做到的，因为这意味着 Cloudflare 可以使用像 Argo Smart Routing 这样的技术来找到通过互联网的最快路径，如果他们的用户必须出国，这将帮助他们节省 30% 的首字节到达时间。但如果用户根本不用离开吉达呢？</p>
	<p>通过将应用程序迁移到 Cloudflare，您可以将越来越多的应用程序推送到这些位于下一代市场中的数据中心，确保用户在国内获得更好的体验。例如，以下是开发人员周的性能测试期间，用来评估我们与 Lambda@Edge 之间差异的<a href="https://blog.cloudflare.com/zh-cn/network-performance-update-developer-week-zh-cn">比较数据</a>。这个比较的目的是显示，将应用程序计算托管在 Cloudflare 和 AWS 上时，您的用户分别需要走多远距离。与 Lambda@Edge 对比，我们在下一代市场的 P95 TCP 连接时间方面具有显著优势。下面图表显示，在非洲和亚洲，Cloudflare Workers 的速度比 AWS 的 Lambda@Edge 快大约三倍：</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image2-33.png" class="kg-image" alt="" loading="lazy"></figure><!--kg-card-begin: html-->
	<table width="100%">
		<thead>
			<tr>
				<th></th>
				<th>P95 连接 (ms)<br>非洲</th>
				<th>亚洲</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Lambda JS</td>
				<td>358</td>
				<td>330</td>
			</tr>
			<tr>
				<td>Cloudflare JS</td>
				<td>104</td>
				<td>111</td>
			</tr>
		</tbody>
	</table>
	<center><small>95 百分位 TCP 连接时间（ms）</small></center>
	<br><!--kg-card-end: html-->
	<p>这意味着 Cloudflare 内置的操作和功能可以更贴近用户执行，确保更好的端到端性能。Lambda@Edge 的场景本身就已经很糟糕了，但是请考虑并不是所有的事情都可以在 Lambda@Edge 中完成，并且可能需要到达比 AWS 边缘更远的 AWS 实例。Cloudflare 的超级云看起来特别有吸引力，因为我们允许您在一个完全位于最终用户本地的应用程序中构建所有您需要的东西。这有助于确保下一代市场在他们关心的应用程序方面获得与世界其他地区相同的性能。</p>
	<h2 id="--5">使每个地方的每个人都更快</h2>
	<p>Cloudflare 帮助下一代市场的用户更快地、更私密地连接到互联网，并帮助他们的应用程序更接近他们所在的地方。通过像我们的边缘合作伙伴计划这样的举措，我们可以帮助下一代市场的用户更接近应用程序，通过我们强大的开发人员平台，我们可以确保为这些市场构建的应用程序具有世界级的性能。</p>
	<p>如果您是应用程序开发人员，没有尝试过我们强大的开发平台及其能做到的一切， 欢迎今天就<a href="https://workers.cloudflare.com" target="_blank">试用一下</a>。</p>
	<p>如果您是网络运营商，并希望 Cloudflare 进驻您的网络以帮助将用户的体验提升到新的水平，欢迎了解我们的<a href="https://www.cloudflare.com/partners/peering-portal" target="_blank">边缘合作伙伴计划</a>，并让我们建立连接。</p>
	<p>下一代市场的用户是互联网的未来：他们是我们所期望的大多数互联网用户在未来的行为方式。Cloudflare 具备独特的优势，能够确保所有这些用户和开发人员都能拥有他们期望的互联网体验。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/image8-3.png" class="kg-image" alt="" loading="lazy"></figure>
</div>