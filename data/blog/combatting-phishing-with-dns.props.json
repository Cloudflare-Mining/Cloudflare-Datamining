{
	"initialReadingTime": "3",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Dani Grant",
				"slug": "dani",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/3NrjRpQjxB3yAtf6DSGLux/d6082f32b911266d75f3317f7b65c75a/dani.jpg",
				"location": null,
				"website": null,
				"twitter": "@thedanigrant",
				"facebook": null
			}
		],
		"excerpt": "Phishing is the absolute worst.\n\nUnfortunately, sometimes phishing campaigns use Cloudflare for the very convenient, free DNS. ",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/4x5sz2bl1mCkzmCh1kULwa/6bd3899aa5d6e2ebb81492f8fe7e9c90/combatting-phishing-with-dns.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/4cYYmZBGDpwiXQwvj2UxUo/38821722343dd4cc2e66ef5266953613/Artboard-30-2.png\" alt=\"\" class=\"kg-image\" width=\"1359\" height=\"849\" loading=\"lazy\"/>\n            \n            </figure><p>Phishing is the absolute worst.</p><p>Unfortunately, sometimes phishing campaigns use Cloudflare for the very convenient, free DNS. To be clear –– there’s a difference between a compromised server being leveraged to send phishing emails and an intentionally malicious website dedicated to this type of activity. The latter clearly violates our terms of service.</p><p>In the past, our Trust and Safety team would kick these intentional phishers off the platform, but now we have a new trick up our sleeve and a way for their malicious emails to mysteriously disappear into the ether.</p><h3>Background: How Email Works</h3><p>SMTP - the protocol used for sending email - was <a href=\"/the-history-of-email/\">finalized in 1982</a>, when it was just a <a href=\"https://blog.ted.com/what-the-internet-looked-like-in-1982-a-closer-look-at-danny-hillis-vintage-directory-of-users/\">small community</a> online. Many of them knew and trusted each other, and so the protocol was built entirely on trust. In an SMTP message, the MAIL FROM field can be arbitrarily defined. That means you could send an email from any email address, even one you don’t own.</p><p>This is great for phishers, and bad for everyone else.</p><p>The solution to <a href=\"https://www.cloudflare.com/learning/email-security/how-to-prevent-phishing/\">prevent email spoofing</a> was to create the Sender Policy Framework (SPF). SPF allows the domain owner to specify which servers are allowed to send email from that domain. That policy is stored in a DNS TXT record like this one from cloudflare.com:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig cloudflare.com txt\n&quot;v=spf1 ip4:199.15.212.0/22 ip4:173.245.48.0/20 include:_spf.google.com include:spf1.mcsv.net include:spf.mandrillapp.com include:mail.zendesk.com include:customeriomail.com include:stspg-customer.com -all&quot;</pre></code>\n            <p>This says that email clients should only accept cloudflare.com emails if they come from an IP in the ranges 199.15.212.0/22, 173.245.48.0/20, or one of the IP ranges found in the SPF records for the other domains listed. Then if a receiving email server receives an email from <a href=\"mailto:someone@cloudflare.com\">someone@cloudflare.com</a> from the server at 185.12.80.67, that email server would check the SPF records of all the allowed domains until it finds that 185.12.80.67 is allowed because 185.12.80.0/22 is listed in mail.zendesk.com’s SPF record:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig txt mail.zendesk.com\n&quot;v=spf1 ip4:192.161.144.0/20 ip4:185.12.80.0/22 ip4:96.46.150.192/27 ip4:174.137.46.0/24 ip4:188.172.128.0/20 ip4:216.198.0.0/18 ~all&quot;</pre></code>\n            <p>Additional methods for <a href=\"https://www.cloudflare.com/zero-trust/solutions/email-security-services/\">securing email</a> were created after SPF. SPF only validates the email sender but doesn’t do anything about verifying the content of the email. (While SMTP can be sent over an encrypted connection, SMTP is <a href=\"https://blog.filippo.io/the-sad-state-of-smtp-encryption/\">notoriously easy to downgrade</a> to plaintext with an on-path attacker.)</p><p>To verify the content, domain owners can sign email messages using DKIM. The email sender includes the message signature in an email header called DKIM-Signature and stores the key in a DNS TXT record.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig txt smtpapi._domainkey.cloudflare.com\n&quot;k=rsa\\; t=s\\; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDPtW5iwpXVPiH5FzJ7Nrl8USzuY9zqqzjE0D1r04xDN6qwziDnmgcFNNfMewVKN2D1O+2J9N14hRprzByFwfQW76yojh54Xu3uSbQ3JP0A7k8o8GutRF8zbFUA8n0ZH2y0cIEjMliXY4W4LwPA7m4q0ObmvSjhd63O9d8z1XkUBwIDAQAB&quot;</pre></code>\n            <p>There’s one more mechanism for controlling email spoofing called DMARC. DMARC sets the overarching email policy, indicates what to do if the policies are not met and sets a reporting email address for logging invalid mail attempts. Cloudflare’s DMARC record says that noncomplying emails should be sent to junk mail, 100% of messages should be subject to filtering and if policies are not met, send the report to the two email addresses below.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig txt _dmarc.cloudflare.com\n&quot;v=DMARC1\\; p=quarantine\\; pct=100\\; rua=mailto:rua@cloudflare.com, mailto:gjqhulld@ag.dmarcian.com&quot;</pre></code>\n            <p>When an email server receives an email from <a href=\"mailto:someone@cloudflare.com\">someone@cloudflare.com</a>, it first checks SPF, DKIM and DMARC records to know whether the email is valid, and if not, how to route it.</p><h3>Stopping Phishy Behavior</h3><p>For known phishing campaigns using the Cloudflare platform for evil, we have a DNS trick for getting their phishing campaigns to stop. If you remember, there are three DNS records required for sending email: SPF, DKIM and DMARC. The last one is the one that defines the overarching email policy for the domain.</p><p>What we do is rewrite the DMARC record so that the overarching email policy instructs email clients to reject all emails from that sender. We also remove the other DNS record types used for sending email.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">&quot;v=DMARC1; p=reject&quot;</pre></code>\n            <p>When an email client receives a phishing email, the corresponding DNS records instruct the client not to accept the email and the phishing email is not delivered.</p><p>You can see it in action on our fake phish domain, astronautrentals.com.</p><p>astronautrentals.com is configured with an SPF record, a DKIM record, and a DMARC record with a policy to accept all email.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/4eFm0QSHY505LXsU2rds8C/c91ef26c4dc515fd06614a77fe48e7a8/Screen-Shot-2017-12-11-at-7.58.27-PM.png\" alt=\"\" class=\"kg-image\" width=\"498\" height=\"310\" loading=\"lazy\"/>\n            \n            </figure><p>However, because it is a known (fake) phishing domain, when you query DNS for these records, SPF will be missing:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig astronautrentals.com txt\nastronautrentals.com.\t3600\tIN\tSOA\tart.ns.cloudflare.com. dns.cloudflare.com. 2026351035 10000 2400 604800 3600</pre></code>\n            <p>DKIM will be missing:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig _domainkey.astronautrentals.com txt\nastronautrentals.com.\t3600\tIN\tSOA\tart.ns.cloudflare.com. dns.cloudflare.com. 2026351035 10000 2400 604800 3600</pre></code>\n            <p>And DMARC policy will be rewritten to reject all emails:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ dig _dmarc.astronautrentals.com txt\n&quot;v=DMARC1\\; p=reject&quot;</pre></code>\n            <p>If we try to send an email from @astronautrentals.com, the email never reaches the recipient because the receiving client sees the DMARC policy and rejects the email.</p><p>This DMARC alteration happens on the fly –– it&#39;s a computation we do at the moment when we answer the DNS query –– so the original DNS records are still shown to the domain owner in the Cloudflare DNS editor. This adds some mystery to why the phish attempts are failing to send.</p><h3>Using DNS To Combat Phishing</h3><p>Phishing is the absolute worst, and the problem is that it sometimes succeeds. Last year Verizon reported that <a href=\"https://www.prnewswire.com/news-releases/verizons-2016-data-breach-investigations-report-finds-cybercriminals-are-exploiting-human-nature-300258134.html\">30% of phishing emails</a> are opened, and 13% of those opened end with the receiver clicking on the phishing link.</p><p>Keeping people safe on the internet means decreasing the number of successful phishing attempts. We&#39;re glad to be able to fight phish using the DNS.</p>",
		"id": "3EGw4u6PtzahSALx0hsmcI",
		"localeList": {
			"name": "Why Some Phishing Emails Are Mysteriously Disappearing Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "Phishing is the absolute worst. \n Unfortunately, sometimes phishing campaigns use Cloudflare for the very convenient, free DNS. We have a new trick up our sleeve.",
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2017-12-12T14:00:00.000+00:00",
		"slug": "combatting-phishing-with-dns",
		"tags": [
			{
				"id": "21DTsaKOfe5jbKfPDzYIBX",
				"name": "Phishing",
				"slug": "phishing"
			},
			{
				"id": "2yskwsCS0bVLjzbIJrpFuZ",
				"name": "Abuse",
				"slug": "abuse"
			},
			{
				"id": "5fZHv2k9HnJ7phOPmYexHw",
				"name": "DNS",
				"slug": "dns"
			},
			{
				"id": "6QVJOBzgKXUO9xAPEpqxvK",
				"name": "Reliability",
				"slug": "reliability"
			}
		],
		"title": "Why Some Phishing Emails Are Mysteriously Disappearing",
		"updated_at": "2024-08-27T02:26:05.479Z",
		"url": "https://blog.cloudflare.com/combatting-phishing-with-dns"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}