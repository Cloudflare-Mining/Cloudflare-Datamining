{
	"initialReadingTime": "3",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Jon Levine",
				"slug": "jpl",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/2xdSqLo0jn89CExvkA5vvj/03599c6af64ea17f04105c94f6ecd37f/jpl.jpg",
				"location": "San Francisco, CA",
				"website": null,
				"twitter": "@jplevine",
				"facebook": null
			},
			{
				"name": "Miki Mokrysz",
				"slug": "miki",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6XITbc07kJAoghCtkFLgp7/10269eb46c5675feebfab92f5be34c79/miki.jpg",
				"location": null,
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "If you care about the performance of your website or APIs, it’s critical to understand why things are slow.  Today we're introducing new analytics tools to help you understand what is contributing to \"Time to First Byte\" (TTFB) of Cloudflare and your origin",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/3OJz4FsE0LhywLRBFZtoZ8/c46cd74d0444f47fad295641d6497f8d/introducing-timing-insights.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/1OastOs9G4xxa9jwrnKl3V/90567ce7eee6bc23ef67ab57bfad03b5/xi31J0JmYNP5dcB-gEsTujRYG1gyFUsod_Fx7XPsjPwwxTQBIOFwTy9m0jPNQabe0bi5oUSwJHo5ubAq9rcAhgTXsqlTcoi9rpLM5pwoAwY-Yj8vuothGdHJHJbz.png\" alt=\"\" class=\"kg-image\" width=\"1600\" height=\"900\" loading=\"lazy\"/>\n            \n            </figure><p>If you care about the performance of your website or APIs, it’s critical to understand why things are slow.</p><p>Today we&#39;re introducing new analytics tools to help you understand what is contributing to &quot;Time to First Byte&quot; (TTFB) of Cloudflare and your origin. TTFB is just a simple timer from when a client sends a request until it receives the first byte in response. Timing Insights breaks down TTFB from the perspective of our servers to help you understand <i>what</i> is slow, so that you can begin addressing it.</p><p>But wait – maybe you&#39;ve heard that <a href=\"/ttfb-time-to-first-byte-considered-meaningles/\">you should stop worrying about TTFB</a>? Isn&#39;t Cloudflare <a href=\"/ttfb-is-not-what-it-used-to-be/\">moving away</a> from TTFB as a metric? Read on to understand why there are still situations where TTFB matters.</p><h3>Why you may need to care about TTFB</h3><p>It&#39;s true that TTFB on its own can be a misleading metric. When measuring web applications, metrics like <a href=\"https://web.dev/vitals/\">Web Vitals</a> provide a more holistic view into user experience. That&#39;s why we offer Web Analytics and Lighthouse within <a href=\"/cloudflare-observatory-generally-available/\">Cloudflare Observatory</a>.</p><p>But there are two reasons why you still may need to pay attention to TTFB:</p><p><b>1. Not all applications are websites</b>More than half of Cloudflare traffic is for APIs, and many customers with API traffic don&#39;t control the environments where those endpoints are called. In those cases, there may not be anything you can <a href=\"https://www.cloudflare.com/application-services/solutions/app-performance-monitoring/\">monitor</a> or improve besides TTFB.</p><p><b>2. Sometimes TTFB is the problem</b>Even if you are measuring Web Vitals metrics like LCP, sometimes the reason your site is slow is because TTFB is slow! And when that happens, you need to know why, and what you can do about it.</p><p>When you need to know why TTFB is slow, we’re here to help.</p><h3>How Timing Insights can help</h3><p>We now expose performance data through our <a href=\"https://developers.cloudflare.com/analytics/graphql-api/\">GraphQL Analytics API</a> that will let you query TTFB performance, and start to drill into what contributes to TTFB.</p><p>Specifically, customers on our Pro, Business, and Enterprise plans can now query for the following fields in the <code>httpRequestsAdaptiveGroups</code> dataset:</p><p><b>Time to First Byte</b> (edgeTimeToFirstByteMs)</p><p>What is the time elapsed between when Cloudflare started processing the first byte of the request received from an end user, until when we started sending a response?</p><p><b>Origin DNS lookup time</b> (edgeDnsResponseTimeMs)</p><p>If Cloudflare had to <a href=\"https://developers.cloudflare.com/dns/zone-setups/partial-setup/setup/\">resolve a CNAME</a> to reach your origin, how long did this take?</p><p><b>Origin Response Time</b> (originResponseDurationMs)</p><p>How long did it take to reach, and receive a response from your origin?</p><p>We are exposing each metric as an average, median, 95th, and 99th percentiles (i.e. P50 / P95 / P99).</p><p>The <code>httpRequestAdaptiveGroups</code> dataset powers the <a href=\"https://dash.cloudflare.com/?to=/:account/:zone/analytics/traffic\">Traffic</a> analytics page in our dashboard, and represents all of the HTTP requests that flow through our network. The upshot is that this dataset gives you the ability to filter and “group by” any aspect of the HTTP request.</p><h3>An example of how to use Timing Insights</h3><p>Let’s walk through an example of how you’d actually use this data to pinpoint a problem.</p><p>To start with, I want to understand the lay of the land by querying TTFB at various quantiles:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">query TTFBQuantiles($zoneTag: string) {\n  viewer {\n    zones(filter: {zoneTag: $zoneTag}) {\n      httpRequestsAdaptiveGroups(limit: 1) {\n        quantiles {\n          edgeTimeToFirstByteMsP50\n          edgeTimeToFirstByteMsP95\n          edgeTimeToFirstByteMsP99\n        }\n      }\n    }\n  }\n}\n\nResponse:\n{\n  &quot;data&quot;: {\n    &quot;viewer&quot;: {\n      &quot;zones&quot;: [\n        {\n          &quot;httpRequestsAdaptiveGroups&quot;: [\n            {\n              &quot;quantiles&quot;: {\n                &quot;edgeTimeToFirstByteMsP50&quot;: 32,\n                &quot;edgeTimeToFirstByteMsP95&quot;: 1392,\n                &quot;edgeTimeToFirstByteMsP99&quot;: 3063,\n              }\n            }\n          ]\n        }\n      ]\n    }\n  }\n}</pre></code>\n            <p>This shows that TTFB is over 1.3 seconds at P95 – that’s fairly slow, given that <a href=\"https://web.dev/lcp/\">best practices</a> are for 75% of pages to <i>finish rendering</i> within 2.5 seconds, and TTFB is just one component of LCP.</p><p>If I want to dig into why TTFB, it would be helpful to understand <i>which URLs</i> are slowest. In this query I’ll filter to that slowest 5% of page loads, and now look at the <i>aggregate</i> time taken – this helps me understand which pages contribute most to slow loads:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">query slowestURLs($zoneTag: string, $filter:filter) {\n  viewer {\n    zones(filter: {zoneTag: $zoneTag}) {\n      httpRequestsAdaptiveGroups(limit: 3, filter: {edgeTimeToFirstByteMs_gt: 1392}, orderBy: [sum_edgeTimeToFirstByteMs_DESC]) {\n        sum {\n          edgeTimeToFirstByteMs\n        }\n        dimensions {\n          clientRequestPath\n        }\n      }\n    }\n  }\n}\n\nResponse:\n{\n  &quot;data&quot;: {\n    &quot;viewer&quot;: {\n      &quot;zones&quot;: [\n        {\n          &quot;httpRequestsAdaptiveGroups&quot;: [\n            {\n              &quot;dimensions&quot;: {\n                &quot;clientRequestPath&quot;: &quot;/api/v2&quot;\n              },\n              &quot;sum&quot;: {\n                &quot;edgeTimeToFirstByteMs&quot;: 1655952\n              }\n            },\n            {\n              &quot;dimensions&quot;: {\n                &quot;clientRequestPath&quot;: &quot;/blog&quot;\n              },\n              &quot;sum&quot;: {\n                &quot;edgeTimeToFirstByteMs&quot;: 167397\n              }\n            },\n            {\n              &quot;dimensions&quot;: {\n                &quot;clientRequestPath&quot;: &quot;/&quot;\n              },\n              &quot;sum&quot;: {\n                &quot;edgeTimeToFirstByteMs&quot;: 118542\n              }\n            }\n          ]\n        }\n      ]\n    }\n  }\n}</pre></code>\n            <p>Based on this query, it looks like the <code>/api/v2</code> path is most often responsible for these slow requests. In order to know how to fix the problem, we need to know <i>why</i> these pages are slow. To do this, we can query for the average (mean) DNS and origin response time for queries on these paths, where TTFB is above our P95 threshold:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">query originAndDnsTiming($zoneTag: string, $filter:filter) {\n  viewer {\n    zones(filter: {zoneTag: $zoneTag}) {\n      httpRequestsAdaptiveGroups(filter: {edgeTimeToFirstByteMs_gt: 1392, clientRequestPath_in: [$paths]}) {\n        avg {\n          originResponseDurationMs\n          edgeDnsResponseTimeMs\n        }\n      }\n    }\n}\n\nResponse:\n{\n  &quot;data&quot;: {\n    &quot;viewer&quot;: {\n      &quot;zones&quot;: [\n        {\n          &quot;httpRequestsAdaptiveGroups&quot;: [\n            {\n              &quot;average&quot;: {\n                &quot;originResponseDurationMs&quot;: 4955,\n                &quot;edgeDnsResponseTimeMs&quot;: 742,\n              }\n            }\n          ]\n        }\n      ]\n    }\n  }\n}</pre></code>\n            <p>According to this, most of the long TTFB values are actually due to resolving DNS! The good news is that’s something we can fix – for example, by setting longer TTLs with my DNS provider.</p><h3>Conclusion</h3><p>Coming soon, we’ll be bringing this to Cloudflare Observatory in the dashboard so that you can easily explore timing data via the UI.</p><p>And we’ll be adding even more granular metrics so you can see exactly which components are contributing to high TTFB. For example, we plan to separate out the difference between origin “connection time” (how long it took to establish a TCP and/or TLS connection) vs “application response time” (how long it took an HTTP server to respond).</p><p>We’ll also be making improvements to our GraphQL API to allow more flexible querying – for example, the ability to query arbitrary percentiles, not just 50th, 95th, or 99th.</p><p>Start using the <a href=\"https://developers.cloudflare.com/analytics/graphql-api/\">GraphQL API</a> today to get Timing Insights, or hop on the discussion about our Analytics products in <a href=\"https://discord.com/channels/595317990191398933/1115387663982276648\">Discord</a>.</p><h3>Watch on Cloudflare TV</h3><!--kg-card-begin: html--><div style=\"position: relative; padding-top: 56.25%;\"><iframe src=\"https://customer-rhnwzxvb3mg4wz3v.cloudflarestream.com/52d1657849a6180daa52bd51f25a83f2/iframe?preload=true&poster=https%3A%2F%2Fcustomer-rhnwzxvb3mg4wz3v.cloudflarestream.com%2F52d1657849a6180daa52bd51f25a83f2%2Fthumbnails%2Fthumbnail.jpg%3Ftime%3D1s%26height%3D600\" style=\"border: none; position: absolute; top: 0; left: 0; height: 100%; width: 100%;\" allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;\" allowfullscreen=\"true\"></iframe></div><!--kg-card-end: html-->",
		"id": "1vitH7RVlSZWDB2VUyPmVA",
		"localeList": {
			"name": "Introducing Timing Insights: new performance metrics via our GraphQL API Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "If you care about the performance of your website or APIs, it’s critical to understand why things are slow.  Today we're introducing new analytics tools to help you understand what is contributing to \"Time to First Byte\" (TTFB) of Cloudflare and your origin.",
		"metadata": {
			"title": "Introducing Timing Insights: new performance metrics via our GraphQL API",
			"description": "If you care about the performance of your website or APIs, it’s critical to understand why things are slow.  Today we're introducing new analytics tools to help you understand what is contributing to \"Time to First Byte\" (TTFB) of Cloudflare and your origin.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/60Bgsn9sYgfcZrIgkZXIGc/c1ab3aed6e5e94fd478f93dcca267a8d/introducing-timing-insights-Sr0UuU.png"
		},
		"primary_author": {},
		"published_at": "2023-06-20T14:00:47.000+01:00",
		"slug": "introducing-timing-insights",
		"tags": [
			{
				"id": "7a1NuQRjeZo9DhGt97wDwe",
				"name": "Speed Week",
				"slug": "speed-week"
			},
			{
				"id": "4gN0ARax0fHxjtZL07THOe",
				"name": "Performance",
				"slug": "performance"
			},
			{
				"id": "2OotqBxtRdi5MuC90AlyxE",
				"name": "Analytics",
				"slug": "analytics"
			},
			{
				"id": "6GfYtlrIy3UkkZHclLS3LX",
				"name": "GraphQL",
				"slug": "graphql"
			}
		],
		"title": "Introducing Timing Insights: new performance metrics via our GraphQL API",
		"updated_at": "2024-08-27T01:09:41.353Z",
		"url": "https://blog.cloudflare.com/introducing-timing-insights"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}