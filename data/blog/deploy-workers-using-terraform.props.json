{
	"initialReadingTime": "4",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Jake Riesterer",
				"slug": "jake-riesterer",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/T1taDU4jhX8oroEk7jNIo/f3724a8b3a8eb9144e40a2857988582e/jake-riesterer.jpg",
				"location": null,
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "Today we're excited to announce that Cloudflare Workers are now supported in the Cloudflare Terraform Provider. ",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/355uB7AwRquDNtOfXFjGMX/bb78cacb875379e302ef633fa962d72b/deploy-workers-using-terraform.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/5zlJzPJqtTSYj73Tb7Nuzu/e7f4e364541b137ab297dad7849c564b/cf-plus-terraform-_2x-1.png\" alt=\"cf-plus-terraform-@2x-1\" class=\"kg-image\" width=\"2000\" height=\"1500\" loading=\"lazy\"/>\n            \n            </figure><p>Today we&#39;re excited to announce that Cloudflare Workers are now supported in the <a href=\"https://www.terraform.io/docs/providers/cloudflare/index.html\">Cloudflare Terraform Provider</a>.</p><p><a href=\"https://www.terraform.io/\">Terraform</a> is a fantastic tool for configuring your infrastructure. Traditionally if you wanted to spin up, tear down or update some of your infrastructure you would have to click around on a website or make some API calls, which is prone to human error. With Terraform, you define your infrastructure in simple, declarative configuration files and let Terraform figure out how to make the API calls for you. This also lets you treat your infrastructure like your code. You can check your Terraform configuration files into version control and integrate them into your normal software development workflow.</p><p>Terraform integrates with <a href=\"https://www.terraform.io/docs/providers/\">many infrastructure providers</a> including Cloudflare. If you&#39;d like to read more about setting up Terraform with Cloudflare, check out <a href=\"/getting-started-with-terraform-and-cloudflare-part-1/\">Getting started with Terraform and Cloudflare</a>. In this post, I&#39;m going to focus specifically on how to integrate <a href=\"https://www.cloudflare.com/products/cloudflare-workers/\">Cloudflare Workers</a> with Terraform.</p><p>In this example we&#39;re going to create <a href=\"https://partyparrot.business\">partyparrot.business</a>, and we&#39;re going to serve the whole site out of a worker without any origin server. We&#39;re starting from scratch here, but if you&#39;re already using Cloudflare workers and want to migrate to managing your workers with Terraform, you&#39;ll need to import your existing script and routes so that Terraform knows about them. See the &quot;Importing your existing workers&quot; section at the end.</p><h3>Prerequisites</h3><ul><li><p><a href=\"https://www.terraform.io/intro/getting-started/install.html\">Install Terraform</a></p></li><li><p>Provide your Cloudflare credentials via environment variables</p><ul><li><p>Set <code>CLOUDFLARE_EMAIL</code> to your email address</p></li><li><p>Set <code>CLOUDFLARE_TOKEN</code> to your <a href=\"https://support.cloudflare.com/hc/en-us/articles/200167836-Where-do-I-find-my-Cloudflare-API-key-\">Cloudflare API key</a></p></li><li><p>If you&#39;re on an Enterprise plan and want to use multiple scripts, you&#39;ll also need to set <code>CLOUDFLARE_ORG_ID</code> to your account ID. You can find your account ID by using the <a href=\"https://api.cloudflare.com/#accounts-list-accounts\">List Accounts API</a></p></li></ul></li></ul><h3>Create the Terraform config file</h3><p>Create a file with any name and give it a <code>.tf</code> file extension. This is where we&#39;ll define our Terraform resources. In this file, first we&#39;ll need to setup the Cloudflare provider:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">provider &quot;cloudflare&quot; {}</pre></code>\n            <p>You could define your credentials in this file, but in general it&#39;s better to use environment variables so that you can check the configuration file into version control without including any private data.</p><p>Next we&#39;re going to create a variable named <code>zone</code>. One of the benefits about defining the zone in a variable as opposed to hard-coding it is that you can setup a separate staging domain and use the same Terraform configuration as your production domain. See the <a href=\"https://www.terraform.io/docs/configuration/variables.html\">documentation</a> for more information on working with variables.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">variable &quot;zone&quot; {\n  default = &quot;partyparrot.business&quot;\n}</pre></code>\n            <h3>Setting up the worker script</h3><p>Now let&#39;s write our worker script. If you&#39;re looking for inspiration, check out some <a href=\"https://developers.cloudflare.com/workers/recipes/\">Worker recipes</a>. For this example, I&#39;ll use <a href=\"https://gist.github.com/jRiest/7893cf10c550057ce1ff53f270683e1c#file-party_parrot_worker-js\">this script</a> and name it <code>party_parrot_worker.js</code>.</p><p>Next we need to add a <code>cloudflare_worker_script</code> resource to our Terraform config and reference the script file. Open your <code>.tf</code> file and add the following:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">resource &quot;cloudflare_worker_script&quot; &quot;main_script&quot; {\n  zone = &quot;${var.zone}&quot;\n  content = &quot;${file(&quot;party_parrot_worker.js&quot;)}&quot;\n}</pre></code>\n            <p>If you&#39;re new to Terraform, check out the <a href=\"https://www.terraform.io/docs/configuration/resources.html\">Terraform Resource documentation</a> to learn more about this schema. Here we provide 2 parameters, the <code>zone</code> which references the variable we defined earlier and <code>content</code> which references the file we just created.</p><p><b>NOTE:</b> The <a href=\"https://www.cloudflare.com/plans/enterprise/\">Cloudflare Enterprise plan</a> supports using multiple (named) scripts. To use this, the parameters will be slightly different. Remove the <code>zone</code> parameter since named scripts are not tied to a particular zone and instead add a <code>name</code> parameter to define the name of the script. See <a href=\"https://www.terraform.io/docs/providers/cloudflare/r/worker_script.html\">the cloudflare_worker_script documentation</a> for an example.</p><h3>Setting up the worker routes</h3><p>In order for the worker to start handling traffic, we&#39;ll also need to define at least one route. To do so, add a <code>cloudflare_worker_route</code> resource to the Terraform config.</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">resource &quot;cloudflare_worker_route&quot; &quot;catch_all_route&quot; {\n  zone = &quot;${var.zone}&quot;\n  pattern = &quot;*${var.zone}/*&quot;\n  enabled = true\n  depends_on = [&quot;cloudflare_worker_script.main_script&quot;]\n}</pre></code>\n            <p>Just like with the script resource, the <code>zone</code> parameter references the variable we defined earlier.</p><p>The <code>pattern</code> parameter defines which requests should be sent to the worker. In this example we use a route pattern like <code>*partyparrot.business*</code> which will match all traffic. If, however, you only want your worker to handle a subset of requests to your zone, you can define a more specific pattern like <code>mysubdomain.example.com/*</code> or <code>*example.com/mypath*</code>. More information on route patterns is available <a href=\"https://developers.cloudflare.com/workers/api/route-matching/\">here</a>.</p><p>The <code>enabled</code> parameter specifies that requests that match the pattern <b>should</b> run the worker. Alternatively, you can set <code>enabled</code> to <code>false</code> which would mean that any requests that match the pattern <b>should not</b> run the worker. You can create multiple route patterns, and more-specific route patterns apply before less-specific route patterns. For example, you could create one route pattern like <code>example.com/assets/*</code> and set <code>enabled = false</code> then create another pattern like <code>*example.com*</code> and set <code>enabled = true</code>. This would enable the worker for all traffic <i>except</i> for requests that match <code>example.com/assets/*</code>.</p><p>Finally, we set <code>depends_on</code> to point to the script resource we created above. In general, Terraform will try to create resources in parallel, but you may get an error if you try to create a route before you have a script. By using the <code>depends_on</code> parameter, Terraform will know to create the script first before creating the route.</p><p><b>NOTE:</b> As with the script resource, some of the parameters are different if you&#39;re on the Enterprise plan and using multiple scripts. Remove the <code>enabled</code> parameter and instead set <code>script_name = &quot;${cloudflare_worker_script.your_script_resource.name}&quot;</code> to specify which script the route should run. By directly referencing the script resource using this syntax, Terraform already knows that the route depends on the script, so you can also remove the <code>depends_on</code> parameter. You can see more details in <a href=\"https://www.terraform.io/docs/providers/cloudflare/r/worker_route.html\">the cloudflare_worker_route documentation</a>.</p><h3>Applying the Terraform config</h3><p>Now that we&#39;ve defined our script and route resources in the config file, we&#39;re ready to deploy! To initialize Terraform, run <code>terraform init</code></p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">$ terraform init\n\nInitializing provider plugins...\n\nTerraform has been successfully initialized!\n\nYou may now begin working with Terraform. Try running &quot;terraform plan&quot; to see\nany changes that are required for your infrastructure. All Terraform commands\nshould now work.\n\nIf you ever set or change modules or backend configuration for Terraform,\nrerun this command to reinitialize your working directory. If you forget, other\ncommands will detect it and remind you to do so if necessary.</pre></code>\n            <p>Now to deploy the changes, run <code>terraform apply</code>. Terraform will show you a preview of the changes it will make.</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">$ terraform apply\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  + cloudflare_worker_route.catch_all_route\n      id:           &lt;computed&gt;\n      enabled:      &quot;true&quot;\n      multi_script: &lt;computed&gt;\n      pattern:      &quot;*partyparrot.business/*&quot;\n      zone:         &quot;partyparrot.business&quot;\n      zone_id:      &lt;computed&gt;\n\n  + cloudflare_worker_script.main_script\n      id:           &lt;computed&gt;\n      content:      &quot;...omitted for brevity...&quot;\n      zone:         &quot;partyparrot.business&quot;\n      zone_id:      &lt;computed&gt;\n\n\nPlan: 2 to add, 0 to change, 0 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only &#039;yes&#039; will be accepted to approve.\n\n  Enter a value:</pre></code>\n            <p>If everything looks good, type <code>yes</code> and press return to apply the changes.</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">cloudflare_worker_script.main_script: Creating...\n  content: &quot;&quot; =&gt; &quot;...omitted for brevity...&quot;\n  zone:    &quot;&quot; =&gt; &quot;partyparrot.business&quot;\n  zone_id: &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;\ncloudflare_worker_script.main_script: Creation complete after 1s (ID: zone:partyparrot.business)\ncloudflare_worker_route.catch_all_route: Creating...\n  enabled:      &quot;&quot; =&gt; &quot;true&quot;\n  multi_script: &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;\n  pattern:      &quot;&quot; =&gt; &quot;*partyparrot.business/*&quot;\n  zone:         &quot;&quot; =&gt; &quot;partyparrot.business&quot;\n  zone_id:      &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;\ncloudflare_worker_route.catch_all_route: Creation complete after 0s (ID: af595c1bb7cd4d1698c4d6cbcb364662)\n\nApply complete! Resources: 2 added, 0 changed, 0 destroyed.</pre></code>\n            <p>Congratulations, your worker script and route are deployed! You can see the example script running at <a href=\"https://partyparrot.business/\">partyparrot.business</a>.</p><p>As you make changes to your script or Terraform config, you can run <code>terraform apply</code> again and Terraform will figure out what&#39;s changed and deploy any updates.</p><h3>Importing your existing workers</h3><p>If you&#39;re already using Cloudflare Workers but want to start managing them via Terraform, you&#39;ll need to let Terraform know about your existing configuration so it knows how to apply changes going forward.</p><p>First youâ€™ll need to create your <code>.tf</code> file and add <code>cloudflare_worker_script</code> and <code>cloudflare_worker_route</code> resources for all of your existing scripts and routes.</p><p>Next you&#39;ll need to individually run the appropriate <code>terraform import ...</code> command for each script and route resource. The import command takes two arguments:</p><ul><li><p>the identifier of the resource that you defined in your <code>.tf</code> file (ex: <code>cloudflare_worker_script.main_script</code> or <code>cloudflare_worker_route.catch_all_route</code>)</p></li><li><p>an ID that&#39;s used to lookup the resource from the cloudflare API. See the <a href=\"https://www.terraform.io/docs/providers/cloudflare/r/worker_script.html\">cloudflare_worker_script</a> and <a href=\"https://www.terraform.io/docs/providers/cloudflare/r/worker_route.html\">cloudflare_worker_route</a> documentation for more information.</p></li></ul><h3>Wrapping up</h3><p>The complete script and terraform configuration file for this example are hosted <a href=\"https://gist.github.com/jRiest/7893cf10c550057ce1ff53f270683e1c\">on Github</a>.</p><p>Whether you&#39;re already using Cloudflare Workers or just getting started, Terraform can be a great way to manage your Workers configuration. If you&#39;re interested in learning more, here&#39;s a few useful links:</p><ul><li><p><a href=\"https://developers.cloudflare.com/workers/\">Cloudflare Workers documentation</a></p></li><li><p><a href=\"https://developers.cloudflare.com/terraform/\">Cloudflare Terraform Provider documentation</a></p></li><li><p><a href=\"/tag/workers/\">More Workers blog posts</a></p></li><li><p><a href=\"/tag/terraform/\">More Terraform blog posts</a></p></li><li><p><a href=\"https://github.com/terraform-providers/terraform-provider-cloudflare\">terraform-provider-cloudflare source</a></p></li></ul>",
		"id": "5QupFF8DVLR5KBikEm5App",
		"localeList": {
			"name": "Deploy Workers using Terraform Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2018-09-13T17:03:15.000+01:00",
		"slug": "deploy-workers-using-terraform",
		"tags": [
			{
				"id": "6hbkItfupogJP3aRDAq6v8",
				"name": "Cloudflare Workers",
				"slug": "workers"
			},
			{
				"id": "5cye1Bh5KxFh3pKSnX8Dsy",
				"name": "Serverless",
				"slug": "serverless"
			},
			{
				"id": "78aSAeMjGNmCuetQ7B4OgU",
				"name": "JavaScript",
				"slug": "javascript"
			},
			{
				"id": "4PjcrP7azfu8cw8rGcpYoM",
				"name": "Terraform",
				"slug": "terraform"
			},
			{
				"id": "6QktrXeEFcl4e2dZUTZVGl",
				"name": "Product News",
				"slug": "product-news"
			},
			{
				"id": "6lhzEBz2B56RKa4nUEAGYJ",
				"name": "Programming",
				"slug": "programming"
			},
			{
				"id": "4HIPcb68qM0e26fIxyfzwQ",
				"name": "Developers",
				"slug": "developers"
			},
			{
				"id": "3JAY3z7p7An94s6ScuSQPf",
				"name": "Developer Platform",
				"slug": "developer-platform"
			}
		],
		"title": "Deploy Workers using Terraform",
		"updated_at": "2024-08-27T02:19:21.221Z",
		"url": "https://blog.cloudflare.com/deploy-workers-using-terraform"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}