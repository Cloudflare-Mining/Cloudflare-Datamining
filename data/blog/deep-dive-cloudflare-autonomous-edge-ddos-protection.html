<div class="mb2 gray5">5 min read</div>
<div class="mt4">This post is also available in <a href="https://blog.cloudflare.com/zh-cn/deep-dive-cloudflare-autonomous-edge-ddos-protection">简体中文</a>, <a href="https://blog.cloudflare.com/fr-fr/deep-dive-cloudflare-autonomous-edge-ddos-protection">Français</a>, <a href="https://blog.cloudflare.com/de-de/deep-dive-cloudflare-autonomous-edge-ddos-protection">Deutsch</a>, <a href="https://blog.cloudflare.com/it-it/deep-dive-cloudflare-autonomous-edge-ddos-protection">Italiano</a>, <a href="https://blog.cloudflare.com/ja-jp/deep-dive-cloudflare-autonomous-edge-ddos-protection">日本語</a>, <a href="https://blog.cloudflare.com/ko-kr/deep-dive-cloudflare-autonomous-edge-ddos-protection">한국어</a>, <a href="https://blog.cloudflare.com/pt-br/deep-dive-cloudflare-autonomous-edge-ddos-protection">Português</a>, <a href="https://blog.cloudflare.com/es-es/deep-dive-cloudflare-autonomous-edge-ddos-protection">Español</a> and <a href="https://blog.cloudflare.com/zh-tw/deep-dive-cloudflare-autonomous-edge-ddos-protection">繁體中文</a>.</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6aTrVUJXeSgALWslKLiDcZ/3dccb5adfb96a1b8b460ad1c4d6bc104/deep-dive-cloudflare-autonomous-edge-ddos-protection.png" alt="">
<div class="post-content lh-copy gray1">
	<p></p>
	<p>Today, I’m excited to talk about our autonomous DDoS (<a href="https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack">Distributed Denial of Service</a>) protection system. This system has been deployed globally to all of our 200+ data centers and actively protects all our customers against DDoS attacks across layers 3 to 7 (in the <a href="https://www.cloudflare.com/learning/ddos/glossary/open-systems-interconnection-model-osi">OSI model</a>) without requiring any human intervention. As part of our <a href="https://blog.cloudflare.com/unmetered-mitigation">unmetered DDoS protection commitment</a>, we won’t charge a customer more just because they got hit by a DDoS.</p>
	<div class="flex anchor relative">
		<h3 id="autonomous-protection-at-the-edge">Autonomous protection at the edge</h3>
		<a href="https://blog.cloudflare.com/#autonomous-protection-at-the-edge" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>To protect our customers quickly and with precision against DDoS attacks, we built an autonomous edge detection and mitigation system that can make decisions on its own without seeking a centralized consensus. It is completely software-defined and runs on our edge on commodity servers. It’s powered by our denial of service daemon (dosd) which originally went live in mid-2019 for protection against L3/4 DDoS attacks. Since then, we’ve been investing in enhancing and improving its capabilities to stay ahead of attackers and to disrupt the economics of attacks. The latest set of improvements have expanded our edge mitigation component to protect against <a href="https://www.cloudflare.com/learning/ddos/application-layer-ddos-attack">L7 attacks</a> in addition to <a href="https://www.cloudflare.com/learning/ddos/layer-3-ddos-attacks">L3/4</a>.</p>
	<p>This system runs on every single server in all our edge data centers. It constantly analyzes packets and HTTP requests, scanning for DDoS attacks. Upon detection, it immediately pushes a mitigation rule with a real-time generated signature to the most optimal location in the Linux stack where the most cost-efficient mitigation can be applied.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/15Hk0Q8gqqwu4pkZXq4foF/c97de51639de77feb3dc93486a2ad8c5/DDoS-mitigation-diagram_2x-1.png" alt="A conceptual diagram of Cloudflare DDoS mitigation systems" class="kg-image" width="2237" height="1067" loading="lazy">

	</figure>
	<p>A conceptual diagram of Cloudflare DDoS mitigation systems</p>
	<p>Our new edge detection capabilities complement our existing global threat detection mechanism, <a href="https://blog.cloudflare.com/meet-gatebot-a-bot-that-allows-us-to-sleep">Gatebot</a>, which resides in our network’s core. Detecting attacks at the network core with Gatebot is great for larger, distributed volumetric attacks that require coordination across the entire Cloudflare edge, but smaller, localized attacks require a different approach. Detecting network-layer and HTTP attacks at the edge means we can sample at a higher rate, detect both small and large attacks, and immediately generate a mitigation rule. Over the past few months, 98.6% of all L3/4 DDoS attacks were detected by dosd. Similarly, since deploying the expanded version of dosd, it has been mitigating 81% of all L7 attacks.</p>
	<p>In previous blogs, we’ve already covered <a href="https://blog.cloudflare.com/meet-gatebot-a-bot-that-allows-us-to-sleep">Gatebot</a> and <a href="https://blog.cloudflare.com/announcing-flowtrackd">flowtrackd</a>. So in this blog, we’ll be focusing on the expanded dosd capabilities.</p>
	<div class="flex anchor relative">
		<h3 id="harnessing-linux-networking-to-drop-packets-and-requests-at-wire-speed">Harnessing Linux networking to drop packets and requests at wire speed</h3>
		<a href="https://blog.cloudflare.com/#harnessing-linux-networking-to-drop-packets-and-requests-at-wire-speed" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Ten years ago, Linux networking was slow. Today, we’re dropping packets at wire speed thanks to Linux — specifically, with iptables and the eXpress Data Path (XDP).</p>
	<div class="flex anchor relative">
		<h3 id="the-life-of-a-packet">The life of a packet</h3>
		<a href="https://blog.cloudflare.com/#the-life-of-a-packet" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>A packet destined for a Cloudflare-protected customer makes its way to the closest <a href="https://www.cloudflare.com/network">Cloudflare data center</a> through <a href="https://www.cloudflare.com/learning/cdn/glossary/anycast-network">BGP Anycast</a>. Once it arrives, it is passed from the router to a server using equal-cost multi-path routing groups (<a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing">ECMP</a>) algorithm via network switches. When it arrives at a server, the packet is sent into a group of eXpress Data Path (<a href="https://en.wikipedia.org/wiki/Express_Data_Path">XDP</a>) programs. The first group of XDP programs, <a href="https://blog.cloudflare.com/l4drop-xdp-ebpf-based-ddos-mitigations">L4Drop</a>, applies mitigation rules from previously detected attacks and transmits packet samples to dosd for further analysis.</p>
	<p>If a packet is not dropped as malicious, it’s then passed to <a href="https://blog.cloudflare.com/unimog-cloudflares-edge-load-balancer">Unimog</a>, our proprietary L4 load balancer. Using server health and performance metrics, Unimog decides whether it should keep the packet in the same server or pass it on to another server in the data center better able to handle it. After Unimog, it is passed through the iptables firewall and then, if targeting an L7 application, e.g., a service protected by the <a href="https://www.cloudflare.com/application-services/products/waf">Cloudflare WAF</a>, to our HTTP reverse proxy. The reverse-proxy runs in userspace and HTTP requests go through our <a href="https://www.cloudflare.com/waf">Web Application Firewall</a>, application Firewall rules, and additional customer configurations. If the packet is instead destined for a TCP/UDP application (<a href="https://www.cloudflare.com/application-services/products/cloudflare-spectrum">Spectrum</a>) or an IP destination that is routed rather than proxied (<a href="https://www.cloudflare.com/network-services/products/magic-transit">Magic Transit</a>), it would pass through those systems rather than our HTTP proxy.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/66UlMrtt1qMkZIKeHkiSF1/dc76094ef0551319f1509063b9d8d4e1/L7-ddos-diagram_2x-1-1.png" alt="Life of a packet" class="kg-image" width="2572" height="1976" loading="lazy">

	</figure>
	<p>Life of a packet</p>
	<p>In addition to L4Drop, our HTTP proxy also transmits samples and metadata of HTTP requests to dosd. This edge sampling happens at a rate that’s 10 times greater than core sampling, as signals can now be analyzed (and acted upon) locally rather than shipped to a core data center. Similarly, packets are sampled by dosd at a rate that is 81 times faster than gatebot.</p>
	<p>Together, dosd, gatebot, and flowtrackd analyze samples they receive and apply mitigation rules when DDoS attacks are detected. They push mitigation rules into the web proxy to mitigate HTTP attacks. Attack requests are handled with a block, rate limit, or challenge action, depending on the system’s decision. However, if the attack is highly volumetric, the mitigation rule is pushed down the stack into the iptables firewall and L7 attacks are dropped at L4 using <a href="https://blog.cloudflare.com/rolling-with-the-punches-shifting-attack-tactics-dropping-packets-faster-cheaper-at-the-edge/#jails">IP Jails,</a> for a more cost-efficient mitigation. Similarly, L3/4 attacks are mitigated in the iptables firewall using extended Berkeley Packet Filter (<a href="https://blog.cloudflare.com/cloudflare-architecture-and-how-bpf-eats-the-world">eBPF</a>) programs inside L4Drop. Leveraging these components allows us to automatically <a href="https://www.cloudflare.com/learning/ddos/ddos-mitigation">mitigate DDoS attacks</a> at scale.</p>
	<div class="flex anchor relative">
		<h3 id="disrupting-the-attack-economics">Disrupting the attack economics</h3>
		<a href="https://blog.cloudflare.com/#disrupting-the-attack-economics" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Our expanded autonomous system, described above, along with our existing threat mitigation components, was developed to protect our customers against DDoS attacks that have become very easy and cheap to launch. These attacks are used by malicious actors that aim to take down a website, mobile app, game, or any Internet-connected property. These expanded protections were a necessary step as during the past year the number of attacks has increased, as we’ve documented in our <a href="https://blog.cloudflare.com/network-layer-ddos-attack-trends-for-q3-2020">DDoS trends reports</a>. Additionally, the attacks are getting bigger and more <a href="https://blog.cloudflare.com/beat-an-acoustics-inspired-ddos-attack">sophisticated</a>, such as the attack that imitated acoustic beats. Just as important are small attacks that could take down a small web property; we want to block the large and small.</p>
	<p>In many cases, attackers can launch DDoS attacks for free using publicly available tools, or for a small fee by hiring a DDoS-as-a-service <a href="https://www.cloudflare.com/learning/ddos/what-is-a-ddos-botnet">botnet</a> such as <a href="https://blog.cloudflare.com/moobot-vs-gatebot-cloudflare-automatically-blocks-botnet-ddos-attack-topping-at-654-gbps">Moobot</a> in the dark web. According to the <a href="https://www.privacyaffairs.com/dark-web-price-index-2020">Dark Web Price Index for 2020</a>, the price of a DDoS attack starts at $10 for a one-hour attack at a rate of 10-50k requests per second. Attacks are far cheaper to launch than the damage they cause. By causing an outage or even <i>just</i> by degrading the service, attackers can take a substantial toll on their victim. As an example, taking down an <a href="https://www.cloudflare.com/ecommerce">ecommerce website</a> means that users cannot log in and make purchases. Even increased <a href="https://www.cloudflare.com/solutions/ecommerce/optimization">latency</a> can cause users to abandon their shopping carts and pop over to the competition. A minute of downtime can easily translate to the loss of <a href="https://www.gremlin.com/ecommerce-cost-of-downtime">tens of thousands of dollars</a>.</p>
	<p>The frequency, sophistication, and size of DDoS attacks require a new approach — one that is fast, accurate, and precise. And this is why we developed the expanded protections described in this post.</p>
	<div class="flex anchor relative">
		<h3 id="helping-build-a-better-internet">Helping build a better Internet</h3>
		<a href="https://blog.cloudflare.com/#helping-build-a-better-internet" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Cloudflare’s mission is to help build a better Internet — one that is secure, faster, and more reliable for all. The DDoS team’s vision is derived from this mission: our goal is to make the impact of DDoS attacks a thing of the past. In the ’90s and 2000s, <a href="https://en.wikipedia.org/wiki/History_of_email_spam">spam emails became a serious problem</a>. Today, email services filter them out for us, and our objective is to do the same for DDoS attacks.</p>
	<p>For more information about <a href="https://www.cloudflare.com/ddos">Cloudflare’s DDoS protection</a>, <a href="https://www.cloudflare.com/enterprise">reach out to us</a> or have a go with a hands-on evaluation of <a href="https://www.cloudflare.com/plans/free">Cloudflare’s free plan</a>.</p>
	<p>By the way, if you are interested in working in the DDoS Protection engineering team, we're currently hiring in our London and Austin offices. Submit your application here:</p>
	<p> Austin: <a href="https://boards.greenhouse.io/cloudflare/jobs/2291040?gh_jid=2291040">https://boards.greenhouse.io/cloudflare/jobs/2291040?gh_jid=2291040</a> London: <a href="https://boards.greenhouse.io/cloudflare/jobs/2291038?gh_jid=2291038">https://boards.greenhouse.io/cloudflare/jobs/2291038?gh_jid=2291038</a></p>
</div>