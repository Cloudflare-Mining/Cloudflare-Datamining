{
	"initialReadingTime": "2",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5vGNsXzZrtSLn2X30pnpUY/a43660c54db33a4289ab5a7d99d3d414/john-graham-cumming.jpg",
				"location": "Lisbon, Portugal",
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "A cornerstone of CloudFlare's infrastructure is our ability to serve DNS requests quickly and handle DNS attacks. To do both those things we wrote our own authoritative DNS server called RRDNS in Go. ",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/7lCDvfhTzFcVMB5PveKJco/eb0dcfca429a2949ffd1abb7606e5129/the-weird-and-wonderful-world-of-dns-loc-records.jpg",
		"featured": false,
		"html": "<p>A cornerstone of CloudFlare&#39;s infrastructure is our ability to serve DNS requests quickly and <a href=\"/deep-inside-a-dns-amplification-ddos-attack\">handle DNS attacks</a>. To do both those things we wrote our own authoritative DNS server called <a href=\"/the-story-of-a-little-dns-easter-egg\">RRDNS</a> in Go. Because of it we&#39;ve been able to fight off DNS attacks, and be consistenly one of the <a href=\"/cloudflare-fastest-free-dns-among-fastest-dns\">fastest</a> DNS providers on the web.</p><p>Implementing an authoritative DNS server is a large task. That&#39;s in part because DNS is a very old standard (<a href=\"http://www.ietf.org/rfc/rfc1035.txt\">RFC 1035</a> dates to 1987), in part because as DNS has developed it has grown into a more and more complex system, and in part because what&#39;s written in the RFCs and what happens in the real-world aren&#39;t always the same thing.</p><p>One little used type of DNS record is the LOC (or location). It allows you to specify a physical location. CloudFlare handles millions of DNS records; of those just 743 are LOCs. Nevertheless, it&#39;s possible to set up a LOC record in the CloudFlare DNS editor.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/SE3YNqdqCWTZjCq2X3204/f2eac4b46e9465b2ab11e75649643ad5/480px-Trinity_Site_Obelisk_National_Historic_Landmark.jpg\" alt=\"Trinity\" class=\"kg-image\" width=\"480\" height=\"480\" loading=\"lazy\"/>\n            \n            </figure><p>My site <a href=\"https://web.archive.org/web/20140329092052/http://geekatlas.com/\">geekatlas.com</a> has a LOC record as an Easter Egg. Here&#39;s how it&#39;s configured in the CloudFlare DNS settings:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2Qe1yA3xIACsdf36XEi1oQ/e46ec25c5981e87c3e31749679bcf68f/Screen_Shot_2014-03-27_at_11.34.24.png\" alt=\"LOC Example\" class=\"kg-image\" width=\"1894\" height=\"96\" loading=\"lazy\"/>\n            \n            </figure><p>When you operate at CloudFlare scale the little-used nooks and crannies turn out to be important. And even though there are only 743 LOC records in our entire database, at least one customer contacted support to find out why their LOC record wasn&#39;t being served.</p><p>And that sent me into the RRDNS source code to find out why.</p><p>The answer was simple. Although RRDNS had code for receiving requests for LOC records, creating response packets containing LOC data, there was a missing link. The CloudFlare DNS server stores the LOC record as a string (such as the <code>33 40 31 N 106 28 29 W 10m</code> above) and no one had written the code to parse that and turn it into the internal format. Oops.</p><p>The textual LOC format and the binary, on-the-wire, format are described in <a href=\"https://tools.ietf.org/rfc/rfc1876.txt\">RFC 1876</a> and it&#39;s one of many RFCs that updated the original 1987 standard. RFC 1876 is from 1996.</p><p>The textual format is fairly simple. Here&#39;s what the RFC says:</p>\n            <pre class=\"language-Python\"><code class=\"language-Python\">The LOC record is expressed in a primary file in the following format:\n\nowner TTL class LOC ( d1 [m1 [s1]] {&quot;N&quot;|&quot;S&quot;} d2 [m2 [s2]]\n                           {&quot;E&quot;|&quot;W&quot;} alt[&quot;m&quot;] [siz[&quot;m&quot;] [hp[&quot;m&quot;]\n                           [vp[&quot;m&quot;]]]] )\n\nwhere:\n\n   d1:     [0 .. 90]            (degrees latitude)\n   d2:     [0 .. 180]           (degrees longitude)\n   m1, m2: [0 .. 59]            (minutes latitude/longitude)\n   s1, s2: [0 .. 59.999]        (seconds latitude/longitude)\n   alt:    [-100000.00 .. 42849672.95] BY .01 (altitude in meters)\n   siz, hp, vp: [0 .. 90000000.00] (size/precision in meters)\n\nIf omitted, minutes and seconds default to zero, size defaults to 1m,\nhorizontal precision defaults to 10000m, and vertical precision\ndefaults to 10m.  These defaults are chosen to represent typical\nZIP/postal code area sizes, since it is often easy to find\napproximate geographical location by ZIP/postal code.</pre></code>\n            <p>So, there are required latitude, longitude and altitude and three optional values for the size of the location and precision information. Pretty simple.</p><p>Then there&#39;s the on-the-wire format. Unlike a TXT record the LOC record data is parsed and turned into a fixed size binary format. Back to RFC 1876:</p>\n            <pre class=\"language-Python\"><code class=\"language-Python\">  MSB                                           LSB\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n  0|        VERSION        |         SIZE          |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n  2|       HORIZ PRE       |       VERT PRE        |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n  4|                   LATITUDE                    |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n  6|                   LATITUDE                    |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n  8|                   LONGITUDE                   |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n 10|                   LONGITUDE                   |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n 12|                   ALTITUDE                    |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n 14|                   ALTITUDE                    |\n   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</pre></code>\n            <p>So, 32 bits of latitude, longitude and altitude and then three 8 bit values for the size and precision. The latitude and longitude values have a pretty simple encoding that treats the 32 bits as an unsigned integer:</p>\n            <pre class=\"language-Python\"><code class=\"language-Python\">The latitude of the center of the sphere described by the SIZE field, expressed as a 32-bit integer, most significant octet first (network standard byte order), in thousandths of a second of arc.  2^31 represents the equator; numbers above that are north latitude.</pre></code>\n            <p>And the altitude can be below sea-level but still unsigned:</p>\n            <pre class=\"language-Python\"><code class=\"language-Python\">The altitude of the center of the sphere described by the SIZE field, expressed as a 32-bit integer, most significant octet first (network standard byte order), in centimeters, from a base of 100,000m below the [WGS 84] reference spheroid used by GPS.</pre></code>\n            <p>But the 8 bit values use a very special encoding that allows a wide range of approximate values to be packed into 8 bits and also be human-readable when dumped out in hex!</p>\n            <pre class=\"language-Python\"><code class=\"language-Python\">The diameter of a sphere enclosing the described entity, in centimeters, expressed as a pair of four-bit unsigned integers, each ranging from zero to nine, with the most significant four bits representing the base and the second number representing the power of ten by which to multiply the base.  This allows sizes from 0e0 (&lt;1cm) to 9e9 (90,000km) to be expressed.  This representation was chosen such that the hexadecimal representation can be read by eye; 0x15 = 1e5.</pre></code>\n            <p>For example, the value <code>0x12</code> means <code>1 * 10^2</code> or 100cm. <code>0x99</code> means <code>9 * 10^9</code> or 90,000,000m. The smallest value that can be represented is 1cm (it&#39;s <code>0x10</code>). So, in just 8 bits there&#39;s a range values from 1cm to larger than the diameter of Jupiter.</p><p>To fix this I wrote a parser for the LOC text record type (and associated tests). It can be found <a href=\"https://gist.github.com/jgrahamc/9807839\">here</a>.</p><p>We&#39;ve now rolled out the fix and all the existing LOC records are being served by RRDNS. For example, my <code>geekatlas.com</code> LOC record can be queried like this:</p>\n            <pre class=\"language-Python\"><code class=\"language-Python\">$ dig geekatlas.com LOC\n; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; geekatlas.com LOC\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 2997\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:    \n;geekatlas.com.         IN  LOC\n\n;; ANSWER SECTION:\ngeekatlas.com.      299 IN  LOC 33 40 31.000 N 106 28 29.000 W 10.00m 1m 10000m 10m\n\n;; Query time: 104 msec\n;; SERVER: 192.168.14.1#53(192.168.14.1)\n;; WHEN: Tue Apr  1 14:13:48 2014\n;; MSG SIZE  rcvd: 59</pre></code>\n            <p></p>",
		"id": "5aav5kAWuJGhGea0pOkie7",
		"localeList": {
			"name": "The weird and wonderful world of DNS LOC records Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": " ",
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2014-04-01T02:19:00.000+01:00",
		"slug": "the-weird-and-wonderful-world-of-dns-loc-records",
		"tags": [
			{
				"id": "5X8LHhjKihRu7muwB9u5a1",
				"name": "RRDNS",
				"slug": "rrdns"
			},
			{
				"id": "5fZHv2k9HnJ7phOPmYexHw",
				"name": "DNS",
				"slug": "dns"
			},
			{
				"id": "6QVJOBzgKXUO9xAPEpqxvK",
				"name": "Reliability",
				"slug": "reliability"
			},
			{
				"id": "5kIxDMJCg3PXQxVINDL0Cw",
				"name": "Attacks",
				"slug": "attacks"
			},
			{
				"id": "KDI5hQcs301H8vxpGKXO0",
				"name": "Go",
				"slug": "go"
			}
		],
		"title": "The weird and wonderful world of DNS LOC records",
		"updated_at": "2024-09-09T16:18:44.955Z",
		"url": "https://blog.cloudflare.com/the-weird-and-wonderful-world-of-dns-loc-records"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}