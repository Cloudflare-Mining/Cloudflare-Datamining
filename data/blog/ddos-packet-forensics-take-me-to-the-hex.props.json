{
	"footerBlurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
	"initialReadingTime": "2",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5vGNsXzZrtSLn2X30pnpUY/6f350e7dd36058a6422f9199b452bb02/john-graham-cumming.jpg",
				"location": "Lisbon, Portugal",
				"website": null,
				"twitter": null,
				"facebook": null,
				"publiclyIndex": true
			}
		],
		"excerpt": "A few days ago, my colleague Marek sent an email about a DDoS attack against one of our DNS servers that we'd been blocking with our BPF rules.",
		"feature_image": "https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5UuClwPcGt9HcYTbPdiAAO/9a47cbe0f7ccd8f9810d10a35d99bd05/ddos-packet-forensics-take-me-to-the-hex.jpg",
		"featured": false,
		"html": "<p>A few days ago, my colleague Marek sent an email about a DDoS attack against one of our DNS servers that we&#39;d been blocking with our <a href=\"/bpf-the-forgotten-bytecode/\">BPF rules</a>. He noticed that there seemed to be a strange correlation between the TTL field in the IP header and the IPv4 source address.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6g3lAZht4S4HBqWLjL3y33/9a9631d741d3a9b895d1ad50e39bd241/30957385_bfb4b7fb79_z.jpg\" alt=\"\" class=\"kg-image\" width=\"640\" height=\"480\" loading=\"lazy\"/>\n            \n            </figure><p><a href=\"https://creativecommons.org/licenses/by/2.0\">CC BY 2.0</a> <a href=\"https://www.flickr.com/photos/adactio/30957385/\">image</a> by <a href=\"https://www.flickr.com/photos/adactio/\">Jeremy Keith</a></p><p>The source address was being spoofed, as usual, and apparently chosen randomly, but something else was going on. He offered a bottle of Scotch to the first person to come up with a satisfactory solution.</p><p>Here&#39;s what some of the packets looked like:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ tcpdump -ni eth0 -c 10 &quot;ip[8]=40 and udp and port 53&quot;\n1.181.207.7.46337 &gt; x.x.x.x.53: 65098+\n1.178.97.141.45569 &gt; x.x.x.x.53: 65101+\n1.248.136.142.63489 &gt; x.x.x.x.53: 65031+\n1.207.241.195.52993 &gt; x.x.x.x.53: 65072+\n\n$ tcpdump -ni eth0 -c 10 &quot;ip[8]=41 and udp and port 53&quot;\n2.10.30.2.2562 &gt; x.x.x.x.53: 65013+\n2.4.9.36.1026 &gt; x.x.x.x.53: 65019+\n2.98.1.99.25090 &gt; x.x.x.x.53: 64925+\n2.109.69.229.27906 &gt; x.x.x.x.53: 64914+\n\n$ tcpdump -ni eth0 -c 10 &quot;ip[8]=42 and udp and port 53&quot;\n4.72.42.184.18436 &gt; x.x.x.x.53: 64439+\n4.240.78.0.61444 &gt; x.x.x.x.53: 64271+\n5.73.44.84.18693 &gt; x.x.x.x.53: 64182+\n4.69.99.10.17668 &gt; x.x.x.x.53: 64442+</pre></code>\n            <p>I&#39;ve removed the destination IP address, but left in the DNS ID number (the number with the plus after it), the spoofed source IP, and port. There are three different TTLs represented (40, 41, and 42) by filtering on ip[8].</p><p>Stop reading here if you want to go figure this out for yourself.</p>\n    <div class=\"flex anchor relative\">\n      <h3 id=\"into-the-hex\">Into the hex</h3>\n      <a href=\"#into-the-hex\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n      </a>\n    </div>\n    <p>I couldn&#39;t resist Marek&#39;s challenge, so I did what I always do with anything involving packets: I went straight for the hex. Since Marek hadn&#39;t given me a pcap, I manually converted the first few to hex.</p><p>The reason hex is useful is that bytes, words, dwords, and qwords are the real stuff of computing and looking at decimal obscures data.</p><p>Taking the first three (one for each TTL), I saw this pattern:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">1.181.207.7.46337\n2.10.30.2.2562\n4.72.42.184.18436\n\nConverted to hex they are\n\n01.b5.cf.07.b501\n02.0a.1e.02.0a02\n04.48.2a.b8.4804</pre></code>\n            <p>It&#39;s immediately obvious that the &#39;random&#39; source port is the first two bytes of the random IP source address reversed: <code>01.b5.cf.07</code> has source port <code>b501</code>.</p><p>A little bit of tinkering revealed a relationship between the TTL and the first byte of the IP address.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">TTL = first byte &gt;&gt; 1 + 40</pre></code>\n            <p>This relationship was confirmed by a later packet that had a TTL of 150 and a source IP of 220.255.141.181. The shift right also explained why the same TTL was used when the first byte differed by one (see the third group above for an example: 4.x.x.x and 5.x.x.x have the same TTL).</p><p>I then spotted that the DNS ID field was also related to the IP address.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">1.181.207.7.46337 &gt; x.x.x.x.53: 65098+\n\nConverted to hex:\n\n01.b5.cf.07.b501 &gt; x.x.x.x.35: fe4a+</pre></code>\n            <p>It&#39;s probably not obvious at first glance (unless you&#39;re a hex-level hacker), but fe4a is the one&#39;s complement of 01b5. So the DNS ID field was simply the one&#39;s complement of the first two bytes of the source IP.</p><p>Finally, Marek gave me a pcap, and I had one more relationship to find. The ID value in the IPv4 header was also related to the random source IP addressâ€”in fact, it was just the first two bytes of the IP address.</p>\n    <div class=\"flex anchor relative\">\n      <h3 id=\"mystery\">Mystery</h3>\n      <a href=\"#mystery\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n      </a>\n    </div>\n    <p>One mystery remains (and there&#39;s a CloudFlare T-shirt for person with the most convincing explanation): How are the random source IPs being generated?</p><p>The answer might be boring (i.e. it might just be reading bytes from /dev/random), but given the author&#39;s love of relationships between fields, perhaps there&#39;s something else going on. We&#39;ve seen IP addresses get reused which leads us to think that there&#39;s something to discover here.</p><p>Here&#39;s a sequence of actual source IPs seen:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">218.254.187.151\n8.187.160.236\n123.73.134.186\n68.133.199.20\n205.26.91.155\n169.235.56.120\n96.160.119.221\n44.226.72.236\n205.26.91.155\n140.206.27.92\n70.62.151.0\n161.98.197.249</pre></code>\n            <p>We have no real guarantee that the attacker generated them in this order, but perhaps there&#39;s an interesting way these are being generated.</p><p>Answers in comments if you manage to figure it out!</p>",
		"id": "6c3dtzFmbR4HToIqhUW8aa",
		"localeList": {
			"name": "DDoS Packet Forensics: Take me to the hex! Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"publicly_index": true,
		"published_at": "2015-01-06T23:10:34.000+00:00",
		"slug": "ddos-packet-forensics-take-me-to-the-hex",
		"tags": [
			{
				"id": "64g1G2mvZyb6PjJsisO09T",
				"name": "DDoS",
				"slug": "ddos"
			},
			{
				"id": "6QVJOBzgKXUO9xAPEpqxvK",
				"name": "Reliability",
				"slug": "reliability"
			},
			{
				"id": "5kIxDMJCg3PXQxVINDL0Cw",
				"name": "Attacks",
				"slug": "attacks"
			},
			{
				"id": "1QMcB7xjiP8Z1YK6WX3jn8",
				"name": "IPv4",
				"slug": "ipv4"
			},
			{
				"id": "57ajJ0drP3Z69MfGUSADCq",
				"name": "TTL",
				"slug": "ttl"
			}
		],
		"title": "DDoS Packet Forensics: Take me to the hex!",
		"updated_at": "2025-10-03T18:26:06.582Z",
		"url": "https://blog.cloudflare.com/ddos-packet-forensics-take-me-to-the-hex"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.icon_aria_label": "Search",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"search.result_stat_empty": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong>",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"search.autocomplete_title": "Insert a query. Press enter to send",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}