{
	"post": {
		"id": "5d16453b41acde0011a955a3",
		"uuid": "998311e8-96c8-4cb0-acca-e7923dc9f478",
		"title": "Open Sourcing CloudFlare’s UI Framework",
		"slug": "cf-ui",
		"html": "<!--kg-card-begin: markdown--><p>Late last year, the CloudFlare UI team made a huge decision: to change JavaScript frameworks from Backbone &amp; Marionette to React &amp; Redux.</p>\n<p>We’ve been one of the single biggest Backbone+Marionette apps on the web for a while now, and the decision to move was not taken lightly. On our team we have a former core team member of the Marionette team (<a href=\"https://github.com/thejameskyle\">myself</a>), and the <a href=\"https://github.com/wyuenho\">author</a> of several popular Backbone projects: Backgrid and Backbone Paginator.</p>\n<p>In the spirit of the open web, we want to share more about what we’re doing. This starts by open sourcing the UI framework that we have spent the last few months building.</p>\n<h3 id=\"introducingcfui\">Introducing cf-ui</h3>\n<p>While moving to React, we’ve taken our existing Backbone UI framework and rebuilt it from scratch on top of React. This includes over 50 packages that include dozens of components, utilities, test helpers, and more.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/06/cf-ui-turned-ghost.png\" alt=\"cf-ui logo\" loading=\"lazy\"></p>\n<p>Examples: <a href=\"https://cloudflare.github.io/cf-ui\">https://cloudflare.github.io/cf-ui</a><br>\nGitHub: <a href=\"https://github.com/cloudflare/cf-ui\">https://github.com/cloudflare/cf-ui</a></p>\n<p>We’re not open sourcing cf-ui because we think our buttons are any better than anyone else’s buttons, but because it’s an opportunity to share some of the technical decisions that we’ve made while building out a massive React application. The hope is that this will be an awesome technical resource for many other devs.</p>\n<p>We’ve made some interesting design decisions in cf-ui that we would like to talk about more, starting with the multi-package repo structure.</p>\n<h3 id=\"improvingthedevelopmentexperiencewithlerna\">Improving the development experience with <a href=\"https://lernajs.io\">Lerna</a></h3>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/06/lerna-text-ghost.png\" alt=\"Lerna logo\" loading=\"lazy\"></p>\n<p>We have several different applications under development at CloudFlare: there’s our primary dashboard that the majority of our customers are familiar with, but also a number of internal and external applications that we build.</p>\n<p>For us, being able to share code between repositories is a must have. We could just dump all the shared code into a single repository, but our applications are developed at different speeds and we want to be able to version our shared code using <a href=\"http://semver.org\">semver</a>. So we use <a href=\"https://www.npmjs.com\">npm</a> to build tons of separate packages.</p>\n<p>However, maintaining dozens of packages across all of their repositories is a development nightmare. Making changes across packages is a difficult workflow, and it’s tough to test changes across all the packages.</p>\n<p>Using <a href=\"https://lernajs.io\">Lerna</a>, we’re able to put all of the packages into a single repository and have our ideal workflow while also versioning packages independently.</p>\n<p>The basic idea here is that our cf-ui repository looks like this:</p>\n<pre><code>packages/\n  cf-builder-card/\n  cf-builder-form/\n  ...\n  cf-util-route-handler/\n  cf-util-text/\nlerna.json\npackage.json\n</code></pre>\n<p>Then each of the directories inside <code>packages/</code> looks like this:</p>\n<pre><code>packages/cf-builder-card/\n  src/\n  test/\n  package.json\n  README.md\n</code></pre>\n<p>Each of these get built into a separate npm package and gets published whenever they have changed.</p>\n<p>The other interesting part of Lerna is that it “links” cross-dependencies within the same repo so that you can test changes made in one package across all of the packages</p>\n<p>For example, <code>cf-util-http-poll</code> depends on <code>cf-util-http</code>. If I make a change to <code>cf-util-http</code>, I want to be able to test that it didn’t break <code>cf-util-http-poll</code> and if it did I want to make sure that both packages get updated and versioned properly. Lerna allows us to do exactly that.</p>\n<p>There are many more benefits to using this multi-package style repository which is why many other projects choose to use a similar structure. Projects like Babel, React, Ember, Angular, Jest, Meteor, PouchDB, and many many more all do the same thing.</p>\n<p>Read more on the <a href=\"https://lernajs.io\">Lerna website</a>.</p>\n<h3 id=\"buildercomponents\">Builder Components</h3>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/06/feedback-form-ghost.png\" alt=\"Form Builder Component example\" loading=\"lazy\"></p>\n<p>When we built the UI framework initially, we built each component package out to expose multiple components that you compose together like so:</p>\n<pre><code class=\"language-js\">import React from 'react';\nimport {\n  Table,\n  TableHead,\n  TableHeadCell,\n  TableBody,\n  TableRow,\n  TableCell\n} from 'cf-component-table';\n\nexport default class MyTableComponent extends React.Component {\n  render() {\n    return (\n      &lt;Table&gt;\n        &lt;TableHead&gt;\n          &lt;TableRow&gt;\n            &lt;TableHeadCell&gt;Name&lt;/TableHeadCell&gt;\n            &lt;TableHeadCell&gt;Value&lt;/TableHeadCell&gt;\n          &lt;/TableRow&gt;\n        &lt;/TableHead&gt;\n        &lt;TableBody&gt;\n          {this.props.data.map(row =&gt;\n            &lt;TableRow key={row.id}&gt;\n              &lt;TableCell&gt;{row.name}&lt;/TableCell&gt;\n              &lt;TableCell&gt;{row.value}&lt;/TableCell&gt;\n            &lt;/TableRow&gt;\n          }\n        &lt;/TableBody&gt;\n      &lt;/Table&gt;\n    );\n  }\n}\n</code></pre>\n<p>This was obviously a lot of repetition, so we wanted some kind of “factory” components that would set it up for us. Something like:</p>\n<pre><code class=\"language-js\">const data = [\n  { id: 1, name: 'Foo', value: 'foo' },\n  { id: 2, name: 'Bar', value: 'bar' }\n];\n\n&lt;TableBuilder\n  rows={data.map(item =&gt; {\n    return { id: item.id, data: item }\n  }}\n  columns={[{\n    label: 'Name',\n    cell: (data) =&gt; {\n      return &lt;TableCell&gt;{data.name}&lt;/TableCell&gt;\n    }\n  }, {\n    label: 'Value',\n    cell: (data) =&gt; {\n      return &lt;TableCell&gt;{data.value}&lt;/TableCell&gt;\n    }\n  }]}/&gt;\n</code></pre>\n<p>In addition to that, one of the frustrating things with base components in Redux is hooking them into the state tree all the time. Setting up handlers for every event that dispatches actions and get reduced into state is a tiresome process.</p>\n<p>Instead we have defined that these “builder” components can be tied directly to Redux and have their own reducers and actions.</p>\n<p>All you have to do is set up the reducer before using the builder component.</p>\n<pre><code class=\"language-js\">import {combineReducers, applyMiddleware, createStore} from 'redux';\nimport thunk from 'redux-thunk';\nimport {tableReducer} from 'cf-builder-table';\n\nconst reducer = combineReducers({\n  tables: tableReducer\n});\n\nconst store = createStore(reducer, {}, applyMiddleware(thunk));\n</code></pre>\n<p>Then you can use builder components like they were any other component. They each just need a unique ID, which you can store in a <code>ComponentNames.js</code> constants file.</p>\n<pre><code class=\"language-js\">&lt;TableBuilder tableName={ComponentNames.EXAMPLE_TABLE} .../&gt;\n</code></pre>\n<p>You can also dispatch actions that do various things to the builders.</p>\n<pre><code class=\"language-js\">import {tableActions} from 'cf-builder-table';\n\n// ...\n\ndispatch(tableActions.flashRow(\n  ComponentNames.EXAMPLE_TABLE,\n  'rowId',\n  'success'\n));\n</code></pre>\n<h3 id=\"integratedtestutilities\">Integrated Test Utilities</h3>\n<p>cf-ui also includes a number of test utilites that integrate with Mocha, Sinon, and Redux in order to prevent various mistakes while writing tests.</p>\n<p>For example using sinon you could stub out a method inside a test:</p>\n<pre><code class=\"language-js\">it('should stub a method', () =&gt; {\n  sinon.stub(obj, 'methodName');\n  // ...\n});\n</code></pre>\n<p>But if you forget to restore that stub or maybe an error causes the stub to stick around through the rest of your tests you might run into some problems.</p>\n<p>Instead there is a <code>cf-test-stub</code> package that includes a <code>stubMethod()</code> util that is automatically sandboxed and reset in between tests, preventing you from ever making a mistake and making it even easier to use.</p>\n<p>There’s a handful of other useful test utils that do similar things.</p>\n<h3 id=\"wrappingapisforthesakeofit\">Wrapping APIs for the sake of it</h3>\n<p>If you’re browsing the cf-ui packages you might notice there are some packages like <code>cf-util-logger</code> that wrap external APIs like this:</p>\n<pre><code class=\"language-js\">const debug = require(‘debug’);\n\nfunction createLogger(name) {\n  const logger = debug(name);\n\n  return function(message) {\n    logger(message);\n  };\n}\n\nmodule.exports = createLogger;\n</code></pre>\n<p>This might seem unnecessary, however it forces us to expose a minimal API surface area that allows us to make changes to them confidently, even swapping out the underlying modules without having to update our application code.</p>\n<p>For example, if we decided to stop using <code>marked</code> in favor of <code>remarkable</code> or some other markdown engine we could do that in a single pull request in one codebase.</p>\n<h3 id=\"improvingtheaccessibilityofourcomponents\">Improving the accessibility of our components</h3>\n<p>Rewriting all of our components from the ground up was an excellent opportunity to evaluate how well we’ve been following accessibility best practices.</p>\n<p>As we rewrote the components, we found a number of improvements that we could make and we took the time to make sure that our components were as accessible as possible.</p>\n<p>For example, we greatly improved keyboard navigation across all of our components, even open sourcing some of the libraries we built to do it: <a href=\"https://github.com/cloudflare/react-modal2\">react-modal2</a>, <a href=\"https://github.com/cloudflare/a11y-focus-store\">a11y-focus-store</a>, <a href=\"https://github.com/cloudflare/a11y-focus-scope\">a11y-focus-scope</a>.</p>\n<hr>\n<p>In closing, we’re really really excited to be open sourcing our UI framework today. A lot of work went into this and it’s great to finally be putting it out there, so please give us a star on <a href=\"https://github.com/cloudflare/cf-ui\">GitHub</a> (we love stars).</p>\n<p>Also, if this work interests you then you should come <a href=\"https://careers.jobscore.com/careers/cloudflare/jobs/ui-engineer-cI9kn86-ir4z5yiGakhP3Q?ref=rss&amp;sid=68\">join our team</a>!</p>\n<!--kg-card-end: markdown-->",
		"comment_id": "4811",
		"feature_image": "http://blog.cloudflare.com/content/images/2016/06/cf-ui-turned-ghost-1.png",
		"featured": false,
		"visibility": "public",
		"created_at": "2016-06-08T18:47:12.000+01:00",
		"updated_at": "2018-08-27T21:06:52.000+01:00",
		"published_at": "2016-06-08T18:47:00.000+01:00",
		"custom_excerpt": "Late last year, the CloudFlare UI team made a huge decision: to change JavaScript frameworks from Backbone & Marionette to React & Redux.",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"authors": [
			{
				"id": "5d1644b141acde0011a94f6d",
				"name": "James Kyle",
				"slug": "james",
				"profile_image": "http://blog.cloudflare.com/content/images/2018/02/AAEAAQAAAAAAAAk4AAAAJDhiZmFkNDA2LThmMjktNDkwOC05MjlkLWJjZjllMjdlMzA2MQ.jpg",
				"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-30.png",
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/james/"
			}
		],
		"tags": [
			{
				"id": "5d16450341acde0011a95165",
				"name": "JavaScript",
				"slug": "javascript",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/javascript/"
			},
			{
				"id": "5d16450341acde0011a95214",
				"name": "Programming",
				"slug": "programming",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/programming/"
			},
			{
				"id": "5d16450341acde0011a951ce",
				"name": "Reliability",
				"slug": "reliability",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/reliability/"
			}
		],
		"primary_author": {
			"id": "5d1644b141acde0011a94f6d",
			"name": "James Kyle",
			"slug": "james",
			"profile_image": "http://blog.cloudflare.com/content/images/2018/02/AAEAAQAAAAAAAAk4AAAAJDhiZmFkNDA2LThmMjktNDkwOC05MjlkLWJjZjllMjdlMzA2MQ.jpg",
			"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-30.png",
			"bio": null,
			"website": null,
			"location": null,
			"facebook": null,
			"twitter": null,
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/james/"
		},
		"primary_tag": {
			"id": "5d16450341acde0011a95165",
			"name": "JavaScript",
			"slug": "javascript",
			"description": null,
			"feature_image": null,
			"visibility": "public",
			"meta_title": null,
			"meta_description": null,
			"og_image": null,
			"og_title": null,
			"og_description": null,
			"twitter_image": null,
			"twitter_title": null,
			"twitter_description": null,
			"codeinjection_head": null,
			"codeinjection_foot": null,
			"canonical_url": null,
			"accent_color": null,
			"url": "http://blog.cloudflare.com/tag/javascript/"
		},
		"url": "http://blog.cloudflare.com/cf-ui/",
		"excerpt": "Late last year, the CloudFlare UI team made a huge decision: to change JavaScript frameworks from Backbone & Marionette to React & Redux.",
		"reading_time": 6,
		"access": true,
		"comments": false,
		"og_image": null,
		"og_title": null,
		"og_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": null,
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	},
	"locale": "en-us"
}