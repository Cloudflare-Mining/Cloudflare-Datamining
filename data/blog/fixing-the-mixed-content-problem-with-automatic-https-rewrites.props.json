{
	"locale": "en-us",
	"post": {
		"id": "5d16453b41acde0011a955c5",
		"uuid": "acc3b7bb-7bf2-43da-92ef-6c9cad0db499",
		"title": "Fixing the mixed content problem with Automatic HTTPS Rewrites",
		"slug": "fixing-the-mixed-content-problem-with-automatic-https-rewrites",
		"html": "<!--kg-card-begin: markdown--><p>CloudFlare aims to put an end to the unencrypted Internet. But the web has a chicken and egg problem moving to HTTPS.</p>\n<p>Long ago it was difficult, expensive, and slow to set up an HTTPS capable web site. Then along came services like CloudFlare’s <a href=\"http://blog.cloudflare.com/introducing-universal-ssl/\">Universal SSL</a> that made switching from http:// to https:// as easy as clicking a button. With one click a site was served over HTTPS with a freshly minted, <a href=\"https://www.cloudflare.com/application-services/products/ssl/\">free SSL certificate</a>.</p>\n<p>Boom.</p>\n<p>Suddenly, the website is available over HTTPS, and, even better, the website gets faster because it can take advantage of the latest web protocol <a href=\"https://www.cloudflare.com/http2/\">HTTP/2</a>.</p>\n<p>Unfortunately, the story doesn’t end there. Many otherwise secure sites suffer from the problem of mixed content.  And mixed content means the green padlock icon will not be displayed for an https:// site because, in fact, it’s not truly secure.</p>\n<p>Here’s the problem: if an https:// website includes any content from a site (even its own) served over http:// the green padlock can’t be displayed. That’s because resources like images, JavaScript, audio, video etc. included over http:// open up a security hole into the secure web site. A backdoor to trouble.</p>\n<p>Web browsers have known this was a problem for a long, long time. Way back in 1997, Internet Explorer 3.0.2 warned users of sites with mixed content with the following dialog box.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/IC310968.gif\" alt=\"\" loading=\"lazy\"></p>\n<p>Today, Google Chrome shows a circled i on any https:// that has insecure content.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/Screen-Shot-2016-09-22-at-11.22.08.png\" alt=\"\" loading=\"lazy\"></p>\n<p>And Firefox shows a padlock with a warning symbol. To get a green padlock from either of these browsers requires every single subresource (resource loaded by a page) to be served over HTTPS.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/Screen-Shot-2016-09-22-at-11.23.45.png\" alt=\"\" loading=\"lazy\"></p>\n<p>If you had clicked Yes back in 1997, Internet Explorer would have ignored the dangers of mixed content and gone ahead and loaded subresources using plaintext HTTP. Clicking No prevented them from being loaded (often resulting in a broken but secure web page).</p>\n<h3 id=\"transitioningtofullysecurecontent\">Transitioning to fully secure content</h3>\n<p>It's tempting, but naive, to think that the solution to mixed content is easy: “Simply load everything using https:// and just fix your website”. Unfortunately, the smörgåsbord of content loaded into modern websites from first-party and third-party web sites makes it very hard to ‘simply’ make that change.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/14127169401_54ca5e9c1f_z.jpg\" alt=\"\" loading=\"lazy\"><br>\n<small><a href=\"https://creativecommons.org/licenses/by/2.0/\">CC BY 2.0</a> <a href=\"https://www.flickr.com/photos/jeepersmedia/14127169401/in/photolist-nwnrhe-nwFTKm-nwpaXy-nd8jZZ-nwnqMB-6bsjcC-nwFSD3-aQ5Zk4-c4uV99-6itRSF-6iy17Y-8iDUTL-jb2wag-MvpRU-B61f-B61b-7GcrpR-jCxYo4-bTkuiD-2rLaU-a7VsfV-eyNEd-dUEjYu-4iVNkY-a3Gcnb-nJhD2H-nHasXC-5L7FZy-2i8iQ9-qN5RF-6HHCqb-6HDxai-6HDxnK-6HHCvU-5T9v3L-6ytdUs-6HHCyG-2WZgpg-5XZ5BD-b4SFeF-hNBK9K-8JDyeY-pbysVv-5dkLUi-6iy19o-6HDxiV-4o63bZ-kiN76q-ik1o7a-qkcqbe\">image</a> by <a href=\"https://www.flickr.com/photos/jeepersmedia/\">Mike Mozart</a></small></p>\n<p>Wired <a href=\"https://www.wired.com/2016/09/now-encrypting-wired-com/\">documented</a> their transition to https:// in a series of blog posts that shows just how hard it can be to switch everything to HTTPS. They started in <a href=\"https://www.wired.com/2016/04/wired-launching-https-security-upgrade/\">April</a> and spent 5 months on the process (after having already prepped for months just to get to https:// on their main web site). In May they wrote about a <a href=\"https://www.wired.com/2016/05/wired-first-big-https-rollout-snag/\">snag</a>:</p>\n<p><em>&quot;[…] one of the biggest challenges of moving to HTTPS is preparing all of our content to be delivered over secure connections. If a page is loaded over HTTPS, all other assets (like images and Javascript files) must also be loaded over HTTPS. We are seeing a high volume of reports of these “mixed content” issues, or events in which an insecure, HTTP asset is loaded in the context of a secure, HTTPS page. To do our rollout right, we need to ensure that we have fewer mixed content issues—that we are delivering as much of WIRED.com’s content as securely possible.”</em></p>\n<p>In 2014, the New York Times identified mixed content as a <a href=\"http://open.blogs.nytimes.com/2014/11/13/embracing-https/\">major hurdle</a> to going secure:</p>\n<p><em>&quot;To successfully move to HTTPS, all requests to page assets need to be made over a secure channel. It’s a daunting challenge, and there are a lot of moving parts. We have to consider resources that are currently being loaded from insecure domains — everything from JavaScript to advertisement assets.”</em></p>\n<p>And the W3C <a href=\"https://www.w3.org/TR/upgrade-insecure-requests/\">recognized</a> this as a huge problem saying: <em>“Most notably, mixed content checking has the potential to cause real headache for administrators tasked with moving substantial amounts of legacy content onto HTTPS. In particular, going through old content and rewriting resource URLs manually is a huge undertaking.”</em> And cited the BBC’s <a href=\"http://www.bbc.co.uk/blogs/internet/entries/f7126d19-2afa-3231-9c4e-0f7198c468ab\">huge archive</a> as a difficult example.</p>\n<p>But it’s not just media sites that have a problem with mixed content. Many CMS users find it difficult or impossible to update all the links that their CMS generates as they may be buried in configuration files, source code or databases. In addition, sites that need to deal with user-generated content also face a problem with http:// URIs.</p>\n<h3 id=\"thedangersofmixedcontent\">The Dangers of Mixed Content</h3>\n<p>Mixed content comes in two flavors: active and passive. Modern web browsers approach the dangers from these different types of mixed content as follows: active mixed content (the most dangerous) is automatically and completely blocked, passive mixed content is allowed through but results in a warning.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/6714200883_2ba8167533_b.jpg\" alt=\"\" loading=\"lazy\"><br>\n<small><a href=\"https://creativecommons.org/licenses/by/2.0/\">CC BY 2.0</a> <a href=\"https://www.flickr.com/photos/99mph/6714200883/in/photolist-bej31c-szQAb-i2swr-fnz3A-avkaMz-SB8LC-4kKK2r-6UFtFq-5EhUFH-i2sBe-dHEMmA-A4cie-aC6Wtc-4ZRUkX-srjkGs-5raEpY-eosHU-Ee7Ye-6vWtxh-6Pd2Nq-5Yz5u2-nU1Pfn-nBPiU4-N6B99-7WL2J9-FEkU5X-dU1PPb-JbHZad-aBEqKL-6w5v1r-65Nths-6DbhPs-nsfgLN-67jbBc-nAxzxi-7krEou-4GxJDe-nUsvgg-9kk75E-8AAsi-jJpNkj-4a5Znf-NQtE-d5xmAL-qiBCh-8cM-qXdkTc-9aLMpU-dWVoe-4A1jyr\">image</a> by <a href=\"https://www.flickr.com/photos/99mph/\">Ben Tilley</a></small></p>\n<p>Active content is anything that can modify the DOM (the web page itself). Resources included via the <code>&lt;script&gt;</code>, <code>&lt;link&gt;</code>, <code>&lt;iframe&gt;</code> or <code>&lt;object&gt;</code> tags, CSS values that use <code>url</code> and anything requested using <code>XMLHTTPRequest</code> is capable of modifying a page, reading cookies and accessing user credentials.</p>\n<p>Passive content is anything else: images, audio, video that are written into the page but that cannot themselves access the page.</p>\n<p>Active content is a real threat because if an attacker manages to intercept the request for an http:// URI they can replace the content with their own. This is not a theoretical concern. In 2015 Github was attacked by a system dubbed the <a href=\"https://citizenlab.org/2015/04/chinas-great-cannon/\">Great Cannon</a> that intercepted requests for common JavaScript files over HTTP and replaced them with a JavaScript attack script. The Great Cannon weaponized innocent users’ machines by intercepting TCP and exploiting the inherent vulnerability in active content loaded from http:// URIs.</p>\n<p>Passive content is a different kind of threat: because requests for passive content are sent in the clear an eavesdropper can monitor the requests and extract information. For example, a well positioned eavesdropper could monitor cookies, web pages visited and potentially authentication information.</p>\n<p>The <a href=\"http://codebutler.com/firesheep/\">Firesheep</a> Firefox add-on can be used to monitor a local network (for example, in a coffee shop) for requests sent over HTTP and automatically steal cookies allowing a user to hijack someone’s identity with a single click.</p>\n<p>Today, modern browsers block active content that's loaded insecurely, but allow passive content through. Nevertheless, transitioning to all https:// is the only way to address all the security concerns of mixed content.</p>\n<h3 id=\"fixingmixedcontentautomatically\">Fixing Mixed Content Automatically</h3>\n<p>We’ve wanted to help fix the mixed content properly for a long time as our goal is that the web become completely encrypted. And, like other CloudFlare services, we wanted to make this a ‘one click’ experience.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/1078317132_0e96301aef_b--1-.jpg\" alt=\"\" loading=\"lazy\"><br>\n<small><a href=\"https://creativecommons.org/licenses/by/2.0/\">CC BY 2.0</a> <a href=\"https://www.flickr.com/photos/pinkmoose/1078317132/in/photolist-2DhE7G-pvcxy5-k8yyU-dGahX9-7cRyRV-byeo7f-cNka9m-5VqLgk-byenTE-dG4STe-dGafYU-dG4RnT-tAGvqC-tAGA6u-uxhxfW-4Wrx7L-dGahZQ-dGafW9-dG4QiZ-dGagHY-4K5jAk-dwrgVQ-dGafTE-xyEYA-dG4SYP-9LEfKd-7cRy3F-dGainJ-dGahAN-4LPBp9-bnWEe3-bNknmF-pTFtg2-dG4Ra8-6hZDxR-AobuPS-bM92up-dGafDC-yuJw-q8ZsgV-4GGuAM-4Twy1U-dGaf9s-dG4QfX-52rQZg-dpK5hj-dG4RSz-dpJU8v-4EJ5JP-5pvYKT\">image</a> by <a href=\"https://www.flickr.com/photos/pinkmoose/\">Anthony Easton</a></small></p>\n<p>We considered a number of approaches:</p>\n<p><em>Automatically insert the upgrade-insecure-requests CSP directive</em></p>\n<p>The <a href=\"https://www.w3.org/TR/upgrade-insecure-requests/\">upgrade-insecure-requests</a> directive can be added in a <a href=\"https://www.w3.org/TR/CSP/\">Content Security Policy</a> header like this:</p>\n<pre><code>Content-Security-Policy: upgrade-insecure-requests\n</code></pre>\n<p>which instructs the browser to automatically upgrade any HTTP request to HTTPS. This can be useful if the website owner knows that every subresource is available over HTTPS. The website will not have to actually change http:// URIs embedded in the website to https://, the browser will take care of that automatically.</p>\n<p>Unfortunately, there is a large downside to upgrade-insecure-requests. Since the browser blindly upgrades every URI to https:// regardless of whether the resulting URI will actually work pages can be <a href=\"https://www.w3.org/TR/upgrade-insecure-requests/#example-failed\">broken</a>.</p>\n<p><em>Modify all links to use https://</em></p>\n<p>Since not all browsers used by visitors to CloudFlare web sites support upgrade-insecure-requests we considered upgrading all http:// URIs to https:// as pages pass through our service. Since we are able to parse and modify web pages in real-time we could have created an ‘upgrade-insecure-requests’ service that did not rely on browser support.</p>\n<p>Unfortunately, that still suffers from the same problem of broken links when an http:// URI is transformed to https:// but the resource can’t actually be loaded using HTTPS</p>\n<p><em>Modify links that point to other CloudFlare sites</em></p>\n<p>Since CloudFlare gives all our 4 million customers free <a href=\"http://blog.cloudflare.com/introducing-universal-ssl/\">Universal SSL</a> and we cover a large percentage of web traffic we considered just upgrading http:// to https:// for URIs that we know (because they use our service) will work.</p>\n<p>This solves part of the problem but isn’t a good solution for the general problem of upgrading from HTTP to HTTPS</p>\n<p><em>Create a system that rewrites known HTTPS capable URIs</em></p>\n<p>Finally, we settled upon doing something smart: upgrade a URI from http:// to https:// if we know that the resource can be served using HTTPS. To figure out which links are upgradable we turned to the EFF’s excellent <a href=\"https://www.eff.org/https-Everywhere\">HTTPS Everywhere</a> extension and Google Chrome <a href=\"https://github.com/chromium/hstspreload.appspot.com\">HSTS preload</a> list to augment our knowledge of CloudFlare sites that have SSL enabled.</p>\n<p>We are very grateful that the EFF graciously accepted to help us with this project.</p>\n<p>The HTTPS Everywhere ruleset goes far beyond just switching http:// to https://: it contains rules (and exclusions) that allow it (and us) to target very specific URIs. For example, here’s an actual HTTP Everywhere rule for gstatic.com:</p>\n<pre><code>&lt;rule from=&quot;^http://(csi|encrypted-tbn\\d|fonts|g0|[\\w-]+\\.metric|ssl|t\\d)\\.\ngstatic\\.com/&quot; to=&quot;https://$1.gstatic.com/&quot;/&gt;\n</code></pre>\n<p>It uses a regular expression to identify specific subdomains of gstatic.com that can safely be upgraded to use HTTPS. The complete set of rules can be browsed <a href=\"https://www.eff.org/https-everywhere/atlas\">here</a>.</p>\n<p>Because we need to upgrade a huge number of URIs embedded in web pages (we estimate around 5 million per second) we benchmarked existing HTML parsers (including our own) and decided to write a new one for this type of rewriting task. We’ll write more about its design, testing and performance in a future post.</p>\n<h3 id=\"automatichttpsrewrites\">Automatic HTTPS Rewrites</h3>\n<p>Automatic HTTPS Rewrites are now available in the customer dashboard for all CloudFlare customers. Today, this feature is disabled by default and can be enabled in ‘one click’:</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/09/Screen-Shot-2016-09-22-at-11.06.05.png\" alt=\"\" loading=\"lazy\"></p>\n<p>We will be monitoring the performance and effectiveness of this feature and enable it by default for Free and Pro customers later in the year. We also plan to use the Content Security Policy reporting features to give customers an automatic view of which URIs remain to be upgraded so that their transition to all https:// is made as simple as possible: sometimes just finding which URIs need to be changed can be very hard as Wired <a href=\"https://www.wired.com/2016/05/wired-first-big-https-rollout-snag/\">found out</a>.</p>\n<p>Would love to hear how this feature works out for you.</p>\n<!--kg-card-end: markdown-->",
		"comment_id": "4853",
		"feature_image": "http://blog.cloudflare.com/content/images/2018/03/6714200883_2ba8167533_b.jpg",
		"featured": false,
		"visibility": "public",
		"created_at": "2016-09-22T14:38:18.000+01:00",
		"updated_at": "2023-09-19T16:36:16.000+01:00",
		"published_at": "2016-09-22T15:34:37.000+01:00",
		"custom_excerpt": "Long ago it was difficult, expensive, and slow to set up an HTTPS capable web site. Then along came services like CloudFlare’s Universal SSL that made switching from http:// to https:// as easy as clicking a button. ",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"authors": [
			{
				"id": "5d1644b141acde0011a94f2c",
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"profile_image": "http://blog.cloudflare.com/content/images/2017/03/url-2.jpg",
				"cover_image": "http://blog.cloudflare.com/content/images/2023/05/Twitter-Header-@cloudflare-US.png",
				"bio": null,
				"website": null,
				"location": "Lisbon, Portugal",
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/john-graham-cumming/"
			}
		],
		"tags": [
			{
				"id": "5d16450341acde0011a95185",
				"name": "HTTPS",
				"slug": "https",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/https/"
			},
			{
				"id": "5d16450341acde0011a951f9",
				"name": "Automatic HTTPS",
				"slug": "automatic-https",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/automatic-https/"
			},
			{
				"id": "5d16450341acde0011a951da",
				"name": "SSL",
				"slug": "ssl",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/ssl/"
			},
			{
				"id": "5d16450341acde0011a951b2",
				"name": "Mixed Content Errors",
				"slug": "mixed-content-errors",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/mixed-content-errors/"
			},
			{
				"id": "5d16450341acde0011a951ee",
				"name": "Product News",
				"slug": "product-news",
				"description": "Product News (EN)",
				"feature_image": "http://blog.cloudflare.com/content/images/2020/10/Product-News-1.png",
				"visibility": "public",
				"meta_title": "Cloudflare Blog: Product News",
				"meta_description": "Collection of Cloudflare blog posts tagged 'Product News'.",
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/product-news/"
			},
			{
				"id": "5d16450341acde0011a95265",
				"name": "Security",
				"slug": "security",
				"description": null,
				"feature_image": "http://blog.cloudflare.com/content/images/2020/10/Security.png",
				"visibility": "public",
				"meta_title": "Cloudflare Blog: Security",
				"meta_description": "Collection of Cloudflare blog posts tagged 'Security'.",
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/security/"
			},
			{
				"id": "5d16450341acde0011a95275",
				"name": "Crypto Week",
				"slug": "crypto-week",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/crypto-week/"
			}
		],
		"primary_author": {
			"id": "5d1644b141acde0011a94f2c",
			"name": "John Graham-Cumming",
			"slug": "john-graham-cumming",
			"profile_image": "http://blog.cloudflare.com/content/images/2017/03/url-2.jpg",
			"cover_image": "http://blog.cloudflare.com/content/images/2023/05/Twitter-Header-@cloudflare-US.png",
			"bio": null,
			"website": null,
			"location": "Lisbon, Portugal",
			"facebook": null,
			"twitter": null,
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/john-graham-cumming/"
		},
		"primary_tag": {
			"id": "5d16450341acde0011a95185",
			"name": "HTTPS",
			"slug": "https",
			"description": null,
			"feature_image": null,
			"visibility": "public",
			"meta_title": null,
			"meta_description": null,
			"og_image": null,
			"og_title": null,
			"og_description": null,
			"twitter_image": null,
			"twitter_title": null,
			"twitter_description": null,
			"codeinjection_head": null,
			"codeinjection_foot": null,
			"canonical_url": null,
			"accent_color": null,
			"url": "http://blog.cloudflare.com/tag/https/"
		},
		"url": "http://blog.cloudflare.com/fixing-the-mixed-content-problem-with-automatic-https-rewrites/",
		"excerpt": "Long ago it was difficult, expensive, and slow to set up an HTTPS capable web site. Then along came services like CloudFlare’s Universal SSL that made switching from http:// to https:// as easy as clicking a button. ",
		"reading_time": 8,
		"access": true,
		"comments": false,
		"og_image": null,
		"og_title": null,
		"og_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": null,
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	}
}