{
	"post": {
		"id": "5d16453b41acde0011a955ae",
		"uuid": "9878f415-5283-4b3e-883b-492e8180b09b",
		"title": "HTTP/2 Server Push with multiple assets per Link header",
		"slug": "http-2-server-push-with-multiple-assets-per-link-header",
		"html": "<!--kg-card-begin: markdown--><p>In April we <a href=\"http://blog.cloudflare.com/announcing-support-for-http-2-server-push-2/\">announced</a> that we had added experimental support for <a href=\"https://www.cloudflare.com/http2/server-push/\">HTTP/2 Server Push</a> to all CloudFlare web sites. We did this so that our customers could iterate on this new functionality.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/06/1673801831_a93ecfc3c4_z.jpg\" alt=\"\" loading=\"lazy\"><br>\n<small><a href=\"https://creativecommons.org/licenses/by/2.0/\">CC BY 2.0</a> <a href=\"https://www.flickr.com/photos/mryipyop/1673801831/in/photolist-3xUEYg-nMS6rx-jvSsLx-9oBV3s-8KH2YK-o54g8R-8h4bmw-eapSfS-cj4No3-nMSXLP-nMRZQJ-iNpH9k-hcr3m3-nMS6ui-5RDVrK-fAaYES-nMXwba-cNFT3N-iZDTWg-k5VzKt-jeJE8T-7bM32E-d3rznG-89jZ9e-aVLkBT-4y2kdD-qtKzjY-62Yv2h-5WcKeC-87jJdA-5Es3vn-bQ8W5a-7DhbKd-hE5oza-6NutL7-5WLwFt-hcnrny-5WAoU1-5mSoVV-8RSQ7A-gXiVcG-5Wp6pS-8GFkMr-hcoeN9-bC1zH5-ePG8BQ-hcokfv-hcpgme-hcqQ59-qUkfTa\">image</a> by <a href=\"Mike\">https://www.flickr.com/photos/mryipyop/</a></small></p>\n<p>Our implementation of Server Push made use of the <a href=\"http://blog.cloudflare.com/announcing-support-for-http-2-server-push-2/#fnref:1\">HTTP <code>Link</code></a> header as detailed in W3C <a href=\"https://www.w3.org/TR/preload/\">Preload</a> Working Draft.</p>\n<p>We also showed how to make Server Push work from within <a href=\"http://blog.cloudflare.com/using-http-2-server-push-with-php/\">PHP code</a> and many people started testing and using this feature.</p>\n<p>However, there was a serious restriction in our initial version: it was not possible to specify more than one asset per <code>Link</code> header for Server Push and many CMS and web development platforms would not allow multiple <code>Link</code> headers.</p>\n<p>We have now addressed that problem and it is possible to request that multiple assets be pushed in a single <code>Link</code> header. This change is live and was used to push assets in this blog post to your browser if your browser supports HTTP/2.</p>\n<p>When CloudFlare reads a <code>Link</code> header sent by an origin web server it will remove assets that it pushes from the <code>Link</code> header passed on to the web browser. That made it a little difficult to debug problems with <code>Link</code> and Server Push so we have added a header called <code>Cf-H2-Pushed</code> which contains the assets that were pushed.</p>\n<p>For example, browsing to this <a href=\"http://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/\">recent</a> blog post results in the origin web server sending the following headers:</p>\n<pre><code>Cache-Control: public, max-age=0\nContent-Encoding: gzip\nContent-Length: 33640\nContent-Type: text/html; charset=utf-8\nDate: Wed, 29 Jun 2016 16:09:37 GMT\nExpires: Wed, 29 Jun 2016 16:10:07 GMT\nLink: &lt;/assets/css/screen.css?v=5fc240c512&gt;; rel=preload; as=style,&lt;//cdn.bizible.com/scripts/bizible.js&gt;; rel=preload; as=script,&lt;/content/images/2016/06/Timeouts-001.png&gt;; rel=preload; as=image,&lt;/content/images/2016/06/Timeouts-002.png&gt;; rel=preload; as=image,&lt;//platform.linkedin.com/in.js&gt;; rel=preload; as=script,&lt;https://code.jquery.com/jquery-1.11.3.min.js&gt;; rel=preload; as=script,&lt;/assets/js/jquery.fitvids.js?v=5fc240c512&gt;; rel=preload; as=script\nVary: Accept-Encoding\nX-Ghost-Cache-Status:From Cache\nX-Powered-By: Express \n</code></pre>\n<p>CloudFlare decides to HTTP/2 Server Push the assets <code>/assets/css/screen.css?v=5fc240c512</code>, <code>/content/images/2016/06/Timeouts-001.png</code>, <code>/content/images/2016/06/Timeouts-002.png</code> and <code>/assets/js/jquery.fitvids.js?v=5fc240c512</code>. As the response passes through CloudFlare those assets are removed from the <code>Link</code> header, pushed and added to the <code>Cf-H2-Pushed</code> header:</p>\n<pre><code>cache-control:public, max-age=30\ncf-cache-status:EXPIRED\ncf-h2-pushed:&lt;/assets/css/screen.css?v=5fc240c512&gt;,&lt;/content/images/2016/06/Timeouts-001.png&gt;,&lt;/content/images/2016/06/Timeouts-002.png&gt;,&lt;/assets/js/jquery.fitvids.js?v=5fc240c512&gt;\ncontent-encoding:gzip\ncontent-type:text/html; charset=utf-8\ndate:Wed, 29 Jun 2016 16:09:37 GMT\nexpires:Wed, 29 Jun 2016 16:10:07 GMT\nlink:&lt;//cdn.bizible.com/scripts/bizible.js&gt;; rel=preload; as=script,&lt;//platform.linkedin.com/in.js&gt;; rel=preload; as=script,&lt;https://code.jquery.com/jquery-1.11.3.min.js&gt;; rel=preload; as=script\nserver:cloudflare-nginx\nstatus:200 OK\nvary:Accept-Encoding\nx-ghost-cache-status:From Cache\nx-powered-by:Express\n</code></pre>\n<p>In Google Chrome Canary's Developer view the pushed assets can be clearly seen.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/06/Screen-Shot-2016-06-30-at-11-15-02.png\" alt=\"\" loading=\"lazy\"></p>\n<h3 id=\"conclusion\">Conclusion</h3>\n<p>Please let us know how you use Server Push. We're particularly interested in experiences with pushing different types of resources (images vs. styles vs. scripts) and working out the optimal number of items to push (we currently allow up to 50 resources per page).</p>\n<!--kg-card-end: markdown-->",
		"comment_id": "4823",
		"feature_image": "http://blog.cloudflare.com/content/images/2018/08/1673801831_a93ecfc3c4_z.jpg",
		"featured": false,
		"visibility": "public",
		"created_at": "2016-06-30T10:53:01.000+01:00",
		"updated_at": "2018-08-28T21:06:56.000+01:00",
		"published_at": "2016-06-30T13:09:46.000+01:00",
		"custom_excerpt": "In April we announced that we had added experimental support for HTTP/2 Server Push to all CloudFlare web sites. We did this so that our customers could iterate on this new functionality.\n\n",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"tags": [
			{
				"id": "5d16450341acde0011a951c5",
				"name": "HTTP2",
				"slug": "http2",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/http2/"
			},
			{
				"id": "5d16450341acde0011a95197",
				"name": "php",
				"slug": "php",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/php/"
			},
			{
				"id": "5d16450341acde0011a951ce",
				"name": "Reliability",
				"slug": "reliability",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/reliability/"
			},
			{
				"id": "5d16450341acde0011a95214",
				"name": "Programming",
				"slug": "programming",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/programming/"
			},
			{
				"id": "5d16450341acde0011a95267",
				"name": "Server Push",
				"slug": "server-push",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/server-push/"
			}
		],
		"authors": [
			{
				"id": "5d1644b141acde0011a94f2c",
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"profile_image": "http://blog.cloudflare.com/content/images/2017/03/url-2.jpg",
				"cover_image": "http://blog.cloudflare.com/content/images/2023/05/Twitter-Header-@cloudflare-US.png",
				"bio": null,
				"website": null,
				"location": "Lisbon, Portugal",
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/john-graham-cumming/"
			}
		],
		"primary_author": {
			"id": "5d1644b141acde0011a94f2c",
			"name": "John Graham-Cumming",
			"slug": "john-graham-cumming",
			"profile_image": "http://blog.cloudflare.com/content/images/2017/03/url-2.jpg",
			"cover_image": "http://blog.cloudflare.com/content/images/2023/05/Twitter-Header-@cloudflare-US.png",
			"bio": null,
			"website": null,
			"location": "Lisbon, Portugal",
			"facebook": null,
			"twitter": null,
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/john-graham-cumming/"
		},
		"primary_tag": {
			"id": "5d16450341acde0011a951c5",
			"name": "HTTP2",
			"slug": "http2",
			"description": null,
			"feature_image": null,
			"visibility": "public",
			"meta_title": null,
			"meta_description": null,
			"og_image": null,
			"og_title": null,
			"og_description": null,
			"twitter_image": null,
			"twitter_title": null,
			"twitter_description": null,
			"codeinjection_head": null,
			"codeinjection_foot": null,
			"canonical_url": null,
			"accent_color": null,
			"url": "http://blog.cloudflare.com/tag/http2/"
		},
		"url": "http://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/",
		"excerpt": "In April we announced that we had added experimental support for HTTP/2 Server Push to all CloudFlare web sites. We did this so that our customers could iterate on this new functionality.\n\n",
		"reading_time": 3,
		"access": true,
		"comments": false,
		"og_image": null,
		"og_title": null,
		"og_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": null,
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	},
	"locale": "en-us"
}