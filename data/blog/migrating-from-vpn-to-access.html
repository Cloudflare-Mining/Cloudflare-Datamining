<div class="mb2 gray5">3 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/HbcD2nz4oPww319S2cbBv/0971f31c93254919a898bd833da72c33/access-plus-Spectrum_2x-1.png" alt="" class="kg-image" width="2312" height="1190" loading="lazy">

	</figure>
	<p>With so many people at Cloudflare now working remotely, it's worth stepping back and looking at the systems we use to get work done and how we protect them. <a href="https://blog.cloudflare.com/dogfooding-from-home">Over the years we've migrated</a> from a traditional "put it behind the VPN!" company to a modern zero-trust architecture. Cloudflare hasn’t completed its journey yet, but we're pretty darn close. Our general strategy: protect every internal app we can with <a href="https://teams.cloudflare.com/access/index.html">Access</a> (our zero-trust access proxy), and simultaneously beef up our VPN’s security with <a href="https://www.cloudflare.com/products/cloudflare-spectrum">Spectrum</a> (a product allowing the proxying of arbitrary TCP and UDP traffic, protecting it from DDoS).</p>
	<p>Before Access, we had many services behind VPN (Cisco ASA running AnyConnect) to enforce strict authentication and authorization. But VPN always felt clunky: it's difficult to set up, maintain (securely), and scale on the server side. Each new employee we onboarded needed to learn how to configure their client. But migration takes time and involves many different teams. While we migrated services one by one, we focused on the high priority services first and worked our way down. Until the last service is moved to Access, we still maintain our VPN, keeping it protected with Spectrum.</p>
	<p>Some of our services didn't run over HTTP or other Access-supported protocols, and still required the use of the VPN: source control (git+ssh) was a particular sore spot. If any of our developers needed to commit code they'd have to fire up the VPN to do so. To help in our new-found goal to destroy the <a href="https://blog.cloudflare.com/releasing-the-cloudflare-access-feature-that-let-us-smash-a-vpn-on-stage">pinata</a>, we introduced support for <a href="https://www.cloudflare.com/learning/access-management/what-is-ssh">SSH</a> over Access, which allowed us to replace the VPN as a protection layer for our source control systems.</p>
	<p>Over the years, we've been whittling away at our services, one-by-one. We're nearly there, with only a few niche tools remaining behind the VPN and not behind Access. As of this year, we are no longer requiring new employees to set up VPN as part of their company onboarding! We can see this in our Access logs, with more users logging into more apps every month:</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/5V12QwR05YIkZ1PHUXvnw6/454b1eac7b64577a3f8ba4ef98735e7b/1-3.png" alt="Logins for apps behind Access steadily going up" class="kg-image" width="1600" height="985" loading="lazy">

	</figure>
	<p>During this transition period from VPN to Access, we've had to keep our VPN service up and running. As VPN is a key tool for people doing their work while remote, it's extremely important that this service is highly available and performant.</p>
	<p>Enter Spectrum: our DDoS protection and performance product for any TCP and UDP-based protocol. We put Spectrum in front of our VPN very early on and saw immediate improvement in our security posture and availability, all without any changes in end-user experience.</p>
	<p>With Spectrum sitting in front of our VPN, we now use the entire Cloudflare edge network to protect our VPN endpoints against DDoS and improve performance for VPN end-users.</p>
	<p>Setup was a breeze, with only minimal configuration needed:</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/3ToKNn4OwfUURzIitlS0VV/ace6f13975147e94aff215482b9642ed/2-3.png" alt="" class="kg-image" width="1436" height="1594" loading="lazy">

	</figure>
	<p>Cisco AnyConnect uses HTTPS (TCP) to authenticate, after which the actual data is tunneled using a DTLS encrypted UDP protocol.</p>
	<p>Although configuration and setup was a breeze, actually getting it to work was definitely not. Our early users quickly noted that although authenticating worked just fine, they couldn’t actually see any data flowing through the VPN. We quickly realized our arch nemesis, the MTU (maximum transmission unit) was to <a href="https://blog.cloudflare.com/path-mtu-discovery-in-practice">blame</a>. As some of our readers might remember, we have historically always set a very small MTU size for IPv6. We did this because there might be IPv6 to IPv4 tunnels in between eyeballs and our edge. By setting it very low we prevented PTB (packet too big) packets from ever getting sent back to us, which causes problems due to our ECMP routing inside our data centers. But with a VPN, you always increase the packet size due to the VPN header. This means that the 1280 MTU that we had set would never be enough to run a UDP-based VPN. We ultimately settled on an <a href="https://blog.cloudflare.com/increasing-ipv6-mtu">MTU of 1420</a>, which we still run today and allows us to protect our VPN entirely using Spectrum.</p>
	<p>Over the past few years this has served us well, knowing that our VPN infrastructure is safe and people will be able to continue to work remotely no matter what happens. All in all this has been a very interesting journey, whittling down one service at a time, getting closer and closer to the day we can officially retire our VPN. To us, Access represents the future, with Spectrum + VPN to tide us over and protect our services until they’ve migrated over. In the meantime, as of the start of 2020, new employees no longer get a VPN account by default!</p>
</div>