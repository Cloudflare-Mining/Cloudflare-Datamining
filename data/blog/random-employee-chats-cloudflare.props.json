{
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Sven Sauleau",
				"slug": "sven",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/4AvybzTkWLlF4cdTgLrE3q/2d93a9df65eec9eb8ab5441e5b591908/sven.jpg",
				"location": null,
				"website": null,
				"twitter": "@svensauleau",
				"facebook": null
			},
			{
				"name": "David Wragg",
				"slug": "david-wragg",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/3HXFIyxRTF4ruiqfb2rEHF/4ae404054de41344b70a4fb3e119f6c6/david-wragg.jpg",
				"location": null,
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "We developed the Random Employee Chats application internally, with the goal of recreating the pre-pandemic informal interactions. Here's how we moved from a shared spreadsheet to Cloudflare Workers to automate the entire process.",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/7lrXWL4f6IEY8gQ650cXWT/33a48eeb1bc0a43716bb5e05dad5791a/random-employee-chats-cloudflare.png",
		"featured": false,
		"html": "<p>Due to the COVID-19 pandemic, most Cloudflare offices closed in March 2020, and employees began working from home. Having online meetings presented its own challenges, but preserving the benefits of casual encounters in physical offices was something we struggled with. Those informal interactions, like teams talking next to the coffee machine, help form the social glue that holds companies together.</p><p>In an attempt to recreate that experience, David Wragg, an engineer at Cloudflare, introduced “Random Engineer Chats” (We’re calling them “Random Employee Chats” here since this can be applied to any team). The idea is that participants are randomly paired, and the pairs then schedule a 30-minute video call. There’s no fixed agenda for these conversations, but the participants might learn what is going on in other teams, gain new perspectives on their own work by discussing it, or meet new people.</p><p>The first iteration of Random Employee Chats used a shared spreadsheet to coordinate the process. People would sign up by adding themselves to the spreadsheet, and once a week, David would randomly form pairs from the list and send out emails with the results. Then, each pair would schedule a call at their convenience. This process was the minimum viable implementation of the idea, but it meant that the process relied on a single person.</p><h3>Moving to Cloudflare Workers</h3><p>We wanted to automate these repetitive manual tasks, and naturally, we wanted to use <a href=\"https://workers.cloudflare.com/\">Cloudflare Workers</a> to do it. This is a great example of a complete application that runs entirely in Cloudflare Workers on the edge with no backend or origin server.</p><p>The technical requirements included:</p><ul><li><p>A user interface so people can sign up</p></li><li><p>Storage to keep track of the participants</p></li><li><p>A program that automatically pairs participants and notifies each pair</p></li><li><p>A program that reminds people to register for the next sessions</p></li></ul><p>Workers met all of these requirements, and the resulting application runs in Cloudflare&#39;s edge network without any need to run code or store data on other platforms. The Workers script supplies the UI that returns static HTML and JavaScript assets, and for storage, Workers KV keeps track of people who signed in.</p><p>We also recently announced <a href=\"https://developers.cloudflare.com/workers/platform/cron-triggers\">Workers Cron Triggers</a> which allow us to run a Cloudflare Workers script on a defined schedule. The Workers Cron Triggers are perfect for pairing people up before the sessions and reminding users to register for the next session.</p><h3>The User Interface</h3>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/26ih1wWQgNslI8kNjBYq1d/556e8e4c4caab253173431054f5129aa/Random-Engineer-Chat-Dashboard-1.png\" alt=\"The User Interface\" class=\"kg-image\" width=\"400\" height=\"599\" loading=\"lazy\"/>\n            \n            </figure><p>The interface is very simple. It shows the list of participants and allows users to register for the next session.</p><p>When a user clicks on the register button, it calls an API that adds a key in Workers KV:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">key: register:ID\nvalue: {&quot;name&quot;:&quot;Sven Sauleau&quot;,&quot;picture&quot;:&quot;picture.jpg&quot;,&quot;email&quot;:&quot;example@cloudflare.com&quot;}</pre></code>\n            <p>User information is stored in Workers KV and displayed in the interface to create the list of participants. The user information gets deleted during pairing so the list is ready for the next round of chats. We require weekly sign-ups from participants who want to participate in the chats to confirm their availability.</p><p>The code for the interface can be found <a href=\"https://github.com/cloudflare/random-employee-chat/tree/master/src/workers/randengchat/public\">here</a> and the API is <a href=\"https://github.com/cloudflare/random-employee-chat/blob/master/src/workers/randengchat/server/index.js\">here</a>.</p><h3>Forming the pairs</h3><p>A Random Employee Chat is a one-on-one conversation, so at a set time, the application puts participants into pairs. Each Monday morning at 0800 UTC, a Workers cron job runs the pairing script which is deployed using <a href=\"https://developers.cloudflare.com/workers/cli-wrangler\">Wrangler</a>.</p><p>Wrangler supports configuring the schedule for a job using the familiar cron notation. For instance, our wrangler.toml has:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">name = &quot;randengchat-cron-pair&quot;\ntype = &quot;webpack&quot;\naccount_id = &quot;...&quot;\nwebpack_config = &quot;webpack.config.js&quot;\n…\n\nkv_namespaces = [...]\n\n[triggers]\ncrons = [&quot;0 8 * * 2&quot;]</pre></code>\n            <p>The pairing script is the most intricate part of the application, so let’s run through its code. First, we list the users that are currently registered. This is done using the <a href=\"https://developers.cloudflare.com/workers/runtime-apis/kv#listing-by-prefix\">list</a> function in Workers KV extracting keys with the prefix <code>register:</code>.</p>\n            <pre class=\"language-js\"><code class=\"language-js\">const list = await KV_NAMESPACE.list({ prefix: &quot;register:&quot; });</pre></code>\n            <p>If we don’t have an even number of participants, we remove one person from the list (David!).</p><p>Then, we create all possible pairs and attach a weight to them.</p>\n            <pre class=\"language-js\"><code class=\"language-js\">async function createWeightedPairs() {\n  const pairs = [];\n  for (let i = 0; i &lt; keys.length - 1; i++) {\n    for (let j = i + 1; j &lt; keys.length; j++) {\n      const weight = (await countTimesPaired(...)) * -1;\n      pairs.push([i, j, weight]);\n    }\n  }\n  return pairs;\n}</pre></code>\n            <p>For example, suppose four people have registered (Tom, Edie, Ivie and Ada), that’s 6 possible pairs (<a href=\"https://www.wolframalpha.com/input/?i=4+choose+2\">4 choose 2</a>). We might end up with the following pairs and their associated weights:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">(Tom, Edie, 1)\n(Tom, Ivie, 0)\n(Tom, Ada, 1)\n(Edie, Ivie, 2)\n(Edie, Ada, 0)\n(Ivie, Ada, 2)</pre></code>\n            <p>The weight is calculated using the number of times a pair matched in the past to avoid scheduling chats between people that already met. More sophisticated factors could be taken into account, such as the same office or timezone, when they last met, and etc.</p><p>We keep track of how many times the pair matched using a count kept in KV:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">async function countTimesPaired(key) {\n  const v = await DB.get(key, &quot;json&quot;);\n  if (v !== null &amp;&amp; v.count) {\n    return v.count;\n  }\n  return 0;\n}</pre></code>\n            <p>The people form a complete graph with people as nodes and the edges weighted by the number of times the two people connected by the edge have met.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/anoEru6iUYXNlVFxpCk4w/3f50df75752add270f226f387a11b8bb/image5-20.png\" alt=\"The people form a complete graph with people as nodes and the edges weighted by the number of times the two people connected by the edge have met.\" class=\"kg-image\" width=\"570\" height=\"468\" loading=\"lazy\"/>\n            \n            </figure><p>Next, we run a weighted matching algorithm, in our case the <a href=\"https://en.wikipedia.org/wiki/Blossom_algorithm\">Blossom algorithm</a>, which will find a maximum matching on the graph (a set of edges that maximize the number of pairs of people connected with each person appearing exactly once). As we use the weighted form of the Blossom algorithm we also minimize the path weights. This has the effect of finding the optimal set of pairs minimizing the number of times people have met previously.</p><p>In the case above the algorithm suggests the optimal pairs are  (Tom, Ivie) and (Edie, Ada). In this case, those pairs have never met before.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/5Fi6gV8b7uZHZMVR7jouFF/fa27bedfe0d13dc2f6e38b56d65b9f79/image2-18.png\" alt=\"In this case, those pairs have never met before.\" class=\"kg-image\" width=\"570\" height=\"468\" loading=\"lazy\"/>\n            \n            </figure><p>The pairs are recorded in Workers KV with their updated matching count to refine the weights at future sessions:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">key: paired:ID\nvalue: {&quot;emails&quot;:[&quot;left@cloudflare.com&quot;,&quot;right@cloudflare.com&quot;, &quot;count&quot;: 1]}</pre></code>\n            <p>A notification is sent to each pair of users to notify them that they matched.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/7xVSUWDwEFKqY2KS9Mupwj/713a474b5c75e4c14a8882ba0e8768d3/image4-17.png\" alt=\"\" class=\"kg-image\" width=\"805\" height=\"147\" loading=\"lazy\"/>\n            \n            </figure><p>Once the pairing is done, all <code>register:</code> keys are deleted from KV.</p><p>All the pairing logic is <a href=\"https://github.com/cloudflare/random-employee-chat/blob/master/src/workers/cron-pair/index.js\">here</a>.</p><h3>Reminders</h3><p>The application sends users a reminder to sign up every week. For the reminder, we use another Workers cron job that runs every Thursday at 1300 UTC. The schedule in Wrangler is</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">[triggers]\ncrons = [&quot;0 13 * * 5&quot;]</pre></code>\n            <p>This script is much simpler than the pairing script. It simply sends a message to a room in our company messaging platform that notifies all members of the channel.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/7ACIIWbP4COwxXbImfqiQE/dd48fd462a24405ccd7f465f1528c53a/image3-19.png\" alt=\"\" class=\"kg-image\" width=\"655\" height=\"192\" loading=\"lazy\"/>\n            \n            </figure><p>All the reminder code is <a href=\"https://github.com/cloudflare/random-employee-chat/blob/master/src/workers/cron-reminder/index.js\">here</a>.</p><p>We hope you find this code useful and that it inspires you to use Workers, Workers KV, Workers Unbound and Workers Cron Triggers to write large, real applications that run entirely without a backend server.</p>",
		"id": "3MzecqWNHhc0wbjnxE2kiX",
		"localeList": {
			"name": "Random Employee Chats at Cloudflare Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "We developed the Random Employee Chats application internally, with the goal of recreating the pre-pandemic informal interactions. Here's how we moved from a shared spreadsheet to Cloudflare Workers to automate the entire process.",
		"metadata": {
			"title": "Random Employee Chats at Cloudflare",
			"description": "We developed the Random Employee Chats application internally, with the goal of recreating the pre-pandemic informal interactions. Here's how we moved from a shared spreadsheet to Cloudflare Workers to automate the entire process.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/4SEah53GZPGisyGpdcYcNa/d7d38adf411509735eb254d46a0deb39/random-employee-chats-cloudflare-CuSOhA.png"
		},
		"primary_author": {},
		"published_at": "2021-03-20T12:00:00.000+00:00",
		"reading_time": 5,
		"slug": "random-employee-chats-cloudflare",
		"tags": [
			{
				"id": "6hbkItfupogJP3aRDAq6v8",
				"name": "Cloudflare Workers",
				"slug": "workers"
			},
			{
				"id": "q88b6J14cYlPx98w6u1If",
				"name": "Cloudflare Workers KV",
				"slug": "cloudflare-workers-kv"
			},
			{
				"id": "3CHhhmZIu8jnzcZ81VLRUQ",
				"name": "Wrangler",
				"slug": "wrangler"
			}
		],
		"title": "Random Employee Chats at Cloudflare",
		"updated_at": "2024-08-27T01:52:42.671Z",
		"url": "https://blog.cloudflare.com/random-employee-chats-cloudflare"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}