<div class="mb2 gray5">1 min read</div>
<div class="mt4">This post is also available in <a href="https://blog.cloudflare.com/zh-cn/cve-2021-44228-log4j-rce-0-day-mitigation">简体中文</a>, <a href="https://blog.cloudflare.com/ja-jp/cve-2021-44228-log4j-rce-0-day-mitigation">日本語</a>, <a href="https://blog.cloudflare.com/ko-kr/cve-2021-44228-log4j-rce-0-day-mitigation">한국어</a> and <a href="https://blog.cloudflare.com/zh-tw/cve-2021-44228-log4j-rce-0-day-mitigation">繁體中文</a>.</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/695RT7CGNxVSry4CPxgayi/20b4bb0e31c57107e90eec4ad2173bfa/cve-2021-44228-log4j-rce-0-day-mitigation.png" alt="">
<div class="post-content lh-copy gray1">
	<p></p>
	<p><i>Update: all three WAF rules have now been configured with a default action of </i><code><i>BLOCK</i></code><i>.</i></p>
	<p>A zero-day exploit affecting the popular <a href="https://logging.apache.org/log4j/2.x/index.html">Apache Log4j utility</a> (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228">CVE-2021-44228</a>) was made public on December 9, 2021, that results in <a href="https://www.cloudflare.com/learning/security/what-is-remote-code-execution">remote code execution (RCE)</a>.</p>
	<p>This vulnerability is actively being exploited and anyone using Log4j should update to version 2.15.0 as soon as possible. The latest version can already be found on the <a href="https://logging.apache.org/log4j/2.x/download.html">Log4j download page</a>.</p>
	<p>If updating to the latest version is not possible the vulnerability can be mitigated by removing the JndiLookup class from the class path. Additionally, the issue can be mitigated on Log4j versions &gt;=2.10 by setting the system property <code>log4j2.formatMsgNoLookups</code> or the <code>LOG4J_FORMAT_MSG_NO_LOOKUPS</code> environment variable to <code>true</code>.</p>
	<p>Customers using the Cloudflare WAF can also leverage three newly deployed rules to help mitigate any exploit attempts:</p>
	<table>
		<tbody>
			<tr>
				<td>
					<p><b>Rule ID</b></p>
				</td>
				<td>
					<p><b>Description</b></p>
				</td>
				<td>
					<p><b>Default Action</b></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100514 </code>(legacy WAF)
						<code>6b1cc72dff9746469d4695a474430f12 </code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4j Headers</p>
				</td>
				<td>
					<p><code>BLOCK</code></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100515 </code>(legacy WAF)
						<code>0c054d4e4dd5455c9ff8f01efe5abb10 </code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4j Body</p>
				</td>
				<td>
					<p><code>BLOCK</code></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100516 </code>(legacy WAF)
						<code>5f6744fa026a4638bda5b3d7d5e015dd </code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4j URL</p>
				</td>
				<td>
					<p><code>BLOCK</code></p>
				</td>
			</tr>
		</tbody>
	</table>
	<p>The mitigation has been split across three rules inspecting HTTP headers, body and URL respectively.</p>
	<p>We are continuing to monitor the situation and will update any WAF managed rules accordingly.</p>
	<p>More details on the vulnerability can be found on the official <a href="https://logging.apache.org/log4j/2.x/security.html">Log4j security page</a>.</p>
	<div class="flex anchor relative">
		<h3 id="who-is-affected">Who is affected</h3>
		<a href="https://blog.cloudflare.com/#who-is-affected" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Log4j is a powerful Java based logging library maintained by the Apache Software Foundation.</p>
	<p>In all Log4j versions &gt;= 2.0-beta9 and ← 2.14.1 JNDI features used in configuration, log messages, and parameters can be exploited by an attacker to perform remote code execution. Specifically, an attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled.</p>
</div>