{
	"initialReadingTime": "2",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Filippo Valsorda",
				"slug": "filippo",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/46wTy3eKIkbnXRmuf2gsIt/ef5fc878a27d020b33532be5e44d9e1f/filippo.jpg",
				"location": null,
				"website": null,
				"twitter": "@filosottile",
				"facebook": null
			}
		],
		"excerpt": "Something that often, uh... bugs Go developers is the lack of a proper debugger. Builds are ridiculously fast and easy, but sometimes it would be nice to just set a breakpoint and step through that endless if chain or print a bunch of values without recompiling ten times.",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6IjRAYM4k4adA7QPdZKb6s/69586c3e9374032b8058e6a07585222f/go-has-a-debugger-and-its-awesome.jpg",
		"featured": false,
		"html": "<p>Something that often, uh... <i>bugs</i><a href=\"#fn1\">[1]</a> Go developers is the <b>lack of a proper debugger</b>. Sure, builds are ridiculously fast and easy, and <code>println(hex.Dump(b))</code> is your friend, but sometimes it would be nice to just set a breakpoint and step through that endless <code>if</code> chain or print a bunch of values without recompiling ten times.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/1PlA0CeyPc2zJ6Ai6u9f9u/4c94e2efe1612261fe4aeb9c75ed8836/12294903084_3a3d128ae7_z.jpg\" alt=\"\" class=\"kg-image\" width=\"640\" height=\"427\" loading=\"lazy\"/>\n            \n            </figure><p><a href=\"https://creativecommons.org/licenses/by/2.0/\">CC BY 2.0</a> <a href=\"https://www.flickr.com/photos/62766743@N07/12294903084/in/photolist-jJsAkE-hiHrhB-9TNjzG-9TMKnB-9TKuyt-9TKuQx-4rHRku-9TNj1L-dCD4Ay-bbk7in-ngEQwy-q577yv-qmsFPs-qXFbRy-dCMyqk-rmqu1H-tncWw9-fzkCLf-54MZxq-9ZCivM-fdC6b-5jvVQ7-q4YkxA-2vVkpu-aY6pnx-9TNiVC-j8TKCC-9TNji3-dKjVwD-eRrMtP-dVJA3D-bwjW2u-ohnZh9-iRdXBy-dWXXKe-fdT8VT-ePmAs-ecdQqy-ieu7sA-iFi5z-j6m1Qs-ncgQ2q-7W3hJi-r17FpD-ekipUs-jYbRdy-ckWNBh-gT4VL-9TNjvC-9TNjpL\">image</a> by <a href=\"https://www.flickr.com/photos/62766743@N07/\">Carl Milner</a></p><p>You <i>could</i> try to use some dirty gdb hacks that will work if you built your binary with a certain linker and ran it on some architectures when the moon was in a waxing crescent phase, but let&#39;s be honest, it isn&#39;t an enjoyable experience.</p><p>Well, worry no more! <a href=\"https://github.com/mailgun/godebug\">godebug</a> is here!</p><p><b>godebug is an awesome cross-platform debugger</b> created by the Mailgun team. You can read <a href=\"http://blog.mailgun.com/introducing-a-new-cross-platform-debugger-for-go/\">their introduction</a> for some under-the-hood details, but here&#39;s the cool bit: instead of wrestling with half a dozen different ptrace interfaces that would not be portable, <b>godebug rewrites your source code</b> and injects function calls like <code>godebug.Line</code> on every line, <code>godebug.Declare</code> at every variable declaration, and <code>godebug.SetTrace</code> for breakpoints (i.e. wherever you type <code>_ = &quot;breakpoint&quot;</code>).</p><p>I find this solution brilliant. What you get out of it is a (possibly cross-compiled) debug-enabled binary that you can drop on a staging server just like you would with a regular binary. When a breakpoint is reached, the program will stop inline and wait for you on stdin. <b>It&#39;s the single-binary, zero-dependencies philosophy of Go that we love applied to debugging.</b> Builds everywhere, runs everywhere, with no need for tools or permissions on the server. It even compiles to JavaScript with gopherjs (check out the Mailgun post above—show-offs ;) ).</p><p>You might ask, &quot;But does it get a decent runtime speed or work with big applications?&quot; Well, the other day I was seeing RRDNS—our in-house Go DNS server—hit a weird branch, so I placed a breakpoint a couple lines above the <i>if</i> in question, <b>recompiled the whole of RRDNS with godebug instrumentation</b>, dropped the binary on a staging server, and replayed some DNS traffic.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">filippo@staging:~$ ./rrdns -config config.json\n-&gt; _ = &quot;breakpoint&quot;\n(godebug) l\n\n    q := r.Query.Question[0]\n\n--&gt; _ = &quot;breakpoint&quot;\n\n    if !isQtypeSupported(q.Qtype) {\n        return\n(godebug) n\n-&gt; if !isQtypeSupported(q.Qtype) {\n(godebug) q\ndns.Question{Name:&quot;filippo.io.&quot;, Qtype:0x1, Qclass:0x1}\n(godebug) c</pre></code>\n            <p>Boom. The request and the debug log paused (make sure to terminate any timeout you have in your tools), waiting for me to step through the code.</p><p>Sold yet? Here&#39;s how you use it: simply run <code>godebug {build|run|test}</code> instead of <code>go {build|run|test}</code>. <a href=\"https://github.com/mailgun/godebug/pull/32/commits\">We adapted godebug</a> to resemble the go tool as much as possible. Remember to use <code>-instrument</code> if you want to be able to step into packages that are not <i>main</i>.</p><p>For example, here is part of the RRDNS Makefile:</p>\n            <pre class=\"language-make\"><code class=\"language-make\">bin/rrdns:\nifdef GODEBUG\n\tGOPATH=&quot;${PWD}&quot; go install github.com/mailgun/godebug\n\tGOPATH=&quot;${PWD}&quot; ./bin/godebug build -instrument &quot;${GODEBUG}&quot; -o bin/rrdns rrdns\nelse\n\tGOPATH=&quot;${PWD}&quot; go install rrdns\nendif\n\ntest:\nifdef GODEBUG\n\tGOPATH=&quot;${PWD}&quot; go install github.com/mailgun/godebug\n\tGOPATH=&quot;${PWD}&quot; ./bin/godebug test -instrument &quot;${GODEBUG}&quot; rrdns/...\nelse\n\tGOPATH=&quot;${PWD}&quot; go test rrdns/...\nendif</pre></code>\n            <p>Debugging is just a <code>make bin/rrdns GODEBUG=rrdns/...</code> away.</p><p>This tool is still young, but in my experience, perfectly functional. The UX could use some love if you can spare some time (as you can see above it&#39;s pretty spartan), but it should be easy to build on what&#39;s there already.</p><h2>About source rewriting</h2><p>Before closing, I&#39;d like to say a few words about the technique of source rewriting in general. It powers many different Go tools, like <a href=\"https://blog.golang.org/cover\">test coverage</a>, <a href=\"https://github.com/dvyukov/go-fuzz\">fuzzing</a> and, indeed, debugging. It&#39;s made possible primarily by Go’s blazing-fast compiles, and it enables amazing cross-platform tools to be built easily.</p><p>However, since it&#39;s such a handy and powerful pattern, I feel like <b>there should be a standard way to apply it in the context of the build process</b>. After all, all the source rewriting tools need to implement a subset of the following features:</p><ul><li><p>Wrap the main function</p></li><li><p>Conditionally rewrite source files</p></li><li><p>Keep global state</p></li></ul><p>Why should every tool have to reinvent all the boilerplate to copy the source files, rewrite the source, make sure stale objects are not used, build the right packages, run the right tests, and interpret the CLI..? Basically, all of <a href=\"https://github.com/mailgun/godebug/blob/f8742f647adb8ee17a1435de3b1929d36df590c8/cmd.go\">godebug/cmd.go</a>. And what about <a href=\"http://getgb.io/\">gb</a>, for example?</p><p>I think we need a framework for Go source code rewriting tools. (Spoiler, spoiler, ...)</p><p><i>If you’re interested in working on Go servers at scale and developing tools to do it better, remember </i><a href=\"https://www.cloudflare.com/join-our-team\"><i>we’re hiring in London, San Francisco, and Singapore</i></a><i>!</i></p><hr/><hr/><ol><li><p>I&#39;m sorry. <a href=\"#fnref1\">↩︎</a></p></li></ol>",
		"id": "7rlszh5ZEwkE3JfCjkJkZv",
		"localeList": {
			"name": "Go has a debugger—and it's awesome! Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2015-06-18T12:14:00.000+01:00",
		"slug": "go-has-a-debugger-and-its-awesome",
		"tags": [
			{
				"id": "5X8LHhjKihRu7muwB9u5a1",
				"name": "RRDNS",
				"slug": "rrdns"
			},
			{
				"id": "1fCflWFtZIDnGI4cd3gRgx",
				"name": "Tools",
				"slug": "tools"
			},
			{
				"id": "5fZHv2k9HnJ7phOPmYexHw",
				"name": "DNS",
				"slug": "dns"
			},
			{
				"id": "6QVJOBzgKXUO9xAPEpqxvK",
				"name": "Reliability",
				"slug": "reliability"
			},
			{
				"id": "6lhzEBz2B56RKa4nUEAGYJ",
				"name": "Programming",
				"slug": "programming"
			},
			{
				"id": "KDI5hQcs301H8vxpGKXO0",
				"name": "Go",
				"slug": "go"
			},
			{
				"id": "4HIPcb68qM0e26fIxyfzwQ",
				"name": "Developers",
				"slug": "developers"
			}
		],
		"title": "Go has a debugger—and it's awesome!",
		"updated_at": "2024-08-27T02:39:05.022Z",
		"url": "https://blog.cloudflare.com/go-has-a-debugger-and-its-awesome"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}