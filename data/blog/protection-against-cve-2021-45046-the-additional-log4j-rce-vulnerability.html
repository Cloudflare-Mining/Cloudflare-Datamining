<div class="mb2 gray5">1 min read</div>
<div class="mt4">This post is also available in <a href="https://blog.cloudflare.com/zh-cn/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability">简体中文</a>, <a href="https://blog.cloudflare.com/fr-fr/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability">Français</a>, <a href="https://blog.cloudflare.com/de-de/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability">Deutsch</a>, <a href="https://blog.cloudflare.com/ja-jp/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability">日本語</a>, <a href="https://blog.cloudflare.com/ko-kr/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability">한국어</a> and <a href="https://blog.cloudflare.com/zh-tw/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability">繁體中文</a>.</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/uI6jAGy2p2WOmDdcDyaOO/451f8d79bd8b792ce3c4e1a744609856/protection-against-cve-2021-45046-the-additional-log4j-rce-vulnerability.png" alt="">
<div class="post-content lh-copy gray1">
	<p></p>
	<p>Hot on the heels of CVE-2021-44228 a second Log4J CVE has been filed <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046">CVE-2021-45046</a>. The rules that we <a href="https://blog.cloudflare.com/cve-2021-44228-log4j-rce-0-day-mitigation">previously released for CVE-2021-44228</a> give the same level of protection for this new CVE.</p>
	<p>This vulnerability is actively being exploited and anyone using Log4J should update to version <b>2.16.0</b> as soon as possible, even if you have previously updated to 2.15.0. The latest version can be found on the <a href="https://logging.apache.org/log4j/2.x/download.html">Log4J download page</a>.</p>
	<p>Customers using the Cloudflare WAF have three rules to help mitigate any exploit attempts:</p>
	<table>
		<tbody>
			<tr>
				<td>
					<p><b>Rule ID</b></p>
				</td>
				<td>
					<p><b>Description</b></p>
				</td>
				<td>
					<p><b>Default Action</b></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100514 </code>(legacy WAF)
						<code>6b1cc72dff9746469d4695a474430f12</code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4J Headers</p>
				</td>
				<td>
					<p><code>BLOCK</code></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100515 </code>(legacy WAF)
						<code>0c054d4e4dd5455c9ff8f01efe5abb10 </code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4J Body</p>
				</td>
				<td>
					<p><code>BLOCK</code></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100516 </code>(legacy WAF)
						<code>5f6744fa026a4638bda5b3d7d5e015dd </code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4J URL</p>
				</td>
				<td>
					<p><code>BLOCK</code></p>
				</td>
			</tr>
		</tbody>
	</table>
	<p>The mitigation has been split across three rules inspecting HTTP headers, body and URL respectively.</p>
	<p>In addition to the above rules we have also released a fourth rule that will protect against a much wider range of attacks at the cost of a higher false positive rate. For that reason we have made it available but not set it to <code>BLOCK</code> by default:</p>
	<table>
		<tbody>
			<tr>
				<td>
					<p><b>Rule ID</b></p>
				</td>
				<td>
					<p><b>Description</b></p>
				</td>
				<td>
					<p><b>Default Action</b></p>
				</td>
			</tr>
			<tr>
				<td>
					<p><code>100517 </code>(legacy WAF)
						<code>2c5413e155db4365befe0df160ba67d7 </code>(new WAF)
					</p>
				</td>
				<td>
					<p>Log4J Advanced URI, Headers</p>
				</td>
				<td>
					<p><code>DISABLED</code></p>
				</td>
			</tr>
		</tbody>
	</table>
	<div class="flex anchor relative">
		<h3 id="who-is-affected">Who is affected</h3>
		<a href="https://blog.cloudflare.com/#who-is-affected" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Log4J is a powerful Java-based logging library maintained by the Apache Software Foundation.</p>
	<p>In all Log4J versions &gt;= 2.0-beta9 and ← 2.14.1 JNDI features used in configuration, log messages, and parameters can be exploited by an attacker to perform <a href="https://www.cloudflare.com/learning/security/what-is-remote-code-execution">remote code execution</a>. Specifically, an attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled.</p>
	<p>In addition, the previous mitigations for CVE-2021-22448 as seen in version 2.15.0 were not adequate to protect against CVE-2021-45046.</p>
</div>