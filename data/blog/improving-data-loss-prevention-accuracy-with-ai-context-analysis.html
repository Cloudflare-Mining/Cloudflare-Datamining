<div class="mb2 gray5">5 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7k1jqytoKrUA4FF4ivwLvy/ddf9a33f4722a915b9ae51095cfde33a/Feature_Image.png" alt="">
<div class="post-content lh-copy gray1">
	<p>We are excited to announce our latest innovation to Cloudflare’s <a href="https://www.cloudflare.com/zero-trust/products/dlp"><u>Data Loss Prevention</u></a> (DLP) solution: a self-improving AI-powered algorithm that adapts to your organization’s unique traffic patterns to reduce false positives.&nbsp;</p>
	<p>Many customers are plagued by the shapeshifting task of identifying and protecting their sensitive data as it moves within and even outside of their organization. Detecting this data through deterministic means, such as regular expressions, often fails because they cannot identify details that are categorized as personally identifiable information (PII) nor intellectual property (IP). This can generate a high rate of false positives, which contributes to noisy alerts that subsequently may lead to review fatigue. Even more critically, this less than ideal experience can turn users away from relying on our DLP product and result in a reduction in their overall security posture.&nbsp;</p>
	<p>Built into Cloudflare’s DLP Engine, AI enables us to intelligently assess the contents of a document or HTTP request in parallel with a customer’s historical reports to determine context similarity and draw conclusions on data sensitivity with increased accuracy.</p>
	<p>In this blog post, we’ll explore <a href="https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/advanced-settings"><u>DLP AI Context Analysis</u></a>, its implementation using <a href="https://www.cloudflare.com/developer-platform/products/workers-ai"><u>Workers AI</u></a> and <a href="https://www.cloudflare.com/developer-platform/products/vectorize"><u>Vectorize</u></a>, and future improvements we’re developing.&nbsp;</p>
	<div class="flex anchor relative">
		<h3 id="understanding-false-positives-and-their-impact-on-user-confidence">Understanding false positives and their impact on user confidence</h3>
		<a href="https://blog.cloudflare.com/#understanding-false-positives-and-their-impact-on-user-confidence" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Data Loss Prevention (DLP) at Cloudflare detects sensitive information by scanning potential sources of data leakage across various channels such as web, cloud, email, and SaaS applications. While we leverage several detection methods, pattern-based methods like regular expressions play a key role in our approach. This method is effective for many types of sensitive data. However, certain information can be challenging to classify solely through patterns. For instance, U.S. Social Security Numbers (SSNs), structured as <a href="https://en.wikipedia.org/wiki/Social_Security_number#Structure"><u>AAA-GG-SSSS</u></a>, sometimes with dashes omitted, are often confused with other similarly formatted data, such as U.S. taxpayer identification numbers, bank account numbers, or phone numbers.&nbsp;</p>
	<p>Since <a href="https://blog.cloudflare.com/inline-data-loss-prevention"><u>announcing</u></a> our DLP product, we have introduced new capabilities like <a href="https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/advanced-settings/#confidence-levels"><u>confidence thresholds</u></a> to reduce the number of false positives users receive. This method involves examining the surrounding context of a pattern match to assess Cloudflare’s confidence in its accuracy. With confidence thresholds, users specify a threshold (low, medium, or high) to signify a preference for how tolerant detections are to false positives. DLP uses the chosen threshold as a minimum, surfacing only those detections with a confidence score that meets or exceeds the specified threshold.&nbsp;&nbsp;</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1EOKyJisPTPWcSOep9Se7F/22c1bf40cbd0d698b0e24095826548cd/1.png" alt="" class="kg-image" width="1628" height="866" loading="lazy">
	</figure>
	<p>However, implementing context analysis is also not a trivial task. A straightforward approach might involve looking for specific keywords near the matched pattern, such as "SSN" near a potential SSN match, but this method has its limitations. Keyword lists are often incomplete, users may make typographical errors, and many true positives do not have any identifying keywords nearby (e.g., bank accounts near routing numbers or SSNs near names).</p>
	<div class="flex anchor relative">
		<h3 id="leveraging-ai-ml-for-enhanced-detection-accuracy">Leveraging AI/ML for enhanced detection accuracy</h3>
		<a href="https://blog.cloudflare.com/#leveraging-ai-ml-for-enhanced-detection-accuracy" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>To address the limitations of a hardcoded strategy for context analysis, we have developed a dynamic, self-improving algorithm that learns from customer feedback to further improve their future experience. Each time a customer reports a false positive via <a href="https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/logging-options/#4-view-payload-logs"><u>decrypted payload logs</u></a>, the system reduces its future confidence for hits in similar contexts. Conversely, reports of true positives increase the system's confidence for hits in similar contexts.&nbsp;</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4h84zJ0SNtfhTVGzwxVyk0/bbdcce73d4538619abb296617d793bff/2.png" alt="" class="kg-image" width="1999" height="946" loading="lazy">
	</figure>
	<p>To determine context similarity, we leverage Workers AI. Specifically, <a href="https://developers.cloudflare.com/workers-ai/models/bge-base-en-v1.5"><u>a pretrained language model</u></a> that converts the text into a high-dimensional vector (i.e. text embedding). These embeddings capture the meaning of the text, ensuring that two sentences with the same meaning but different wording map to vectors that are close to each other.&nbsp;</p>
	<p>When a pattern match is detected, the system uses the AI model to compute the embedding of the surrounding context. It then performs a nearest neighbor search to find previously logged false or true positives with similar meanings. This allows the system to identify context similarities even if the exact wording differs, but the meaning remains the same.&nbsp;</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/z8yLmrAXES70MzTn2GdQE/0845b35884535843fa01e4f1a92a3f41/3.png" alt="" class="kg-image" width="1999" height="795" loading="lazy">
	</figure>
	<p>In our experiments using Cloudflare employee traffic, this approach has proven robust, effectively handling new pattern matches it hadn't encountered before. When the DLP admin reports false and true positives through the Cloudflare dashboard while viewing the payload log of a <a href="https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies"><u>policy</u></a> match, it helps DLP continue to improve, leading to a significant reduction in false positives over time.&nbsp;</p>
	<div class="flex anchor relative">
		<h3 id="seamless-integration-with-workers-ai-and-vectorize">Seamless integration with Workers AI and Vectorize</h3>
		<a href="https://blog.cloudflare.com/#seamless-integration-with-workers-ai-and-vectorize" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>In developing this new feature, we used components from Cloudflare's developer platform — <a href="https://developers.cloudflare.com/workers-ai"><u>Workers AI</u></a> and <a href="https://developers.cloudflare.com/vectorize"><u>Vectorize</u></a> — which helps simplify our design. Instead of managing the underlying infrastructure ourselves, we leveraged <a href="https://www.cloudflare.com/developer-platform/products/workers"><u>Cloudflare Workers</u></a> as the foundation, using Workers AI for text embedding, and Vectorize as the vector database. This setup allows us to focus on the algorithm itself without the overhead of provisioning underlying resources.&nbsp;&nbsp;</p>
	<p>Thanks to Workers AI, converting text into embeddings couldn’t be easier. With just a single line of code we can transform any text into its corresponding vector representation.</p>
	<pre class="language-JavaScript"><code class="language-JavaScript">const result = await env.AI.run(model, {text: [text]}).data;</code></pre>
	<p>This handles everything from tokenization to GPU-powered inference, making the process both simple and scalable.</p>
	<p>The nearest neighbor search is equally straightforward. After obtaining the vector from Workers AI, we use Vectorize to quickly find similar contexts from past reports. In the meantime, we store the vector for the current pattern match in Vectorize, allowing us to learn from future feedback.&nbsp;</p>
	<p>To optimize resource usage, we’ve incorporated a few more clever techniques. For example, instead of storing every vector from pattern hits, we use online clustering to group vectors into clusters and store only the cluster centroids along with counters for tracking hits and reports. This reduces storage needs and speeds up searches. Additionally, we’ve integrated <a href="https://www.cloudflare.com/developer-platform/products/cloudflare-queues"><u>Cloudflare Queues</u></a> to separate the indexing process from the DLP scanning hot path, ensuring a robust and responsive system.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6e6krasQ5t5ekp1TK0kJ0A/414f74fd48ef10a16e369775ead189b7/4.png" alt="" class="kg-image" width="1999" height="981" loading="lazy">
	</figure>
	<p>Privacy is a top priority. We redact any matched text before conversion to embeddings, and all vectors and reports are stored in customer-specific private namespaces across <a href="https://www.cloudflare.com/developer-platform/products/vectorize"><u>Vectorize</u></a>, <a href="https://www.cloudflare.com/developer-platform/products/d1"><u>D1</u></a>, and <a href="https://www.cloudflare.com/developer-platform/products/workers-kv"><u>Workers KV</u></a>. This means each customer’s learning process is independent and secure. In addition, we implement data retention policies so that vectors that have not been accessed or referenced within 60 days are automatically removed from our system.&nbsp;&nbsp;</p>
	<div class="flex anchor relative">
		<h3 id="limitations-and-continuous-improvements">Limitations and continuous improvements</h3>
		<a href="https://blog.cloudflare.com/#limitations-and-continuous-improvements" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>AI-driven context analysis significantly improves the accuracy of our detections. However, this comes at the cost of some increase in latency for the end user experience.&nbsp; For requests that do not match any enabled DLP entries, there will be no latency increase.&nbsp; However, requests that match an enabled entry in a profile with AI context analysis enabled will typically experience an increase in latency of about 400ms. In rare extreme cases, for example requests that match multiple entries, that latency increase could be as high as 1.5 seconds. We are actively working to drive the latency down, ideally to a typical increase of 250ms or better.&nbsp;</p>
	<p>Another limitation is that the current implementation supports English exclusively because of our choice of the language model. However, Workers AI is developing a multilingual model which will enable DLP to increase support across different regions and languages.</p>
	<p>Looking ahead, we also aim to enhance the transparency of AI context analysis. Currently, users have no visibility on how the decisions are made based on their past false and true positive reports. We plan to develop tools and interfaces that provide more insight into how confidence scores are calculated, making the system more explainable and user-friendly.&nbsp;&nbsp;</p>
	<p>With this launch, AI context analysis is only available for Gateway HTTP traffic. By the end of 2025, AI context analysis will be available in both <a href="https://www.cloudflare.com/zero-trust/products/casb"><u>CASB</u></a> and <a href="https://www.cloudflare.com/zero-trust/products/email-security"><u>Email Security</u></a> so that customers receive the same AI enhancements across their entire data landscape.</p>
	<div class="flex anchor relative">
		<h3 id="unlock-the-benefits-start-using-ai-powered-detection-features-today">Unlock the benefits: start using AI-powered detection features today</h3>
		<a href="https://blog.cloudflare.com/#unlock-the-benefits-start-using-ai-powered-detection-features-today" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>DLP’s AI context analysis is in closed beta. Sign up <a href="https://www.cloudflare.com/lp/dlp-ai-context-analysis"><u>here</u></a> for early access to experience immediate improvements to your DLP HTTP traffic matches. More updates are coming soon as we approach general availability!</p>
	<p>To get access to DLP via Cloudflare One, contact your account manager.</p>
</div>