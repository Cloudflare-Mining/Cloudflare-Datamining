{
	"footerBlurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
	"initialReadingTime": "5",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Marek Majkowski",
				"slug": "marek-majkowski",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1JuU5qavgwVeqR8BAUrd6U/3a0d0445d41c9a3c42011046efe9c37b/marek-majkowski.jpeg",
				"location": null,
				"website": null,
				"twitter": "@majek04",
				"facebook": null
			}
		],
		"excerpt": "Last month we shared statistics on some popular reflection attacks. Back then the average SSDP attack size was ~12 Gbps.",
		"feature_image": "https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7lnctTxBH0EoaZjuMiuCyf/0623eaa36e871d8e2086e5bd1667bf4f/ssdp-100gbps.png",
		"featured": false,
		"html": "<p>Last month we <a href=\"/reflections-on-reflections/\">shared statistics on some popular reflection</a> attacks. Back then the average SSDP attack size was ~12 Gbps and largest SSDP reflection we recorded was:</p><ul><li><p>30 Mpps (millions of packets per second)</p></li><li><p>80 Gbps (billions of bits per second)</p></li><li><p>using 940k reflector IPs</p></li></ul><p>This changed a couple of days ago when we noticed an unusually large SSDP amplification. It&#39;s worth deeper investigation since it crossed the symbolic threshold of 100 Gbps.</p><p>The packets per second chart during the attack looked like this:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2GPd738jNjjbpCqukAPD9A/c58213ae079f7e12c20debf25e3c2d22/7a9f87325c0e3921-qps-1.png\" alt=\"\" class=\"kg-image\" width=\"800\" height=\"257\" loading=\"lazy\"/>\n            \n            </figure><p>The bandwidth usage:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5kePNxdtoDtGkdJPms4FJF/5e1b9bfab4163e71b4d4c93773b3e1d1/7a9f87325c0e3921-bps-2.png\" alt=\"\" class=\"kg-image\" width=\"800\" height=\"266\" loading=\"lazy\"/>\n            \n            </figure><p>This packet flood lasted 38 minutes. According to our sampled netflow data it utilized 930k reflector servers. We estimate that the during 38 minutes of the attack each reflector sent 112k packets to Cloudflare.</p><p>The reflector servers are across the globe, with a large presence in Argentina, Russia and China. Here are the unique IPs per country:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ cat ips-nf-ct.txt|uniq|cut -f 2|sort|uniq -c|sort -nr|head\n 439126 CN\n 135783 RU\n  74825 AR\n  51222 US\n  41353 TW\n  32850 CA\n  19558 MY\n  18962 CO\n  14234 BR\n  10824 KR\n  10334 UA\n   9103 IT\n   ...</pre></code>\n            <p>The reflector IP distribution across ASNs is typical. It pretty much follows the world’s largest residential ISPs:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ cat ips-nf-asn.txt |uniq|cut -f 2|sort|uniq -c|sort -nr|head\n 318405 4837   # CN China Unicom\n  84781 4134   # CN China Telecom\n  72301 22927  # AR Telefonica de Argentina\n  23823 3462   # TW Chunghwa Telecom\n  19518 6327   # CA Shaw Communications Inc.\n  19464 4788   # MY TM Net\n  18809 3816   # CO Colombia Telecomunicaciones\n  11328 28573  # BR Claro SA\n   7070 10796  # US Time Warner Cable Internet\n   6840 8402   # RU OJSC &quot;Vimpelcom&quot;\n   6604 3269   # IT Telecom Italia\n   6377 12768  # RU JSC &quot;ER-Telecom Holding&quot;\n   ...</pre></code>\n            \n          <div class=\"flex anchor relative\">\n            <h3 id=\"whats-ssdp-anyway\">What&#39;s SSDP anyway?</h3>\n            <a href=\"#whats-ssdp-anyway\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>The attack was composed of UDP packets with source port 1900. This port is used by the <a href=\"https://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol\">SSDP</a> and is used by the UPnP protocols. UPnP is one of the <a href=\"https://en.wikipedia.org/wiki/Zero-configuration_networking#UPnP\">zero-configuration networking</a> protocols. Most likely your home devices support it, allowing them to be easily discovered by your computer or phone. When a new device (like your laptop) joins the network, it can query the local network for specific devices, like internet gateways, audio systems, TVs, or printers. Read more on <a href=\"http://www.zeroconf.org/zeroconfandupnp.html\">how UPnP compares to Bonjour</a>.</p><p><a href=\"http://www.upnp-hacks.org/upnp.html\">UPnP</a> is poorly standardised, but here&#39;s a snippet from <a href=\"https://web.archive.org/web/20151107123618/http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v2.0.pdf\">the spec</a> about the <code>M-SEARCH</code> frame - the main method for discovery:</p><p><i>When a control point is added to the network, the UPnP discovery protocol allows that control point to search for devices of interest on the network. It does this by multicasting on the reserved address and port (239.255.255.250:1900) a search message with a pattern, or target, equal to a type or identifier for a device or service.</i></p><p>Responses to <code>M-SEARCH</code> frame:</p><p><i>To be found by a network search, a device shall send a unicast UDP response to the source IP address and port that sent the request to the multicast address. Devices respond if the ST header field of the </i><code><i>M-SEARCH</i></code><i> request is “ssdp:all”, “upnp:rootdevice”, “uuid:” followed by a UUID that exactly matches the one advertised by the device, or if the </i><code><i>M-SEARCH</i></code><i> request matches a device type or service type supported by the device.</i></p><p>This works in practice. For example, my Chrome browser regularly asks for a Smart TV I guess:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ sudo tcpdump -ni eth0 udp and port 1900 -A\nIP 192.168.1.124.53044 &gt; 239.255.255.250.1900: UDP, length 175\nM-SEARCH * HTTP/1.1\nHOST: 239.255.255.250:1900\nMAN: &quot;ssdp:discover&quot;\nMX: 1\nST: urn:dial-multiscreen-org:service:dial:1\nUSER-AGENT: Google Chrome/58.0.3029.110 Windows</pre></code>\n            <p>This frame is sent to a multicast IP address. Other devices listening on that address and supporting this specific <code>ST</code> (search-target) multiscreen type are supposed to answer.</p><p>Apart from queries for specific device types, there are two &quot;generic&quot; <code>ST</code> query types:</p><ul><li><p><code>upnp:rootdevice</code>: search for root devices</p></li><li><p><code>ssdp:all</code>: search for all UPnP devices and services</p></li></ul><p>To emulate these queries you can run this python script (based on <a href=\"https://www.electricmonk.nl/log/2016/07/05/exploring-upnp-with-python/\">this work</a>):</p>\n            <pre class=\"language-.py\"><code class=\"language-.py\">#!/usr/bin/env python2\nimport socket\nimport sys\n\ndst = &quot;239.255.255.250&quot;\nif len(sys.argv) &gt; 1:\n    dst = sys.argv[1]\nst = &quot;upnp:rootdevice&quot;\nif len(sys.argv) &gt; 2:\n    st = sys.argv[2]\n\nmsg = [\n    &#039;M-SEARCH * HTTP/1.1&#039;,\n    &#039;Host:239.255.255.250:1900&#039;,\n    &#039;ST:%s&#039; % (st,),\n    &#039;Man:&quot;ssdp:discover&quot;&#039;,\n    &#039;MX:1&#039;,\n    &#039;&#039;]\n\ns = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP)\ns.settimeout(10)\ns.sendto(&#039;\\r\\n&#039;.join(msg), (dst, 1900) )\n\nwhile True:\n    try:\n        data, addr = s.recvfrom(32*1024)\n    except socket.timeout:\n        break\n    print &quot;[+] %s\\n%s&quot; % (addr, data)</pre></code>\n            <p>On my home network two devices show up:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ python ssdp-query.py\n[+] (&#039;192.168.1.71&#039;, 1026)\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age = 60\nEXT:\nLOCATION: http://192.168.1.71:5200/Printer.xml\nSERVER: Network Printer Server UPnP/1.0 OS 1.29.00.44 06-17-2009\nST: upnp:rootdevice\nUSN: uuid:Samsung-Printer-1_0-mrgutenberg::upnp:rootdevice\n\n[+] (&#039;192.168.1.70&#039;, 36319)\nHTTP/1.1 200 OK\nLocation: http://192.168.1.70:49154/MediaRenderer/desc.xml\nCache-Control: max-age=1800\nContent-Length: 0\nServer: Linux/3.2 UPnP/1.0 Network_Module/1.0 (RX-S601D)\nEXT:\nST: upnp:rootdevice\nUSN: uuid:9ab0c000-f668-11de-9976-000adedd7411::upnp:rootdevice</pre></code>\n            \n          <div class=\"flex anchor relative\">\n            <h3 id=\"the-firewall\">The firewall</h3>\n            <a href=\"#the-firewall\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Now that we understand the basics of SSDP, understanding the reflection attack should be easy. You see, there are in fact two ways of delivering the <code>M-SEARCH</code> frame:</p><ul><li><p>what we presented, over the multicast address</p></li><li><p>directly to a UPnP/SSDP enabled host on a normal unicast address</p></li></ul><p>The latter method works. We can specifically target my printer IP address:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ python ssdp-query.py 192.168.1.71\n[+] (&#039;192.168.1.71&#039;, 1026)\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age = 60\nEXT:\nLOCATION: http://192.168.1.71:5200/Printer.xml\nSERVER: Network Printer Server UPnP/1.0 OS 1.29.00.44 06-17-2009\nST: upnp:rootdevice\nUSN: uuid:Samsung-Printer-1_0-mrgutenberg::upnp:rootdevice</pre></code>\n            <p>Now the problem is easily seen: the SSDP protocol does not check whether the querying party is in the same network as the device. It will happily respond to an <code>M-SEARCH</code> delivered over the public Internet. All it takes is a tiny misconfiguration in a firewall - port 1900 UDP open to the world - and a perfect target for UDP amplification will be available.</p><p>Given a misconfigured target our script will happily work over the internet:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ python ssdp-query.py 100.42.x.x\n[+] (&#039;100.42.x.x&#039;, 1900)\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age=120\nST: upnp:rootdevice\nUSN: uuid:3e55ade9-c344-4baa-841b-826bda77dcb2::upnp:rootdevice\nEXT:\nSERVER: TBS/R2 UPnP/1.0 MiniUPnPd/1.2\nLOCATION: http://192.168.2.1:40464/rootDesc.xml</pre></code>\n            \n          <div class=\"flex anchor relative\">\n            <h3 id=\"the-amplification\">The amplification</h3>\n            <a href=\"#the-amplification\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>The real damage is done by the <code>ssdp:all</code> <code>ST</code> type though. These responses are <i>much</i> larger:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ python ssdp-query.py 100.42.x.x ssdp:all\n[+] (&#039;100.42.x.x&#039;, 1900)\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age=120\nST: upnp:rootdevice\nUSN: uuid:3e55ade9-c344-4baa-841b-826bda77dcb2::upnp:rootdevice\nEXT:\nSERVER: TBS/R2 UPnP/1.0 MiniUPnPd/1.2\nLOCATION: http://192.168.2.1:40464/rootDesc.xml\n\n[+] (&#039;100.42.x.x&#039;, 1900)\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age=120\nST: urn:schemas-upnp-org:device:InternetGatewayDevice:1\nUSN: uuid:3e55ade9-c344-4baa-841b-826bda77dcb2::urn:schemas-upnp-org:device:InternetGatewayDevice:1\nEXT:\nSERVER: TBS/R2 UPnP/1.0 MiniUPnPd/1.2\nLOCATION: http://192.168.2.1:40464/rootDesc.xml\n\n... 6 more response packets....</pre></code>\n            <p>In this particular case, a single SSDP <code>M-SEARCH</code> packet triggered 8 response packets. tcpdump view:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ sudo tcpdump -ni en7 host 100.42.x.x -ttttt\n 00:00:00.000000 IP 192.168.1.200.61794 &gt; 100.42.x.x.1900: UDP, length 88\n 00:00:00.197481 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 227\n 00:00:00.199634 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 299\n 00:00:00.202938 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 295\n 00:00:00.208425 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 275\n 00:00:00.209496 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 307\n 00:00:00.212795 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 289\n 00:00:00.215522 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 291\n 00:00:00.219190 IP 100.42.x.x.1900 &gt; 192.168.1.200.61794: UDP, length 291</pre></code>\n            <p>That target exposes 8x packet count amplification and 26x bandwidth amplification. Sadly, this is typical for SSDP.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"ip-spoofing\">IP Spoofing</h3>\n            <a href=\"#ip-spoofing\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>The final step for the attack is to fool the vulnerable servers to flood the target IP - not the attacker. For that the attacker needs to <a href=\"https://en.wikipedia.org/wiki/IP_address_spoofing\">spoof the source IP address</a> on their queries.</p><p>We probed the reflector IPs used in the shown 100 Gbps+ attack. We found that out of the 920k reflector IPs, only 350k (38%) still respond to SSDP probes.</p><p>Out of the reflectors that responded, each sent on average 7 packets:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">$ cat results-first-run.txt|cut -f 1|sort|uniq -c|sed -s &#039;s#^ \\+##g&#039;|cut -d &quot; &quot; -f 1| ~/mmhistogram -t &quot;Response packets per IP&quot; -p\nResponse packets per IP min:1.00 avg:6.99 med=8.00 max:186.00 dev:4.44 count:350337\nResponse packets per IP:\n value |-------------------------------------------------- count\n     0 |                    ****************************** 23.29%\n     1 |                                              ****  3.30%\n     2 |                                                **  2.29%\n     4 |************************************************** 38.73%\n     8 |            ************************************** 29.51%\n    16 |                                               ***  2.88%\n    32 |                                                    0.01%\n    64 |                                                    0.00%\n   128 |                                                    0.00%</pre></code>\n            <p>The response packets had 321 bytes (+/- 29 bytes) on average. Our request packets had 110 bytes.</p><p>According to our measurements with the <code>ssdp:all</code> <code>M-SEARCH</code> attacker would be able to achieve:</p><ul><li><p><b>7x</b> packet number amplification</p></li><li><p><b>20x</b> bandwidth amplification</p></li></ul><p>We can estimate the 43 Mpps/112 Gbps attack was generated with roughly:</p><ul><li><p>6.1 Mpps of spoofing capacity</p></li><li><p>5.6 Gbps of spoofed bandwidth</p></li></ul><p>In other words: a single well connected 10 Gbps server able to perform IP spoofing can deliver a significant SSDP attack.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"more-on-the-ssdp-servers\">More on the SSDP servers</h3>\n            <a href=\"#more-on-the-ssdp-servers\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Since we probed the vulnerable SSDP servers, here are the most common <code>Server</code> header values we received:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\"> 104833 Linux/2.4.22-1.2115.nptl UPnP/1.0 miniupnpd/1.0\n  77329 System/1.0 UPnP/1.0 IGD/1.0\n  66639 TBS/R2 UPnP/1.0 MiniUPnPd/1.2\n  12863 Ubuntu/7.10 UPnP/1.0 miniupnpd/1.0\n  11544 ASUSTeK UPnP/1.0 MiniUPnPd/1.4\n  10827 miniupnpd/1.0 UPnP/1.0\n   8070 Linux UPnP/1.0 Huawei-ATP-IGD\n   7941 TBS/R2 UPnP/1.0 MiniUPnPd/1.4\n   7546 Net-OS 5.xx UPnP/1.0\n   6043 LINUX-2.6 UPnP/1.0 MiniUPnPd/1.5\n   5482 Ubuntu/lucid UPnP/1.0 MiniUPnPd/1.4\n   4720 AirTies/ASP 1.0 UPnP/1.0 miniupnpd/1.0\n   4667 Linux/2.6.30.9, UPnP/1.0, Portable SDK for UPnP devices/1.6.6\n   3334 Fedora/10 UPnP/1.0 MiniUPnPd/1.4\n   2814  1.0\n   2044 miniupnpd/1.5 UPnP/1.0\n   1330 1\n   1325 Linux/2.6.21.5, UPnP/1.0, Portable SDK for UPnP devices/1.6.6\n    843 Allegro-Software-RomUpnp/4.07 UPnP/1.0 IGD/1.00\n    776 Upnp/1.0 UPnP/1.0 IGD/1.00\n    675 Unspecified, UPnP/1.0, Unspecified\n    648 WNR2000v5 UPnP/1.0 miniupnpd/1.0\n    562 MIPS LINUX/2.4 UPnP/1.0 miniupnpd/1.0\n    518 Fedora/8 UPnP/1.0 miniupnpd/1.0\n    372 Tenda UPnP/1.0 miniupnpd/1.0\n    346 Ubuntu/10.10 UPnP/1.0 miniupnpd/1.0\n    330 MF60/1.0 UPnP/1.0 miniupnpd/1.0\n    ...</pre></code>\n            <p>The most common <code>ST</code> header values we saw:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\"> 298497 upnp:rootdevice\n 158442 urn:schemas-upnp-org:device:InternetGatewayDevice:1\n 151642 urn:schemas-upnp-org:device:WANDevice:1\n 148593 urn:schemas-upnp-org:device:WANConnectionDevice:1\n 147461 urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1\n 146970 urn:schemas-upnp-org:service:WANIPConnection:1\n 145602 urn:schemas-upnp-org:service:Layer3Forwarding:1\n 113453 urn:schemas-upnp-org:service:WANPPPConnection:1\n 100961 urn:schemas-upnp-org:device:InternetGatewayDevice:\n 100180 urn:schemas-upnp-org:device:WANDevice:\n  99017 urn:schemas-upnp-org:service:WANCommonInterfaceConfig:\n  98112 urn:schemas-upnp-org:device:WANConnectionDevice:\n  97246 urn:schemas-upnp-org:service:WANPPPConnection:\n  96259 urn:schemas-upnp-org:service:WANIPConnection:\n  93987 urn:schemas-upnp-org:service:Layer3Forwarding:\n  91108 urn:schemas-wifialliance-org:device:WFADevice:\n  90818 urn:schemas-wifialliance-org:service:WFAWLANConfig:\n  35511 uuid:IGD{8c80f73f-4ba0-45fa-835d-042505d052be}000000000000\n   9822 urn:schemas-upnp-org:service:WANEthernetLinkConfig:1\n   7737 uuid:WAN{84807575-251b-4c02-954b-e8e2ba7216a9}000000000000\n   6063 urn:schemas-microsoft-com:service:OSInfo:1\n    ...</pre></code>\n            <p>The vulnerable IPs are seem to be mostly unprotected home routers.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"open-ssdp-is-a-vulnerability\">Open SSDP is a vulnerability</h3>\n            <a href=\"#open-ssdp-is-a-vulnerability\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>It&#39;s not a novelty that allowing UDP port 1900 traffic from the Internet to your home printer or such is not a good idea. This problem has been known since at least January 2013:</p><ul><li><p><a href=\"https://community.rapid7.com/community/infosec/blog/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play\">&quot;Security Flaws in Universal Plug and Play: Unplug, Don&#39;t Play&quot;</a></p></li></ul><p>Authors of SSDP clearly didn&#39;t give any thought to UDP amplification potential. There are a number of obvious recommendations about future use of SSDP protocol:</p><ul><li><p>The authors of SSDP should answer if there is any real world use of unicast <code>M-SEARCH</code> queries. From what I understand <code>M-SEARCH</code> only makes practical sense as a multicast query in local area network.</p></li><li><p>Unicast <code>M-SEARCH</code> support should be either deprecated or at least rate limited, in similar way to <a href=\"http://www.redbarn.org/dns/ratelimits\">DNS Response Rate Limit techniques</a>.</p></li><li><p><code>M-SEARCH</code> responses should be only delivered to local network. Responses routed over the network make little sense and open described vulnerability.</p></li></ul><p>In the meantime we recommend:</p><ul><li><p>Network administrators should ensure inbound UDP port 1900 is blocked on firewall.</p></li><li><p>Internet service providers should <b>never allow IP spoofing</b> to be performed on their network. IP spoofing is the true root cause of the issue. See the infamous <a href=\"http://www.bcp38.info/index.php/Main_Page\">BCP38</a>.</p></li><li><p>Internet service providers should allow their customers to use <b>BGP flowspec</b> to rate limit inbound UDP source port 1900 traffic, to relieve congestion during large SSDP attacks.</p></li><li><p>Internet providers should internally collect <b>netflow</b> protocol samples. The netflow is needed to identify the true source of the attack. With netflow it&#39;s trivial to answer questions like: &quot;Which of my customers sent 6.4Mpps of traffic to port 1900?&quot;. Due to privacy concerns we recommend collecting netflow samples with largest possible sampling value: 1 in 64k packets. This will be sufficient to track DDoS attacks while preserving decent privacy of single customer connections.</p></li><li><p>Developers should not roll out their own UDP protocols without careful consideration of UDP amplification problems. UPnP should be properly standardized and scrutinized.</p></li><li><p>End users are encouraged to use the script scan their network for UPnP enabled devices. Consider if these devices should be allowed to access to the internet.</p></li></ul><p>Furthermore, we prepared on online checking website. Click if you want to know if your public IP address has a vulnerable SSDP service:</p><ul><li><p><a href=\"https://badupnp.benjojo.co.uk/\">https://badupnp.benjojo.co.uk/</a></p></li></ul><p>Sadly, the most unprotected routers we saw in the described attack were from China, Russia and Argentina, places not historically known for the most agile internet service providers.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"summary\">Summary</h3>\n            <a href=\"#summary\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Cloudflare customers are fully protected from SSDP and other L3 amplification attacks. These attacks are nicely deflected by <a href=\"/how-cloudflares-architecture-allows-us-to-scale-to-stop-the-largest-attacks/\">Cloudflare anycast</a> infrastructure and require no special action. Unfortunately the raising of SSDP attack sizes might be a tough problem for other Internet citizens. We should encourage our ISPs to stop IP spoofing within their network, support BGP flowspec and configure in netflow collection.</p><p><i>This article is a joint work of Marek Majkowski and Ben Cartwright-Cox.</i></p><p>Dealing with large attacks sounds like fun? <a href=\"https://boards.greenhouse.io/cloudflare/jobs/589572\">Join our world famous DDoS team</a> in London, Austin, San Francisco and our elite office in Warsaw, Poland.</p>",
		"id": "6OxWqi0a4sgrgeYF9Q7Yy",
		"localeList": {
			"name": "Stupidly Simple DDoS Protocol (SSDP) generates 100 Gbps DDoS Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2017-06-28T16:45:49.000+01:00",
		"slug": "ssdp-100gbps",
		"tags": [
			{
				"id": "64g1G2mvZyb6PjJsisO09T",
				"name": "DDoS",
				"slug": "ddos"
			},
			{
				"id": "6QVJOBzgKXUO9xAPEpqxvK",
				"name": "Reliability",
				"slug": "reliability"
			},
			{
				"id": "6lhzEBz2B56RKa4nUEAGYJ",
				"name": "Programming",
				"slug": "programming"
			},
			{
				"id": "6Mp7ouACN2rT3YjL1xaXJx",
				"name": "Security",
				"slug": "security"
			},
			{
				"id": "5kIxDMJCg3PXQxVINDL0Cw",
				"name": "Attacks",
				"slug": "attacks"
			}
		],
		"title": "Stupidly Simple DDoS Protocol (SSDP) generates 100 Gbps DDoS",
		"updated_at": "2024-10-10T00:33:58.509Z",
		"url": "https://blog.cloudflare.com/ssdp-100gbps"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.icon_aria_label": "Search",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"search.result_stat_empty": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong>",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"search.autocomplete_title": "Insert a query. Press enter to send",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}