<div class="mb2 gray5">5 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image3-1.png" class="kg-image" alt="Workers AI Update: Stable Diffusion, Code Llama + Workers AI in 100 cities" loading="lazy" width="1999" height="1125"></figure>
	<p>Thanksgiving might be a US holiday (and one of our favorites — we have many things to be thankful for!). Many people get excited about the food or deals, but for me as a developer, it’s also always been a nice quiet holiday to hack around and play with new tech. So in that spirit, we're thrilled to announce that <strong>Stable Diffusion</strong> and <strong>Code Llama</strong> are now available as part of Workers AI, running in over 100 cities across Cloudflare’s global network.</p>
	<p>As many AI fans are aware, Stable Diffusion is the groundbreaking image-generation model that can conjure images based on text input. Code Llama is a powerful language model optimized for generating programming code.</p>
	<p>For more of the fun details, read on, or head over to the<a href="https://developers.cloudflare.com/workers-ai/models" target="_blank"> developer docs</a> to get started!</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2023/11/image2-3.png" class="kg-image" alt="" loading="lazy" width="1024" height="1024">
		<figcaption><em>Generated by Stable Diffusion - “Happy llama in an orange cloud celebrating thanksgiving”</em></figcaption>
	</figure>
	<h3 id="generating-images-with-stable-diffusion">Generating images with Stable Diffusion</h3>
	<p>Stability AI launched Stable Diffusion XL 1.0 (SDXL) this past summer. You can read more about it <a href="https://stability.ai/news/stable-diffusion-public-release" target="_blank">here</a>, but we’ll briefly mention some really cool aspects.</p>
	<p>First off, “Distinct images can be prompted without having any particular ‘feel’ imparted by the model, ensuring absolute freedom of style”. This is great as it gives you a blank canvas as a developer, or should I say artist.</p>
	<p>Additionally, it’s “particularly well-tuned for vibrant and accurate colors, with better contrast, lighting, and shadows than its predecessor, all in native 1024x1024 resolution.” With the advancements in today's cameras (or phone cameras), quality images are table stakes, and it’s nice to see these models keeping up.</p>
	<p>Getting started with Workers AI + SDXL (via <a href="https://developers.cloudflare.com/workers-ai/models/text-to-image" target="_blank">API</a>) couldn’t be easier. Check out the example below:</p><!--kg-card-begin: markdown-->
	<pre><code>curl -X POST \
"https://api.cloudflare.com/client/v4/accounts/{account-id}/ai/run/@cf/stabilityai/stable-diffusion-xl-base-1.0" \
-H "Authorization: Bearer {api-token}" \
-H "Content-Type:application/json" \
-d '{ "prompt": "A happy llama running through an orange cloud" }' \
-o 'happy-llama.png'
</code></pre>
	<!--kg-card-end: markdown-->
	<p>And here is our happy llama:</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image1-9.png" class="kg-image" alt="" loading="lazy" width="1024" height="1024"></figure>
	<p>You can also do this in a <a href="https://developers.cloudflare.com/workers-ai/models/text-to-image" target="_blank">Worker</a>:</p><!--kg-card-begin: markdown-->
	<pre><code class="language-JavaScript">import { Ai } from '@cloudflare/ai';
export default {
  async fetch(request, env) {
    const ai = new Ai(env.AI);
    const response = await ai.run('@cf/stabilityai/stable-diffusion-xl-base-1.0', {
      prompt: 'A happy llama running through an orange cloud'
    });
    return new Response(response, {
      headers: {
          "content-type": "image/png",
      },
  });
  }
}
</code></pre>
	<!--kg-card-end: markdown-->
	<h3 id="generate-code-with-code-llama">Generate code with Code Llama</h3>
	<p>If you’re not into generating art, then maybe you can have some fun with code. Code Llama, which was also released this last summer by Meta, is built on top of Llama 2, but optimized to understand and generate code in many popular languages (Python, C++, Java, PHP, Typescript / Javascript, C#, and Bash).</p>
	<p>You can use it to help you generate code for a tough problem you're faced with, or you can also use it to help you understand code — perfect if you are picking up an existing, unknown codebase.</p>
	<p>And just like all the other models, generating code with Workers AI is really easy.</p>
	<p>From a Worker:</p><!--kg-card-begin: markdown-->
	<pre><code class="language-JavaScript">import { Ai } from '@cloudflare/ai';

// Enable env.AI for your worker by adding the ai binding to your wrangler.toml file:
// [ai]
// binding = "AI"

export default {
  async fetch(request, env) {
    const ai = new Ai(env.AI);
    const response = await ai.run('@hf/thebloke/codellama-7b-instruct-awq', {
      prompt: 'In JavaScript, define a priority queue class. The constructor must take a function that is called on each object to determine its priority.'
    });
    return Response.json(response);
  }
}
</code></pre>
	<!--kg-card-end: markdown-->
	<p>Using curl:</p><!--kg-card-begin: markdown-->
	<pre><code class="language-curl">curl -X POST \
"https://api.cloudflare.com/client/v4/accounts/{account-id}/ai/run/@hf/thebloke/codellama-7b-instruct-awq" \

-H "Authorization: Bearer {api-token}" \-H "Content-Type: application/json" \
-d '{ "prompt": "In JavaScript, define a priority queue class. The constructor must take a function that is called on each object to determine its priority." }
</code></pre>
	<!--kg-card-end: markdown-->
	<p>Using python:</p><!--kg-card-begin: markdown-->
	<pre><code class="language-python">#!/usr/bin/env python3

import json
import os
import requests

ACCOUNT_ID=os.environ["ACCOUNT_ID"]
API_TOKEN=os.environ["API_TOKEN"]
MODEL="@hf/thebloke/codellama-7b-instruct-awq"

prompt="""In JavaScript, define a priority queue class. The constructor must take a function that is called on each object to determine its priority."""
url = f"https://api.cloudflare.com/client/v4/accounts/{ACCOUNT_ID}/ai/run/{MODEL}"
headers = {
  "Authorization": f"Bearer {API_TOKEN}"
}
payload = json.dumps({
  "prompt": prompt
})

print(url)
r = requests.post(url, data=payload, headers=headers)

j = r.json()
if "result" in j and "response" in j["result"]:
   print(r.json()["result"]["response"])
else:
   print(json.dumps(j, indent=2))
</code></pre>
	<!--kg-card-end: markdown-->
	<h3 id="workers-ai-inference-now-available-in-100-cities">Workers AI inference now available in 100 cities</h3>
	<p>When we <a href="https://blog.cloudflare.com/workers-ai">first released Workers AI</a> back in September we launched with inference running in seven cities, but set an ambitious target to support Workers AI inference in 100 cities by the end of the year, and nearly everywhere by the end of 2024. We’re proud to say that we’re ahead of schedule and now support Workers AI Inference in 100 cities thanks to some awesome, hard-working folks across multiple teams. For developers this means that your inference tasks are more likely to run near your users, and it will only continue to improve over the next 18 months.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image4-1.png" class="kg-image" alt="" loading="lazy" width="1801" height="1013"></figure>
	<h3 id="mistral-in-case-you-missed-it">Mistral, in case you missed it</h3>
	<p>Lastly, in case you didn’t see our other update earlier this week, we also launched Mistral 7B, a super capable and powerful language model that packs a punch for its size. You can read more about it <a href="https://blog.cloudflare.com/workers-ai-update-hello-mistral-7b">here</a>, or start building with it <a href="https://developers.cloudflare.com/workers-ai/models/text-generation" target="_blank">here</a>.</p>
	<h3 id="go-forth-and-build-something-fun">Go forth and build something fun</h3>
	<p>Today we gave you images (art), code, and Workers AI inference running in more cities. Please go have fun, build something cool, and if you need help, want to give feedback, or want to share what you’re building just pop into our <a href="https://discord.com/invite/cloudflaredev" target="_blank">Developer Discord</a>!</p>
	<h3 id="happy-thanksgiving">Happy Thanksgiving!</h3>
	<p>Additionally, if you’re just getting started with AI, we’ll be offering a series of developer workshops ranging from understanding the basics such as embeddings, models and vector databases, getting started with LLMs on Workers AI and more. We encourage you to <a href="https://www.cloudflare.com/lp/ai-developer-workshop" target="_blank">sign up here</a>.</p>
</div>