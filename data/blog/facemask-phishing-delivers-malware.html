<div class="mb2 gray5">6 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6gx59q419IL9wdYCDOy0CN/67c73283955865ec3948d520f29a2dad/facemask-phishing-delivers-malware.png" alt="">
<div class="post-content lh-copy gray1">
	<p><i>This blog originally appeared in August 2020 on the Area 1 Security website, and was issued in advance of Cloudflare's acquisition of Area 1 Security on April 1, 2022. </i><a href="https://blog.cloudflare.com/why-we-are-acquiring-area-1"><i>Learn more</i></a><i>.</i></p>
	<p>It’s no surprise that the world is currently facing a major shortage of the now-iconic blue surgical mask. Once only seen in hospitals and medical dramas, these masks are now the hottest selling streetwear. New state regulations now have businesses saying, “No Shirt, No Shoes, No Mask, No Service.” The incredible demand has led opportunistic businesses to get into the import/export of this vital article.</p>
	<p>Recent phishing campaigns are also capitalizing on this trend by sending email attachments infected with <a href="https://www.aha.org/standardsguidelines/2020-06-16-hc3-sector-note-tlp-white-remote-access-trojan-agent-tesla-targets">Agent Tesla malware</a>, an advanced Remote Access Trojan (RAT), to various companies under the guise of a mask production business venture. Area 1 Security caught these attacks filled with enticing traps that bypass legacy vendors and would have otherwise made their way into users’ inboxes.</p>
	<div class="flex anchor relative">
		<h3 id="face-mask-and-forehead-thermometer-phishing">Face Mask and Forehead Thermometer Phishing</h3>
		<a href="https://blog.cloudflare.com/#face-mask-and-forehead-thermometer-phishing" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>A prevalent phishing campaign loaded with a malicious executable is attempting to wreak havoc on companies worldwide, spanning numerous industry verticals. This campaign began as early as May, during the start of major lockdowns and mask shortages across the globe due to the COVID-19 pandemic. There have been numerous iterations of the campaign, but the main body of text remains the same.</p>
	<p>The attacker lures targets by using language that preys on fears surrounding COVID-19 and claiming to offer face masks and forehead thermometers, products currently in high demand but short supply. To avoid detection, the phishing campaign generally follows a 10-day cycle wherein the threat actor slightly modifies their Tactics, Techniques, and Procedures (TTPs) before launching a new wave of emails. A recent phishing message from this campaign can be found below.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2bBDzRT9eirJr0ZQC3SyfZ/77c6396e6abefae34b3681415be7fafd/image4-8.png" alt="" class="kg-image" width="1918" height="1338" loading="lazy">

	</figure>
	<p>Transchem Inc. is not associated in any way with this attack</p>
	<p>The attacker spoofs chemical manufacturers and import/export businesses to make the phishing message appear more legitimate. Area 1 Security’s research shows that the attacker continually revises their phishing messages by periodically spoofing different companies in an effort to evade detection. For the example phish above, the attacker spoofed Transchem Inc., a legitimate chemical supplier. With previously spoofed companies, the attacker included the real email address of the purported sender in the signature block; however, in this latest campaign, they remove it to reduce the chances of being detected.</p>
	<p>To achieve the greatest success in reaching the most inboxes, the attacker uses a dynamic approach to stay one step ahead of common email security defenses:</p>
	<ul>
		<li>
			<p>With each wave of the campaign, the attacker rotates to a new IP address in a likely attempt to bypass filters that only deny based on known sources of malicious activity;</p>
		</li>
		<li>
			<p>Furthermore, the malware in the attachment is continually modified in order to change its hash; and</p>
		</li>
		<li>
			<p>With a new hash value, the malware is effectively brand new — legacy detections that are configured to scan for known malicious hashes will not alert on this.</p>
		</li>
	</ul>
	<p>Additionally, due to flaws in the implementation and configuration of email authentication protocols, such as DMARC, SPF and DKIM, the attacker is able to successfully spoof the legitimate sender domains of numerous companies. This demonstrates that the complexity and nuances involved in setting up these protocols can leave you open to attack, and, even when implemented properly, are not enough to protect you from the dynamic phishing attacks that plague companies and individuals.</p>
	<p>After bypassing a well-known email gateway and DMARC controls, the only defense left is for the email recipient to recognize this email as a phish. However, the attacker goes to great lengths to present an authentic façade. They:</p>
	<ul>
		<li>
			<p>Impersonate real employees at various companies to fool unsuspecting targets into downloading purported information on the production of face masks and forehead thermometers;</p>
		</li>
		<li>
			<p>Include the legitimate logo of the spoofed company, as well as accurate mailing and contact details; and</p>
		</li>
		<li>
			<p>Include the URL in the email’s signature block also leading to the legitimate website of the impersonated company.</p>
		</li>
	</ul>
	<p>The attacker is clearly going the extra mile to ensure this spoof will appear as authentic as possible for unsuspecting targets.</p>
	<p>Once the email is delivered, recipients are a mere two steps away from executing the Agent Tesla RAT. The target only needs to extract the compressed attachment, then click on the resulting “PDF”, which will launch the malware.</p>
	<p>To further reduce suspicion, the attachment’s file name is manipulated to make it appear legitimate. More specifically, the attacker always names the attached file “Supplier-Face Mask Forehead Thermometer.pdf.gz”. The use of a double extension will often trick targets into thinking the file is a PDF, when in fact it’s a compressed executable. This ruse is made possible by the fact that many modern operating systems do not display the file extension (in this case “.gz”) for known extensions by default.</p>
	<p>Once downloaded, victims may only see “Supplier-Face Mask Forehead Thermometer.pdf”, which is the actual file name. To make matters worse, some legacy vendors inspect an attachment’s extension <i>rather than the file properties itself</i>, thus allowing compressed executables to bypass rule filtering that is based on file extension.</p>
	<div class="flex anchor relative">
		<h3 id="analysis-of-executable">Analysis of Executable</h3>
		<a href="https://blog.cloudflare.com/#analysis-of-executable" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>The attachment is the focal point of this face mask-themed campaign. In order to carry out its information stealing capabilities, this infected attachment requires the target to take action by unzipping and clicking on the resulting file, “Supplier-Face Mask Forehead Thermometer.pdf.exe”. If this file is opened, the victim host will be infected with Agent Tesla, a form of Malware-As-A-Service (MaaS), which provides attackers with a dashboard and user interface (UI) to monitor the success of their campaign. Agent Tesla is an advanced RAT that functions as a keylogger and information stealer, and its primary delivery method is via attachments in phishing emails.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3kmWesi4eUB1tfkRnlamWf/639dc91ded1a88a61347aa38a9fe862b/image2-14.png" alt="" class="kg-image" width="762" height="515" loading="lazy">

	</figure>
	<div class="flex anchor relative">
		<h3 id="what-is-agent-tesla">What is Agent Tesla?</h3>
		<a href="https://blog.cloudflare.com/#what-is-agent-tesla" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Although Agent Tesla first surfaced in 2014, it is making a resurgence as the preferred MaaS for attackers, superseding even TrickBot and Emotet. The main advantage of Agent Tesla is its ability to adapt and change to avoid detection, providing attackers with a stealthy platform to launch attacks and bypass security measures. Various tiers are available for purchase that provide additional licenses and different functionality. However, in typical internet fashion, there is a torrent available on Russian websites.</p>
	<p>For the initial file, the attacker uses a 32-bit Windows executable to ensure that the malware can be executed on common Windows devices. This file is a trojan, appearing as a benign application but containing hidden, malicious functionality. This initial phase determines if it is in a malware analysis environment so the program can decide whether to proceed with the attack or go to sleep.</p>
	<p>If the malware detects it is in a target’s device, it will make a connection to the attacker’s command and control (C2) server located at us2[.]smtp[.]mailhostbox[.]com. This initial connection does not contain any information; rather, it is only an attempt to provide the attacker with confirmation that the malware successfully ran on the target device.</p>
	<p>The malware contains functionality to read the data within a victim’s AppData folder, which contains browser credentials and credentials from email clients. The malware will attempt to load missing DLLs and download additional files in order to exfiltrate stolen information from the AppData folder. This data is sent to the C2 via SMTP as seen in packet capture below. This is a common tactic for exfiltration, given outgoing emails containing sensitive information are not likely to be marked as suspicious unless Data Loss Prevention (DLP) software is configured. The exfiltrated victim information is then available to the attacker via the Agent Tesla UI for use in future attacks.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1tXyxamhlhwBBgE7RYyh3K/45a0414060ee8e06f77551c39e47f7bb/image3-8.png" alt="" class="kg-image" width="1392" height="652" loading="lazy">

	</figure>
	<p>With each new wave of this phishing campaign, the malware is updated by using a number of advanced obfuscation techniques to avoid detection by antivirus software:</p>
	<ul>
		<li>
			<p>Firstly, the attacker generates a new hash for the attached file in order to circumvent defenses that leverage databases of known malware files. This is done in part by generating executables written for the .NET framework and constantly recompiling with alternative feature sets.</p>
		</li>
		<li>
			<p>Secondly, a number of anti-debugging methods are employed to halt any reverse engineering. These methods check if a debugger is present, as well as hiding threads and breakpoints from debugging tools.</p>
		</li>
	</ul>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7H7191Nj247N6yOpM0BVC6/9e8ef71059a9af8a9a25557afd542ad2/image1-11.png" alt="" class="kg-image" width="411" height="699" loading="lazy">

	</figure>
	<div class="flex anchor relative">
		<h3 id="recommendations">Recommendations</h3>
		<a href="https://blog.cloudflare.com/#recommendations" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>If you think your device may have been compromised by malware, it’s imperative to run a full scan of your system to check for signs of infection. It’s also vital to keep your software and OS secure by installing the latest updates on a routine basis in order to reduce exposure to this “Face Mask Supplier” phishing campaign.</p>
	<p><b>It is not enough to rely on email gateways, cloud email suites and traditional AV to protect against these types of attacks, as the threat actor is continually evolving and finding new ways to leverage commodity malware like Agent Tesla.</b></p>
	<p>As attackers often rely on the end user to download and install malicious executables, it is also vital that employees are aware of common tactics an attacker may use to trick targets into opening malicious files. Unsolicited emails from unknown companies should be regarded as guilty until proven otherwise and reported to the security team. Additionally, any attachments containing compressed files should be handled with extreme caution, and any executable files should not be opened. These extra verifications are just a small precaution but go a long way toward ensuring the safety and security of your organization.</p>
	<p>With each wave of the campaign, the malicious files and attacker infrastructure are altered to evade detection. Fortunately, Area 1 Security’s comprehensive protection detects and blocks Agent Tesla-based phishing attacks and other targeted campaigns before they can cause any damage.</p>
	<p>Area 1 Security‘s advanced Machine Learning and Artificial Intelligence technology allow our algorithms to uncover new tactics malicious actors are using to bypass legacy vendors and cloud email providers in real time versus waiting days or weeks for signature updates. Our time-zero detections lead the industry with reliable verdicts that stop phishing attempts at delivery time. This has many advantages over post-delivery retraction in that the user is never exposed to the attack.</p>
	<div class="flex anchor relative">
		<h3 id="indicators-of-compromise">Indicators of Compromise</h3>
		<a href="https://blog.cloudflare.com/#indicators-of-compromise" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Attachment: Supplier-Face Mask Forehead Thermometer.pdf.gz:</p>
	<p>MD5: fdfaaf9efb8507262ee9b97324bbb69a</p>
	<p>SHA1: 846da85a2f2e6e79ebc7ed84b00ed97af513c80f</p>
	<p>SHA256: b419849ce915ede72fda1ea0b566651e233ef5eaffbf8b9211bd44085407ad5e</p>
	<p>Executable: Supplier-Face Mask Forehead Thermometer.pdf.exe</p>
	<p>MD5: 64bc654373549584f7e596de24e1d8cc</p>
	<p>SHA1: 6a39bd3ddaa2c9846e2a4912a80fd718eaee622f</p>
	<p>SHA256: 53445247552485c277400bafba84458670f0c1001c91b4f0bcc15935c12d662b </p>
	<p>Command and Control Server:</p>
	<p>us2[.]smtp[.]mailhostbox[.]com</p>
	<p>Sender IP Addresses:</p>
	<p>209[.]58[.]149[.]65</p>
	<p>203[.]188[.]252[.]14</p>
	<p>185[.]66[.]40[.]36</p>
	<p>50[.]28[.]40[.]153</p>
	<p>62[.]210[.]83[.]136</p>
	<p>72[.]32[.]232[.]136</p>
	<p>95[.]216[.]16[.]146</p>
	<p>209[.]58[.]149[.]66</p>
	<p>89[.]33[.]246[.]113</p>
	<p>178[.]239[.]161[.]164</p>
	<p>156[.]96[.]47[.]65</p>
	<p>209[.]58[.]149[.]69</p>
	<p>95[.]211[.]208[.]50</p>
	<p>209[.]58[.]149[.]87</p>
	<p>37[.]48[.]85[.]232</p>
	<p>208[.]91[.]199[.]224</p>
</div>