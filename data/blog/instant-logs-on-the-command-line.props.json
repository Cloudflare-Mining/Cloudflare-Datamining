{
	"initialReadingTime": "2",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Cole MacKenzie",
				"slug": "cole",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/7zlJQTlcTghWLomyrgpKtO/f93e0e94d012a7a40bbfcc1d5661735f/cole.jpg",
				"location": null,
				"website": null,
				"twitter": "@Cole_MacKenzie",
				"facebook": null
			}
		],
		"excerpt": "Today, I am going to introduce you to Instant Logs in your terminal",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/50ZSXFLHQ06xI9GQsqOCGw/75a791e110347a077ddce05eb88634df/instant-logs-on-the-command-line.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/5x3aLlINzMShJK4anPOXaS/3a313daf86379c6647d8c1e5be42a34d/image3-10-2.png\" alt=\"Slicing and Dicing Instant Logs: Real-time Insights on the Command Line\" class=\"kg-image\" width=\"1235\" height=\"639\" loading=\"lazy\"/>\n            \n            </figure><p>During Speed Week 2021 we announced a new offering for Enterprise customers, <a href=\"/how-we-built-instant-logs/\">Instant Logs</a>. Since then, the team has not slowed down and has been working on new ways to enable our customers to consume their logs and gain powerful insights into their HTTP traffic in real time.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/4vhooHoc2Xv3yigrIOQBkW/c418fa253354e3ee57195d80a02e15f8/image1-6.png\" alt=\"Screenshot showing the Instant Logs dashboard with an expanded row showing details about a request\" class=\"kg-image\" width=\"1999\" height=\"1459\" loading=\"lazy\"/>\n            \n            </figure><p>We recognize that as developers, UIs are useful but sometimes there is the need for a more powerful alternative. Today, I am going to introduce you to Instant Logs in your terminal! In order to get started we need to install a few open-source tools to help us:</p><ul><li><p><a href=\"https://github.com/vi/websocat\">Websocat</a> - to connect to WebSockets.</p></li><li><p><a href=\"https://github.com/rcoh/angle-grinder\">Angle Grinder</a> - a utility to slice-and-dice a stream of logs on the command line.</p></li></ul><h2>Creating an Instant Log’s Session</h2><p>For enterprise zones with access to Instant Logs, you can create a new session by sending a POST request to our jobs&#39; endpoint. You will need:</p><ul><li><p>Your Zone Tag / ID</p></li><li><p>An Authentication Key or an API Token with at least the Zone Logs Read permission</p></li></ul>\n            <pre class=\"language-bash\"><code class=\"language-bash\">curl -X POST &#039;https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/logpush/edge/jobs&#039; \\\n-H &#039;X-Auth-Key: &lt;KEY&gt;&#039; \\\n-H &#039;X-Auth-Email: &lt;EMAIL&gt;&#039; \\\n-H &#039;Content-Type: application/json&#039; \\\n--data-raw &#039;{\n    &quot;fields&quot;: &quot;ClientIP,ClientRequestHost,ClientRequestMethod,ClientRequestPath,EdgeEndTimestamp,EdgeResponseBytes,EdgeResponseStatus,EdgeStartTimestamp,RayID&quot;,\n    &quot;sample&quot;: 1,\n    &quot;filter&quot;: &quot;&quot;,\n    &quot;kind&quot;: &quot;instant-logs&quot;\n}&#039;</pre></code>\n            <h3>Response</h3><p>The response will include a new field called <code>destination_conf</code>. The value of this field is your unique WebSocket address that will receive messages directly from our network!</p>\n            <pre class=\"language-json\"><code class=\"language-json\">{\n    &quot;errors&quot;: [],\n    &quot;messages&quot;: [],\n    &quot;result&quot;: {\n        &quot;id&quot;: 401,\n        &quot;fields&quot;: &quot;ClientIP,ClientRequestHost,ClientRequestMethod,ClientRequestPath,EdgeEndTimestamp,EdgeResponseBytes,EdgeResponseStatus,EdgeStartTimestamp,RayID&quot;,\n        &quot;sample&quot;: 1,\n        &quot;filter&quot;: &quot;&quot;,\n        &quot;destination_conf&quot;: &quot;wss://logs.cloudflare.com/instant-logs/ws/sessions/949f9eb846f06d8f8b7c91b186a349d2&quot;,\n        &quot;kind&quot;: &quot;instant-logs&quot;\n    },\n    &quot;success&quot;: true\n}</pre></code>\n            <h2>Connect to WebSocket</h2><p>Using a CLI utility like <a href=\"https://github.com/vi/websocat\">Websocat</a>, you can connect to the WebSocket and start immediately receiving logs of line-delimited JSON.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">websocat wss://logs.cloudflare.com/instant-logs/ws/sessions/949f9eb846f06d8f8b7c91b186a349d2\n{&quot;ClientRequestHost&quot;:&quot;example.com&quot;,&quot;ClientRequestMethod&quot;:&quot;GET&quot;,&quot;ClientRequestPath&quot;:&quot;/&quot;,&quot;EdgeEndTimestamp&quot;:&quot;2022-01-25T17:23:05Z&quot;,&quot;EdgeResponseBytes&quot;:363,&quot;EdgeResponseStatus&quot;:200,&quot;EdgeStartTimestamp&quot;:&quot;2022-01-25T17:23:05Z&quot;,&quot;RayID&quot;:&quot;6d332ff74fa45fbe&quot;,&quot;sampleInterval&quot;:1}\n{&quot;ClientRequestHost&quot;:&quot;example.com&quot;,&quot;ClientRequestMethod&quot;:&quot;GET&quot;,&quot;ClientRequestPath&quot;:&quot;/&quot;,&quot;EdgeEndTimestamp&quot;:&quot;2022-01-25T17:23:06Z&quot;,&quot;EdgeResponseBytes&quot;:363,&quot;EdgeResponseStatus&quot;:200,&quot;EdgeStartTimestamp&quot;:&quot;2022-01-25T17:23:06Z&quot;,&quot;RayID&quot;:&quot;6d332fffe9c4fc81&quot;,&quot;sampleInterval&quot;:1}</pre></code>\n            <h2>The Scenario</h2><p>Now that you are able to create a new Instant Logs session let’s give it a purpose! Say you just recently deployed a new firewall rule blocking users from downloading a specific asset that is only available to users in Canada. For the purpose of this example, the asset is available at the path <code>/canadians-only</code>.</p><h3>Specifying Fields</h3><p>In order to see what firewall actions (if any) were taken, we need to make sure that we include <code>ClientRequestCountry</code>, <code>​​FirewallMatchesActions</code> and <code>FirewallMatchesRuleIDs</code> fields when creating our session.</p><p>Additionally, any field available in our HTTP request dataset is usable by Instant Logs. You can view the entire list of HTTP Request fields <a href=\"https://developers.cloudflare.com/logs/reference/log-fields/zone/http_requests\">on our developer docs</a>.</p><h3>Choosing a Sample Rate</h3><p>Instant Logs users also have the ability to choose a sample rate. The <code>sample</code> parameter is the inverse probability of selecting a log. This means that <code>&quot;sample&quot;: 1</code> is 100% of records, <code>&quot;sample&quot;: 10</code> is 10% and so on.</p><p>Going back to our example of validating that our newly deployed firewall rule is working as expected, in this case, we are choosing not to sample the data by setting <code>&quot;sample&quot;: 1</code>.</p><p>Please note that Instant Logs has a maximum data rate supported. For high volume domains, we sample server side as indicated in the &quot;sampleInterval&quot; parameter returned in the logs. For example, &quot;sampleInterval&quot;: 10 indicates this log message is just one out of 10 logs received.</p><h3>Defining the Filters</h3><p>Since we are only interested in requests with the path of <code>/canadians-only</code>, we can use filters to remove any logs that do not match that specific path. The filters consist of three parts: <code>key</code>, <code>operator</code> and <code>value</code>. The <code>key</code> can be any field specified in the <code>&quot;fields&quot;: &quot;&quot;</code> list when creating the session. The complete list of supported operators can be found on our <a href=\"https://developers.cloudflare.com/logs/instant-logs\">Instant Logs documentation</a>.</p><p>To only get the logs of requests destined to <code>/canadians-only</code>, we can specify the following filter:</p>\n            <pre class=\"language-json\"><code class=\"language-json\">{\n  &quot;filter&quot;: &quot;{\\&quot;where\\&quot;:{\\&quot;and\\&quot;:[{\\&quot;key\\&quot;:\\&quot;ClientRequestPath\\&quot;,\\&quot;operator\\&quot;:\\&quot;eq\\&quot;,\\&quot;value\\&quot;:\\&quot;/canadians-only\\&quot;}]}}&quot;\n}</pre></code>\n            <h2>Creating an Instant Logs Session: Canadians Only</h2><p>Using the information above, we can now craft the request for our custom Instant Logs session.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">curl -X POST &#039;https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/logpush/edge/jobs&#039; \\\n-H &#039;X-Auth-Key: &lt;KEY&gt;&#039; \\\n-H &#039;X-Auth-Email: &lt;EMAIL&gt;&#039; \\\n-H &#039;Content-Type: application/json&#039; \\\n--data-raw &#039;{\n  &quot;fields&quot;: &quot;ClientIP,ClientRequestHost,ClientRequestMethod,ClientRequestPath,ClientCountry,EdgeEndTimestamp,EdgeResponseBytes,EdgeResponseStatus,EdgeStartTimestamp,RayID,FirewallMatchesActions,FirewallMatchesRuleIDs&quot;,\n  &quot;sample&quot;: 1,\n  &quot;kind&quot;: &quot;instant-logs&quot;,\n  &quot;filter&quot;: &quot;{\\&quot;where\\&quot;:{\\&quot;and\\&quot;:[{\\&quot;key\\&quot;:\\&quot;ClientRequestPath\\&quot;,\\&quot;operator\\&quot;:\\&quot;eq\\&quot;,\\&quot;value\\&quot;:\\&quot;/canadians-only\\&quot;}]}}&quot;\n}&#039;</pre></code>\n            <h3>Angle Grinder</h3><p>Now that we have a connection to our WebSocket and are receiving logs that match the request path <code>/canadians-only</code>, we can start slicing and dicing the logs to see that the rule is working as expected. A handy tool to use for this is <a href=\"https://github.com/rcoh/angle-grinder\">Angle Grinder</a>. Angle Grinder lets you apply filtering, transformations and aggregations on stdin with first class JSON support. For example, to get the number of visitors from each country we can sum the number of events by the <code>ClientCountry</code> field.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">websocat wss://logs.cloudflare.com/instant-logs/ws/sessions/949f9eb846f06d8f8b7c91b186a349d2 | agrind &#039;* | json | sum(sampleInterval) by ClientCountry&#039;\nClientCountry    \t_sum\n---------------------------------\npt               \t4\nfr               \t3\nus               \t3</pre></code>\n            <p>Using Angle Grinder, we can create a query to count the firewall actions by each country.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">websocat wss://logs.cloudflare.com/instant-logs/ws/sessions/949f9eb846f06d8f8b7c91b186a349d2 |  agrind &#039;* | json | sum(sampleInterval) by ClientCountry,FirewallMatchesActions&#039;\nClientCountry        FirewallMatchesActions        _sum\n---------------------------------------------------------------\nca                   []                            5\nus                   [block]                       1</pre></code>\n            <p>Looks like our newly deployed firewall rule is working :)</p><p>Happy Logging!</p>",
		"id": "5upQVQrIIaXHco5X9VKRGb",
		"localeList": {
			"name": "Slicing and Dicing Instant Logs: Real-time Insights on the Command Line Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "Today, I am going to introduce you to Instant Logs in your terminal.",
		"metadata": {
			"title": "Slicing and Dicing Instant Logs: Real-time Insights on the Command Line",
			"description": "Today, I am going to introduce you to Instant Logs in your terminal.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/2KL8tmGD2XcFQTQmIqqE2x/f39b8b18c8104dcb79a51f3b20c05a2d/instant-logs-on-the-command-line-e8uWou.png"
		},
		"primary_author": {},
		"published_at": "2022-02-07T17:04:28.000+00:00",
		"slug": "instant-logs-on-the-command-line",
		"tags": [
			{
				"id": "4YYee7nj2IYM3qb1AjguFP",
				"name": "CLI",
				"slug": "cli"
			},
			{
				"id": "4fkY3bvsgn5JfTgXxTZHIR",
				"name": "Logs",
				"slug": "logs"
			}
		],
		"title": "Slicing and Dicing Instant Logs: Real-time Insights on the Command Line",
		"updated_at": "2024-08-27T01:36:50.990Z",
		"url": "https://blog.cloudflare.com/instant-logs-on-the-command-line"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}