<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2019/10/DoT-DoH@2x.png" class="kg-image"></figure>
	<p>El sistema de nombres de dominio (DNS) es la libreta de direcciones de Internet. Cuando visitas cloudflare.com o cualquier otro sitio, tu navegador le solicitará a un resolutor de DNS la dirección IP para encontrar el sitio web. Lamentablemente, estas consultas y respuestas de DNS suelen estar desprotegidas. El cifrado de DNS mejoraría la privacidad y la seguridad del usuario. En esta publicación, analizaremos dos mecanismos para el cifrado de DNS: DNS mediante TLS (DoT) y DNS mediante HTTPS (DoH), y explicaremos cómo funcionan.</p>
	<p>Las aplicaciones que desean resolver un nombre de dominio en una dirección IP suelen usar DNS. Esto, por lo general, no lo hace de manera explícita el programador que escribió la aplicación. El programador escribe algo como acceder a ("https://example.com/news") y espera que una biblioteca de software se encargue de la traducción de “example.com” a una dirección IP.</p>
	<p>En segundo plano, la biblioteca de software debe descubrir el <a href="https://www.cloudflare.com/learning/dns/what-is-dns/" target="_blank">resolutor de DNS recurrente</a> externo, conectarse a este y leer el protocolo de DNS (consulta la figura siguiente) para resolver el nombre solicitado por la aplicación. La elección del resolutor de DNS externo y si se proporciona privacidad y seguridad es ajena al control de la aplicación. Depende de la biblioteca de software que se usa y de las políticas del sistema operativo del dispositivo que ejecuta el software.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2019/10/DNS-flow-diagram.png" class="kg-image">
		<figcaption>Descripción de la consulta y la respuesta de DNS</figcaption>
	</figure>
	<h2 id="resolutor-de-dns-externo"><strong>Resolutor de DNS externo</strong></h2>
	<p>El sistema operativo, por lo general, aprende la dirección del resolutor de la red local mediante el protocolo de configuración dinámica de host (DHCP). En las redes domésticas y móviles, por lo general, se suele usar el resolutor del proveedor del servicios de Internet (ISP). En las redes corporativas, el resolutor seleccionado suele ser controlado por el administrador de red. Si lo desean, los usuarios con control de sus dispositivos pueden anular el resolutor con una dirección específica, como la dirección de un resolutor público como 8.8.8.8 de Google o <a href="https://blog.cloudflare.com/dns-resolver-1-1-1-1/">1.1.1.1 de Cloudflare</a>, pero la mayoría de los usuarios probablemente no se molesten en cambiarlo cuando se conectan a un punto de acceso de wifi público en una cafetería o en un aeropuerto.</p>
	<p>La elección del resolutor externo afecta de manera directa la experiencia del usuario final. La mayoría de los usuarios no cambia la configuración del resolutor y probablemente use el resolutor de DNS de su proveedor de red. La propiedad visible más obvia es la velocidad y precisión de la resolución de nombres. Es posible que las características que mejoran la privacidad o la seguridad no sean visibles de inmediato, pero ayudarán a evitar que otros generen perfiles o interfieran con tu actividad de navegación. Esto resulta especialmente importante en las redes wifi públicas donde cualquier persona que se encuentre físicamente próxima puede capturar y descifrar el tráfico de la red inalámbrica.</p>
	<h2 id="dns-no-cifrado"><strong>DNS no cifrado</strong></h2>
	<p>Desde que se creó el DNS en 1987, ha estado durante mucho tiempo sin cifrar. Cualquiera entre tu dispositivo y el resolutor puede espiar, o incluso modificar, tus consultas y respuestas de DNS. Esto incluye a cualquier persona de tu red wifi local, tu proveedor de servicios de Internet (ISP) y los proveedores de tránsito. Esto puede afectar tu privacidad, ya que puede revelar los nombres de dominio que estás visitando.</p>
	<p>¿Qué pueden ver las demás personas? Bien, considera esta captura de paquetes de red tomada de una computadora portátil conectada a una red doméstica:</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2019/10/dns-at-home-marked.png" class="kg-image"></figure>
	<p>Se pueden plantear las siguientes observaciones:</p>
	<ul>
		<li>El puerto de origen UDP es 53, que es el número de puerto estándar para DNS sin cifrar. Por lo tanto, es probable que la carga útil UDP sea una respuesta de DNS.</li>
		<li>Esto sugiere que la dirección IP de origen 192.168.2.254 es un resolutor de DNS, mientras que la IP de destino 192.168.2.14 es el cliente DNS.</li>
		<li>La carga útil UDP se podría analizar como una respuesta de DNS, y revela que el usuario estaba tratando de visitar twitter.com.</li>
		<li>Si se establecen conexiones futuras a 104.244.42.129 o 104.244.42.1, lo más probable es que sea tráfico que se dirija a “twitter.com”.</li>
		<li>Si hay tráfico HTTPS con cifrado adicional a esta IP, realizado correctamente por más consultas de DNS, esto podría indicar que un navegador web cargó recursos adicionales desde esa página. Eso podría revelar las páginas que un usuario estaba mirando durante su visita a twitter.com.</li>
	</ul>
	<p>Como los mensajes de DNS no están protegidos, es posible que haya otros ataques:</p>
	<ul>
		<li>Las consultas se pueden dirigir a un resolutor que lleve a cabo un <a href="https://en.wikipedia.org/wiki/DNS_hijacking" target="_blank">secuestro de DNS</a>. Por ejemplo, en el Reino Unido, Virgin Media y <a href="https://bt.custhelp.com/app/answers/detail/a_id/14244/c/402" target="_blank">BT</a> devuelven una respuesta falsa para dominios que no existen, y redireccionan a los usuarios a una página de búsqueda. Esta redirección es posible porque la computadorar/el teléfono confía ciegamente en el resolutor de DNS que el enrutador de puerta de enlace proporcionado por el ISP anunció mediante el protocolo de configuración dinámica de host (DHCP).</li>
		<li>Los firewalls pueden interceptar, bloquear o modificar con facilidad cualquier tráfico de DNS sin cifrar solo en función del número de puerto. Vale la pena señalar que la inspección de texto sin formato no es una solución mágica para lograr la visibilidad, ya que el resolutor de DNS se puede omitir.</li>
	</ul>
	<h2 id="cifrado-de-dns"><strong>Cifrado de DNS</strong></h2>
	<p>El cifrado de DNS hace que sea más difícil espiar tus mensajes de DNS, o que sufran adulteraciones mientras están en tránsito. Al igual que la web evolucionó del HTTP sin cifrado al HTTPS cifrado, ahora existen actualizaciones para protocolo de DNS que cifran el DNS. El cifrado de la web posibilitó el crecimiento de las comunicaciones y el comercio privados y seguros. El cifrado de DNS mejorará aún más la privacidad del usuario.</p>
	<p>Existen dos mecanismos estandarizados para garantizar el traslado de DNS entre tú y el resolutor, <a href="https://tools.ietf.org/html/rfc7858" target="_blank">DNS mediante TLS (2016)</a> y <a href="https://tools.ietf.org/html/rfc8484" target="_blank">consultas de DNS mediante HTTPS (2018)</a>. Ambos se basan en la seguridad de la capa de transporte (TLS) que también se utiliza para proteger la comunicación entre tú y un sitio web mediante HTTPS. En TLS, el servidor (ya sea un servidor web o un resolutor de DNS) se autentica de manera automática al cliente (tu dispositivo) mediante un certificado. Esto garantiza que ninguna otra parte pueda hacerse pasar por el servidor (el resolutor).</p>
	<p>Con DNS mediante TLS (DoT), el mensaje DNS original se integra directamente en el canal TLS seguro. Desde el exterior, uno no puede conocer el nombre que se consultaba ni modificarlo. La solicitud del cliente podrá descifrar TLS, y se ve de la siguiente manera:</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2019/10/dns-over-tls13-marked.png" class="kg-image"></figure>
	<p>En el seguimiento de paquetes para DNS sin cifrar, está claro que un cliente puede enviar directamente una solicitud de DNS, y que a esta le sigue una respuesta de DNS del resolutor. Sin embargo, en el caso de DoT cifrado, algunos mensajes del protocolo de enlace TLS se intercambian antes de enviar mensajes DNS cifrados:</p>
	<ul>
		<li>El cliente envía un mensaje <em>Client Hello</em>, anunciando su compatibilidad con TLS.</li>
		<li>El servidor responde con un mensaje<em> Server Hello</em>, aceptando los parámetros TLS que se utilizarán para proteger la conexión. El mensaje del certificado contiene la identidad del servidor, mientras que el mensaje de verificación de certificado contendrá una firma digital que el cliente puede verificar mediante el certificado del servidor. Por lo general, el cliente controla este certificado con su lista local de entidades de certificación de confianza, pero la especificación DoT menciona <a href="https://tools.ietf.org/html/rfc7858#section-3.2" target="_blank">mecanismos de confianza alternativos</a> como la asignación de claves públicas.</li>
		<li>Una vez que finaliza el protocolo de enlace TLS, el cliente y el servidor pueden comenzar a intercambiar mensajes cifrados.</li>
		<li>Si bien la imagen anterior contiene una consulta y una respuesta de DNS, en la práctica la conexión TLS segura permanecerá abierta y se reutilizará para futuras consultas de DNS.</li>
	</ul>
	<p>La protección de protocolos no cifrados mediante la imposición de TLS en la parte superior de un puerto nuevo se ha hecho antes:</p>
	<ul>
		<li>Tráfico web: HTTP (tcp/80) -&gt; HTTPS (tcp/443)</li>
		<li>Envío de correo electrónico: SMTP (tcp/25) -&gt; SMTPS (tcp/465)</li>
		<li>Recepción de correo electrónico: IMAP (tcp/143) -&gt; IMAPS (tcp/993)</li>
		<li>Ahora: DNS (tcp/53 o udp/53) -&gt; DoT (tcp/853)</li>
	</ul>
	<p>Un problema con la introducción de un puerto nuevo es que los firewalls actuales pueden bloquearlo. Ya sea porque aplican una lista blanca donde los nuevos servicios tienen que habilitarse de manera explícita, o una lista de bloqueo donde un administrador de red bloquea un servicio de manera explícita. Si es menos probable que esté disponible la opción segura (DoT) que la opción insegura, los usuarios y las aplicaciones podrían verse tentados a hacer una reversión al DNS sin cifrar. Esto posteriormente podría permitir que los atacantes fuercen a los usuarios a usar una versión insegura.</p>
	<p>Estos ataques de reversión no son algo teórico. Previamente se ha utilizado la <a href="https://blog.cloudflare.com/performing-preventing-ssl-stripping-a-plain-english-primer/">eliminación de SSL</a> para generar cambios de los sitios web HTTPS a HTTP, lo que permite a los atacantes robar contraseñas o secuestrar cuentas.</p>
	<p>Se <a href="https://tools.ietf.org/html/rfc8484#section-1" target="_blank">diseñó</a> otro enfoque, las consultas DNS mediante HTTPS (DoH), para admitir dos ejemplos de uso principales:</p>
	<ul>
		<li>Evitar el problema mencionado anteriormente donde los dispositivos en la ruta de acceso interfieren con el DNS. Esto incluye el problema de bloqueo de puertos anterior.</li>
		<li>Habilitar las aplicaciones web para acceder a DNS a través de las API del navegador existentes.<br>El DoH es esencialmente el HTTPS, el mismo estándar cifrado que utiliza la web, y reutiliza el mismo número de puerto (tcp/443). Los navegadores web ya han <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" target="_blank">dejado de usar los HTTP no seguros</a> y ahora usan HTTPS. Esto hace que HTTPS sea una excelente opción para transportar mensajes de DNS de forma segura. Puedes encontrar <a href="https://tools.ietf.org/html/rfc8484#section-4.1.1" target="_blank">aquí</a> un ejemplo de esta solicitud de DoH.</li>
	</ul>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2019/10/DoH-flow-diagram.png" class="kg-image">
		<figcaption>DoH: Consulta y respuesta de DNS transportadas a través de una secuencia de HTTPS segura</figcaption>
	</figure>
	<p>A algunos usuarios les preocupa que el uso de HTTPS pueda comprometer la privacidad debido al uso potencial de cookies con fines de seguimiento. Los diseñadores del protocolo DoH <a href="https://tools.ietf.org/html/rfc8484#section-8" target="_blank">consideraron</a> varios aspectos de privacidad y desaconsejaron de manera explícita el uso de cookies HTTP para evitar el seguimiento, recomendación que es muy respetada. La reanudación de la sesión TLS mejora el rendimiento del protocolo de enlace TLS 1.2, pero se podría llegar a usar para correlacionar conexiones TLS. Afortunadamente, el uso de TLS 1.3 evita la necesidad de reanudar la sesión TLS, ya que reduce de manera predeterminada la cantidad de recorridos de ida y vuelta, lo que permite abordar de manera eficaz la preocupación relacionada con la privacidad.</p>
	<p>El uso de HTTPS significa que las mejoras del protocolo HTTP también pueden resultar beneficiosas para DoH. Por ejemplo, el <a href="https://blog.cloudflare.com/http3-the-past-present-and-future/">protocolo HTTP/3</a> en desarrollo, construido sobre <a href="https://blog.cloudflare.com/the-road-to-quic/">QUIC</a>, podría ofrecer mejoras adicionales en el rendimiento ante la pérdida de paquetes por la falta de bloqueo en el encabezado de línea. Esto significa que se podrían enviar varias consultas de DNS de manera simultánea por el canal seguro sin bloquearse entre sí cuando se pierde un paquete.</p>
	<p>También hay un <a href="https://tools.ietf.org/html/draft-huitema-quic-dnsoquic" target="_blank">borrador</a> para DNS a través de QUIC (DNS/QUIC), y es similar a DoT, pero sin el problema de bloqueo en el encabezado de línea debido al uso de QUIC. Sin embargo, tanto HTTP/3 como DNS/QUIC requieren un puerto UDP accesible. En teoría, ambos podrían hacer una reversión a DoH mediante HTTP/2 y DoT respectivamente.</p>
	<h2 id="implementaci-n-de-dot-y-doh"><strong>Implementación de DoT y DoH</strong></h2>
	<p>Como DoT y DoH son relativamente nuevos, todavía no se implementan de manera universal. Por el lado del servidor, los principales resolutores públicos, como 1.1.1.1 de Cloudflare, y DNS de Google los admiten. Sin embargo, muchos resolutores de ISP aún no los admiten. Puedes encontrar una breve lista de resolutores públicos que admiten DoH en <a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/DNS-server-sources" target="_blank">Orígenes de servidor DNS</a>, y otra lista de resolutores públicos que admiten DoT y DoH en <a href="https://dnsprivacy.org/wiki/display/DP/DNS+Privacy+Public+Resolvers" target="_blank">Resolutores públicos de privacidad de DNS</a></p>
	<p>Existen dos métodos para habilitar el DoT o el DoH en los dispositivos del usuario final:</p>
	<ul>
		<li>Permite mayor compatibilidad con las aplicaciones, al omitir el servicio de resolución del sistema operativo.</li>
		<li>Permite mayor compatibilidad con el sistema operativo, al brindar soporte a las aplicaciones de manera transparente.</li>
	</ul>
	<p>Por lo general, existen tres modos de configuración para el DoT o el DoH del lado del cliente:</p>
	<ul>
		<li>Desactivado: DNS no se cifrará.</li>
		<li>Modo oportunista: trata de utilizar un transporte seguro para DNS, pero haz una reversión a DNS sin cifrar si el anterior no está disponible. Este modo es vulnerable a los ataques que generan cambios a versiones anteriores donde un atacante puede forzar a un dispositivo a usar DNS sin cifrar. Su objetivo es ofrecer privacidad cuando no hay atacantes activos en la ruta.</li>
		<li>Modo estricto: intenta usar DNS mediante transporte seguro. Si no está disponible, se genera una falla y el usuario visualiza un mensaje de error.</li>
	</ul>
	<p>Estado actual de la configuración de DNS para todo el sistema mediante transporte seguro:</p>
	<ul>
		<li>Android 9: <a href="https://android-developers.googleblog.com/2018/04/dns-over-tls-support-in-android-p.html" target="_blank">es compatible con</a> DoT mediante su función “Private DNS” (DNS privado). Modos:</li>
		<li>El modo oportunista (“Automático”) se utiliza de forma predeterminada. Se utilizará el resolutor de las configuraciones de red (habitualmente DHCP).</li>
		<li>El modo estricto se puede <a href="https://blog.cloudflare.com/enable-private-dns-with-1-1-1-1-on-android-9-pie/">configurar</a> al establecer un nombre de host explícito. No se permite ninguna dirección IP, el nombre de host se resuelve mediante el resolutor predeterminado y también se utiliza para validar el certificado. (<a href="https://github.com/aosp-mirror/platform_frameworks_base/commit/a24d459a5d60c706472f9b620d079cd0a40a7279" target="_blank">Código fuente relevante</a>)</li>
		<li>Los usuarios de iOS y Android también pueden instalar la <a href="https://1.1.1.1/" target="_blank">aplicación 1.1.1.1</a> para habilitar la compatibilidad con DoH o DoT en modo estricto. Internamente, utiliza las interfaces de programación VPN para habilitar la interceptación del tráfico DNS sin cifrar antes de que se reenvíe a través de un canal seguro.</li>
		<li>Linux con systemd-resolved de systemd 239: DoT mediante la opción <a href="https://www.freedesktop.org/software/systemd/man/resolved.conf.html#DNSOverTLS=" target="_blank"> DNS mediante TLS</a>.</li>
		<li>El valor por defecto es desactivado.</li>
		<li>Se puede configurar el modo oportunista, pero no se hace una validación de certificado.</li>
		<li>El modo estricto está disponible desde systemd 243. Se acepta cualquier certificado firmado por una autoridad de certificación de confianza. Sin embargo, <a href="https://github.com/systemd/systemd/blob/v243/src/resolve/resolved-dnstls-gnutls.c#L62-L63" target="_blank">no hay validación de nombre de host</a> con el backend GnuTLS mientras el backend OpenSSL <a href="https://github.com/systemd/systemd/blob/v243/src/resolve/resolved-dnstls-openssl.c#L86-L87" target="_blank">espera</a> una dirección IP.</li>
		<li>En cualquier caso, no se envía ninguna indicación de nombre de servidor (SNI). El nombre del certificado <a href="https://github.com/systemd/systemd/issues/9397" target="_blank">no se valida</a>, lo que hace que un ataque de intermediario sea bastante insignificante.</li>
		<li>Linux, macOS y Windows pueden <a href="https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy/" target="_blank">usar</a> un cliente DoH en modo estricto. El comando proxy-dns de cloudflare utiliza el resolutor DNS de Cloudflare de forma predeterminada, pero los usuarios pueden invalidarlo a través de la opción proxy de dns ascendente.</li>
	</ul>
	<p>Los navegadores web admiten DoH en lugar de DoT:</p>
	<ul>
		<li>Firefox 62 <a href="https://support.mozilla.org/en-US/kb/firefox-dns-over-https" target="_blank">es compatible con</a> DoH y ofrece varias configuraciones de <a href="https://wiki.mozilla.org/Trusted_Recursive_Resolver" target="_blank">resolutores recursivos de confianza</a> (TRR). De forma predeterminada, DoH está desactivado, pero Mozilla está ejecutando un <a href="https://blog.mozilla.org/futurereleases/2019/09/06/whats-next-in-making-dns-over-https-the-default/" target="_blank">experimento</a> para habilitar DoH para algunos usuarios en EE. UU. Este experimento actualmente utiliza el resolutor 1.1.1.1 de Cloudflare, ya que somos el único proveedor que actualmente satisface la <a href="https://wiki.mozilla.org/Security/DOH-resolver-policy" target="_blank">política estricta de resolutores</a> que requiere Mozilla. Dado que muchos resolutores de DNS aún no admiten un transporte de DNS cifrado, el método de Mozilla garantizará que más usuarios estén protegidos mediante DoH.</li>
		<li>Cuando se habilite a través del experimento, o a través de la opción “Enable DNS over HTTPS” (Habilitar DNS mediante HTTPS) en Network Settings (Configuraciones de red), Firefox usará el modo oportunista (network.trr.mode=2 at about:config).</li>
		<li>El modo estricto se puede habilitar con network.trr.mode=3, pero requiere que se especifique una dirección IP explícita de resolutor (por ejemplo, network.trr.bootstrapAddress=1.1.1.1).</li>
		<li>Aunque Firefox ignora el resolutor predeterminado del sistema, se puede configurar con resolutores alternativos. Además, las implementaciones a nivel de empresa que usan un resolutor que no admite DoH tienen la <a href="https://support.mozilla.org/en-US/kb/configuring-networks-disable-dns-over-https" target="_blank">opción </a> de deshabilitar DoH.</li>
		<li>Chrome 78 <a href="https://blog.chromium.org/2019/09/experimenting-with-same-provider-dns.html" target="_blank">habilita</a> DoH en el modo oportunista si la dirección del resolutor del sistema coincide con uno de los<a href="https://www.chromium.org/developers/dns-over-https" target="_blank">proveedores de DoH con codificación fija</a> (<a href="https://chromium.googlesource.com/chromium/src.git/+/f93a48e3720931c25a3abc7848b08afed43e3be2%5E%21/" target="_blank">cambio de código fuente</a>). Este experimento está habilitado para todas las plataformas, salvo para Linux e iOS, y excluye de forma predeterminada las implementaciones de las empresas.</li>
		<li>Opera 65 <a href="https://blogs.opera.com/desktop/2019/09/opera-65-0-3430-0-developer-update/" target="_blank">agrega</a> una opción para habilitar DoH mediante el resolutor 1.1.1.1 de Cloudflare. Esta función está desactivada de forma predeterminada. Una vez que se activa, utiliza el modo oportunista: si 1.1.1.1:443 (sin SNI) es accesible, se utilizará. De lo contrario, recurre al resolutor predeterminado de una versión anterior, sin cifrar.</li>
	</ul>
	<p>La página de<a href="https://github.com/curl/curl/wiki/DNS-over-HTTPS" target="_blank">DNS mediante HTTPS</a> del proyecto curl incluye una lista completa de proveedores de DoH e implementaciones adicionales.</p>
	<p>Como alternativa al cifrado de toda la ruta de red entre el dispositivo y el resolutor DNS externo, se puede tomar un punto intermedio: utilizar DNS sin cifrar entre los dispositivos y la puerta de enlace de la red local, pero <a href="https://blog.cloudflare.com/dns-over-tls-built-in/">cifrar todo el tráfico DNS</a> entre el enrutador de la puerta de enlace y el resolutor de DNS externo. Una red por cable o inalámbrica segura protegería todos los dispositivos en la red local contra un proveedor de Internet (ISP) que realiza actividades de espionaje u otros adversarios en Internet. Como los puntos de acceso de wifi públicos no se consideran seguros, este método no sería seguro en redes de wifi abiertas. Incluso si está protegido por contraseña con WPA2-PSK, otros aún podrán espiar y modificar un DNS sin cifrar.</p>
	<h2 id="otras-consideraciones-de-seguridad"><strong>Otras consideraciones de seguridad</strong></h2>
	<p>En las secciones anteriores se describen los transportes de DNS seguros, DoH y DoT. Estos solo asegurarán que tu cliente reciba la respuesta sin interferencias del resolutor de DNS. Sin embargo, no protege al cliente si el resolutor devuelve la respuesta incorrecta (a través del secuestro de DNS o ataques de envenenamiento de caché de DNS). La respuesta “verdadera” la determina el propietario de un dominio o zona según lo informado por el servidor de nombres autorizado. <a href="https://www.cloudflare.com/learning/dns/dns-security/" target="_blank">DNSSEC</a> permite a los clientes verificar la integridad de la respuesta DNS devuelta y detectar cualquier alteración no autorizada en la ruta de acceso entre el cliente y el servidor de nombres autorizado.</p>
	<p>Sin embargo, la implementación de DNSSEC se ve obstaculizada por dispositivos intermedios de seguridad que <a href="https://labs.ripe.net/Members/willem_toorop/sunrise-dns-over-tls-sunset-dnssec" target="_blank">de manera incorrecta</a> reenvían mensajes DNS, e incluso si la información está disponible, es posible que los resolutores auxiliares utilizados por las aplicaciones ni siquiera validen los resultados. Un informe de 2016 <a href="https://www.internetsociety.org/resources/doc/2016/state-of-dnssec-deployment-2016/" target="_blank">detectó</a> que solo el 26 % de los usuarios usan resolutores de validación de DNSSEC.</p>
	<p>DoH y DoT protegen el transporte entre el cliente y el resolutor público. Es posible que el resolutor público tenga que ponerse en contacto con servidores de nombres autorizados adicionales para resolver un nombre. Tradicionalmente, la ruta de acceso entre los resolutores y el servidor de nombres autorizado utiliza DNS sin cifrar. Para proteger estos mensajes de DNS, también hicimos un experimento con Facebook, mediante el uso de DoT entre 1.1.1.1 y los servidores de nombres autorizados de Facebook. Al configurar un canal seguro mediante TLS aumenta la latencia, se puede amortizar después de muchas consultas.</p>
	<p>El cifrado de transporte garantiza que los resultados y metadatos del resolutor estén protegidos. Por ejemplo, la información de <a href="https://tools.ietf.org/html/rfc7871" target="_blank">la subred de cliente EDNS (ECS)</a> que se incluye con las consultas DNS podría revelar la dirección original del cliente que inició la consulta de DNS. Ocultar esa información en la ruta de acceso mejora la privacidad. También <a href="https://labs.ripe.net/Members/willem_toorop/sunrise-dns-over-tls-sunset-dnssec" target="_blank">evitará</a> que los dispositivos intermedios de seguridad causen inconvenientes en DNSSEC debido a problemas en el reenvío de DNS.</p>
	<h2 id="problemas-operativos-con-el-cifrado-de-dns"><strong>Problemas operativos con el cifrado de DNS</strong></h2>
	<p>El cifrado de DNS puede traer inconvenientes a los individuos o las organizaciones que dependen del monitoreo o la modificación del tráfico de DNS. Los dispositivos de seguridad que dependen del monitoreo pasivo supervisan todo el tráfico de red entrante y saliente en una máquina o en el perímetro de una red. En función de las consultas de DNS no cifradas, podrían, por ejemplo, identificar las máquinas que están infectadas con malware. Si la consulta de DNS está cifrada, las soluciones de monitoreo pasivo no podrán supervisar los nombres de dominio.</p>
	<p>Algunas partes esperan que los resolutores de DNS apliquen el filtrado de contenido para fines como los siguientes:</p>
	<ul>
		<li>Bloqueo de dominios que se utilizan para la distribución de malware.</li>
		<li>Bloqueo de anuncios.</li>
		<li>Filtrado de control parental mediante el bloqueo de dominios relacionados con contenido para adultos.</li>
		<li>Bloqueo del acceso a dominios que ofrecen contenido ilegal de acuerdo con las regulaciones locales.</li>
		<li>Oferta de un <a href="https://en.wikipedia.org/wiki/Split-horizon_DNS" target="_blank">DNS de horizonte dividido</a>para brindar diferentes respuestas en función de la red de origen.</li>
	</ul>
	<p>Una ventaja de bloquear el acceso a los dominios a través del resolutor de DNS es que se puede hacer de forma centralizada, sin volver a implementarlo en cada aplicación. Lamentablemente, esto tampoco es muy seguro. Supongamos que un sitio web aloja contenido para múltiples usuarios en example.com/videos/for-kids/ y example.com/videos/for-adults/. El resolutor de DNS solo podrá ver “example.com” y puede optar por bloquearlo o no. En este caso, los controles específicos de la aplicación, como las extensiones del navegador, serían más eficaces, ya que en realidad pueden examinar los URL e impedir de manera selectiva el acceso al contenido.</p>
	<p>El monitoreo de DNS no es integral. El malware podría omitir el DNS y las direcciones IP predefinidas en el código, o usar <a href="https://blog.netlab.360.com/an-analysis-of-godlua-backdoor-en/" target="_blank">métodos alternativos</a> para consultar una dirección IP. Sin embargo, no todo el malware es tan complicado, por lo que el monitoreo de DNS todavía puede servir como una herramienta de <a href="https://en.wikipedia.org/wiki/Defense_in_depth_%28computing%29" target="_blank">seguridad adicional</a>.</p>
	<p>Todos estos casos de monitoreo no pasivo o el uso de bloqueo de DNS requieren compatibilidad con el resolutor de DNS. Las implementaciones que se basan en actualizaciones DoH/DoT oportunistas del resolutor actual mantendrán las mismas características que se brindan habitualmente a través de DNS sin cifrar. Lamentablemente, como se mencionó anteriormente, esto es vulnerable a los cambios a versiones anteriores Para resolver esto, los administradores del sistema pueden indicar puntos de conexión a un resolutor DoH/DoT en modo estricto. Lo ideal es hacerlo a través de soluciones de administración de dispositivos seguros (<a href="https://en.wikipedia.org/wiki/Mobile_device_management" target="_blank">MDM</a>, <a href="https://en.wikipedia.org/wiki/Group_Policy" target="_blank">política de grupo</a> en Windows, etc.).</p>
	<h2 id="conclusi-n"><strong>Conclusión</strong></h2>
	<p>Uno de los fundamentos de Internet es la asignación de nombres a una dirección mediante DNS. DNS tradicionalmente ha utilizado transportes inseguros y sin cifrar. Los ISP abusaron de esto en el pasado para insertar <a href="https://www.icsi.berkeley.edu/pubs/networking/redirectingdnsforads11.pdf" target="_blank">anuncios</a>, pero también genera pérdida de privacidad. Los visitantes curiosos en la cafetería pueden usar DNS sin cifrar para seguir tu actividad. Todos estos problemas se pueden resolver con el uso de DNS mediante TLS (DoT) o DNS mediante HTTPS (DoH). Estas técnicas para proteger al usuario son relativamente nuevas y se observa un crecimiento en su adopción.</p>
	<p>Desde una perspectiva técnica, DoH es muy similar a HTTPS y sigue la tendencia general de la industria de <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" target="_blank">dejar de usar opciones no seguras</a>. DoT es un modo de transporte más simple que DoH, ya que se elimina el nivel HTTP, pero eso también facilita los bloqueos deliberados o accidentales.</p>
	<p>Luego de habilitar un transporte seguro es necesario elegir un resolutor de DNS. Algunos proveedores usarán el resolutor de DNS configurado a nivel local, pero intentarán actualizar según la conveniencia el transporte sin cifrar a un transporte más seguro (DoT o DoH). Lamentablemente, el resolutor de DNS, por lo general, tiene un valor predeterminado del ISP que puede no ser compatible con transportes seguros.</p>
	<p>Mozilla ha adoptado un enfoque diferente. En lugar de depender de resolutores locales que ni siquiera admiten DoH, permiten al usuario seleccionar un resolutor de manera explícita. Los resolutores recomendados por Mozilla deben satisfacer <a href="https://wiki.mozilla.org/Security/DOH-resolver-policy" target="_blank">altos estándares</a> para proteger la privacidad del usuario. Para garantizar que las funciones de control parental en función de DNS sigan siendo funcionales, y para admitir el caso práctico de horizonte dividido, Mozilla ha <a href="https://support.mozilla.org/en-US/kb/configuring-networks-disable-dns-over-https" target="_blank">agregado</a> un mecanismo que permite a los resolutores deshabilitar DoH.</p>
	<p>Los protocolos de transporte de DoT y DoH están listos para que avancemos hacia una Internet más segura. Como se puede ver en los recorridos previos de los paquetes, estos protocolos son similares a los mecanismos actuales para garantizar el tráfico de la aplicación. Una vez solucionado este problema de seguridad y privacidad, habrá <a href="https://arxiv.org/pdf/1906.09682.pdf" target="_blank">muchos</a> <a href="https://blog.cloudflare.com/esni/">más</a> por resolver.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/10/tales-from-the-crypto-team@2x-5.png" class="kg-image"></figure>
</div>