<div class="mb2 gray5">6 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/03/image1-25.png" class="kg-image" alt="A deep-dive into Cloudflare’s autonomous edge DDoS protection" loading="lazy"></figure>
	<p>Hoy me complace hablar de nuestro sistema autónomo de protección contra DDoS (<a href="https://www.cloudflare.com/es-es/learning/ddos/what-is-a-ddos-attack" target="_blank">denegación de servicio distribuido</a>). Este sistema se ha implementado a escala global en todos nuestros más de 200 centros de datos y protege activamente a todos nuestros clientes contra los ataques DDoS a las capas 3-7 (<a href="https://www.cloudflare.com/es-es/learning/ddos/glossary/open-systems-interconnection-model-osi" target="_blank">modelo OSI</a>) sin intervención humana. Como parte de nuestro compromiso con la <a href="https://blog.cloudflare.com/unmetered-mitigation">protección DDoS ilimitada</a>, no facturaremos más a un cliente solo porque ha sido blanco de un ataque DDoS.</p>
	<h3 id="protecci-n-aut-noma-en-el-per-metro">Protección autónoma en el perímetro</h3>
	<p>Para proteger a nuestros clientes contra los ataques DDoS de manera rápida y precisa, hemos desarrollado un sistema autónomo de detección y mitigación en el perímetro que puede tomar decisiones por sí mismo sin buscar un consenso centralizado. Está completamente definido por software y se ejecuta en nuestro perímetro, en servidores de productos. Funciona con nuestro daemon de denegación de servicio (dosd), que originalmente se puso en marcha a mediados de 2019 para la protección contra los ataques DDoS a las capas 3 y 4. Desde entonces, hemos invertido en su desarrollo y la mejora de sus capacidades para adelantarnos a los atacantes y desarmar la economía de los ataques. El último conjunto de mejoras ha ampliado nuestro componente de mitigación perimetral para proteger contra los ataques a la capa 7, además de los ataques a las capas 3 y 4.</p>
	<p>Este sistema se ejecuta en cada servidor de todos nuestros centros de datos perimetrales. Analiza constantemente los paquetes y las solicitudes HTTP para identificar ataques DDoS. Tras la detección, envía de inmediato una regla de mitigación con una firma generada en tiempo real a la ubicación más óptima de la pila Linux, donde se puede aplicar la mitigación más rentable.</p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2021/03/DDoS-mitigation-diagram@2x-1.png" class="kg-image" alt="A conceptual diagram of Cloudflare DDoS mitigation systems" loading="lazy">
		<figcaption>Un diagrama conceptual de los sistemas de mitigación de DDoS de Cloudflare</figcaption>
	</figure>
	<p>Nuestras nuevas capacidades de detección en el perímetro complementan nuestro actual mecanismo de detección global de amenazas, <a href="https://blog.cloudflare.com/meet-gatebot-a-bot-that-allows-us-to-sleep">Gatebot</a>, que se aloja en el núcleo de nuestra red. La detección de ataques en el núcleo de la red con Gatebot es estupenda para los ataques volumétricos, más grandes y distribuidos, que requieren la coordinación en todo el perímetro de Cloudflare, pero los ataques más pequeños y localizados requieren un enfoque diferente. Detectar los ataques a la capa de red y HTTP en el perímetro significa que podemos muestrear con mayor frecuencia, detectar ataques, tanto a pequeña como a gran escala, y generar inmediatamente una regla de mitigación. En los últimos meses, dosd ha detectado el 98,6 % de todos los ataques contra DDoS a las capas 3 y 4. Del mismo modo, desde la implementación de la versión ampliada de dosd, hemos mitigado el 81 % de todos los ataques a la capa 7.</p>
	<p>Ya hemos hablado de <a href="https://blog.cloudflare.com/meet-gatebot-a-bot-that-allows-us-to-sleep">Gatebot</a> y <a href="https://blog.cloudflare.com/announcing-flowtrackd">flowtrackd</a> en blogs anteriores, así que en esta entrada nos centraremos en las funciones ampliadas de dosd.</p>
	<h3 id="uso-de-la-red-linux-para-anular-paquetes-y-solicitudes-a-velocidad-de-cable">Uso de la red Linux para anular paquetes y solicitudes a velocidad de cable</h3>
	<p>Hace diez años, la red Linux era lenta. Hoy, eliminamos paquetes a velocidad de cable gracias a Linux, concretamente, con iptables y eXpress Data Path (XDP).</p>
	<h3 id="ciclo-de-un-paquete">Ciclo de un paquete</h3>
	<p>Un paquete destinado a un cliente dotado de los sistemas de protección de Cloudflare se dirige al <a href="https://www.cloudflare.com/es-es/network" target="_blank">centro de datos de Cloudflare</a> más cercano a través de <a href="https://www.cloudflare.com/es-es/learning/cdn/glossary/anycast-network" target="_blank">BGP Anycast</a>. Una vez que llega, pasa del enrutador a un servidor utilizando la ruta de acceso múltiple de igual coste (<a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing" target="_blank">ECMP</a>) a través de conmutadores de red. Cuando llega a un servidor, el paquete se envía a un grupo de programas eXpress Data Path (<a href="https://en.wikipedia.org/wiki/Express_Data_Path" target="_blank">XDP</a>). El primer grupo de programas XDP, <a href="https://blog.cloudflare.com/l4drop-xdp-ebpf-based-ddos-mitigations">L4Drop</a>, aplica las reglas de mitigación de los ataques previamente detectados y transmite las muestras de los paquetes a dosd para su posterior análisis.</p>
	<p>Si un paquete no se elimina como malicioso, se pasa a <a href="https://blog.cloudflare.com/unimog-cloudflares-edge-load-balancer">Unimog</a>, nuestro propio equilibrador de carga de capa 4. Utilizando las métricas de estado y rendimiento del servidor, Unimog decide si debe mantener el paquete en el mismo servidor o pasarlo a otro servidor del centro de datos que pueda gestionarlo mejor. Después de Unimog, pasa a través del firewall con iptables y a continuación, si se dirige a una aplicación de capa 7, por ejemplo, un servicio protegido por el WAF de Cloudflare, a nuestro proxy inverso HTTP. El proxy inverso se ejecuta en el espacio de usuario y las solicitudes HTTP pasan por nuestro <a href="https://www.cloudflare.com/es-es/waf" target="_blank">firewall de aplicaciones web</a>, las reglas del firewall de aplicaciones y las configuraciones adicionales del cliente. En cambio, si el paquete se destina a una aplicación TCP/UDP (Spectrum) o a un destino IP que se enruta en lugar de redireccionarse mediante proxy (Magic Transit), pasaría por esos sistemas en lugar de por nuestro proxy HTTP.</p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2021/04/L7-ddos-diagram@2x-1-1.png" class="kg-image" alt="Life of a packet" loading="lazy">
		<figcaption>Ciclo de un paquete</figcaption>
	</figure>
	<p>Además de L4Drop, nuestro proxy HTTP también transmite muestras y metadatos de las solicitudes HTTP a dosd. Este muestreo de perímetro se produce a una velocidad 10 veces mayor que el muestreo del núcleo, ya que ahora las señales se pueden analizar (y se puede actuar sobre ellas) localmente en lugar de enviarse a un centro de datos principal. Del mismo modo, dosd muestra los paquetes 81 veces más rápido que gatebot.</p>
	<p>Juntos, dosd, gatebot y flowtrackd analizan las muestras que reciben e implementan reglas de mitigación cuando se detectan ataques DDoS. Aplican reglas de mitigación en el proxy web para mitigar los ataques HTTP. Las solicitudes de ataque se gestionan con una acción de bloqueo, límite de velocidad o desafío, según la decisión del sistema. Sin embargo, si el ataque es volumétrico, la regla de mitigación se transfiere en la pila al firewall con iptables y los ataques a la capa 7 se eliminan en la capa 4 utilizando <a href="https://blog.cloudflare.com/rolling-with-the-punches-shifting-attack-tactics-dropping-packets-faster-cheaper-at-the-edge/#jails">IP Jails</a>, para una mitigación más rentable. Del mismo modo, los ataques a las capas 3 y 4 se mitigan en el firewall con iptables utilizando programas de filtro de paquetes extendido de Berkeley (<a href="https://blog.cloudflare.com/es-es/cloudflare-architecture-and-how-bpf-eats-the-world-es-es">eBPF</a>) dentro de L4Drop. Usar estos componentes nos permite mitigar automáticamente los ataques DDoS a escala.</p>
	<h3 id="desarmar-la-econom-a-de-los-ataques">Desarmar la economía de los ataques</h3>
	<p>Nuestro nuevo sistema autónomo, descrito anteriormente, junto con nuestros componentes de mitigación de amenazas existentes, se desarrolló para proteger a nuestros clientes contra los ataques DDoS que son cada vez más fáciles y baratos de llevar a cabo. Estos ataques son utilizados por actores maliciosos que pretenden interrumpir un sitio web, una aplicación móvil, un videojuego o cualquier recurso conectado a Internet. Aumentar la protección era un paso necesario dada la tendencia al alza de los ataques, tal y como muestran nuestros <a href="https://blog.cloudflare.com/network-layer-ddos-attack-trends-for-q3-2020">informes de tendencias DDoS</a>. Además, la escala de los ataques es cada vez mayor y se han vuelto más <a href="https://blog.cloudflare.com/beat-an-acoustics-inspired-ddos-attack">sofisticados</a>, como el ataque que imitaba los sonidos producidos por diferentes teclas. Igual de importantes son los pequeños ataques que podrían interrumpir una pequeña propiedad web. Queremos bloquear todos los ataques, de pequeña o gran escala.</p>
	<p>En muchos casos, los atacantes pueden lanzar ataques DDoS sin coste utilizando herramientas disponibles públicamente, o por una pequeña tarifa contratando una <a href="https://www.cloudflare.com/es-es/learning/ddos/what-is-a-ddos-botnet" target="_blank">botnet</a> DDoS como servicio, como <a href="https://blog.cloudflare.com/moobot-vs-gatebot-cloudflare-automatically-blocks-botnet-ddos-attack-topping-at-654-gbps">Moobot</a>, en la web oscura. Según el <a href="https://www.privacyaffairs.com/dark-web-price-index-2020" target="_blank">índice de precios de la web oscura de 2020</a>, el precio de un ataque DDoS comienza en 10 dólares por un ataque de una hora a un ritmo de 10 000-50 000 solicitudes por segundo. El precio por lanzar un ataque es muy inferior a sus repercusiones. La interrupción o incluso <em>solo </em>la reducción del servicio permite a los ciberdelincuentes cobrar un precio considerable a su víctima. Por ejemplo, la caída de un sitio web de comercio electrónico significa que los usuarios no pueden iniciar sesión ni realizar compras. Incluso el aumento de la latencia puede hacer que los usuarios abandonen sus carritos de la compra y recurran a la competencia. Un minuto de inactividad se puede traducir fácilmente en la pérdida de <a href="https://www.gremlin.com/ecommerce-cost-of-downtime" target="_blank">decenas de miles de dólares</a>.</p>
	<p>La frecuencia, la sofisticación y el tamaño de los ataques DDoS requieren un nuevo enfoque, uno que sea rápido, exacto y preciso. Esta es la razón por la que hemos aumentado los sistemas de protección que se describen en esta publicación.</p>
	<h3 id="ayudamos-a-mejorar-internet">Ayudamos a mejorar Internet</h3>
	<p>La misión de Cloudflare es ayudar a mejorar Internet para que sea más segura, rápida y fiable para todos. La visión del equipo de protección contra DDoS se deriva de esta misión. Nuestro objetivo es hacer que el impacto de los ataques DDoS sea cosa del pasado. En los años 90 y 2000, <a href="https://en.wikipedia.org/wiki/History_of_email_spam" target="_blank">los correos electrónicos no deseados se convirtieron en un grave problema. </a>Hoy, los servicios de correo electrónico se encargan de filtrarlos, y nuestro objetivo es hacer lo mismo con los ataques DDoS.</p>
	<p>Para obtener más información sobre la protección contra DDoS de Cloudflare, <a href="https://www.cloudflare.com/es-es/enterprise" target="_blank">ponte en contacto con nosotros</a> o prueba el plan gratuito de Cloudflare <a href="https://dash.cloudflare.com/sign-up" target="_blank">aquí</a>.</p>
	<p>Por cierto, si te interesa trabajar en el equipo de ingenieros especialistas en la protección contra DDoS, estamos buscando profesionales en nuestras oficinas en Londres y Austin. Envía tu curriculum aquí:</p>
	<p>Austin: <a href="https://boards.greenhouse.io/cloudflare/jobs/2291040?gh_jid=2291040" target="_blank">https://boards.greenhouse.io/cloudflare/jobs/2291040?gh_jid=2291040</a></p>
	<p>Londres: <a href="https://boards.greenhouse.io/cloudflare/jobs/2291038?gh_jid=2291038" target="_blank">https://boards.greenhouse.io/cloudflare/jobs/2291038?gh_jid=2291038</a></p>
</div>