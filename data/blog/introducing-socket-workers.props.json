{
	"initialReadingTime": "3",
	"locale": "en-us",
	"localesAvailable": [
		"zh-cn",
		"ja-jp"
	],
	"post": {
		"authors": [
			{
				"name": "James M Snell",
				"slug": "jasnell",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5dR6CJtYedvLrkAZ6rxv9I/970c185aa99d695713240262acf428bb/jasnell.jpg",
				"location": "California",
				"website": null,
				"twitter": "@jasnell",
				"facebook": null
			}
		],
		"excerpt": "The ability to make TCP and QUIC client connections from within Workers and Durable Objects, as well as the ability to connect to Workers over TCP and QUIC without using HTTP, will be coming to Cloudflare Workers. Here’s a peek at what we’re working on.",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5DfFwXRDH0cDrR0MsaA2zX/f6e13a369155e4fa7fbb4b143eff4e9d/introducing-socket-workers.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2BgonTNWdD0eYX6V4RW2DK/39f704c474455326457a7f3d3093d461/unnamed--1--4.png\" alt=\"Making connections with TCP and Sockets for Workers\" class=\"kg-image\" width=\"1200\" height=\"675\" loading=\"lazy\"/>\n            \n            </figure><p>Today we are excited to announce that we are developing <a href=\"https://www.cloudflare.com/learning/security/api/what-is-an-api/\">APIs</a> and infrastructure to support more TCP, UDP, and QUIC-based protocols in Cloudflare Workers. Once released, these new capabilities will make it possible to use non-HTTP socket connections to and from a Worker or Durable Object as easily as one can use HTTP and WebSockets today.</p><p>Out of the box, <a href=\"https://workers.cloudflare.com/?&_bt=521144407143&_bk=&_bm=b&_bn=g&_bg=123914288844&_placement=&_target=&_loc=1013686&_dv=c&awsearchcpc=1&gclid=Cj0KCQiAsqOMBhDFARIsAFBTN3eXuRcLLiS_c0CtV8uR9xVVQhymoIrK5uHE_yReRLtVkHkekfCWprUaAtoyEALw_wcB&gclsrc=aw.ds\">Cloudflare Workers</a> support the ability to open HTTP and WebSocket connections using the standardized <a href=\"https://developers.cloudflare.com/workers/runtime-apis/fetch\">fetch</a> and <a href=\"https://developers.cloudflare.com/workers/runtime-apis/websockets\">WebSocket APIs</a>. With just a few internal changes to make it operational in Workers, we’ve developed an <a href=\"/relational-database-connectors/\">example</a> using an off-the-shelf driver (in this example, a Deno-based <a href=\"https://deno.land/x/postgres@v0.13.0\">Postgres client driver</a>) to communicate with a remote Postgres server via WebSocket over a secure <a href=\"https://www.cloudflare.com/products/tunnel/\">Cloudflare Tunnel</a>.</p>\n            <pre class=\"language-typescript\"><code class=\"language-typescript\">import { Client } from &#039;./driver/postgres/postgres&#039;\n\nexport default {\n  async fetch(request: Request, env, ctx: ExecutionContext) {\n    try {\n      const client = new Client({\n        user: &#039;postgres&#039;,\n        database: &#039;postgres&#039;,\n        hostname: &#039;https://db.example.com&#039;,\n        password: &#039;&#039;,\n        port: 5432,\n      })\n      await client.connect()\n      const result = await client.queryArray(&#039;SELECT * FROM users WHERE uuid=1;&#039;)\n      ctx.waitUntil(client.end())\n      return new Response(JSON.stringify(result.rows[0]))\n    } catch (e) {\n      return new Response((e as Error).message)\n    }\n  },\n}\n</pre></code>\n            <p>The example works by replacing the bits of the Postgres client driver that use the Deno-specific TCP socket APIs with standard fetch and WebSockets APIs. We then establish a WebSocket connection with a remote Cloudflare Tunnel daemon running adjacent to the Postgres server, establishing what is effectively TCP-over-WebSockets.</p>\n            <figure class=\"kg-card kg-image-card kg-width-wide\">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/xvjFKpdAS2plGdWFtEcSd/3fb332f5f87dd191d298bbd6ce86a041/image1-17.png\" alt=\"Connecting to a backend data center via a Cloudflare Tunnel\" class=\"kg-image\" width=\"1416\" height=\"611\" loading=\"lazy\"/>\n            \n            </figure><p>While the fact we were able to build the example and communicate effectively and efficiently with the Postgres server — without making any changes to the Cloudflare Workers runtime — is impressive, there are limitations to the approach. For one, the solution requires additional infrastructure to establish and maintain the WebSocket tunnel — in this case, the instance of the Cloudflare Tunnel daemon running adjacent to the Postgres server. While we are certainly happy to provide that daemon to customers, it would just be better if that component were not required at all. Second, tunneling TCP over WebSockets, which is itself tunneled via HTTP over TCP is a bit suboptimal. It works, but we can do better.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"making-connections-from-cloudflare-workers\">Making connections from Cloudflare Workers</h3>\n            <a href=\"#making-connections-from-cloudflare-workers\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Currently, there is no standard API for socket connections in JavaScript. We want to change that.</p><p>If you’ve used Node.js before, then you’re most likely familiar with the <a href=\"https://nodejs.org/dist/latest-v17.x/docs/api/net.html#class-netsocket\"><code>net.Socket</code></a> and <a href=\"https://nodejs.org/dist/latest-v17.x/docs/api/tls.html#class-tlstlssocket\"><code>net.TLSSocket</code></a> objects. If you use Deno, then you might know that they’ve recently introduced the <a href=\"https://doc.deno.land/builtin/stable#Deno.connect\"><code>Deno.connect()</code></a> and <a href=\"https://doc.deno.land/builtin/stable#Deno.connectTls\"><code>Deno.connectTLS()</code></a> APIs. When you look at those APIs, what should immediately be apparent is how different they are from one another despite doing the exact same thing.</p><p>When we decided that we would add the ability to open and use socket connections from within Workers, we also agreed that we really have no interest in developing yet another non-standard, platform-specific API that is unlike the APIs provided by other platforms. Therefore, we are extending an invitation to all JavaScript runtime platforms that need socket capabilities to collaborate on a new (and eventually standardized) API that just works no matter which runtime you choose to develop on.</p><p>Here’s a rough example of what we have in mind for opening and reading from a simple TCP client connection:</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">const socket = new Socket({\n  remote: { address: &#039;123.123.123.123&#039;, port: 1234 },\n})\nfor await (const chunk of socket.readable)\n  console.log(chunk)</pre></code>\n            <p>Or, this example, sending a simple “hello world” packet using UDP:</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">const socket = new Socket({\n  type: &#039;udp&#039;,\n  remote: { address: &#039;123.123.123.123&#039;, port: 1234 },\n});\nconst enc = new TextEncoder();\nconst writer = socket.writable.getWriter();\nawait writer.write(enc.encode(&#039;hello world&#039;));\nawait writer.close();</pre></code>\n            <p>The API will be designed generically enough to work both client and server-side; for TCP, UDP, and QUIC; with or without TLS, and will not rely on any mechanism specific to any single JavaScript runtime. It will build on existing broadly supported Web Platform standards such as <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\">EventTarget</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\">ReadableStream</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WritableStream\">WritableStream</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal\">AbortSignal</a>, and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises\">promises</a>. It will be familiar to developers who are already familiar with the <code>fetch()</code> API, service workers, and promises using async/await.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">interface Socket : EventTarget {\n  constructor(object SocketInit);\n\n  Promise&lt;undefined&gt; update(object SocketInit);\n\n  readonly attribute ReadableStream readable;\n  readonly attribute WritableStream writable;\n  \n  readonly attribute Promise&lt;undefined&gt; ready;\n  readonly attribute Promise&lt;undefined&gt; closed;\n\n  Promise&lt;undefined&gt; abort(optional any reason);\n  readonly attribute AbortSignal signal;\n \n  readonly attribute SocketStats stats;\n  readonly attribute SocketInfo info;\n}</pre></code>\n            <p>This is just a proposal at this point and the details will very likely change from the examples above by the time the capability is delivered in Workers. It is our hope that other platforms will join us in the effort of developing and supporting this new API so that developers have a consistent foundation upon which to build regardless of where they run their code.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"introducing-socket-workers\">Introducing Socket Workers</h3>\n            <a href=\"#introducing-socket-workers\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>The ability to open socket <i>client</i> connections is only half of the story.</p><p>When we first started talking about adding these capabilities an obvious question was asked: What about using non-HTTP protocols to connect <i>to</i> Workers? What if instead of just having the ability to connect a Worker to some other back-end database, we could implement the entire database itself on the edge, inside Workers, and have non-HTTP clients connect to it? For that matter, what if we could implement an SMTP server in Workers? Or an MQTT message queue? Or a full VoIP platform? Or implement packet filters, transformations, inspectors, or protocol transcoders?</p><p>Workers are far too powerful to limit to just HTTP and WebSockets, so we will soon introduce Socket Workers -- that is, Workers that can be connected to directly using raw TCP, UDP, or QUIC protocols without using HTTP.</p><p>What will this new Workers feature look like? Many of the details are still being worked through, but the idea is to deploy a Worker script that understands and responds to “connect” events in much the same way that “fetch” events work today. Importantly, this would build on the same common socket API being developed for client connections:</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">addEventListener(&#039;connect&#039;, (event) =&gt; {\n  const enc = new TextEncoder();\n  const writer = event.socket.writable.getWriter();\n  writer.write(enc.encode(&#039;Hello World&#039;));\n  writer.close();\n});</pre></code>\n            \n          <div class=\"flex anchor relative\">\n            <h3 id=\"next-steps-and-a-call-to-action\">Next Steps (and a call to action)</h3>\n            <a href=\"#next-steps-and-a-call-to-action\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>The new socket API for JavaScript and Socket Workers are under active development, with focus initially on enabling better and more efficient ways for Workers to connect to databases on the backend — you can sign up <a href=\"https://www.cloudflare.com/database-connectors-early-access/\">here</a> to join the waitlist for access to Database Connectors and Socket Workers. We are excited to work with early users, as well as our technology partners to develop, refine, and test these new capabilities.</p><p>Once released, we expect Socket Workers to blow the doors wide open on the types of intelligent distributed applications that can be deployed to the Cloudflare network edge, and we are excited to see what you build with them.</p>",
		"id": "7MZbwJq5IVdd2rRHZRWrUf",
		"localeList": {
			"name": "Making connections with TCP and Sockets for Workers Config",
			"enUS": "English for Locale",
			"zhCN": "Translated for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "Translated for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "The ability to make TCP and QUIC client connections from within Workers and Durable Objects, as well as the ability to connect to Workers over TCP and QUIC without using HTTP, will be coming to Cloudflare Workers. However, there is much to consider and a lot to do to make it happen. Here’s a peek at what we’re working on.",
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2021-11-15T13:59:16.000+00:00",
		"slug": "introducing-socket-workers",
		"tags": [
			{
				"id": "4Q1oXZOskZczYetWpWXIsl",
				"name": "Full Stack Week",
				"slug": "full-stack-week"
			},
			{
				"id": "6hbkItfupogJP3aRDAq6v8",
				"name": "Cloudflare Workers",
				"slug": "workers"
			},
			{
				"id": "76HSdQ6sNz56VVQXRUhhSw",
				"name": "QUIC",
				"slug": "quic"
			},
			{
				"id": "4HIPcb68qM0e26fIxyfzwQ",
				"name": "Developers",
				"slug": "developers"
			},
			{
				"id": "3JAY3z7p7An94s6ScuSQPf",
				"name": "Developer Platform",
				"slug": "developer-platform"
			}
		],
		"title": "Making connections with TCP and Sockets for Workers",
		"updated_at": "2024-08-27T01:41:35.895Z",
		"url": "https://blog.cloudflare.com/introducing-socket-workers"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}