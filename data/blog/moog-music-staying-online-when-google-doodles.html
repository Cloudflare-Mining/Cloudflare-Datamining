<div class="mb2 gray5">3 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1YkMKnTBYklTzJvmRFWhH5/b26b6411144af4d0f03ecf4be5aae495/moogmusic_how_to_doodle.png.scaled500.png" alt="Moog Music: Staying online when Google doodles you" class="kg-image" width="500" height="308" loading="lazy">

	</figure>
	<p>Today Google celebrated the birthday of Bob Moog, the creator of the Moog keyboard, with an interactive doodle. If you haven't played with it, it's pretty cool. Check out, for example, this version of the <a href="https://www.google.com/webhp?doodle=6201726XWhA74MzMMlMzN0pmZthmZn8AAAMRmZnyAAANQAAB6pmZs3__-3-2E8aZmbTPP__9lPUzMz2n7___YzzpmZh2Fx5IRZBcYYhcIZBSIZBaIZBGIZBOGYhOYYROYZBeYZBRYZBZBYhRUZheIZBREYReYZBOeYhOcYhGYZhGIYhOIZBeeZBOEYhGEYhKYZhKIYhGYTgWIRhGISmGEUiGUUiGIWmGQVkUFZOEZBIYYhIQYhIQZRIYYRIIYRIIZBIIYhIQYxIIZ1rAQO-DMzDJTMzdKZmbYZmZ_AAADEZmZ8gAADUAAAeqZmbN___t_thPGmZm0zz___ZT1AAANp-___2M86ZmYcRcJ1CNhdKYwktwrSIxGmQSBeeYwEDvgzMwyUzM3SmZm2GZmfwAAAxGZmfIAAA1AAAHqmZmzf__7f7YTxpmZtM8___2U9QAADafv__9jPMAAAHYWic5DGQ0UN4LOK1hMFJOF5Dg&amp;hl=en&amp;nord=1">Legend of Zelda theme music</a> composed with today's doodle.</p>
	<div class="flex anchor relative">
		<h3 id="youre-going-to-see-some-traffic">You're Going to See Some Traffic</h3>
		<a href="https://blog.cloudflare.com/#youre-going-to-see-some-traffic" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>The top result when you <a href="https://www.google.com/search?q=moog">search for Moog on Google</a> is MoogMusic.com. The site celebrates Bob Moog's legacy and sells versions of his keyboards and other devices (including a <a href="http://www.moogmusic.com/products/apps/animoog-iphone-99-until-5292012">pretty sweet iPhoneapp</a>). Google contacted the site owners to give them notice that there was going to be a doodle four days ago. The only catch, they had to keep the information strictly confidential until the doodle went live in Australia (the first region to see new doodles every day). Oh, and, by the way, Google noted, they should prepare for a crushing load of traffic to their website.</p>
	<p>That presented a bit of a conundrum. Moog Music turned to their web developers, a technically savvy shop called <a href="http://purplecat.net">PurpleCat.net</a>. The site was designed to handle half a million hits a day, so the team at PurpleCat spent the next threedays making several improvements to the site to increase its capacity. They migrated the site to new hardware, secured a dedicated gigabit port, migrated the mysql database to its own server, upgraded the backend of the site replacing Apache with NGINX and added layers of caching and optimizations. Needless to say, it was a busy three days for the PurpleCat team while they did all the upgrades to prepare for the traffic surge. The site, however, was on a single virtual private server (VPS) with limited resources and it didn't make sense to upgrade the whole infrastructure for a one-day spike in traffic.</p>
	<div class="flex anchor relative">
		<h3 id="turning-to-cloudflare-to-help">Turning to CloudFlare to Help</h3>
		<a href="https://blog.cloudflare.com/#turning-to-cloudflare-to-help" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>As soon as the doodle went live in Australia and the embargo was lifted, PurpleCat called us at CloudFlare and explained what was about to happen. We were happy to help having had a lot of experience dealing with floods of traffic from <a href="https://blog.cloudflare.com/today-show-traffic-spike-no-problem-for-khata">events</a> <a href="https://blog.cloudflare.com/cloudflare-saves-groundhog-day">like</a> <a href="https://blog.cloudflare.com/tales-from-the-pumpkin-patch">these</a>. The MoogMusic.com site went live behind CloudFlare and we saw the trafficbegin to rise.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/4D58ezxx3dcI7L9zNky8yx/ea764a2b03abb8eaffde4eb4f68ae2a3/moogmusic_bandwidth.png.scaled500.png" alt="Moog Music: Staying online when Google doodles you" class="kg-image" width="500" height="225" loading="lazy">

	</figure>
	<p>Things were ok at first, but as the sun rose in Asia, errors started to be returned from the stressed MoogMusic.com VPS. CloudFlare's Always Online technology kicked in and served cached versions of the page, but the dynamic portions were at times inaccessible and the pages loaded slowly as our servers waited for a response or timeout from the backend. It wasn't ideal.</p>
	<div class="flex anchor relative">
		<h3 id="page-rules-and-advanced-caching-to-the-rescue">Page Rules and Advanced Caching to the Rescue</h3>
		<a href="https://blog.cloudflare.com/#page-rules-and-advanced-caching-to-the-rescue" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>We knew we could help even more, so our support team worked with the folks at PurpleCat to setup Page Rules for the MoogMusic.com site. While some of the site is dynamic, large portions are relatively static. That meant a Page Rule could define the static portions -- like the front page and a history of Moog's legacy -- and instruct CloudFlare to Cache Everything, even the HTML. That means we will serve all requests to the pages that match the rule from our infrastructure without <i>any</i> requests getting sent to the VPS.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6FUYxDYabfTCo7UHijaJEU/ee42ac53467d963c6ff2fc55dae3a65c/moogmusic_page_rules_cache_everything.png.scaled500.png" alt="Moog Music: Staying online when Google doodles you" class="kg-image" width="500" height="133" loading="lazy">

	</figure>
	<p>The results were dramatic. Approximately 92% of requests that would have previously hit the VPS were instead fielded directly by CloudFlare. We also reduced bandwidth needed to serve the requests to MoogMusic.com by more than 90%. With all the static requests offloaded to CloudFlare, the VPS had plenty of capacity to return the dynamic, uncachable HTML of the site.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/5Ed9Gy5P6a1VSRRHg2rHgl/ba3ae3fd874a66b8cc18dd81de6c14e5/moogmusic_requests_bandwidth_saved.png.scaled500.png" alt="Moog Music: Staying online when Google doodles you" class="kg-image" width="500" height="96" loading="lazy">

	</figure>
	<div class="flex anchor relative">
		<h3 id="focus-on-great-content-well-keep-it-online">Focus On Great Content, We'll Keep It Online</h3>
		<a href="https://blog.cloudflare.com/#focus-on-great-content-well-keep-it-online" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>MoogMusic.com is currently averaging more than 100 requests per second. (What's pretty incredible is that's less than 1/1,000th of CloudFlare's overall load.) The VPS is doing more traffic every 15 minutes than the VPS it's running on is designed to handle over 24 hours. Peter from PurpleCat sent us a <a href="https://plus.google.com/u/0/photos/109991200368962060094/albums/5745759789073888993">nice post</a> thanking us for our help. He also shared the following with John on our team:</p>
	<blockquote>
		<p>your ceo will like this.we built a separate server to just serve this page up:</p>
		<p><a href="http://190-2.purplecat.net">http://190-2.purplecat.net/</a></p>
		<p>But thanks to cloudflare, we never had to put it up.</p>
		<p>He's right, I do love that. And so does everyone else at CloudFlare. It's exactly why our <a href="https://www.cloudflare.com/people">whole team</a> comes to work every day excited to solve what seem like impossible challenges... like scaling a single VPS to deal with the traffic from the Google doodle.</p>
	</blockquote>
</div>