{
	"locale": "en-us",
	"localesAvailable": [
		"zh-cn",
		"ja-jp"
	],
	"post": {
		"authors": [
			{
				"name": "Annika Garbers",
				"slug": "annika",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6SY53ZloWPZ3xlkvdwhfNZ/17f85d5432fafbd717b7c2fc9b593dd4/annika.png",
				"location": null,
				"website": null,
				"twitter": "@annikagarbers",
				"facebook": null
			},
			{
				"name": "Nadin El-Yabroudi",
				"slug": "nadin",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/2tb7HXTXdN3vxdSKjd3Zic/d9f2b638354bf6f7989a11bbea0200ad/nadin.png",
				"location": null,
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "Today, we’re excited to announce the general availability of on-demand packet captures from Cloudflare’s global network",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/mk6xHDcVFErI6ZlQKUh1F/a1bf34c852986a2e5d1568fc1f59a61e/packet-captures-at-edge.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/1nmoiZbyrurKkGuWTvbEzM/346cfb006a8b2747ecbb90bcc4372902/image3-28.png\" alt=\"Packet captures at the edge\" class=\"kg-image\" width=\"1801\" height=\"1013\" loading=\"lazy\"/>\n            \n            </figure><p>Packet captures are a critical tool used by network and security engineers every day. As more network functions migrate from legacy on-prem hardware to cloud-native services, teams risk losing the visibility they used to get by capturing 100% of traffic funneled through a single device in a datacenter rack. We know having easy access to packet captures across all your network traffic is important for troubleshooting problems and deeply understanding traffic patterns, so today, we’re excited to announce the general availability of on-demand packet captures from Cloudflare’s global network.</p><h3>What are packet captures and how are they used?</h3><p>A packet capture is a file that contains all packets that were seen by a particular network box, usually a firewall or router, during a specific time frame. Packet captures are a powerful and commonly used tool for debugging network issues or getting better visibility into attack traffic to tighten security (e.g. by adding firewall rules to block a specific attack pattern).</p><p>A network engineer might use a pcap file in combination with other tools, like <a href=\"https://www.cloudflare.com/learning/network-layer/what-is-mtr/\">mtr</a>, to troubleshoot problems with reachability to their network. For example, if an end user reports intermittent connectivity to a specific application, an engineer can set up a packet capture filtered to the user’s source IP address to record all packets received from their device. They can then analyze that packet capture and compare it to other sources of information (e.g. pcaps from the end user’s side of the network path, traffic logs and analytics) to understand the magnitude and isolate the source of the problem.</p><p>Security engineers can also use packet captures to gain a better understanding of potentially malicious traffic. Let’s say an engineer notices an unexpected spike in traffic that they suspect could be an attempted attack. They can grab a packet capture to record the traffic as it’s hitting their network and analyze it to determine whether the packets are valid. If they’re not, for example, if the packet payload is randomly generated gibberish, the security engineer can create a firewall rule to block traffic that looks like this from entering their network.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/6OKUEiSlnlCSXLryTslrWR/e7717f7008e6c35880abede869922e31/image1-65.png\" alt=\"Example of a packet capture from a recent DDoS attack targeted at Cloudflare infrastructure. The contents of this pcap can be used to create a “signature” to block the attack.\" class=\"kg-image\" width=\"1999\" height=\"1395\" loading=\"lazy\"/>\n            \n            </figure><p><i>Example of a packet capture from a recent DDoS attack targeted at Cloudflare infrastructure. The contents of this pcap can be used to create a “signature” to block the attack.</i></p><h3>Fragmenting traffic creates gaps in visibility</h3><p>Traditionally, users capture packets by logging into their router or firewall and starting a process like <a href=\"https://www.tcpdump.org/\">tcpdump</a>. They’d set up a filter to only match on certain packets and grab the file. But as networks have become more fragmented and users are moving security functions out to the edge, it’s become increasingly challenging to collect packet captures for relevant traffic. Instead of just one device that all traffic flows through (think of a drawbridge in the “<a href=\"https://www.cloudflare.com/learning/access-management/castle-and-moat-network-security/\">castle and moat</a>” analogy) engineers may have to capture packets across many different physical and virtual devices spread across locations. Many of these packets may not allow taking pcaps at all, and then users have to try to  stitch them back together to create a full picture of their network traffic. This is a nearly impossible task today and only getting harder as networks become more fractured and complex.</p>\n            <figure class=\"kg-card kg-image-card kg-width-wide\">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2oAYhpR8RTzQKGijeIYDbq/ef76bf287f0dab98aeba0d59f7e4968a/image2-56.png\" alt=\"\" class=\"kg-image\" width=\"1802\" height=\"1001\" loading=\"lazy\"/>\n            \n            </figure><h3>On-demand packet captures from the Cloudflare global network</h3><p>With Cloudflare, you can regain this visibility. With <a href=\"https://www.cloudflare.com/magic-transit/\">Magic Transit</a> and <a href=\"https://www.cloudflare.com/magic-wan/\">Magic WAN</a>, customers route all their public and private IP traffic through Cloudflare’s network to make it more secure, faster, and more reliable, but also to increase visibility. You can think of Cloudflare like a giant, globally distributed version of the drawbridge in our old analogy: because we act as a single cloud-based router and firewall across all your traffic, we can capture packets across your entire network and deliver them back to you in one place.</p><h3>How does it work?</h3><p>Customers can request a packet capture using our <a href=\"https://developers.cloudflare.com/magic-firewall/how-to/collect-pcaps/\">Packet Captures API</a>. To get the packets you’re looking for you can provide a filter with the IP address, ports, and protocol of the packets you want.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">curl -X POST https://api.cloudflare.com/client/v4/accounts/${account_id}/pcaps \\\n-H 'Content-Type: application/json' \\\n-H 'X-Auth-Email: user@example.com' \\\n-H 'X-Auth-Key: 00000000000' \\\n--data '{\n        \"filter_v1\": {\n               \"source_address\": \"1.2.3.4\",\n               \"protocol\": 6\n        },\n        \"time_limit\": 300,\n        \"byte_limit\": \"10mb\",\n        \"packet_limit\": 10000,\n        \"type\": \"simple\",\n        \"system\": \"magic-transit\"\n}'</pre></code>\n            <p>Example of a request for packet capture using our API.</p><p>We leverage <a href=\"https://netfilter.org/projects/nftables/\">nftables</a> to apply the filter to the customer’s incoming packets and log them using <a href=\"https://www.netfilter.org/projects/libnetfilter_log/index.html\">nflog</a>:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">table inet pcaps_1 {\n    chain pcap_1 {\n        ip protocol 6 ip saddr 1.2.3.4 log group 1 comment “packet capture”\n    }\n}</pre></code>\n            <p>Example nftables configuration used to filter log customer packets</p><p>nflog creates a netfilter socket through which logs of a packet are sent from the Linux kernel to user space. In user space, we use tcpdump to read packets off the netfilter socket and generate a packet capture file:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">tcpdump -i nflog:1 -w pcap_1.pcap</pre></code>\n            <p>Example tcpdump command to create a packet capture file.</p><p>Usually tcpdump is used by listening to incoming packets on a network interface, but in our case we configure it to read packet logs from an nflog group. tcpdump will convert the packet logs into a packet capture file.</p><p>Once we have a packet capture file, we need to deliver it to customers. Because packet capture files can be large and contain sensitive information (e.g. packet payloads), we send them to customers directly from our machines to a cloud storage service of their choice. This means we never store sensitive data, and it’s easy for customers to manage and store these large files.</p><h3>Get started today</h3><p>On-demand packet captures are now generally available for customers who have purchased the Advanced features of Magic Firewall. The <a href=\"https://developers.cloudflare.com/magic-firewall/how-to/collect-pcaps/\">packet capture API</a> allows customers to capture the first 160 bytes of packets, sampled at a default rate of 1/100. More functionality including full packet captures and on-demand packet capture control in the Cloudflare Dashboard is coming in the following weeks. Contact your account team to stay updated on the latest!</p>",
		"id": "3lCeST96Ji4kMdmRbpTRav",
		"localeList": {
			"name": "Packet captures at the edge Config",
			"enUS": "English for Locale",
			"zhCN": "Translated for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "Translated for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "Today, we’re excited to announce the general availability of on-demand packet captures from Cloudflare’s global network.",
		"metadata": {
			"title": "Packet captures at the edge",
			"description": "Today, we’re excited to announce the general availability of on-demand packet captures from Cloudflare’s global network.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5lPM1gW3mAtVTOqOtnhZRH/85fe0b6d618abe2d21d4ca551031250d/packet-captures-at-edge-ptELqx.png"
		},
		"primary_author": {},
		"published_at": "2022-03-17T12:59:12.000+00:00",
		"reading_time": 4,
		"slug": "packet-captures-at-edge",
		"tags": [
			{
				"id": "3DmitkNK6euuD5BlhuvOLW",
				"name": "Security Week",
				"slug": "security-week"
			},
			{
				"id": "3OPPjcK7cKutTdeAjpThfG",
				"name": "Edge",
				"slug": "edge"
			},
			{
				"id": "6Mp7ouACN2rT3YjL1xaXJx",
				"name": "Security",
				"slug": "security"
			},
			{
				"id": "5cye1Bh5KxFh3pKSnX8Dsy",
				"name": "Serverless",
				"slug": "serverless"
			}
		],
		"title": "Packet captures at the edge",
		"updated_at": "2024-08-27T01:36:42.218Z",
		"url": "https://blog.cloudflare.com/packet-captures-at-edge"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}