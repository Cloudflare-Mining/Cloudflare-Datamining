<div class="mb2 gray5">7 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2tWD4aWiLcLAePzIx2I8RO/d669f328fe5b6fcf0c883ee4deb3f72a/image3.png" alt="">
<div class="post-content lh-copy gray1">
	<p>The transition of AI from experimental to production is not without its challenges. Developers face the challenge of balancing rapid innovation with the need to protect users and meet strict regulatory requirements. To address this, we are introducing <b>Guardrails in AI Gateway</b>, designed to help you deploy AI safely and confidently.&nbsp;</p>
	<div class="flex anchor relative">
		<h3 id="why-safety-matters">Why safety matters</h3>
		<a href="https://blog.cloudflare.com/#why-safety-matters" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>LLMs are inherently non-deterministic, meaning outputs can be unpredictable. Additionally, you have no control over your users, and they may ask for something wildly inappropriate or attempt to elicit an inappropriate response from the AI. Now, imagine launching an AI-powered application without clear visibility into the potential for harmful or inappropriate content. Not only does this risk user safety, but it also puts your brand reputation on the line.</p>
	<p>To address the unique security risks specific to AI applications, the <a href="https://genai.owasp.org/resource/owasp-top-10-for-llm-applications-2025"><u>OWASP Top 10 for Large Language Model (LLM) Applications</u></a> was created. This is an industry-driven standard that identifies the most critical security vulnerabilities specifically affecting LLM-based and generative AI applications. It’s designed to educate developers, security professionals, and organizations on the unique risks of deploying and managing these systems.</p>
	<p>The stakes are even higher with new regulations being introduced:</p>
	<ul>
		<li>
			<p><a href="https://artificialintelligenceact.eu/high-level-summary"><b><u>European Union Artificial Intelligence Act</u></b></a>: Enacted on August 1, 2024, the AI Act has a specific section on establishing a risk management system for AI systems, data governance, technical documentation, and record keeping of risks/abuse.&nbsp;</p>
		</li>
		<li>
			<p><a href="https://commission.europa.eu/strategy-and-policy/priorities-2019-2024/europe-fit-digital-age/digital-services-act_en"><b><u>European Union Digital Services Act (DSA</u></b></a><b>): </b>Adopted in 2022, the DSA is designed to enhance safety and accountability online, including mitigating the spread of illegal content and safeguarding minors from harmful content.</p>
		</li>
	</ul>
	<p>These developments emphasize why robust safety controls must be part of every AI application.</p>
	<div class="flex anchor relative">
		<h3 id="the-challenge">The challenge</h3>
		<a href="https://blog.cloudflare.com/#the-challenge" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Developers building AI applications today face a complex set of challenges, hindering their ability to create safe and reliable experiences:</p>
	<ul>
		<li>
			<p><b>Inconsistency across models: </b>The rapid advancement of AI models and providers often leads to varying built-in safety features. This inconsistency arises because different AI companies have unique philosophies, risk tolerances, and regulatory requirements. Some models prioritize openness and flexibility, while others enforce stricter moderation based on ethical and legal considerations. Factors such as company policies, regional compliance laws, fine-tuning methods, and intended use cases all contribute to these differences, making it difficult for developers to deliver a uniformly safe experience across different model providers.</p>
		</li>
		<li>
			<p><b>Lack of visibility into unsafe or inappropriate content: </b>Without proper tools, developers struggle to monitor user inputs and model outputs, making it challenging to identify and manage harmful or inappropriate content effectively when trying out different models and providers.</p>
		</li>
	</ul>
	<p>The answer? A standardized, provider-agnostic solution that offers comprehensive observability and logs in one unified interface, along with granular control over content moderation.</p>
	<div class="flex anchor relative">
		<h3 id="the-solution-guardrails-in-ai-gateway">The solution: Guardrails in AI Gateway</h3>
		<a href="https://blog.cloudflare.com/#the-solution-guardrails-in-ai-gateway" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p><a href="https://developers.cloudflare.com/ai-gateway"><u>AI Gateway</u></a> is a proxy service that sits between your AI application and its model providers (like OpenAI, Anthropic, DeepSeek, <a href="https://developers.cloudflare.com/ai-gateway/providers"><u>and more</u></a>). To address the challenges of deploying AI safely, AI Gateway has added safety guardrails which ensure a consistent and safe experience, regardless of the model or provider you use.</p>
	<p>AI Gateway gives you visibility into what users are asking, and how models are responding, through its detailed logs. This real-time observability actively monitors and assesses content, enabling proactive identification of potential issues. The Guardrails feature offers granular control over content evaluation and actions taken. Customers can define precisely which interactions to evaluate — user prompts, model responses, or both, and specify corresponding actions, including ignoring, flagging, or blocking, based on pre-defined hazard categories.</p>
	<p>Integrating Guardrails is streamlined within AI Gateway, making implementation straightforward. Rather than manually calling a moderation tool, configuring flows, and managing flagging/blocking logic, you can enable Guardrails directly from your AI Gateway settings with just a few clicks.&nbsp;</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6BX7CzkzqkhFwWS4Jk7tcQ/e1054c544eee7265d78a993a2897bc4c/image4.png" alt="" class="kg-image" width="1999" height="362" loading="lazy">
	</figure>
	<p><sup><i>Figure 1. AI Gateway settings with Guardrails turned on, displaying selected hazard categories for prompts and responses, with flagged categories in orange and blocked categories in red</i></sup></p>
	<p>Within the AI Gateway settings, developers can configure:</p>
	<ul>
		<li>
			<p><b>Guardrails</b>: Enable or disable content moderation as needed.</p>
		</li>
		<li>
			<p><b>Evaluation scope</b>: Select whether to moderate user prompts, model responses, or both.</p>
		</li>
		<li>
			<p><b>Hazard categories</b>: Specify which categories to monitor and determine whether detected inappropriate content should be blocked or flagged.</p>
		</li>
	</ul>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3QnhWk1vn1SvFsKICvb9Rd/99f0cfc6e62b1f70db1d102277d73f83/image9.png" alt="" class="kg-image" width="1013" height="770" loading="lazy">
	</figure>
	<p><sup><i>Figure 2. Advanced settings of Guardrails with granular moderation controls for different hazard categories</i></sup></p>
	<p>By implementing these guardrails within AI Gateway, developers can focus on innovation, knowing that risks are proactively mitigated and their AI applications are operating responsibly.</p>
	<div class="flex anchor relative">
		<h4 id="leveraging-llama-guard-on-workers-ai">Leveraging Llama Guard on Workers AI</h4>
		<a href="https://blog.cloudflare.com/#leveraging-llama-guard-on-workers-ai" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>The Guardrails feature is currently powered by <a href="https://ai.meta.com/research/publications/llama-guard-llm-based-input-output-safeguard-for-human-ai-conversations"><u>Llama Guard</u></a>, Meta’s open-source content moderation and safety tool, designed to detect harmful or unsafe content in both user inputs and AI-generated outputs. It provides real-time filtering and monitoring, ensuring responsible AI usage, reducing risk, and improving trust in AI-driven applications. Notably, organizations like <a href="https://mlcommons.org"><u>ML Commons</u></a> use Llama Guard to evaluate the safety of foundation models.&nbsp;</p>
	<p>Llama Guard can be used to provide protection over a wide range of content such as violence and sexually explicit material. It also helps you safeguard sensitive data as outlined in the OWASP, like addresses, Social Security numbers, and credit card details. Specifically, Guardrails on AI Gateway utilizes the <a href="https://github.com/meta-llama/PurpleLlama/blob/main/Llama-Guard3/8B/MODEL_CARD.md"><u>Llama Guard 3 8B</u></a> model hosted on <a href="https://developers.cloudflare.com/workers-ai"><u>Workers AI</u></a> — Cloudflare’s serverless, GPU-powered inference engine. Workers AI is uniquely qualified for this task because it operates on GPUs distributed across Cloudflare’s network, ensuring low-latency inference and rapid content evaluation. We plan to add additional models to power the Guardrails feature to Workers AI in the future.&nbsp;</p>
	<p>Using Guardrails incurs <a href="https://developers.cloudflare.com/workers-ai/models/llama-guard-3-8b"><u>Workers AI usage</u></a>, and that usage is reflected in your <a href="https://dash.cloudflare.com/?to=%2F%3Aaccount%2Fai%2Fworkers-ai"><u>Workers AI dashboard</u></a>, allowing developers to track their inference consumption effectively.&nbsp;</p>
	<div class="flex anchor relative">
		<h3 id="how-it-works">How it works&nbsp;</h3>
		<a href="https://blog.cloudflare.com/#how-it-works" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Functioning as a proxy between users and AI models, AI Gateway intercepts and inspects all interactions—both user prompts and model responses—for potentially harmful content.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/kzup1z7NTP4qkMXWgh8ns/b85afdfd8328f0f8c28e42058c305ecb/image5.jpg" alt="" class="kg-image" width="1200" height="1010" loading="lazy">
	</figure>
	<p><sup><i>Figure 3. Workflow diagram of Guardrails in AI Gateway, illustrating how prompts and responses are evaluated, along with the outcomes when content is deemed safe or unsafe</i></sup></p>
	<p>When a user enters a prompt, AI Gateway runs that prompt through Llama Guard on Workers AI. Behind the scenes, AI Gateway utilizes the <a href="https://developers.cloudflare.com/ai-gateway/integrations/worker-binding-methods"><u>AI Binding</u></a>, making it seamless to connect AI Gateway to Cloudflare <a href="https://developers.cloudflare.com/workers"><u>Workers</u></a> and <a href="https://developers.cloudflare.com/workers-ai"><u>Workers AI</u></a>. To provide better observability, requests to Workers AI through AI Gateway all include the <code>eventID</code> from the original request. This ensures that each request can be linked to its corresponding safety evaluations, allowing for efficient log grouping and traceability of AI interactions.&nbsp;</p>
	<p>Depending on the configured settings, AI Gateway can either flag the prompt while still allowing the request to pass through to the AI model, or block the prompt entirely, preventing it from reaching the model. Blocking harmful prompts in this way not only enhances safety, but also reduces costs by preventing unnecessary processing and token consumption. If a prompt passes the safety check, it’s forwarded to the AI model.</p>
	<p>Let’s see an example of a prompt blocked by Guardrails. In this example, the Guardrails settings have been turned on for user prompts and configured to block for multiple categories, including “Non-Violent Crimes”. The user has asked OpenAI’s <code>gpt-4o-mini </code>model to “Teach me how to steal company data without being detected”. Instead of returning a response from the model, Guardrails has identified this prompt to include content around “Non-Violent Crimes” and blocked it, returning the message “Prompt blocked due to security configurations”.&nbsp;</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/67JO7yPZ1gXOyX8u6Cx7CN/09b8ae7c7080fe7ada50bab70de4ead9/image9.png" alt="" class="kg-image" width="1279" height="763" loading="lazy">
	</figure>
	<p><sup><i>Figure 4. AI Gateway log displaying a blocked prompt classified under “Non-Violent Crimes”, with an error message indicating the prompt was blocked due to security configurations</i></sup></p>
	<p>AI Gateway determined this prompt was unsafe because the response from Workers AI Llama Guard indicated that category S2, Non-Violent Crimes, was <code>safe: false</code>. Since Guardrails was configured to block when the “Non-Violent Crimes” hazard category was detected, AI Gateway failed the request and did not send it to OpenAI. As a result, the request was unsuccessful and no token usage was incurred.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3U401FlyK3XxiySamMfNZv/0a25e547a247f352675f2d9bf4fdb9e0/image4.png" alt="" class="kg-image" width="1267" height="649" loading="lazy">
	</figure>
	<p><sup><i>Figure 5. Guardrails log of a Llama Guard 3 8B request from Workers AI, flagging category S2, as Non-Violent Crimes, with the response indicating safe: false</i></sup></p>
	<p>AI Gateway also inspects AI model responses before they reach the user, again evaluating them against the configured safety settings. Safe responses are delivered to the user. However, if any hazardous content is detected, the response is either flagged or blocked and logged in AI Gateway.&nbsp;</p>
	<p>AI Gateway leverages specialized AI models trained to recognize various forms of harmful content to ensure only safe and appropriate information is shown to users. Currently, Guardrails only works with text-based AI models.&nbsp;</p>
	<div class="flex anchor relative">
		<h3 id="deploy-with-confidence">Deploy with confidence</h3>
		<a href="https://blog.cloudflare.com/#deploy-with-confidence" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>Safely deploying AI in today’s dynamic landscape requires acknowledging that while AI models are powerful, they are also inherently non-deterministic. By leveraging Guardrails within AI Gateway, you gain:</p>
	<ul>
		<li>
			<p><b>Consistent moderation</b>: Uniform moderation layer that works across models and providers.</p>
		</li>
		<li>
			<p><b>Enhanced safety and user trust</b>: Proactively protect users from harmful or inappropriate interactions.</p>
		</li>
		<li>
			<p><b>Flexibility and control over allowed content: </b>Specify which categories to monitor and choose between flagging or outright blocking</p>
		</li>
		<li>
			<p><b>Auditing and compliance capabilities</b>: Stay ahead of evolving regulatory requirements with logs of user prompts, model responses, and enforced guardrails.</p>
		</li>
	</ul>
	<p>If you aren't yet using AI Gateway, Llama Guard is also available directly through Workers AI and will be available directly in the Cloudflare WAF in the near future.&nbsp;</p>
	<p>Looking ahead, we plan to expand Guardrails’ capabilities further, to allow users to create their own classification categories, and to include protections against prompt injection and sensitive data exposure. To begin using Guardrails, check out our <a href="https://developers.cloudflare.com/ai-gateway/guardrails"><u>developer documentation</u></a>. If you have any questions, please reach out in our <a href="https://discord.cloudflare.com"><u>Discord community.</u></a><i></i></p>
</div>