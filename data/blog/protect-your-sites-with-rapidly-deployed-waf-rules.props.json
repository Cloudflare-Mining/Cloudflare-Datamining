{
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5vGNsXzZrtSLn2X30pnpUY/a43660c54db33a4289ab5a7d99d3d414/john-graham-cumming.jpg",
				"location": "Lisbon, Portugal",
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "An attack on your site could be catastrophic. Even a small attack can have major implications. Responding quickly to an attack is imperative.\n\n",
		"feature_image": "https:undefined",
		"featured": false,
		"html": "<p><i>This blog post originally appeared as a </i><a href=\"http://www.rackspace.com/blog/protect-your-sites-with-rapidly-deployed-waf-rules/\"><i>guest post</i></a><i> on the </i><a href=\"http://www.rackspace.com/blog/\"><i>Rackspace blog</i></a></p><p>An attack on your site could be catastrophic. Even a small attack can have major implications. Responding quickly to an attack is imperative.</p><p>In August 2013, we at CloudFlare rolled out a new global <a href=\"/cloudflares-new-waf-compiling-to-lua\">Web Application Firewall</a> (WAF) that runs common sets of firewall rules such as the open source <a href=\"https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project\">OWASP</a> rules that protect against SQL injection, cross-site scripting and more. But the WAF also has a custom rule language that CloudFlare’s support engineers use to write one-of-a-kind rules to protect specific customers or specific software.</p><p>Since the deployment of the new WAF we’ve rolled out many global and customer-specific rules to protect websites from attacks. This blog post looks at a few of them and the process of getting a custom rule deployed.</p><h3>Custom Rules For Customers</h3><p>Commonly, a customer will complain of an attack that’s hitting their web site and will provide us with their web server logs showing the attack (or by giving us permission to examine the traffic going to their web site). The logs will often show a common pattern. For example, here’s an anonymized attack against a customer web site showing up in their logs:</p><p>12/30 01:42:32 23.75.345.200 example.com /index.php?2346354=-349087 WordPress/3.7.2\n12/30 01:42:31 23.75.345.200 example.com /index.php?7231344=4454226 WordPress/3.3.1\n12/30 01:42:25 23.75.345.200 example.com /index.php?1243847=9161112 WordPress/3.7.2\n12/30 01:42:23 23.75.345.200 example.com /index.php?8809549=4423410 WordPress/3.3.1\n12/30 01:42:21 23.75.345.200 example.com /index.php?1834306=3447145 WordPress/3.5.1\n12/30 01:42:16 23.75.345.200 example.com /index.php?-234069=6121852 WordPress/3.3.3\n12/30 01:42:16 23.75.345.200 example.com /index.php?-152536=6922268 WordPress/3.3.1\n12/30 01:42:14 23.75.345.200 example.com /index.php?3433701=7147876 WordPress/3.4.2\n12/30 01:42:14 23.75.345.200 example.com /index.php?6732828=-106444 WordPress/3.2.2</p><p>The attacker was using a botnet to hit the script /index.php on example.com. To make each request different they are appending a query string in the form number=number where each number is randomly chosen. The User-Agent in the requests is spoofed to look like WordPress.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/7aspwt221CBPj5b2BZCkK2/74543c4c3e0bf0951e8d33e2164b167b/cloudflare.1.png\" alt=\"\" class=\"kg-image\" width=\"661\" height=\"98\" loading=\"lazy\"/>\n            \n            </figure><p>Although this attack doesn’t cause CloudFlare a problem it can cause the customer’s web server to become overloaded. The customer contacted us and we put in place a custom rule for them that blocks the attack. The rule looks like this:</p><p>rule 12345678 WordPress Numbers Botnet\nREQUEST_HEADERS:User-Agent matches ^WordPress\\/ and\nREQUEST_METHOD is GET and\nREQUEST_URI matches /index.php\\?-?\\d+=-?\\d+\ndeny</p><p>The support engineer wrote the rule (and an associated set of tests to make sure that it works correctly) and then pushed the rule to our git repository. From there it gets deployed to CloudFlare’s servers around the world in under 30 seconds.</p><p>The customer sees the rule appear in the Manage WAF page in CloudFlare Settings. They can turn the rule on and off and see how many times it has activated (i.e. blocked a request).</p><p>Another customer saw an attack that claimed to come from “Anonymous.” The attack hit the same page on their web server over and over again with a message from Anonymous (in French). A typical request looked like this:</p><p>example.com/?msg=Nous%20sommes%20Anonymous%20Nous%20sommes%20L%C3%A9g\nion%20Nous%20ne%20pardonnons%20pas%20Nous%20n%E2%80%99oublions%20pas</p><p>The rule for this one was simple:</p><p>rule 12345679 Anonymous attack\nREQUEST_METHOD is GET and\nREQUEST_URI begins /?msg=Nous%20sommes%20Anonymous\ndeny</p><p>Another simple attack that was very troublesome for the customer came in the form of a POST request to a URL that didn’t exist on the customer’s site. Once again, the request rate wasn’t troublesome for CloudFlare, but was for the customer, so we put in place a rule that would block all POSTs to that URL. This took the load off the customer web site: CloudFlare took the load for them.</p><p>The attack used a botnet to send the request POST /q to the customer’s web site. The rule to block that was very simple.</p><p>rule 1234567A Simple POST botnet\nREQUEST_METHOD is POST and\nREQUEST_URI is /q\ndeny</p><p>As simple as that looks, it took the load off the customer’s web server and in the first 12 hours after deployment was activated over 27 million times!</p><h3>Custom Global Rules</h3><p>Other attacks are likely to be much more widespread and not focused on a single customer. These attacks are often directed at specific technologies such as WordPress, Joomla or other software.</p><p>Back in October a <a href=\"http://blog.whmcs.com/?t=79427\">zero-day exploit for WHMCS</a> (the popular web hosting management software) was released. CloudFlare patched that by <a href=\"/patching-a-whmcs-zero-day-on-day-zero\">deploying</a> a complex WAF rule on the day the zero-day became public. The WHMCS maintainers also patched the problem.</p><p>Shortly after that, two new WHMCS vulnerabilities were found and we patched them as well by deploying or modifying WHMCS WAF rules.</p><p>We’ve also added custom rules to protect Plone-based web sites, a PHP 5.x <a href=\"http://www.exploit-db.com/exploits/29290/\">remote code execution</a> exploit, and a number of other rules to protect against common botnets and other attack software.</p><p>All those are on top of the generic protection offered by the 2,372 other rules that CloudFlare’s WAF runs to check every request.</p><h3>Conclusion</h3><p>The flexibility of the CloudFlare WAF language and the ability to deploy WAF rules in seconds means we can respond to attacks very rapidly. Visit our learning center to learn more about <a href=\"https://www.cloudflare.com/learning/ddos/glossary/web-application-firewall-waf/\">Web Application Firewalls</a>.</p>",
		"id": "3xJD4CNCEk8BdEkSDblBx6",
		"localeList": {
			"name": "Protect Your Sites With Rapidly Deployed WAF Rules Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2014-01-21T16:00:00.000+00:00",
		"reading_time": 3,
		"slug": "protect-your-sites-with-rapidly-deployed-waf-rules",
		"tags": [
			{
				"id": "7gPQ1MtyU85B0FNCOHq6ju",
				"name": "WAF Rules",
				"slug": "waf-rules"
			},
			{
				"id": "ddJrV1bYzbMmaXkRKrp3G",
				"name": "Tech Talks",
				"slug": "tech-talks"
			},
			{
				"id": "lGCLqAT2SMojMzw5b6aio",
				"name": "WAF",
				"slug": "waf"
			},
			{
				"id": "2UVIYusJwlvsmPYl2AvSuR",
				"name": "Deep Dive",
				"slug": "deep-dive"
			}
		],
		"title": "Protect Your Sites With Rapidly Deployed WAF Rules",
		"updated_at": "2024-08-27T02:44:01.586Z",
		"url": "https://blog.cloudflare.com/protect-your-sites-with-rapidly-deployed-waf-rules"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}