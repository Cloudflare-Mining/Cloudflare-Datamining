<div class="mb2 gray5">3 min read</div><img class="mr2" src="https:undefined" alt="">
<div class="post-content lh-copy gray1">
	<p>Three vulnerabilities were disclosed as <a href="https://cpdos.org">Cache Poisoning Denial of Service</a> attacks in a paper written by Hoai Viet Nguyen, Luigi Lo Iacono, and Hannes Federrath of TH Köln - University of Applied Sciences. These attacks are similar to the cache poisoning attacks presented last year at DEFCON. <a href="https://blog.cloudflare.com/cache-poisoning-protection">Our blog post</a> in response to those attacks includes a detailed description of what a cache poisoning attack is.</p>
	<p><b>Most customers do not have to take any action to protect themselves from the newly disclosed vulnerabilities</b>. Some configuration changes are recommended if you are a Cloudflare customer running unpatched versions of Microsoft IIS and have <a href="https://docs.microsoft.com/en-us/iis/configuration/system.webserver/security/requestfiltering/requestlimits/headerlimits/add">request filtering</a> enabled on your origin or have forced caching of HTTP response code 400 through the use of Cloudflare Workers.</p>
	<p>We have not seen any attempted exploitation of the vulnerabilities described in this paper.</p>
	<p>Maintaining the integrity of our content caching infrastructure and ensuring our customers are able to quickly and reliably serve the content they expect to their visitors is of paramount importance to us. In practice, Cloudflare ensures caches serve the content they should in two ways:</p>
	<ol>
		<li>
			<p>We build our caching infrastructure to behave in ways compliant with industry standards.</p>
		</li>
		<li>
			<p>We actively add defenses to our caching logic to protect customers from common caching pitfalls. We see our job as solving customer problems whenever possible, even if they’re not directly related to using Cloudflare. Examples of this philosophy can be found in how we <a href="https://blog.cloudflare.com/cache-poisoning-protection">addressed</a> <a href="https://blog.cloudflare.com/web-cache-deception-attack-revisited">previously</a> discovered cache attack techniques.</p>
		</li>
	</ol>
	<p>A summary of the three attacks disclosed in the paper and how Cloudflare handles them:</p>
	<p><b><b><b>HTTP Header Method Override (HMO)</b></b></b><b><b>:</b></b></p>
	<ul>
		<li>
			<p><b><b><b>Impact:</b></b></b> Some web frameworks support headers for overriding the HTTP method sent in the HTTP request. Ex: A GET request sent with <code>X-HTTP-Method: POST</code> will be treated by the origin as a POST request (this is not a standard but something many frameworks support). An attacker can use this behavior to potentially trick a <a href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn">CDN</a> into caching poisoned content.</p>
		</li>
		<li>
			<p><b><b><b>Mitigation:</b></b></b> We include the following method override headers as part of customer cache keys for requests which include the headers. This ensures that requests made with the headers present do not poison cache contents for requests without them. Note that Cloudflare does <i>not</i> interpret these headers as an actual method override (ie. the GET request in the above example stays a GET request in our eyes). Headers we consider as part of this cache key modification logic are:</p>
			<ol>
				<li>
					<p>X-HTTP-Method-Override</p>
				</li>
				<li>
					<p>X-HTTP-Method</p>
				</li>
				<li>
					<p>X-Method-Override</p>
				</li>
			</ol>
		</li>
	</ul>
	<p><b><b><b>Oversized HTTP Headers (HHO)</b></b></b><b><b>:</b></b></p>
	<ul>
		<li>
			<p><b><b><b>Impact:</b></b></b> The attacker sends large headers that a CDN passes through to origin, but are too large for the origin server to handle. If in this case the origin returns an error page that a shared cache deems cacheable it can result in denial of service for subsequent visitors.</p>
		</li>
		<li>
			<p><b><b><b>Mitigation:</b></b></b> Cloudflare does not cache HTTP status code 400 responses by default, which is the common denial of service vector called out by the exploit authors. Some CDN vendors <i>did</i> cache 400 responses, which created the poisoning vector called out by the exploit authors. Cloudflare customers were never vulnerable if their origins emitted 400 errors in response to oversized headers.</p>
			<p>The one exception to this is Microsoft IIS in specific circumstances. Versions of Microsoft IIS that have not applied the <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0941">security update</a> for CVE-2019-0941 will return an HTTP 404 response if limits are configured and exceeded for individual request header sizes using the <a href="https://docs.microsoft.com/en-us/iis/configuration/system.webserver/security/requestfiltering/requestlimits/headerlimits/add">“headerLimits” configuration directive</a>. Shared caches are permitted to cache these 404 responses. We recommend either upgrading IIS or removing headerLimits configuration directives on your origin.</p>
		</li>
	</ul>
	<p><b><b><b>HTTP Meta Characters</b></b></b><b><b>:</b></b></p>
	<ul>
		<li>
			<p><b><b><b>Impact:</b></b></b> Essentially the same attack as oversized HTTP headers, except the attack uses meta characters like <code>\r</code> and <code>\n</code> to cause origins to return errors to shared caches.</p>
		</li>
		<li>
			<p><b><b><b>Mitigation:</b></b></b> Same as oversized HTTP headers; Cloudflare does not cache 400 errors by default.</p>
		</li>
	</ul>
	<p>In addition to the behavior laid out above, Cloudflare’s caching logic <a href="https://support.cloudflare.com/hc/en-us/articles/115003206852-Enabling-Origin-Cache-Control-with-Cloudflare-Page-Rules">respects origin Cache-Control headers</a>, which allows customers extremely granular control over how our caches behave. We actively work with customers to ensure that they are following best practices for avoiding cache poisoning attacks and add defense in depth through smarter software whenever possible.</p>
	<p>We look forward to continuing to work with the security community on issues like those discovered to make the Internet safer and more secure for everyone.</p>
</div>