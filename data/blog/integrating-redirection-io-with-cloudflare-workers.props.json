{
	"initialReadingTime": "3",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Guest Author",
				"slug": "guest-author",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/YJzTr2p8aLvtEX5J7CysP/8be54016d68bd43aa5b327f0382f5827/guest-author.png",
				"location": null,
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "Redirection.io is a Web traffic redirection manager. It provides a collection of tools for website administrators, SEO agencies, and developers, which help analyze HTTP errors, setup HTTP redirections, customize HTTP responses, and monitor the traffic efficiently.",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6Iuge2F8aQRmCIDvci80Lu/887f8825d4df01ce64f687184d283004/integrating-redirection-io-with-cloudflare-workers.png",
		"featured": false,
		"html": "<p><i>The following is a guest post by </i><a href=\"https://twitter.com/xavierlacot\"><i>Xavier Lacot</i></a><i>, a developer at </i><a href=\"https://redirection.io/\"><i>redirection.io</i></a><i> and founder at </i><a href=\"https://jolicode.com/\"><i>JoliCode</i></a><i>. He works primarily on Web and mobile projects as a consultant, trainer and technical expert.</i></p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"what-is-redirection-io\">What is redirection.io</h3>\n            <a href=\"#what-is-redirection-io\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Redirection.io is a Web traffic redirection manager. It provides a collection of tools for website administrators, SEO agencies, and developers, which help analyze HTTP errors, setup HTTP redirections, customize HTTP responses, and monitor the traffic efficiently.</p><p>The main part of a traditional redirection.io setup is the proxy, a software component which parses every request to check if a redirection or another response override is required. This &quot;proxy&quot; can be of several types - we <a href=\"https://redirection.io/documentation/developer-documentation/integrations\">provide libraries in several languages</a> - but this setup can be simplified for Cloudflare clients by taking advantage of Cloudflare Workers.</p>\n          <div class=\"flex anchor relative\">\n            <h3 id=\"here-come-cloudflare-workers\">Here come Cloudflare Workers</h3>\n            <a href=\"#here-come-cloudflare-workers\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Earlier this year, Cloudflare unveiled its <a href=\"https://www.cloudflare.com/fr-fr/products/cloudflare-workers/\">Workers</a> product, a smart way of running code <i>on the edge</i> of Cloudflare locations. This computing feature is particularly interesting, as it allows performing several traffic operations without requiring any change on your own platform, code, or infrastructure: just enable Workers, write some code, and let Cloudflare handle the magic ✨</p><p>In practical terms, Workers act as application middleware. They proxy incoming HTTP requests to your stack, and can modify both requests and responses. Cloudflare has <a href=\"https://developers.cloudflare.com/workers/recipes/\">examples and code ideas</a> to help you build your own Worker.</p><p>Here is a very basic Cloudflare Worker:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">addEventListener(&#039;fetch&#039;, event =&gt; {\n  event.respondWith(handleRequest(event.request))\n})\n\nasync function handleRequest(request) {\n  console.log(&#039;Got request&#039;, request)\n  const response = await fetch(request)\n  console.log(&#039;Got response&#039;, response)\n  return response\n}</pre></code>\n            <p>Luckily, redirection.io already has a public HTTP endpoint for exposing hosted agents (for shared hosting, for instance, where it is impossible to install your own binaries). Offering redirection.io to all Cloudflare Workers users is as simple as querying our hosted agent at each incoming request:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/7xa23T55yNTFqNt71UL4He/e4d176c55bf3e9840639c5d5186e5928/cloudflare-redirectionio.png\" alt=\"Integration of redirection.io with Clourdflare Workers\" class=\"kg-image\" width=\"778\" height=\"723\" loading=\"lazy\"/>\n            \n            </figure><p>In terms of code, the pattern we use is very similar to the Workers example: we listen on the incoming request:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">addEventListener(&#039;fetch&#039;, (event) =&gt; {\n    event.respondWith(redirectAndLog(event.request));\n});\n\nasync function redirectAndLog(request) {\n    const response = await redirectOrPass(request);\n    log(request, response);\n\n    return response;\n}</pre></code>\n            <p>Of course, we must implement the <code>redirectOrPass()</code> and <code>log()</code> functions, which will do all the magic:</p><ul><li><p><code>redirectOrPass()</code> queries redirection.io&#39;s API to know if some action has to be run for the current request, and lets the request pass if necessary. This call is blocking; it will stop the request until a response is received from redirection.io&#39;s backend.</p></li><li><p><code>log()</code> sends out log data to our backend for analysis and statistics purpose. This call is non-blocking, as it can be executed even after the response has been sent to the user.</p></li></ul><p>Hence, both of these functions are defined as asynchronous non-blocking functions:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">async function redirectOrPass(request) {\n    ...\n}\n\nasync function log(request, response) {\n    ...\n}</pre></code>\n            <p>Let&#39;s go with the <code>redirectOrPass()</code> implementation! Using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\">fetch API</a>, we can call redirection.io&#39;s agent API:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">const urlObject = new URL(request.url);\nconst context = {\n    &#039;host&#039;: urlObject.host,\n    &#039;request_uri&#039;: urlObject.pathname,\n    &#039;user_agent&#039;: request.headers.get(&#039;user-agent&#039;),\n    &#039;scheme&#039;: urlObject.protocol.includes(&#039;https&#039;) ? &#039;https&#039; : &#039;http&#039;\n};\nlet response = null;\n\ntry {\n    response = await fetch(&#039;https://proxy.redirection.io/&#039; + options.token + &#039;/get&#039;, {\n        method: &#039;POST&#039;,\n        body: JSON.stringify(context),\n    });\n} catch (error) {\n    // if no action found, play the regular request\n    return await fetch(request);\n}</pre></code>\n            <p>Should our API respond with a <code>404</code> status (which means that no redirection or action rule is defined for a request of that type), we simply return the standard response from your website&#39;s backend - this is achieved with <code>return await fetch(request)</code></p><p>If a redirection has to be run, redirection.io&#39;s API will send a status <code>200</code> response with all the information on how to transform the response. The payload could, for instance, look like:</p>\n            <pre class=\"language-json\"><code class=\"language-json\">{\n  &quot;status_code&quot;: 302,\n  &quot;location&quot;: &quot;/blog-yo&quot;\n}</pre></code>\n            <p>... and we can simply use it to change the response:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">const data = await response.text();\n\ntry {\n    response = JSON.parse(data);\n} catch (error) {\n    // If some errors, play the regular request\n    return await fetch(request);\n}\n\n// Send gone response\nif (response.status_code === 410) {\n    return new Response(&#039;&#039;, { status: 410 });\n}\n\n// Send redirection response\nreturn new Response(&#039;&#039;, {\n    status: Number(response.status_code),\n    headers: {\n        &#039;Location&#039;: response.location\n    }\n});</pre></code>\n            <p>The <code>log()</code> function implementation is pretty similar:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">async function log(request, response) {\n    const urlObject = new URL(request.url);\n    const context = {\n        &#039;status_code&#039;: response.status,\n        &#039;host&#039;: urlObject.host,\n        &#039;request_uri&#039;: urlObject.pathname,\n        &#039;user_agent&#039;: request.headers.get(&#039;user-agent&#039;),\n        &#039;scheme&#039;: urlObject.protocol.includes(&#039;https&#039;) ? &#039;https&#039; : &#039;http&#039;,\n    };\n\n    try {\n        return await fetch(&#039;https://proxy.redirection.io/&#039; + options.token + &#039;/log&#039;, {\n            method: &#039;POST&#039;,\n            body: JSON.stringify(context),\n        });\n    } catch (error) {\n        // do nothing, does not matter if some logs are lost\n    }\n}</pre></code>\n            \n          <div class=\"flex anchor relative\">\n            <h3 id=\"impacts-and-performance-concerns\">Impacts and performance concerns</h3>\n            <a href=\"#impacts-and-performance-concerns\" aria-hidden=\"true\" class=\"relative sm:absolute sm:-left-5\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\"></path></svg>\n            </a>\n          </div>\n        <p>Cloudflare workers run <i>very fast</i>. And by &quot;very fast&quot;, we mean in microseconds, with the ability for Cloudflare to execute &quot;many thousands of Worker scripts per second&quot; as stated in their documentation.</p><p>The stack behind redirection.io is also very efficient, able to manage a similar level of traffic without any latency nor slowdown. However, there can be an occasional network slowdown, which could hurt the perceived performance of your web application. There are several ways to mitigate this possible impact.</p><p>First, Cloudflare Workers support caching subrequests made with the Fetch API. This means that, if a url of your application is often hit (for instance the homepage), you may want to cache the result from redirection.io&#39;s API. With this approach, the impact on the vast majority of your incoming requests will be close to zero.</p><p>Another approach is possible, to define the maximum timing overhead using redirection.io will add: we can simply define a timeout to the <code>fetch()</code> calls made by our Service Worker! Just nest the <code>fetch()</code> call inside a <code>Promise.race()</code>:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">response = await fetch(&#039;https://proxy.redirection.io/&#039; + options.token + &#039;/get&#039;, {\n    method: &#039;POST&#039;,\n    body: JSON.stringify(context),\n});</pre></code>\n            <p>becomes:</p>\n            <pre class=\"language-js\"><code class=\"language-js\">response = await Promise.race([\n  fetch(&#039;https://proxy.redirection.io/&#039; + options.token + &#039;/get&#039;, {\n    method: &#039;POST&#039;,\n    body: JSON.stringify(context),\n  }),\n  new Promise((_, reject) =&gt;\n    setTimeout(() =&gt; reject(new Error(&#039;Timeout&#039;)), options.timeout)\n  ),\n])</pre></code>\n            <p>When talking about performance, it is a good idea to provide some numbers for a valid comparison:</p><p>Cloudflare enabled</p><p>Workers enabled</p><p>Request timing</p><p>✅</p><p>❌</p><p>~32ms</p><p>✅</p><p>✅ (empty worker)</p><p>~36ms</p><p>✅</p><p>✅ (redirection.io Worker with no cache)</p><p>~44ms</p><p>This means that you can benefit from redirection.io on your website through Cloudflare workers at the price of ~8ms. And, once responses from redirection.io&#39;s api are cached, we do not notice any difference compared to a standard Cloudflare-enabled website. We strongly believe Cloudflare Workers is an amazing way to integrate redirection.io into your website. Try <a href=\"https://redirection.io/\">redirection.io</a> and <a href=\"https://www.cloudflare.com/products/cloudflare-workers/\">Cloudflare Workers</a> today, and report back!</p>",
		"id": "2p8SdFZjHHCPeScimj3Nss",
		"localeList": {
			"name": "Integrating redirection.io with Cloudflare Workers Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2018-08-21T18:56:39.000+01:00",
		"slug": "integrating-redirection-io-with-cloudflare-workers",
		"tags": [
			{
				"id": "5cye1Bh5KxFh3pKSnX8Dsy",
				"name": "Serverless",
				"slug": "serverless"
			},
			{
				"id": "6hbkItfupogJP3aRDAq6v8",
				"name": "Cloudflare Workers",
				"slug": "workers"
			},
			{
				"id": "78aSAeMjGNmCuetQ7B4OgU",
				"name": "JavaScript",
				"slug": "javascript"
			},
			{
				"id": "4tupeo5aQFnOvZQycFFFWI",
				"name": "SEO",
				"slug": "seo"
			},
			{
				"id": "4HIPcb68qM0e26fIxyfzwQ",
				"name": "Developers",
				"slug": "developers"
			},
			{
				"id": "3JAY3z7p7An94s6ScuSQPf",
				"name": "Developer Platform",
				"slug": "developer-platform"
			}
		],
		"title": "Integrating redirection.io with Cloudflare Workers",
		"updated_at": "2024-08-27T02:20:05.727Z",
		"url": "https://blog.cloudflare.com/integrating-redirection-io-with-cloudflare-workers"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"search.clear": "Clear",
		"search.filter": "Filter",
		"search.source": "Source",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"search.filters": "Filters",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"search.language": "Language",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"search.result_stat": "Results <strong>{search_range}</strong> of <strong>{search_total}</strong> for <strong>{search_keyword}</strong>",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"search.source_location": "Source/Location",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}